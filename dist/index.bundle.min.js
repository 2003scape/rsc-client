!function(){var t=function(t){var e;return function(i){return e||t(e={exports:{},parent:i},e.exports),e.exports}},e=t((function(t,L){t.exports=function(t){const L=((M=e({})).appearance=B({}),M.bank=A({}),M["close-connection"]=k({}),M.death=v({}),M.duel=x({}),M.index=e({}),M.inventory=T({}),M["logout-deny"]=I({}),M.messages=S({}),M["option-list"]=C({}),M["player-stats"]=b({}),M.prayer=y({}),M["region-entity-update"]=w({}),M["region-ground-items"]=g({}),M["region-npc-update"]=f({}),M["region-npcs"]=p({}),M["region-objects"]=m({}),M["region-player-update"]=d({}),M["region-players"]=u({}),M["region-wall-objects"]=c({}),M.settings=l({}),M.shop=h({}),M.sleep=a({}),M.social=o({}),M.sound=n({}),M["teleport-bubble"]=r({}),M.trade=s({}),M["world-info"]=i({}),M);var M;const E={};for(const[e,i]of Object.entries(L))if(!/^_|index/.test(e))for(const[s,r]of Object.entries(i))E[s]=r.bind(t);return E}})),i=t((function(t,e){t.exports={[Mr.WORLD_INFO]:function(t){this.loadingArea=!0,this.localPlayerServerIndex=Li.getUnsignedShort(t,1),this.planeWidth=Li.getUnsignedShort(t,3),this.planeHeight=Li.getUnsignedShort(t,5),this.planeIndex=Li.getUnsignedShort(t,7),this.planeMultiplier=Li.getUnsignedShort(t,9),this.planeHeight-=this.planeIndex*this.planeMultiplier}}})),s=t((function(t,e){t.exports={[Mr.TRADE_OPEN]:function(t){const e=Li.getUnsignedShort(t,1);null!==this.playerServer[e]&&(this.tradeRecipientName=this.playerServer[e].name),this.showDialogTrade=!0,this.tradeRecipientAccepted=!1,this.tradeAccepted=!1,this.tradeItemsCount=0,this.tradeRecipientItemsCount=0},[Mr.TRADE_CLOSE]:function(){this.showDialogTrade=!1,this.showDialogTradeConfirm=!1},[Mr.TRADE_ITEMS]:function(t){this.tradeRecipientItemsCount=255&t[1];let e=2;for(let i=0;i<this.tradeRecipientItemsCount;i++)this.tradeRecipientItems[i]=Li.getUnsignedShort(t,e),e+=2,this.tradeRecipientItemCount[i]=Li.getUnsignedInt(t,e),e+=4;this.tradeRecipientAccepted=!1,this.tradeAccepted=!1},[Mr.TRADE_RECIPIENT_STATUS]:function(t){this.tradeRecipientAccepted=!!t[1]},[Mr.TRADE_STATUS]:function(t){this.tradeAccepted=!!t[1]},[Mr.TRADE_CONFIRM_OPEN]:function(t){this.showDialogTradeConfirm=!0,this.tradeConfirmAccepted=!1,this.showDialogTrade=!1;let e=1;this.tradeRecipientConfirmHash=Li.getUnsignedLong(t,e),e+=8,this.tradeRecipientConfirmItemsCount=255&t[e++];for(let i=0;i<this.tradeRecipientConfirmItemsCount;i++)this.tradeRecipientConfirmItems[i]=Li.getUnsignedShort(t,e),e+=2,this.tradeRecipientConfirmItemCount[i]=Li.getUnsignedInt(t,e),e+=4;this.tradeConfirmItemsCount=255&t[e++];for(let i=0;i<this.tradeConfirmItemsCount;i++)this.tradeConfirmItems[i]=Li.getUnsignedShort(t,e),e+=2,this.tradeConfirmItemCount[i]=Li.getUnsignedInt(t,e),e+=4}}})),r=t((function(t,e){t.exports={[Mr.TELEPORT_BUBBLE]:function(t){if(this.teleportBubbleCount<50){const e=255&t[1],i=t[2]+this.localRegionX,s=t[3]+this.localRegionY;this.teleportBubbleType[this.teleportBubbleCount]=e,this.teleportBubbleTime[this.teleportBubbleCount]=0,this.teleportBubbleX[this.teleportBubbleCount]=i,this.teleportBubbleY[this.teleportBubbleCount]=s,this.teleportBubbleCount++}}}})),n=t((function(t,e){t.exports={[Mr.SOUND]:function(t,e){const i=(s=t.slice(1,e),Array.from(s).map(t=>String.fromCharCode(t)).join(""));var s;this.playSoundFile(i)}}})),o=t((function(t,e){t.exports={[Mr.FRIEND_LIST]:function(t){this.friendListCount=Li.getUnsignedByte(t[1]);for(let e=0;e<this.friendListCount;e++)this.friendListHashes[e]=Li.getUnsignedLong(t,2+9*e),this.friendListOnline[e]=Li.getUnsignedByte(t[10+9*e]);this.sortFriendsList()},[Mr.FRIEND_STATUS_CHANGE]:function(t){const e=Li.getUnsignedLong(t,1),i=255&t[9];for(let s=0;s<this.friendListCount;s++)if(this.friendListHashes[s].equals(e))return 0===this.friendListOnline[s]&&0!==i&&this.showServerMessage(`@pri@${Li.hashToUsername(e)} has logged in`),0!==this.friendListOnline[s]&&0===i&&this.showServerMessage(`@pri@${Li.hashToUsername(e)} has logged out`),this.friendListOnline[s]=i,void this.sortFriendsList();this.friendListHashes[this.friendListCount]=e,this.friendListOnline[this.friendListCount]=i,this.friendListCount++,this.sortFriendsList()},[Mr.FRIEND_MESSAGE]:function(t,e){const i=Li.getUnsignedLong(t,1),s=Li.getUnsignedInt(t,9);for(let n=0;n<this.maxSocialListSize;n++)if(this.messageTokens[n]===s)return;this.messageTokens[this.messageIndex]=s,this.messageIndex=(this.messageIndex+1)%cs.maxSocialListSize;let r=Cr.descramble(t,13,e-13);this.options.wordFilter&&(r=Ks.filter(r)),this.showServerMessage(`@pri@${Li.hashToUsername(i)}: tells you ${r}`)},[Mr.IGNORE_LIST]:function(t){this.ignoreListCount=Li.getUnsignedByte(t[1]);for(let e=0;e<this.ignoreListCount;e++)this.ignoreList[e]=Li.getUnsignedLong(t,2+8*e)}}})),a=t((function(t,e){t.exports={[Mr.SLEEP_OPEN]:function(t){this.isSleeping||(this.fatigueSleeping=this.statFatigue),this.isSleeping=!0,this.inputTextCurrent="",this.inputTextFinal="",this.surface.readSleepWord(this.spriteTexture+1,t),this.sleepingStatusText=null},[Mr.SLEEP_CLOSE]:function(){this.isSleeping=!1},[Mr.SLEEP_INCORRECT]:function(){this.sleepingStatusText="Incorrect - Please wait..."},[Mr.PLAYER_STAT_FATIGUE_ASLEEP]:function(t){this.fatigueSleeping=Li.getUnsignedShort(t,1)}}})),h=t((function(t,e){t.exports={[Mr.SHOP_OPEN]:function(t){this.showDialogShop=!0;let e=1;const i=255&t[e++],s=t[e++];this.shopSellPriceMod=255&t[e++],this.shopBuyPriceMod=255&t[e++];for(let r=0;r<40;r++)this.shopItem[r]=-1;for(let r=0;r<i;r++)this.shopItem[r]=Li.getUnsignedShort(t,e),e+=2,this.shopItemCount[r]=Li.getUnsignedShort(t,e),e+=2,this.shopItemPrice[r]=t[e++];if(1===s){let t=39;for(let e=0;e<this.inventoryItemsCount&&!(t<i);e++){let i=!1;for(let t=0;t<40;t++)if(this.shopItem[t]===this.inventoryItemId[e]){i=!0;break}10===this.inventoryItemId[e]&&(i=!0),i||(this.shopItem[t]=32767&this.inventoryItemId[e],this.shopItemCount[t]=0,this.shopItemPrice[t]=0,t--)}}this.shopSelectedItemIndex>=0&&this.shopSelectedItemIndex<40&&this.shopItem[this.shopSelectedItemIndex]!==this.shopSelectedItemType&&(this.shopSelectedItemIndex=-1,this.shopSelectedItemType=-2)},[Mr.SHOP_CLOSE]:function(){this.showDialogShop=!1}}})),l=t((function(t,e){t.exports={[Mr.PRIVACY_SETTINGS]:function(t){this.settingsBlockChat=t[1],this.settingsBlockPrivate=t[2],this.settingsBlockTrade=t[3],this.settingsBlockDuel=t[4]},[Mr.GAME_SETTINGS]:function(t){this.optionCameraModeAuto=!!Li.getUnsignedByte(t[1]),this.optionMouseButtonOne=!!Li.getUnsignedByte(t[2]),this.optionSoundDisabled=!!Li.getUnsignedByte(t[3])}}})),c=t((function(t,e){t.exports={[Mr.REGION_WALL_OBJECTS]:function(t,e){for(let i=1;i<e;)if(255===Li.getUnsignedByte(t[i])){let e=0;const s=this.localRegionX+t[i+1]>>3,r=this.localRegionY+t[i+2]>>3;i+=3;for(let t=0;t<this.wallObjectCount;t++){const i=(this.wallObjectX[t]>>3)-s,n=(this.wallObjectY[t]>>3)-r;0!==i||0!==n?(t!==e&&(this.wallObjectModel[e]=this.wallObjectModel[t],this.wallObjectModel[e].key=e+1e4,this.wallObjectX[e]=this.wallObjectX[t],this.wallObjectY[e]=this.wallObjectY[t],this.wallObjectDirection[e]=this.wallObjectDirection[t],this.wallObjectId[e]=this.wallObjectId[t]),e++):(this.scene.removeModel(this.wallObjectModel[t]),this.world.removeWallObject(this.wallObjectX[t],this.wallObjectY[t],this.wallObjectDirection[t],this.wallObjectId[t]))}this.wallObjectCount=e}else{const e=Li.getUnsignedShort(t,i);i+=2;const s=this.localRegionX+t[i++],r=this.localRegionY+t[i++],n=t[i++];let o=0;for(let t=0;t<this.wallObjectCount;t++)this.wallObjectX[t]!==s||this.wallObjectY[t]!==r||this.wallObjectDirection[t]!==n?(t!==o&&(this.wallObjectModel[o]=this.wallObjectModel[t],this.wallObjectModel[o].key=o+1e4,this.wallObjectX[o]=this.wallObjectX[t],this.wallObjectY[o]=this.wallObjectY[t],this.wallObjectDirection[o]=this.wallObjectDirection[t],this.wallObjectId[o]=this.wallObjectId[t]),o++):(this.scene.removeModel(this.wallObjectModel[t]),this.world.removeWallObject(this.wallObjectX[t],this.wallObjectY[t],this.wallObjectDirection[t],this.wallObjectId[t]));if(this.wallObjectCount=o,65535!==e){this.world._setObjectAdjacency_from4(s,r,n,e);const t=this.createModel(s,r,n,e,this.wallObjectCount);this.wallObjectModel[this.wallObjectCount]=t,this.wallObjectX[this.wallObjectCount]=s,this.wallObjectY[this.wallObjectCount]=r,this.wallObjectId[this.wallObjectCount]=e,this.wallObjectDirection[this.wallObjectCount++]=n}}}}})),u=t((function(t,e){t.exports={[Mr.REGION_PLAYERS]:function(t,e){this.knownPlayerCount=this.playerCount;for(let l=0;l<this.knownPlayerCount;l++)this.knownPlayers[l]=this.players[l];let i=8;this.localRegionX=Li.getBitMask(t,i,11),i+=11,this.localRegionY=Li.getBitMask(t,i,13),i+=13;const s=Li.getBitMask(t,i,4);i+=4;const r=this.loadNextRegion(this.localRegionX,this.localRegionY);this.localRegionX-=this.regionX,this.localRegionY-=this.regionY;const n=this.localRegionX*this.magicLoc+64,o=this.localRegionY*this.magicLoc+64;r&&(this.localPlayer.waypointCurrent=0,this.localPlayer.movingStep=0,this.localPlayer.currentX=this.localPlayer.waypointsX[0]=n,this.localPlayer.currentY=this.localPlayer.waypointsY[0]=o),this.playerCount=0,this.localPlayer=this.createPlayer(this.localPlayerServerIndex,n,o,s);const a=Li.getBitMask(t,i,8);i+=8;for(let l=0;l<a;l++){const e=this.knownPlayers[l+1],s=Li.getBitMask(t,i,1);if(i++,0!==s){const s=Li.getBitMask(t,i,1);if(i++,0===s){const s=Li.getBitMask(t,i,3);i+=3;let r=e.waypointCurrent,n=e.waypointsX[r],o=e.waypointsY[r];2!==s&&1!==s&&3!==s||(n+=this.magicLoc),6!==s&&5!==s&&7!==s||(n-=this.magicLoc),4!==s&&3!==s&&5!==s||(o+=this.magicLoc),0!==s&&1!==s&&7!==s||(o-=this.magicLoc),e.animationNext=s,e.waypointCurrent=r=(r+1)%10,e.waypointsX[r]=n,e.waypointsY[r]=o}else{if(12==(12&Li.getBitMask(t,i,4))){i+=2;continue}e.animationNext=Li.getBitMask(t,i,4),i+=4}}this.players[this.playerCount++]=e}let h=0;for(;i+24<8*e;){const e=Li.getBitMask(t,i,11);i+=11;let s=Li.getBitMask(t,i,5);i+=5,s>15&&(s-=32);let r=Li.getBitMask(t,i,5);i+=5,r>15&&(r-=32);const n=Li.getBitMask(t,i,4);i+=4;const o=Li.getBitMask(t,i,1);i++;const a=(this.localRegionX+s)*this.magicLoc+64,l=(this.localRegionY+r)*this.magicLoc+64;this.createPlayer(e,a,l,n),0===o&&(this.playerServerIndexes[h++]=e)}if(h>0){this.packetStream.newPacket(ls.KNOWN_PLAYERS),this.packetStream.putShort(h);for(let t=0;t<h;t++){const e=this.playerServer[this.playerServerIndexes[t]];this.packetStream.putShort(e.serverIndex),this.packetStream.putShort(e.serverId)}this.packetStream.sendPacket(),h=0}}}})),d=t((function(t,e){t.exports={[Mr.REGION_PLAYER_UPDATE]:function(t){const e=Li.getUnsignedShort(t,1);let i=3;for(let s=0;s<e;s++){const e=Li.getUnsignedShort(t,i);i+=2;const s=this.playerServer[e],r=t[i++];if(0===r){const e=Li.getUnsignedShort(t,i);i+=2,null!==s&&(s.bubbleTimeout=150,s.bubbleItem=e)}else if(1===r){const e=t[i];if(i++,null!==s){let r=Cr.descramble(t,i,e);this.options.wordFilter&&(r=Ks.filter(r));let n=!1;for(let t=0;t<this.ignoreListCount;t++)if(this.ignoreList[t]===s.hash){n=!0;break}n||(s.messageTimeout=150,s.message=r,this.showMessage(`${s.name}: ${s.message}`,2))}i+=e}else if(2===r){const e=Li.getUnsignedByte(t[i++]),r=Li.getUnsignedByte(t[i++]),n=Li.getUnsignedByte(t[i++]);null!==s&&(s.damageTaken=e,s.healthCurrent=r,s.healthMax=n,s.combatTimer=200,s===this.localPlayer&&(this.playerStatCurrent[3]=r,this.playerStatBase[3]=n,this.showDialogWelcome=!1,this.showDialogServerMessage=!1))}else if(3===r){const e=Li.getUnsignedShort(t,i);i+=2;const r=Li.getUnsignedShort(t,i);i+=2,null!==s&&(s.incomingProjectileSprite=e,s.attackingNpcServerIndex=r,s.attackingPlayerServerIndex=-1,s.projectileRange=this.projectileMaxRange)}else if(4===r){const e=Li.getUnsignedShort(t,i);i+=2;const r=Li.getUnsignedShort(t,i);i+=2,null!==s&&(s.incomingProjectileSprite=e,s.attackingPlayerServerIndex=r,s.attackingNpcServerIndex=-1,s.projectileRange=this.projectileMaxRange)}else if(5===r)if(null!==s){s.serverId=Li.getUnsignedShort(t,i),i+=2,s.hash=Li.getUnsignedLong(t,i),i+=8,s.name=Li.hashToUsername(s.hash);const e=Li.getUnsignedByte(t[i]);i++;for(let r=0;r<e;r++)s.equippedItem[r]=Li.getUnsignedByte(t[i]),i++;for(let t=e;t<12;t++)s.equippedItem[t]=0;s.colourHair=255&t[i++],s.colourTop=255&t[i++],s.colourBottom=255&t[i++],s.colourSkin=255&t[i++],s.level=255&t[i++],s.skullVisible=255&t[i++]}else i+=14,i+=Li.getUnsignedByte(t[i])+1;else if(6===r){const e=t[i++];if(null!==s){const r=Cr.descramble(t,i,e);s.messageTimeout=150,s.message=r,s===this.localPlayer&&this.showMessage(`${s.name}: ${s.message}`,5)}i+=e}}}}})),m=t((function(t,e){t.exports={[Mr.REGION_OBJECTS]:function(t,e){for(let i=1;i<e;)if(255===Li.getUnsignedByte(t[i])){let e=0;const s=this.localRegionX+t[i+1]>>3,r=this.localRegionY+t[i+2]>>3;i+=3;for(let t=0;t<this.objectCount;t++){const i=(this.objectX[t]>>3)-s,n=(this.objectY[t]>>3)-r;0!==i||0!==n?(t!==e&&(this.objectModel[e]=this.objectModel[t],this.objectModel[e].key=e,this.objectX[e]=this.objectX[t],this.objectY[e]=this.objectY[t],this.objectId[e]=this.objectId[t],this.objectDirection[e]=this.objectDirection[t]),e++):(this.scene.removeModel(this.objectModel[t]),this.world.removeObject(this.objectX[t],this.objectY[t],this.objectId[t]))}this.objectCount=e}else{const e=Li.getUnsignedShort(t,i);i+=2;const s=this.localRegionX+t[i++],r=this.localRegionY+t[i++];let n=0;for(let t=0;t<this.objectCount;t++)this.objectX[t]!==s||this.objectY[t]!==r?(t!==n&&(this.objectModel[n]=this.objectModel[t],this.objectModel[n].key=n,this.objectX[n]=this.objectX[t],this.objectY[n]=this.objectY[t],this.objectId[n]=this.objectId[t],this.objectDirection[n]=this.objectDirection[t]),n++):(this.scene.removeModel(this.objectModel[t]),this.world.removeObject(this.objectX[t],this.objectY[t],this.objectId[t]));if(this.objectCount=n,6e4!==e){const t=this.world.getTileDirection(s,r);let i=0,n=0;0===t||4===t?(i=bs.objectWidth[e],n=bs.objectHeight[e]):(n=bs.objectWidth[e],i=bs.objectHeight[e]);const o=(s+s+i)*this.magicLoc/2|0,a=(r+r+n)*this.magicLoc/2|0,h=bs.objectModelIndex[e],l=this.gameModels[h].copy();this.scene.addModel(l),l.key=this.objectCount,l.rotate(0,32*t,0),l.translate(o,-this.world.getElevation(o,a),a),l._setLight_from6(!0,48,48,-50,-10,-50),this.world.removeObject2(s,r,e),74===e&&l.translate(0,-480,0),this.objectX[this.objectCount]=s,this.objectY[this.objectCount]=r,this.objectId[this.objectCount]=e,this.objectDirection[this.objectCount]=t,this.objectModel[this.objectCount++]=l}}}}})),p=t((function(t,e){t.exports={[Mr.REGION_NPCS]:function(t,e){this.npcCacheCount=this.npcCount,this.npcCount=0;for(let r=0;r<this.npcCacheCount;r++)this.npcsCache[r]=this.npcs[r];let i=8;const s=Li.getBitMask(t,i,8);i+=8;for(let r=0;r<s;r++){const e=this.npcsCache[r],s=Li.getBitMask(t,i,1);if(i++,0!==s){const s=Li.getBitMask(t,i,1);if(i++,0===s){const s=Li.getBitMask(t,i,3);i+=3;let r=e.waypointCurrent,n=e.waypointsX[r],o=e.waypointsY[r];2!==s&&1!==s&&3!==s||(n+=this.magicLoc),6!==s&&5!==s&&7!==s||(n-=this.magicLoc),4!==s&&3!==s&&5!==s||(o+=this.magicLoc),0!==s&&1!==s&&7!==s||(o-=this.magicLoc),e.animationNext=s,e.waypointCurrent=r=(r+1)%10,e.waypointsX[r]=n,e.waypointsY[r]=o}else{if(12==(12&Li.getBitMask(t,i,4))){i+=2;continue}e.animationNext=Li.getBitMask(t,i,4),i+=4}}this.npcs[this.npcCount++]=e}for(;i+34<8*e;){const e=Li.getBitMask(t,i,12);i+=12;let s=Li.getBitMask(t,i,5);i+=5,s>15&&(s-=32);let r=Li.getBitMask(t,i,5);i+=5,r>15&&(r-=32);const n=Li.getBitMask(t,i,4);i+=4;const o=(this.localRegionX+s)*this.magicLoc+64,a=(this.localRegionY+r)*this.magicLoc+64;let h=Li.getBitMask(t,i,10);i+=10,h>=bs.npcCount&&(h=24),this.addNpc(e,o,a,n,h)}}}})),f=t((function(t,e){t.exports={[Mr.REGION_NPC_UPDATE]:function(t){const e=Li.getUnsignedShort(t,1);let i=3;for(let s=0;s<e;s++){const e=Li.getUnsignedShort(t,i);i+=2;const s=this.npcsServer[e],r=Li.getUnsignedByte(t[i++]);if(1===r){const e=Li.getUnsignedShort(t,i);i+=2;const r=t[i++];if(null!==s){const n=Cr.descramble(t,i,r);s.messageTimeout=150,s.message=n,e===this.localPlayer.serverIndex&&this.showMessage(`@yel@${bs.npcName[s.npcId]}: `+s.message,5)}i+=r}else if(2===r){const e=Li.getUnsignedByte(t[i++]),r=Li.getUnsignedByte(t[i++]),n=Li.getUnsignedByte(t[i++]);null!==s&&(s.damageTaken=e,s.healthCurrent=r,s.healthMax=n,s.combatTimer=200)}}}}})),g=t((function(t,e){t.exports={[Mr.REGION_GROUND_ITEMS]:function(t,e){for(let i=1;i<e;)if(255===Li.getUnsignedByte(t[i])){let e=0;const s=this.localRegionX+t[i+1]>>3,r=this.localRegionY+t[i+2]>>3;i+=3;for(let t=0;t<this.groundItemCount;t++){const i=(this.groundItemX[t]>>3)-s,n=(this.groundItemY[t]>>3)-r;0===i&&0===n||(t!==e&&(this.groundItemX[e]=this.groundItemX[t],this.groundItemY[e]=this.groundItemY[t],this.groundItemID[e]=this.groundItemID[t],this.groundItemZ[e]=this.groundItemZ[t]),e++)}this.groundItemCount=e}else{let e=Li.getUnsignedShort(t,i);i+=2;const s=this.localRegionX+t[i++],r=this.localRegionY+t[i++];if(0==(32768&e)){this.groundItemX[this.groundItemCount]=s,this.groundItemY[this.groundItemCount]=r,this.groundItemID[this.groundItemCount]=e,this.groundItemZ[this.groundItemCount]=0;for(let t=0;t<this.objectCount;t++)if(this.objectX[t]===s&&this.objectY[t]===r){this.groundItemZ[this.groundItemCount]=bs.objectElevation[this.objectId[t]];break}this.groundItemCount++}else{e&=32767;let t=0;for(let i=0;i<this.groundItemCount;i++)this.groundItemX[i]!==s||this.groundItemY[i]!==r||this.groundItemID[i]!==e?(i!==t&&(this.groundItemX[t]=this.groundItemX[i],this.groundItemY[t]=this.groundItemY[i],this.groundItemID[t]=this.groundItemID[i],this.groundItemZ[t]=this.groundItemZ[i]),t++):e=-123;this.groundItemCount=t}}}}})),w=t((function(t,e){t.exports={[Mr.REGION_ENTITY_UPDATE]:function(t,e){const i=(e-1)/4|0;for(let s=0;s<i;s++){const e=this.localRegionX+Li.getSignedShort(t,1+4*s)>>3,i=this.localRegionY+Li.getSignedShort(t,3+4*s)>>3;let r=0;for(let t=0;t<this.groundItemCount;t++){const s=(this.groundItemX[t]>>3)-e,n=(this.groundItemY[t]>>3)-i;0===s&&0===n||(t!==r&&(this.groundItemX[r]=this.groundItemX[t],this.groundItemY[r]=this.groundItemY[t],this.groundItemID[r]=this.groundItemID[t],this.groundItemZ[r]=this.groundItemZ[t]),r++)}this.groundItemCount=r,r=0;for(let t=0;t<this.objectCount;t++){const s=(this.objectX[t]>>3)-e,n=(this.objectY[t]>>3)-i;0!==s||0!==n?(t!==r&&(this.objectModel[r]=this.objectModel[t],this.objectModel[r].key=r,this.objectX[r]=this.objectX[t],this.objectY[r]=this.objectY[t],this.objectId[r]=this.objectId[t],this.objectDirection[r]=this.objectDirection[t]),r++):(this.scene.removeModel(this.objectModel[t]),this.world.removeObject(this.objectX[t],this.objectY[t],this.objectId[t]))}this.objectCount=r,r=0;for(let t=0;t<this.wallObjectCount;t++){const s=(this.wallObjectX[t]>>3)-e,n=(this.wallObjectY[t]>>3)-i;0!==s||0!==n?(t!==r&&(this.wallObjectModel[r]=this.wallObjectModel[t],this.wallObjectModel[r].key=r+1e4,this.wallObjectX[r]=this.wallObjectX[t],this.wallObjectY[r]=this.wallObjectY[t],this.wallObjectDirection[r]=this.wallObjectDirection[t],this.wallObjectId[r]=this.wallObjectId[t]),r++):(this.scene.removeModel(this.wallObjectModel[t]),this.world.removeWallObject(this.wallObjectX[t],this.wallObjectY[t],this.wallObjectDirection[t],this.wallObjectId[t]))}this.wallObjectCount=r}}}})),y=t((function(t,e){t.exports={[Mr.PRAYER_STATUS]:function(t,e){for(let i=0;i<e-1;i++){const e=1===t[i+1];!this.prayerOn[i]&&e&&this.playSoundFile("prayeron"),this.prayerOn[i]&&!e&&this.playSoundFile("prayeroff"),this.prayerOn[i]=e}}}})),b=t((function(t,e){t.exports={[Mr.PLAYER_STAT_LIST]:function(t){let e=1;for(let i=0;i<this.playerStatCurrent.length;i++)this.playerStatCurrent[i]=Li.getUnsignedByte(t[e++]);for(let i=0;i<this.playerStatBase.length;i++)this.playerStatBase[i]=Li.getUnsignedByte(t[e++]);for(let i=0;i<this.playerExperience.length;i++)this.playerExperience[i]=Li.getUnsignedInt(t,e),e+=4;this.playerQuestPoints=Li.getUnsignedByte(t[e++])},[Mr.PLAYER_STAT_EQUIPMENT_BONUS]:function(t){for(let e=0;e<this.playerStatEquipment.length;e++)this.playerStatEquipment[e]=Li.getUnsignedByte(t[1+e])},[Mr.PLAYER_STAT_EXPERIENCE_UPDATE]:function(t){const e=255&t[1];this.playerExperience[e]=Li.getUnsignedInt(t,2)},[Mr.PLAYER_STAT_UPDATE]:function(t){let e=1;const i=255&t[e++];this.playerStatCurrent[i]=Li.getUnsignedByte(t[e++]),this.playerStatBase[i]=Li.getUnsignedByte(t[e++]),this.playerExperience[i]=Li.getUnsignedInt(t,e),e+=4},[Mr.PLAYER_STAT_FATIGUE]:function(t){this.statFatigue=Li.getUnsignedShort(t,1)},[Mr.PLAYER_QUEST_LIST]:function(t){for(let e=0;e<this.questComplete.length;e++)this.questComplete[e]=!!t[e+1]}}})),C=t((function(t,e){t.exports={[Mr.OPTION_LIST]:function(t){this.showOptionMenu=!0;const e=Li.getUnsignedByte(t[1]);this.optionMenuCount=e;let i=2;for(let r=0;r<e;r++){const e=Li.getUnsignedByte(t[i++]);this.optionMenuEntry[r]=(s=t.slice(i,i+e),Array.from(s).map(t=>String.fromCharCode(t)).join("")),i+=e}var s},[Mr.OPTION_LIST_CLOSE]:function(){this.showOptionMenu=!1}}})),S=t((function(t,e){function i(t){return Array.from(t).map(t=>String.fromCharCode(t)).join("")}t.exports={[Mr.MESSAGE]:function(t,e){const s=i(t.slice(1,e));this.showServerMessage(s)},[Mr.SERVER_MESSAGE]:function(t,e){this.serverMessage=i(t.slice(1,e)),this.showDialogServerMessage=!0,this.serverMessageBoxTop=!1},[Mr.SERVER_MESSAGE_ONTOP]:function(t,e){this.serverMessage=i(t.slice(1,e)),this.showDialogServerMessage=!0,this.serverMessageBoxTop=!0},[Mr.WELCOME]:function(t){this.welcomScreenAlreadyShown||(this.welcomeLastLoggedInIP=Li.getUnsignedInt(t,1),this.welcomeLastLoggedInDays=Li.getUnsignedShort(t,5),this.welcomeRecoverySetDays=255&t[7],this.welcomeUnreadMessages=Li.getUnsignedShort(t,8),this.showDialogWelcome=!0,this.welcomScreenAlreadyShown=!0,this.welcomeLastLoggedInHost=null)},[Mr.SYSTEM_UPDATE]:function(t){this.systemUpdate=32*Li.getUnsignedShort(t,1)}}})),I=t((function(t,e){t.exports={[Mr.LOGOUT_DENY]:function(){this.cantLogout()}}})),T=t((function(t,e){t.exports={[Mr.INVENTORY_ITEMS]:function(t){let e=1;this.inventoryItemsCount=255&t[e++];for(let i=0;i<this.inventoryItemsCount;i++){const s=Li.getUnsignedShort(t,e);e+=2,this.inventoryItemId[i]=32767&s,this.inventoryEquipped[i]=s/32768|0,0===bs.itemStackable[32767&s]?(this.inventoryItemStackCount[i]=Li.getStackInt(t,e),this.inventoryItemStackCount[i]>=128?e+=4:e++):this.inventoryItemStackCount[i]=1}},[Mr.INVENTORY_ITEM_UPDATE]:function(t){let e=1,i=1;const s=255&t[e++],r=Li.getUnsignedShort(t,e);e+=2,0===bs.itemStackable[32767&r]&&((i=Li.getStackInt(t,e))>=128?e+=4:e++),this.inventoryItemId[s]=32767&r,this.inventoryEquipped[s]=r/32768|0,this.inventoryItemStackCount[s]=i,s>=this.inventoryItemsCount&&(this.inventoryItemsCount=s+1)},[Mr.INVENTORY_ITEM_REMOVE]:function(t){const e=255&t[1];this.inventoryItemsCount--;for(let i=e;i<this.inventoryItemsCount;i++)this.inventoryItemId[i]=this.inventoryItemId[i+1],this.inventoryItemStackCount[i]=this.inventoryItemStackCount[i+1],this.inventoryEquipped[i]=this.inventoryEquipped[i+1]}}})),x=t((function(t,e){t.exports={[Mr.DUEL_OPEN]:function(t){const e=Li.getUnsignedShort(t,1);this.playerServer[e]&&(this.duelOpponentName=this.playerServer[e].name),this.showDialogDuel=!0,this.duelOfferItemCount=0,this.duelOfferOpponentItemCount=0,this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1,this.duelSettingsRetreat=!1,this.duelSettingsMagic=!1,this.duelSettingsPrayer=!1,this.duelSettingsWeapons=!1},[Mr.DUEL_CLOSE]:function(){this.showDialogDuel=!1,this.showDialogDuelConfirm=!1},[Mr.DUEL_UPDATE]:function(t){this.duelOfferOpponentItemCount=255&t[1];let e=2;for(let i=0;i<this.duelOfferOpponentItemCount;i++)this.duelOfferOpponentItemId[i]=Li.getUnsignedShort(t,e),e+=2,this.duelOfferOpponentItemStack[i]=Li.getUnsignedInt(t,e),e+=4;this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1},[Mr.DUEL_SETTINGS]:function(t){this.duelSettingsRetreat=!!t[1],this.duelSettingsMagic=!!t[2],this.duelSettingsPrayer=!!t[3],this.duelSettingsWeapons=!!t[4],this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1},[Mr.DUEL_OPPONENT_ACCEPTED]:function(t){this.duelOfferOpponentAccepted=!!t[1]},[Mr.DUEL_ACCEPTED]:function(t){this.duelOfferAccepted=!!t[1]},[Mr.DUEL_CONFIRM_OPEN]:function(t){this.showDialogDuelConfirm=!0,this.duelAccepted=!1,this.showDialogDuel=!1;let e=1;this.duelOpponentNameHash=Li.getUnsignedLong(t,e),e+=8,this.duelOpponentItemsCount=255&t[e++];for(let i=0;i<this.duelOpponentItemsCount;i++)this.duelOpponentItems[i]=Li.getUnsignedShort(t,e),e+=2,this.duelOpponentItemCount[i]=Li.getUnsignedInt(t,e),e+=4;this.duelItemsCount=255&t[e++];for(let i=0;i<this.duelItemsCount;i++)this.duelItems[i]=Li.getUnsignedShort(t,e),e+=2,this.duelItemCount[i]=Li.getUnsignedInt(t,e),e+=4;this.duelOptionRetreat=255&t[e++],this.duelOptionMagic=255&t[e++],this.duelOptionPrayer=255&t[e++],this.duelOptionWeapons=255&t[e++]}}})),v=t((function(t,e){t.exports={[Mr.PLAYER_DIED]:function(){this.deathScreenTimeout=250}}})),k=t((function(t,e){t.exports={[Mr.CLOSE_CONNECTION]:function(){this.closeConnection()}}})),A=t((function(t,e){t.exports={[Mr.BANK_OPEN]:function(t){this.showDialogBank=!0;let e=1;this.newBankItemCount=255&t[e++],this.bankItemsMax=255&t[e++];for(let i=0;i<this.newBankItemCount;i++)this.newBankItems[i]=Li.getUnsignedShort(t,e),e+=2,this.newBankItemsCount[i]=Li.getStackInt(t,e),this.newBankItemsCount[i]>=128?e+=4:e++;this.updateBankItems()},[Mr.BANK_CLOSE]:function(){this.showDialogBank=!1},[Mr.BANK_UPDATE]:function(t){let e=1;const i=255&t[e++],s=Li.getUnsignedShort(t,e);e+=2;const r=Li.getStackInt(t,e);if(r>=128?e+=4:e++,0===r){this.newBankItemCount--;for(let t=i;t<this.newBankItemCount;t++)this.newBankItems[t]=this.newBankItems[t+1],this.newBankItemsCount[t]=this.newBankItemsCount[t+1]}else this.newBankItems[i]=s,this.newBankItemsCount[i]=r,i>=this.newBankItemCount&&(this.newBankItemCount=i+1);this.updateBankItems()}}})),B=t((function(t,e){t.exports={[Mr.APPEARANCE]:function(){this.showAppearanceChange=!0}}})),L=t((function(t,e){t.exports=function(t){const e=((i=L({}))._colours=it({}),i["appearance-panel"]=et({}),i["bank-dialog"]=tt({}),i["chat-message-tabs"]=J({}),i["combat-style"]=Q({}),i.index=L({}),i["inventory-tab"]=K({}),i["login-panels"]=$({}),i["logout-dialog"]=q({}),i["magic-tab"]=z({}),i["minimap-tab"]=Z({}),i["mobile-ui"]=G({}),i["option-menu"]=V({}),i["options-tab"]=W({}),i["password-dialog"]=H({}),i["player-info-tab"]=F({}),i["recovery-panel"]=N({}),i["report-dialog"]=U({}),i["server-message-dialog"]=j({}),i["set-active-ui-tab"]=R({}),i["shop-dialog"]=O({}),i.sleep=_({}),i["social-dialog"]=D({}),i["social-tab"]=X({}),i["trade-confirm-dialog"]=Y({}),i["trade-dialog"]=P({}),i["welcome-dialog"]=E({}),i["wilderness-dialog"]=M({}),i);var i;for(const[s,r]of Object.entries(e))if(!/^_|index/.test(s))for(const[e,i]of Object.entries(r))t[e]="function"==typeof i?i.bind(t):i}})),M=t((function(t,e){const i=it({});t.exports={showUiWildWarn:0,drawDialogWildWarn:function(){let t=97;this.surface.drawBox(86,77,340,180,i.black),this.surface.drawBoxEdge(86,77,340,180,i.white),this.surface.drawStringCenter("Warning! Proceed with caution",256,t,4,i.red),t+=26,this.surface.drawStringCenter("If you go much further north you will enter the",256,t,1,i.white),t+=13,this.surface.drawStringCenter("wilderness. This a very dangerous area where",256,t,1,i.white),t+=13,this.surface.drawStringCenter("other players can attack you!",256,t,1,i.white),t+=22,this.surface.drawStringCenter("The further north you go the more dangerous it",256,t,1,i.white),t+=13,this.surface.drawStringCenter("becomes, but the more treasure you will find.",256,t,1,i.white),t+=22,this.surface.drawStringCenter("In the wilderness an indicator at the bottom-right",256,t,1,i.white),t+=13,this.surface.drawStringCenter("of the screen will show the current level of danger",256,t,1,i.white),t+=22;let e=i.white;this.mouseY>t-12&&this.mouseY<=t&&this.mouseX>181&&this.mouseX<331&&(e=i.red),this.surface.drawStringCenter("Click here to close window",256,t,1,e),0!==this.mouseButtonClick&&(this.mouseY>t-12&&this.mouseY<=t&&this.mouseX>181&&this.mouseX<331&&(this.showUiWildWarn=2),(this.mouseX<86||this.mouseX>426||this.mouseY<77||this.mouseY>257)&&(this.showUiWildWarn=2),this.mouseButtonClick=0)}}})),E=t((function(t,e){const i=it({});t.exports={drawDialogWelcome:function(){let t=65;201!==this.welcomeRecoverySetDays&&(t+=60),this.welcomeUnreadMessages>0&&(t+=60),0!==this.welcomeLastLoggedInIP&&(t+=45);let e=167-(t/2|0);this.surface.drawBox(56,167-(t/2|0),400,t,0),this.surface.drawBoxEdge(56,167-(t/2|0),400,t,i.white),e+=20,this.surface.drawStringCenter("Welcome to RuneScape "+this.loginUser,256,e,4,i.yellow),e+=30;let s=null;if(s=0===this.welcomeLastLoggedInDays?"earlier today":1===this.welcomeLastLoggedInDays?"yesterday":this.welcomeLastLoggedInDays+" days ago",0!==this.welcomeLastLoggedInIP&&(this.surface.drawStringCenter("You last logged in "+s,256,e,1,i.white),e+=15,null===this.welcomeLastLoggedInHost&&(this.welcomeLastLoggedInHost=this.getHostnameIP(this.welcomeLastLoggedInIP)),this.surface.drawStringCenter("from: "+this.welcomeLastLoggedInHost,256,e,1,i.white),e+=15,e+=15),this.welcomeUnreadMessages>0){const t=i.white;this.surface.drawStringCenter("Jagex staff will NEVER email you. We use the",256,e,1,t),e+=15,this.surface.drawStringCenter("message-centre on this website instead.",256,e,1,t),e+=15,1===this.welcomeUnreadMessages?this.surface.drawStringCenter("You have @yel@0@whi@ unread messages in your message-centre",256,e,1,i.white):this.surface.drawStringCenter("You have @gre@"+(this.welcomeUnreadMessages-1)+" unread messages @whi@in your message-centre",256,e,1,i.white),e+=15,e+=15}if(201!==this.welcomeRecoverySetDays){if(200===this.welcomeRecoverySetDays)this.surface.drawStringCenter("You have not yet set any password recovery questions.",256,e,1,i.orange),e+=15,this.surface.drawStringCenter("We strongly recommend you do so now to secure your account.",256,e,1,i.orange),e+=15,this.surface.drawStringCenter("Do this from the 'account management' area on our front webpage",256,e,1,i.orange),e+=15;else{let t=null;t=0===this.welcomeRecoverySetDays?"Earlier today":1===this.welcomeRecoverySetDays?"Yesterday":this.welcomeRecoverySetDays+" days ago",this.surface.drawStringCenter(t+" you changed your recovery questions",256,e,1,i.orange),e+=15,this.surface.drawStringCenter("If you do not remember making this change then cancel it immediately",256,e,1,i.orange),e+=15,this.surface.drawStringCenter("Do this from the 'account management' area on our front webpage",256,e,1,i.orange),e+=15}e+=15}let r=i.white;this.mouseY>e-12&&this.mouseY<=e&&this.mouseX>106&&this.mouseX<406&&(r=i.red),this.surface.drawStringCenter("Click here to close window",256,e,1,r),1===this.mouseButtonClick&&(r===i.red&&(this.showDialogWelcome=!1),(this.mouseX<86||this.mouseX>426)&&(this.mouseY<167-(t/2|0)||this.mouseY>167+(t/2|0))&&(this.showDialogWelcome=!1)),this.mouseButtonClick=0},showDialogWelcome:!1}})),P=t((function(t,e){const i=it({});t.exports={drawDialogTrade:function(){if(0!==this.mouseButtonClick&&0===this.mouseButtonItemCountIncrement&&(this.mouseButtonItemCountIncrement=1),this.mouseButtonItemCountIncrement>0){const t=this.mouseX-22,e=this.mouseY-36;if(t>=0&&e>=0&&t<468&&e<262){if(t>216&&e>30&&t<462&&e<235){const i=((t-217)/49|0)+5*((e-31)/34|0);if(i>=0&&i<this.inventoryItemsCount){let t=!1,e=0;const s=this.inventoryItemId[i];for(let r=0;r<this.tradeItemsCount;r++)if(this.tradeItems[r]===s)if(0===bs.itemStackable[s])for(let e=0;e<this.mouseButtonItemCountIncrement;e++)this.tradeItemCount[r]<this.inventoryItemStackCount[i]&&this.tradeItemCount[r]++,t=!0;else e++;if(this.getInventoryCount(s)<=e&&(t=!0),1===bs.itemSpecial[s]&&(this.showMessage("This object cannot be traded with other players",3),t=!0),!t&&this.tradeItemsCount<12&&(this.tradeItems[this.tradeItemsCount]=s,this.tradeItemCount[this.tradeItemsCount]=1,this.tradeItemsCount++,t=!0),t){this.packetStream.newPacket(ls.TRADE_ITEM_UPDATE),this.packetStream.putByte(this.tradeItemsCount);for(let t=0;t<this.tradeItemsCount;t++)this.packetStream.putShort(this.tradeItems[t]),this.packetStream.putInt(this.tradeItemCount[t]);this.packetStream.sendPacket(),this.tradeRecipientAccepted=!1,this.tradeAccepted=!1}}}if(t>8&&e>30&&t<205&&e<133){const i=((t-9)/49|0)+4*((e-31)/34|0);if(i>=0&&i<this.tradeItemsCount){const t=this.tradeItems[i];for(let e=0;e<this.mouseButtonItemCountIncrement;e++){if(!(0===bs.itemStackable[t]&&this.tradeItemCount[i]>1)){this.tradeItemsCount--,this.mouseButtonDownTime=0;for(let t=i;t<this.tradeItemsCount;t++)this.tradeItems[t]=this.tradeItems[t+1],this.tradeItemCount[t]=this.tradeItemCount[t+1];break}this.tradeItemCount[i]--}this.packetStream.newPacket(ls.TRADE_ITEM_UPDATE),this.packetStream.putByte(this.tradeItemsCount);for(let e=0;e<this.tradeItemsCount;e++)this.packetStream.putShort(this.tradeItems[e]),this.packetStream.putInt(this.tradeItemCount[e]);this.packetStream.sendPacket(),this.tradeRecipientAccepted=!1,this.tradeAccepted=!1}}t>=217&&e>=238&&t<=286&&e<=259&&(this.tradeAccepted=!0,this.packetStream.newPacket(ls.TRADE_ACCEPT),this.packetStream.sendPacket()),t>=394&&e>=238&&t<463&&e<259&&(this.showDialogTrade=!1,this.packetStream.newPacket(ls.TRADE_DECLINE),this.packetStream.sendPacket())}else 0!==this.mouseButtonClick&&(this.showDialogTrade=!1,this.packetStream.newPacket(ls.TRADE_DECLINE),this.packetStream.sendPacket());this.mouseButtonClick=0,this.mouseButtonItemCountIncrement=0}if(this.showDialogTrade){this.surface.drawBox(22,36,468,12,192),this.surface.drawBoxAlpha(22,48,468,18,i.grey,160),this.surface.drawBoxAlpha(22,66,8,248,i.grey,160),this.surface.drawBoxAlpha(227,66,11,248,i.grey,160),this.surface.drawBoxAlpha(484,66,6,248,i.grey,160),this.surface.drawBoxAlpha(30,169,197,22,i.grey,160),this.surface.drawBoxAlpha(30,294,197,20,i.grey,160),this.surface.drawBoxAlpha(238,271,246,43,i.grey,160),this.surface.drawBoxAlpha(30,66,197,103,i.lightGrey2,160),this.surface.drawBoxAlpha(30,191,197,103,i.lightGrey2,160),this.surface.drawBoxAlpha(238,66,246,205,i.lightGrey2,160);for(let t=0;t<4;t++)this.surface.drawLineHoriz(30,66+34*t,197,i.black);for(let t=0;t<4;t++)this.surface.drawLineHoriz(30,191+34*t,197,i.black);for(let t=0;t<7;t++)this.surface.drawLineHoriz(238,66+34*t,246,i.black);for(let t=0;t<6;t++)t<5&&(this.surface.drawLineVert(30+49*t,66,103,i.black),this.surface.drawLineVert(30+49*t,191,103,i.black)),this.surface.drawLineVert(238+49*t,66,205,i.black);this.surface.drawString("Trading with: "+this.tradeRecipientName,23,46,1,i.white),this.surface.drawString("Your Offer",31,63,4,i.white),this.surface.drawString("Opponent's Offer",31,188,4,i.white),this.surface.drawString("Your Inventory",238,63,4,i.white),this.tradeAccepted||this.surface._drawSprite_from3(239,274,this.spriteMedia+25),this.surface._drawSprite_from3(416,274,this.spriteMedia+26),this.tradeRecipientAccepted&&(this.surface.drawStringCenter("Other player",363,282,1,i.white),this.surface.drawStringCenter("has accepted",363,292,1,i.white)),this.tradeAccepted&&(this.surface.drawStringCenter("Waiting for",274,282,1,i.white),this.surface.drawStringCenter("other player",274,292,1,i.white));for(let t=0;t<this.inventoryItemsCount;t++){const e=239+t%5*49,s=67+34*(t/5|0);this.surface._spriteClipping_from9(e,s,48,32,this.spriteItem+bs.itemPicture[this.inventoryItemId[t]],bs.itemMask[this.inventoryItemId[t]],0,0,!1),0===bs.itemStackable[this.inventoryItemId[t]]&&this.surface.drawString(this.inventoryItemStackCount[t].toString(),e+1,s+10,1,i.yellow)}for(let t=0;t<this.tradeItemsCount;t++){const e=31+t%4*49,s=67+34*(t/4|0);this.surface._spriteClipping_from9(e,s,48,32,this.spriteItem+bs.itemPicture[this.tradeItems[t]],bs.itemMask[this.tradeItems[t]],0,0,!1),0===bs.itemStackable[this.tradeItems[t]]&&this.surface.drawString(this.tradeItemCount[t].toString(),e+1,s+10,1,i.yellow),this.mouseX>e&&this.mouseX<e+48&&this.mouseY>s&&this.mouseY<s+32&&this.surface.drawString(bs.itemName[this.tradeItems[t]]+": @whi@"+bs.itemDescription[this.tradeItems[t]],30,309,1,i.yellow)}for(let t=0;t<this.tradeRecipientItemsCount;t++){const e=31+t%4*49,s=192+34*(t/4|0);this.surface._spriteClipping_from9(e,s,48,32,this.spriteItem+bs.itemPicture[this.tradeRecipientItems[t]],bs.itemMask[this.tradeRecipientItems[t]],0,0,!1),0===bs.itemStackable[this.tradeRecipientItems[t]]&&this.surface.drawString(this.tradeRecipientItemCount[t].toString(),e+1,s+10,1,i.yellow),this.mouseX>e&&this.mouseX<e+48&&this.mouseY>s&&this.mouseY<s+32&&this.surface.drawString(bs.itemName[this.tradeRecipientItems[t]]+": @whi@"+bs.itemDescription[this.tradeRecipientItems[t]],30,309,1,i.yellow)}}},showDialogTrade:!1}})),Y=t((function(t,e){const i=it({});t.exports={drawDialogTradeConfirm:function(){this.surface.drawBox(22,36,468,16,192),this.surface.drawBoxAlpha(22,52,468,246,i.grey,160),this.surface.drawStringCenter("Please confirm your trade with @yel@"+Li.hashToUsername(this.tradeRecipientConfirmHash),256,48,1,i.white),this.surface.drawStringCenter("You are about to give:",139,66,1,i.yellow);for(let t=0;t<this.tradeConfirmItemsCount;t++){let e=bs.itemName[this.tradeConfirmItems[t]];0===bs.itemStackable[this.tradeConfirmItems[t]]&&(e+=" x "+Li.formatConfirmAmount(this.tradeConfirmItemCount[t])),this.surface.drawStringCenter(e,139,78+12*t,1,i.white)}0===this.tradeConfirmItemsCount&&this.surface.drawStringCenter("Nothing!",139,78,1,i.white),this.surface.drawStringCenter("In return you will receive:",373,66,1,i.yellow);for(let t=0;t<this.tradeRecipientConfirmItemsCount;t++){let e=bs.itemName[this.tradeRecipientConfirmItems[t]];0===bs.itemStackable[this.tradeRecipientConfirmItems[t]]&&(e+=" x "+Li.formatConfirmAmount(this.tradeRecipientConfirmItemCount[t])),this.surface.drawStringCenter(e,373,78+12*t,1,i.white)}0===this.tradeRecipientConfirmItemsCount&&this.surface.drawStringCenter("Nothing!",373,78,1,i.white),this.surface.drawStringCenter("Are you sure you want to do this?",256,236,4,i.cyan),this.surface.drawStringCenter("There is NO WAY to reverse a trade if you change your mind.",256,251,1,i.white),this.surface.drawStringCenter("Remember that not all players are trustworthy",256,266,1,i.white),this.tradeConfirmAccepted?this.surface.drawStringCenter("Waiting for other player...",256,286,1,i.yellow):(this.surface._drawSprite_from3(105,274,this.spriteMedia+25),this.surface._drawSprite_from3(339,274,this.spriteMedia+26)),1===this.mouseButtonClick&&((this.mouseX<22||this.mouseY<36||this.mouseX>490||this.mouseY>298)&&(this.showDialogTradeConfirm=!1,this.packetStream.newPacket(ls.TRADE_DECLINE),this.packetStream.sendPacket()),this.mouseX>=105&&this.mouseX<=210&&this.mouseY>=274&&this.mouseY<=295&&(this.tradeConfirmAccepted=!0,this.packetStream.newPacket(ls.TRADE_CONFIRM_ACCEPT),this.packetStream.sendPacket()),this.mouseX>=339&&this.mouseX<=445&&this.mouseY>=274&&this.mouseY<=295&&(this.showDialogTradeConfirm=!1,this.packetStream.newPacket(ls.TRADE_DECLINE),this.packetStream.sendPacket()),this.mouseButtonClick=0)},showDialogTradeConfirm:!1}})),X=t((function(t,e){const i=it({}),s=["Friends","Ignore"];t.exports={drawUiTabSocial:function(t){let e=this.gameWidth-196-3,r=36;if(this.options.mobile?(e=35,r=this.gameHeight/2-91):this.surface._drawSprite_from3(this.gameWidth-245-3,3,this.spriteMedia+5),this.uiOpenX=e,this.uiOpenY=r,this.uiOpenWidth=196,this.uiOpenHeight=182,this.surface.drawBoxAlpha(e,r+24,196,158,i.lightGrey,128),this.surface.drawLineHoriz(e,r+182-16,196,i.black),this.surface.drawTabs(e,r,196,24,s,this.uiTabSocialSubTab),this.panelSocialList.clearList(this.controlListSocialPlayers),0===this.uiTabSocialSubTab)for(let i=0;i<this.friendListCount;i++){let t=null;t=255===this.friendListOnline[i]?"@gre@":this.friendListOnline[i]>0?"@yel@":"@red@",this.panelSocialList.addListEntry(this.controlListSocialPlayers,i,`${t}${Li.hashToUsername(this.friendListHashes[i])}~${e+126}~@whi@Remove`)}else if(1===this.uiTabSocialSubTab)for(let i=0;i<this.ignoreListCount;i++)this.panelSocialList.addListEntry(this.controlListSocialPlayers,i,"@yel@"+Li.hashToUsername(this.ignoreList[i])+`~${e+126}~@whi@Remove`);this.panelSocialList.drawPanel();const n=this.options.mobile?"Tap":"Click";if(0===this.uiTabSocialSubTab){const t=this.panelSocialList.getListEntryIndex(this.controlListSocialPlayers);if(t>=0&&this.mouseX<e+176){const s=Li.hashToUsername(this.friendListHashes[t]);this.mouseX>e+116?this.surface.drawStringCenter(`${n} to remove ${s}`,e+98,r+35,1,i.white):255===this.friendListOnline[t]?this.surface.drawStringCenter(`${n} to message ${s}`,e+98,r+35,1,i.white):this.friendListOnline[t]>0?this.friendListOnline[t]<200?this.surface.drawStringCenter(s+" is on world "+(this.friendListOnline[t]-9),e+98,r+35,1,i.white):this.surface.drawStringCenter(s+" is on classic "+(this.friendListOnline[t]-219),e+98,r+35,1,i.white):this.surface.drawStringCenter(s+" is offline",e+98,r+35,1,i.white)}else this.surface.drawStringCenter(n+" a name to send a message",e+98,r+35,1,i.white);let s=i.black;s=this.mouseX>e&&this.mouseX<e+196&&this.mouseY>r+182-16&&this.mouseY<r+182?i.yellow:i.white,this.surface.drawStringCenter(n+" here to add a friend",e+98,r+182-3,1,s)}else if(1===this.uiTabSocialSubTab){const t=this.panelSocialList.getListEntryIndex(this.controlListSocialPlayers);t>=0&&this.mouseX<e+176&&this.mouseX>e+116?this.mouseX>e+116&&this.surface.drawStringCenter(n+" to remove "+Li.hashToUsername(this.ignoreList[t]),e+98,r+35,1,i.white):this.surface.drawStringCenter("Blocking messages from:",e+98,r+35,1,i.white);let s=i.black;s=this.mouseX>e&&this.mouseX<e+196&&this.mouseY>r+182-16&&this.mouseY<r+182?i.yellow:i.white,this.surface.drawStringCenter(n+" here to add a name",e+98,r+182-3,1,s)}if(!t)return;const o=this.mouseX-e,a=this.mouseY-r;if(o>=0&&a>=0&&o<196&&a<182){if(this.panelSocialList.handleMouse(o+e,a+r,this.lastMouseButtonDown,this.mouseButtonDown,this.mouseScrollDelta),a<=24&&1===this.mouseButtonClick&&(o<98&&1===this.uiTabSocialSubTab?(this.uiTabSocialSubTab=0,this.panelSocialList.resetListProps(this.controlListSocialPlayers)):o>98&&0===this.uiTabSocialSubTab&&(this.uiTabSocialSubTab=1,this.panelSocialList.resetListProps(this.controlListSocialPlayers))),1===this.mouseButtonClick&&0===this.uiTabSocialSubTab){const t=this.panelSocialList.getListEntryIndex(this.controlListSocialPlayers);t>=0&&o<176&&(o>116?this.friendRemove(this.friendListHashes[t]):0!==this.friendListOnline[t]&&(this.showDialogSocialInput=2,this.privateMessageTarget=this.friendListHashes[t],this.inputPMCurrent="",this.inputPMFinal=""))}if(1===this.mouseButtonClick&&1===this.uiTabSocialSubTab){const t=this.panelSocialList.getListEntryIndex(this.controlListSocialPlayers);t>=0&&o<176&&o>116&&this.ignoreRemove(this.ignoreList[t])}a>166&&1===this.mouseButtonClick&&(this.inputTextCurrent="",this.inputTextFinal="",0===this.uiTabSocialSubTab?this.showDialogSocialInput=1:1===this.uiTabSocialSubTab&&(this.showDialogSocialInput=3)),this.mouseButtonClick=0}},uiTabSocialSubTab:0}})),D=t((function(t,e){const i=it({});t.exports={drawDialogSocialInput:function(){if(0!==this.mouseButtonClick){if(this.mouseButtonClick=0,1===this.showDialogSocialInput&&(this.mouseX<106||this.mouseY<145||this.mouseX>406||this.mouseY>215))return void(this.showDialogSocialInput=0);if(2===this.showDialogSocialInput&&(this.mouseX<6||this.mouseY<145||this.mouseX>506||this.mouseY>215))return void(this.showDialogSocialInput=0);if(3===this.showDialogSocialInput&&(this.mouseX<106||this.mouseY<145||this.mouseX>406||this.mouseY>215))return void(this.showDialogSocialInput=0);if(this.mouseX>236&&this.mouseX<276&&this.mouseY>193&&this.mouseY<213)return void(this.showDialogSocialInput=0)}let t=145;if(1===this.showDialogSocialInput){if(this.surface.drawBox(106,t,300,70,0),this.surface.drawBoxEdge(106,t,300,70,i.white),t+=20,this.surface.drawStringCenter("Enter name to add to friends list",256,t,4,i.white),t+=20,this.surface.drawStringCenter(this.inputTextCurrent+"*",256,t,4,i.white),this.inputTextFinal.length>0){const t=this.inputTextFinal.trim(),e=Li.usernameToHash(t);this.inputTextCurrent="",this.inputTextFinal="",this.showDialogSocialInput=0,t.length>0&&!e.equals(this.localPlayer.hash)&&this.friendAdd(t)}}else if(2===this.showDialogSocialInput){this.surface.drawBox(6,t,500,70,0),this.surface.drawBoxEdge(6,t,500,70,i.white),t+=20;const e=Li.hashToUsername(this.privateMessageTarget);if(this.surface.drawStringCenter("Enter message to send to "+e,256,t,4,i.white),t+=20,this.surface.drawStringCenter(this.inputPMCurrent+"*",256,t,4,i.white),this.inputPMFinal.length>0){let t=this.inputPMFinal;this.inputPMCurrent="",this.inputPMFinal="",this.showDialogSocialInput=0;const i=Cr.scramble(t);this.sendPrivateMessage(this.privateMessageTarget,Cr.scrambledBytes,i),t=Cr.descramble(Cr.scrambledBytes,0,i),this.options.wordFilter&&(t=Ks.filter(t)),this.showServerMessage(`@pri@You tell ${e}: ${t}`)}}else if(3===this.showDialogSocialInput&&(this.surface.drawBox(106,t,300,70,0),this.surface.drawBoxEdge(106,t,300,70,i.white),t+=20,this.surface.drawStringCenter("Enter name to add to ignore list",256,t,4,i.white),t+=20,this.surface.drawStringCenter(this.inputTextCurrent+"*",256,t,4,i.white),this.inputTextFinal.length>0)){const t=this.inputTextFinal.trim(),e=Li.usernameToHash(t);this.inputTextCurrent="",this.inputTextFinal="",this.showDialogSocialInput=0,t.length>0&&!e.equals(this.localPlayer.hash)&&this.ignoreAdd(t)}let e=i.white;this.mouseX>236&&this.mouseX<276&&this.mouseY>193&&this.mouseY<213&&(e=i.yellow),this.surface.drawStringCenter("Cancel",256,208,1,e)},resetPMText:function(){this.inputPMCurrent="",this.inputPMFinal=""},showDialogSocialInput:0}})),_=t((function(t,e){const i=it({});t.exports={drawSleep:function(){this.surface.fadeToBlack(),Math.random()<=.15&&this.surface.drawStringCenter("ZZZ",80*Math.random()|0,334*Math.random()|0,5,16777215*Math.random()|0),Math.random()<=.15&&this.surface.drawStringCenter("ZZZ",512-(80*Math.random()|0),334*Math.random()|0,5,16777215*Math.random()|0),this.surface.drawBox((this.gameWidth/2|0)-100,160,200,40,i.black),this.surface.drawStringCenter("You are sleeping",this.gameWidth/2|0,50,7,i.yellow),this.surface.drawStringCenter(`Fatigue: ${100*this.fatigueSleeping/750|0}%`,this.gameWidth/2|0,90,7,i.yellow),this.surface.drawStringCenter("When you want to wake up just use your",this.gameWidth/2|0,140,5,i.white),this.surface.drawStringCenter("keyboard to type the word in the box below",this.gameWidth/2|0,160,5,i.white),this.surface.drawStringCenter(this.inputTextCurrent+"*",this.gameWidth/2|0,180,5,i.cyan),null===this.sleepingStatusText?this.surface._drawSprite_from3((this.gameWidth/2|0)-127,230,this.spriteTexture+1):this.surface.drawStringCenter(this.sleepingStatusText,this.gameWidth/2|0,260,5,i.red),this.surface.drawBoxEdge((this.gameWidth/2|0)-128,229,257,42,i.white),this.drawChatMessageTabs(),this.surface.drawStringCenter("If you can't read the word",this.gameWidth/2|0,290,1,i.white),this.surface.drawStringCenter(`@yel@${this.options.mobile?"tap":"click"} here@whi@ to get a different one`,this.gameWidth/2|0,305,1,i.white),this.surface.draw(this.graphics,0,0)},handleSleepInput:function(){this.inputTextFinal.length>0&&(/^::lostcon$/i.test(this.inputTextFinal)?this.packetStream.closeStream():/^::closecon$/.test(this.inputTextFinal)?this.closeConnection():(this.packetStream.newPacket(ls.SLEEP_WORD),this.packetStream.putString(this.inputTextFinal),this.sleepWordDelay||(this.packetStream.putByte(0),this.sleepWordDelay=!0),this.packetStream.sendPacket(),this.inputTextCurrent="",this.inputTextFinal="",this.sleepingStatusText="Please wait...")),1===this.lastMouseButtonDown&&this.mouseY>275&&this.mouseY<310&&this.mouseX>56&&this.mouseX<456&&(this.packetStream.newPacket(ls.SLEEP_WORD),this.packetStream.putString("-null-"),this.sleepWordDelay||(this.packetStream.putByte(0),this.sleepWordDelay=!0),this.packetStream.sendPacket(),this.inputTextCurrent="",this.inputTextFinal="",this.sleepingStatusText="Please wait..."),this.lastMouseButtonDown=0},isSleeping:!1}})),O=t((function(t,e){const i=it({});t.exports={drawDialogShop:function(){if(0!==this.mouseButtonClick){this.mouseButtonClick=0;const t=this.mouseX-52,e=this.mouseY-44;if(!(t>=0&&e>=12&&t<408&&e<246))return this.packetStream.newPacket(ls.SHOP_CLOSE),this.packetStream.sendPacket(),void(this.showDialogShop=!1);{let i=0;for(let s=0;s<5;s++)for(let r=0;r<8;r++){const n=7+49*r,o=28+34*s;t>n&&t<n+49&&e>o&&e<o+34&&-1!==this.shopItem[i]&&(this.shopSelectedItemIndex=i,this.shopSelectedItemType=this.shopItem[i]),i++}if(this.shopSelectedItemIndex>=0){const i=this.shopItem[this.shopSelectedItemIndex];if(-1!==i){if(this.shopItemCount[this.shopSelectedItemIndex]>0&&t>298&&e>=204&&t<408&&e<=215){let t=this.shopBuyPriceMod+this.shopItemPrice[this.shopSelectedItemIndex];t<10&&(t=10);const e=t*bs.itemBasePrice[i]/100|0;this.packetStream.newPacket(ls.SHOP_BUY),this.packetStream.putShort(this.shopItem[this.shopSelectedItemIndex]),this.packetStream.putInt(e),this.packetStream.sendPacket()}if(this.getInventoryCount(i)>0&&t>2&&e>=229&&t<112&&e<=240){let t=this.shopSellPriceMod+this.shopItemPrice[this.shopSelectedItemIndex];t<10&&(t=10);const e=t*bs.itemBasePrice[i]/100|0;this.packetStream.newPacket(ls.SHOP_SELL),this.packetStream.putShort(this.shopItem[this.shopSelectedItemIndex]),this.packetStream.putInt(e),this.packetStream.sendPacket()}}}}}this.surface.drawBox(52,44,408,12,192),this.surface.drawBoxAlpha(52,56,408,17,i.grey,160),this.surface.drawBoxAlpha(52,73,8,170,i.grey,160),this.surface.drawBoxAlpha(451,73,9,170,i.grey,160),this.surface.drawBoxAlpha(52,243,408,47,i.grey,160),this.surface.drawString("Buying and selling items",53,54,1,i.white);let t=i.white;this.mouseX>372&&this.mouseY>=44&&this.mouseX<460&&this.mouseY<56&&(t=i.red),this.surface.drawStringRight("Close window",458,54,1,t),this.surface.drawString("Shops stock in green",54,68,1,i.green),this.surface.drawString("Number you own in blue",187,68,1,i.cyan),this.surface.drawString(`Your money: ${this.getInventoryCount(10)}gp`,332,68,1,i.yellow);let e=0;for(let r=0;r<5;r++)for(let t=0;t<8;t++){const s=59+49*t,n=72+34*r;this.shopSelectedItemIndex===e?this.surface.drawBoxAlpha(s,n,49,34,i.red,160):this.surface.drawBoxAlpha(s,n,49,34,i.lightGrey2,160),this.surface.drawBoxEdge(s,n,50,35,0),-1!==this.shopItem[e]&&(this.surface._spriteClipping_from9(s,n,48,32,this.spriteItem+bs.itemPicture[this.shopItem[e]],bs.itemMask[this.shopItem[e]],0,0,!1),this.surface.drawString(this.shopItemCount[e].toString(),s+1,n+10,1,i.green),this.surface.drawStringRight(this.getInventoryCount(this.shopItem[e]).toString(),s+47,n+10,1,i.cyan)),e++}if(this.surface.drawLineHoriz(57,266,398,0),-1===this.shopSelectedItemIndex)return void this.surface.drawStringCenter("Select an object to buy or sell",256,258,3,i.yellow);const s=this.shopItem[this.shopSelectedItemIndex];if(-1!==s){if(this.shopItemCount[this.shopSelectedItemIndex]>0){let e=this.shopBuyPriceMod+this.shopItemPrice[this.shopSelectedItemIndex];e<10&&(e=10);const r=e*bs.itemBasePrice[s]/100|0;this.surface.drawString(`Buy a new ${bs.itemName[s]} for `+r+"gp",54,258,1,i.yellow),t=i.white,this.mouseX>350&&this.mouseY>=248&&this.mouseX<460&&this.mouseY<=259&&(t=i.red),this.surface.drawStringRight("Click here to buy",457,258,3,t)}else this.surface.drawStringCenter("This item is not currently available to buy",256,258,3,i.yellow);if(this.getInventoryCount(s)>0){let e=this.shopSellPriceMod+this.shopItemPrice[this.shopSelectedItemIndex];e<10&&(e=10);const r=e*bs.itemBasePrice[s]/100|0;return this.surface.drawStringRight(`Sell your ${bs.itemName[s]} for `+r+"gp",457,283,1,i.yellow),t=i.white,this.mouseX>54&&this.mouseY>=273&&this.mouseX<164&&this.mouseY<=284&&(t=i.red),void this.surface.drawString("Click here to sell",54,283,3,t)}this.surface.drawStringCenter("You do not have any of this item to sell",256,283,3,i.yellow)}}}})),R=t((function(t,e){t.exports={setActiveUITab:function(){0===this.showUITab&&this.mouseX>=this.gameWidth-35&&this.mouseY>=3&&this.mouseX<this.gameWidth-3&&this.mouseY<35&&(this.showUITab=1),0===this.showUITab&&this.mouseX>=this.gameWidth-35-33&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-33&&this.mouseY<35&&(this.showUITab=2,this.minimapRandom1=(13*Math.random()|0)-6,this.minimapRandom2=(23*Math.random()|0)-11),0===this.showUITab&&this.mouseX>=this.gameWidth-35-66&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-66&&this.mouseY<35&&(this.showUITab=3),0===this.showUITab&&this.mouseX>=this.gameWidth-35-99&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-99&&this.mouseY<35&&(this.showUITab=4),0===this.showUITab&&this.mouseX>=this.gameWidth-35-132&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-132&&this.mouseY<35&&(this.showUITab=5),0===this.showUITab&&this.mouseX>=this.gameWidth-35-165&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-165&&this.mouseY<35&&(this.showUITab=6),0!==this.showUITab&&this.mouseX>=this.gameWidth-35&&this.mouseY>=3&&this.mouseX<this.gameWidth-3&&this.mouseY<26&&(this.showUITab=1),0!==this.showUITab&&2!==this.showUITab&&this.mouseX>=this.gameWidth-35-33&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-33&&this.mouseY<26&&(this.showUITab=2,this.minimapRandom1=(13*Math.random()|0)-6,this.minimapRandom2=(23*Math.random()|0)-11),0!==this.showUITab&&this.mouseX>=this.gameWidth-35-66&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-66&&this.mouseY<26&&(this.showUITab=3),0!==this.showUITab&&this.mouseX>=this.gameWidth-35-99&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-99&&this.mouseY<26&&(this.showUITab=4),0!==this.showUITab&&this.mouseX>=this.gameWidth-35-132&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-132&&this.mouseY<26&&(this.showUITab=5),0!==this.showUITab&&this.mouseX>=this.gameWidth-35-165&&this.mouseY>=3&&this.mouseX<this.gameWidth-3-165&&this.mouseY<26&&(this.showUITab=6),1===this.showUITab&&(this.mouseX<this.gameWidth-248||this.mouseY>36+34*(this.inventoryMaxItemCount/5|0))&&(this.showUITab=0),3===this.showUITab&&(this.mouseX<this.gameWidth-199||this.mouseY>316)&&(this.showUITab=0),2!==this.showUITab&&4!==this.showUITab&&5!==this.showUITab||!(this.mouseX<this.gameWidth-199||this.mouseY>240)||(this.showUITab=0),6===this.showUITab&&(this.mouseX<this.gameWidth-199||this.mouseY>311)&&(this.showUITab=0)},setActiveMobileUITab:function(){const t=this.gameWidth-32-3,e=this.gameHeight/2-49;let i=e;for(let s=0;s<6;s+=1){const r=s>2?3:t;if(this.mouseX>=r&&this.mouseX<=r+32&&this.mouseY>=i&&this.mouseY<=i+32){if(0===this.showUITab)return void(this.showUITab=s+1);if(this.showUITab===s+1)return}2===s?i=e:i+=33}0!==this.showUITab&&(this.mouseX<this.uiOpenX||this.mouseX>this.uiOpenX+this.uiOpenWidth||this.mouseY<this.uiOpenY||this.mouseY>this.uiOpenY+this.uiOpenHeight)&&(this.showUITab=0)}}})),j=t((function(t,e){const i=it({});t.exports={serverMessageBoxTop:!1,drawDialogServerMessage:function(){let t=100;this.serverMessageBoxTop&&(t=450,t=300),this.surface.drawBox(56,167-(t/2|0),400,t,i.black),this.surface.drawBoxEdge(56,167-(t/2|0),400,t,i.white),this.surface.drawParagraph(this.serverMessage,256,167-(t/2|0)+20,1,i.white,360);const e=157+(t/2|0);let s=i.white;this.mouseY>e-12&&this.mouseY<=e&&this.mouseX>106&&this.mouseX<406&&(s=i.red),this.surface.drawStringCenter("Click here to close window",256,e,1,s),1===this.mouseButtonClick&&(s===i.red&&(this.showDialogServerMessage=!1),(this.mouseX<56||this.mouseX>456)&&(this.mouseY<167-(t/2|0)||this.mouseY>167+(t/2|0))&&(this.showDialogServerMessage=!1)),this.mouseButtonClick=0}}})),U=t((function(t,e){const i=it({}),s=["Offensive language","Item scamming","Password scamming","Bug abuse","Jagex Staff impersonation","Account sharing/trading","Macroing","Mutiple logging in","Encouraging others to break rules","Misuse of customer support","Advertising / website","Real world item trading"];t.exports={drawDialogReportAbuse:function(){this.reportAbuseOffence=0;let t=135;for(let i=0;i<12;i++)this.mouseX>66&&this.mouseX<446&&this.mouseY>=t-12&&this.mouseY<t+3&&(this.reportAbuseOffence=i+1),t+=14;if(0!==this.mouseButtonClick&&0!==this.reportAbuseOffence)return this.mouseButtonClick=0,this.showDialogReportAbuseStep=2,this.inputTextCurrent="",void(this.inputTextFinal="");if(t+=15,0!==this.mouseButtonClick){if(this.mouseButtonClick=0,this.mouseX<56||this.mouseY<35||this.mouseX>456||this.mouseY>325)return void(this.showDialogReportAbuseStep=0);if(this.mouseX>66&&this.mouseX<446&&this.mouseY>=t-15&&this.mouseY<t+5)return void(this.showDialogReportAbuseStep=0)}this.surface.drawBox(56,35,400,290,i.black),this.surface.drawBoxEdge(56,35,400,290,i.white),t=50,this.surface.drawStringCenter("This form is for reporting players who are breaking our rules",256,t,1,i.white),t+=15,this.surface.drawStringCenter("Using it sends a snapshot of the last 60 secs of activity to us",256,t,1,i.white),t+=15,this.surface.drawStringCenter("If you misuse this form you will be banned",256,t,1,i.orange),t+=25,this.surface.drawStringCenter("First indicate which of our 12 rules is being broken. For a detailed",256,t,1,i.yellow),t+=15,this.surface.drawStringCenter("explanation of each rule please read the manual on our website.",256,t,1,i.yellow),t+=15;for(let r=1;r<s.length+1;r+=1){let e=i.black;this.reportAbuseOffence===r?(this.surface.drawBoxEdge(66,t-12,380,15,i.white),e=i.orange):e=i.white;const n=s[r-1];this.surface.drawStringCenter(`${r}: ${n}`,256,t,1,e),t+=14}t+=15;let e=i.white;this.mouseX>196&&this.mouseX<316&&this.mouseY>t-15&&this.mouseY<t+5&&(e=i.yellow),this.surface.drawStringCenter("Click here to cancel",256,t,1,e)},drawDialogReportAbuseInput:function(){if(this.inputTextFinal.length>0){const t=this.inputTextFinal.trim();if(this.inputTextCurrent="",this.inputTextFinal="",t.length>0){const e=Li.usernameToHash(t);this.packetStream.newPacket(ls.REPORT_ABUSE),this.packetStream.putLong(e),this.packetStream.putByte(this.reportAbuseOffence),this.packetStream.putByte(this.reportAbuseMute?1:0),this.packetStream.sendPacket()}return void(this.showDialogReportAbuseStep=0)}this.surface.drawBox(56,130,400,100,i.black),this.surface.drawBoxEdge(56,130,400,100,i.white);let t=160;if(this.surface.drawStringCenter("Now type the name of the offending player, and press enter",256,t,1,i.yellow),t+=18,this.surface.drawStringCenter(`Name: ${this.inputTextCurrent}*`,256,t,4,i.white),this.moderatorLevel>0){t=207;let e=i.white,s="OFF";this.reportAbuseMute&&(e=i.orange,s="ON"),this.surface.drawStringCenter(`Moderator option: Mute player for 48 hours: <${s}>`,256,t,1,e),this.mouseX>106&&this.mouseX<406&&this.mouseY>t-13&&this.mouseY<t+2&&1===this.mouseButtonClick&&(this.mouseButtonClick=0,this.reportAbuseMute=!this.reportAbuseMute)}t=222;let e=i.white;this.mouseX>196&&this.mouseX<316&&this.mouseY>t-13&&this.mouseY<t+2&&(e=i.yellow,1===this.mouseButtonClick&&(this.mouseButtonClick=0,this.showDialogReportAbuseStep=0)),this.surface.drawStringCenter("Click here to cancel",256,t,1,e),1===this.mouseButtonClick&&(this.mouseX<56||this.mouseX>456||this.mouseY<130||this.mouseY>230)&&(this.mouseButtonClick=0,this.showDialogReportAbuseStep=0)},reportAbuseMute:!1,reportAbuseOffence:0,showDialogReportAbuseStep:0}})),N=t((function(t,e){const i=[];i.length=5,i.fill(null),t.exports={selectedRecoverQuestions:i,selectedRecoverIDs:new Int32Array([0,1,2,3,4]),controlRecoverNewQuestions:new Int32Array(5),controlRecoverNewAnswers:new Int32Array(5),controlRecoverNewQuestionButtons:new Int32Array(5),controlRecoverCustomQuestionButtons:new Int32Array(5),controlRecoverCreateButton:0}})),F=t((function(t,e){const i=it({}),s=["Stats","Quests"],r=["Attack","Defense","Strength","Hits","Ranged","Prayer","Magic","Cooking","Woodcut","Fletching","Fishing","Firemaking","Crafting","Smithing","Mining","Herblaw","Agility","Thieving"],n=["Attack","Defense","Strength","Hits","Ranged","Prayer","Magic","Cooking","Woodcutting","Fletching","Fishing","Firemaking","Crafting","Smithing","Mining","Herblaw","Agility","Thieving"],o=["Armour","WeaponAim","WeaponPower","Magic","Prayer"],a=[];let h=0;for(let u=0;u<99;u++){const t=u+1;h+=t+300*Math.pow(2,t/7)|0,a[u]=268435452&h}const l=["Witch's house","Lost city","Hero's quest","Druidic ritual","Merlin's crystal","Scorpion catcher","Family crest","Tribal totem","Fishing contest","Monk's friend","Temple of Ikov","Clock tower","The Holy Grail","Fight Arena","Tree Gnome Village","The Hazeel Cult","Sheep Herder","Plague City","Sea Slug","Waterfall quest","Biohazard","Jungle potion","Grand tree","Shilo village","Underground pass","Observatory quest","Tourist trap","Watchtower","Dwarf Cannon","Murder Mystery","Digsite","Gertrude's Cat","Legend's Quest"].map(t=>t+" (members)"),c=["Black knight's fortress","Cook's assistant","Demon slayer","Doric's quest","The restless ghost","Goblin diplomacy","Ernest the chicken","Imp catcher","Pirate's treasure","Prince Ali rescue","Romeo & Juliet","Sheep shearer","Shield of Arrav","The knight's sword","Vampire slayer","Witch's potion","Dragon slayer"].concat(l);t.exports={drawUiTabPlayerInfo:function(t){let e=this.gameWidth-196-3,h=36;if(this.options.mobile?(e-=32,h=this.gameHeight/2-137.5|0):this.surface._drawSprite_from3(this.gameWidth-245-3,3,this.spriteMedia+3),this.uiOpenX=e,this.uiOpenY=h,this.uiOpenWidth=196,this.uiOpenHeight=275,this.surface.drawBoxAlpha(e,h+24,196,251,i.lightGrey,128),this.surface.drawLineHoriz(e,h+24,196,i.black),this.surface.drawTabs(e,h,196,24,s,this.uiTabPlayerInfoSubTab),0===this.uiTabPlayerInfoSubTab){let t=h+36,s=-1;this.surface.drawString("Skills",e+5,t,3,i.yellow),t+=13;for(let n=0;n<9;n++){let o=i.white;this.mouseX>e+3&&this.mouseY>=t-11&&this.mouseY<t+2&&this.mouseX<e+90&&(o=i.red,s=n),this.surface.drawString(`${r[n]}:@yel@${this.playerStatCurrent[n]}/`+this.playerStatBase[n],e+5,t,1,o),o=i.white,this.mouseX>=e+90&&this.mouseY>=t-13-11&&this.mouseY<t-13+2&&this.mouseX<e+196&&(o=i.red,s=n+9),this.surface.drawString(r[n+9]+":@yel@"+this.playerStatCurrent[n+9]+"/"+this.playerStatBase[n+9],e+98-5,t-13,1,o),t+=13}this.surface.drawString("Quest Points:@yel@"+this.playerQuestPoints,e+98-5,t-13,1,i.white),t+=12,this.surface.drawString(`Fatigue: @yel@${100*this.statFatigue/750|0}%`,e+5,t-13,1,i.white),t+=8,this.surface.drawString("Equipment Status",e+5,t,3,i.yellow),t+=12;for(let r=0;r<3;r++)this.surface.drawString(o[r]+":@yel@"+this.playerStatEquipment[r],e+5,t,1,i.white),r<2&&this.surface.drawString(o[r+3]+":@yel@"+this.playerStatEquipment[r+3],e+98+25,t,1,i.white),t+=13;if(t+=6,this.surface.drawLineHoriz(e,t-15,196,i.black),-1!==s){this.surface.drawString(n[s]+" skill",e+5,t,1,i.yellow),t+=12;let r=a[0];for(let t=0;t<98;t++)this.playerExperience[s]>=a[t]&&(r=a[t+1]);this.surface.drawString("Total xp: "+(this.playerExperience[s]/4|0),e+5,t,1,i.white),t+=12,this.surface.drawString("Next level at: "+(r/4|0),e+5,t,1,i.white)}else{this.surface.drawString("Overall levels",e+5,t,1,i.yellow),t+=12;let s=0;for(let t=0;t<n.length;t++)s+=this.playerStatBase[t];this.surface.drawString("Skill total: "+s,e+5,t,1,i.white),t+=12,this.surface.drawString("Combat level: "+this.localPlayer.level,e+5,t,1,i.white),t+=12}}else if(1===this.uiTabPlayerInfoSubTab){this.panelQuestList.clearList(this.controlListQuest),this.panelQuestList.addListEntry(this.controlListQuest,0,"@whi@Quest-list (green=completed)");for(let t=0;t<c.length;t++)this.panelQuestList.addListEntry(this.controlListQuest,t+1,(this.questComplete[t]?"@gre@":"@red@")+c[t]);this.panelQuestList.drawPanel()}if(!t)return;const l=this.mouseX-e,u=this.mouseY-h;l>=0&&u>=0&&l<196&&u<275&&(1===this.uiTabPlayerInfoSubTab&&this.panelQuestList.handleMouse(l+e,u+h,this.lastMouseButtonDown,this.mouseButtonDown,this.mouseScrollDelta),u<=24&&1===this.mouseButtonClick&&(l<98?this.uiTabPlayerInfoSubTab=0:l>98&&(this.uiTabPlayerInfoSubTab=1)))},uiTabPlayerInfoSubTab:0}})),H=t((function(t,e){const i=it({});t.exports={drawDialogChangePassword:function(){if(0!==this.mouseButtonClick&&(this.mouseButtonClick=0,this.mouseX<106||this.mouseY<150||this.mouseX>406||this.mouseY>210))return void(this.showChangePasswordStep=0);this.surface.drawBox(106,150,300,60,i.black),this.surface.drawBoxEdge(106,150,300,60,i.white);let t=172,e="";if(6===this.showChangePasswordStep){this.surface.drawStringCenter("Please enter your current password",256,t,4,i.white),t+=25,e="*";for(let t=0;t<this.inputTextCurrent.length;t++)e="X"+e;if(this.surface.drawStringCenter(e,256,t,4,i.white),this.inputTextFinal.length>0)return this.changePasswordOld=this.inputTextFinal,this.inputTextCurrent="",this.inputTextFinal="",void(this.showChangePasswordStep=1)}else if(1===this.showChangePasswordStep){this.surface.drawStringCenter("Please enter your new password",256,t,4,i.white),t+=25,e="*";for(let t=0;t<this.inputTextCurrent.length;t++)e="X"+e;if(this.surface.drawStringCenter(e,256,t,4,i.white),this.inputTextFinal.length>0)return this.changePasswordNew=this.inputTextFinal,this.inputTextCurrent="",this.inputTextFinal="",this.changePasswordNew.length>=5?void(this.showChangePasswordStep=2):void(this.showChangePasswordStep=5)}else if(2==this.showChangePasswordStep){this.surface.drawStringCenter("Enter password again to confirm",256,t,4,i.white),t+=25,e="*";for(let t=0;t<this.inputTextCurrent.length;++t)e="X"+e;if(this.surface.drawStringCenter(e,256,t,4,i.white),this.inputTextFinal.length>0)return this.inputTextFinal.toLowerCase()===this.changePasswordNew.toLowerCase()?(this.showChangePasswordStep=4,void this.changePassword(this.changePasswordOld,this.changePasswordNew)):void(this.showChangePasswordStep=3)}else{if(3===this.showChangePasswordStep)return this.surface.drawStringCenter("Passwords do not match!",256,t,4,i.white),t+=25,void this.surface.drawStringCenter("Press any key to close",256,t,4,i.white);if(4===this.showChangePasswordStep)return this.surface.drawStringCenter("Ok, your request has been sent",256,t,4,i.white),t+=25,void this.surface.drawStringCenter("Press any key to close",256,t,4,i.white);5===this.showChangePasswordStep&&(this.surface.drawStringCenter("Password must be at",256,t,4,i.white),t+=25,this.surface.drawStringCenter("least 5 letters long",256,t,4,i.white))}},showChangePasswordStep:0}})),W=t((function(t,e){const i=it({});t.exports={drawUiTabOptions:function(t){let e=this.gameWidth-196-3,s=36;this.options.mobile?(e=35,s=this.gameHeight/2-132.5|0):this.surface._drawSprite_from3(this.gameWidth-245-3,3,this.spriteMedia+6),this.uiOpenX=e,this.uiOpenY=s,this.uiOpenWidth=196,this.uiOpenHeight=265,this.surface.drawBoxAlpha(e,s,196,65,i.darkGrey,160),this.surface.drawBoxAlpha(e,s+65,196,65,i.lightGrey3,160),this.surface.drawBoxAlpha(e,s+130,196,95,i.darkGrey,160),this.surface.drawBoxAlpha(e,s+225,196,40,i.lightGrey3,160);const r=e+3;let n=s+15;if(this.surface.drawString(`Game options - ${this.options.mobile?"tap":"click"} to toggle`,r,n,1,i.black),n+=15,this.surface.drawString("Camera angle mode - "+(this.optionCameraModeAuto?"@gre@Auto":"@red@Manual"),r,n,1,i.white),n+=15,this.surface.drawString(this.options.mobile?"Single tap mode - "+(this.optionMouseButtonOne?"@gre@on":"@red@off"):"Mouse buttons - "+(this.optionMouseButtonOne?"@red@One":"@gre@Two"),r,n,1,i.white),n+=15,this.members&&this.surface.drawString("Sound effects - "+(this.optionSoundDisabled?"@red@off":"@gre@on"),r,n,1,i.white),n+=15,this.options.accountManagement){n+=5,this.surface.drawString("Security settings",r,n,1,0),n+=15;let t=i.white;this.mouseX>r&&this.mouseX<r+196&&this.mouseY>n-12&&this.mouseY<n+4&&(t=i.yellow),this.surface.drawString("Change password",r,n,1,t),n+=15,t=i.white,this.mouseX>r&&this.mouseX<r+196&&this.mouseY>n-12&&this.mouseY<n+4&&(t=i.yellow),this.surface.drawString("Change recovery questions",r,n,1,t),n+=30}else this.surface.drawString("To change your contact details,",r,n,0,i.white),n+=15,this.surface.drawString("password, recovery questions, etc..",r,n,0,i.white),n+=15,this.surface.drawString("please select 'account management'",r,n,0,i.white),n+=15,0===this.referID?this.surface.drawString("from the runescape.com front page",r,n,0,i.white):1===this.referID?this.surface.drawString("from the link below the gamewindow",r,n,0,i.white):this.surface.drawString("from the runescape front webpage",r,n,0,i.white),n+=20;this.surface.drawString("Privacy settings. Will be applied to",e+3,n,1,i.black),n+=15,this.surface.drawString("all people not on your friends list",e+3,n,1,i.black),n+=15,this.surface.drawString("Block chat messages: "+(this.settingsBlockChat?"@gre@<on>":"@red@<off>"),e+3,n,1,i.white),n+=15,this.surface.drawString("Block private messages: "+(this.settingsBlockPrivate?"@gre@<on>":"@red@<off>"),e+3,n,1,i.white),n+=15,this.surface.drawString("Block trade requests: "+(this.settingsBlockTrade?"@gre@<on>":"@red@<off>"),e+3,n,1,i.white),n+=15,this.members&&this.surface.drawString("Block duel requests: "+(this.settingsBlockDuel?"@gre@<on>":"@red@<off>"),e+3,n,1,i.white),n+=20,this.surface.drawString("Always logout when you finish",r,n,1,i.black),n+=15;let o=i.white;if(this.mouseX>r&&this.mouseX<r+196&&this.mouseY>n-12&&this.mouseY<n+4&&(o=i.yellow),this.surface.drawString((this.options.mobile?"Tap":"Click")+" here to logout",e+3,n,1,o),!t)return;const a=this.mouseX-e,h=this.mouseY-s;if(a>=0&&h>=0&&a<196&&h<265){const t=e+3;let i=s+30;this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.optionCameraModeAuto=!this.optionCameraModeAuto,this.packetStream.newPacket(ls.SETTINGS_GAME),this.packetStream.putByte(0),this.packetStream.putByte(this.optionCameraModeAuto?1:0),this.packetStream.sendPacket()),i+=15,this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.optionMouseButtonOne=!this.optionMouseButtonOne,this.packetStream.newPacket(ls.SETTINGS_GAME),this.packetStream.putByte(2),this.packetStream.putByte(this.optionMouseButtonOne?1:0),this.packetStream.sendPacket()),i+=15,this.members&&this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.optionSoundDisabled=!this.optionSoundDisabled,this.packetStream.newPacket(ls.SETTINGS_GAME),this.packetStream.putByte(3),this.packetStream.putByte(this.optionSoundDisabled?1:0),this.packetStream.sendPacket()),this.options.accountManagement?(i+=35,this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.showChangePasswordStep=6,this.inputTextCurrent="",this.inputTextFinal=""),i+=15,this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.packetStream.newPacket(ls.RECOVER_SET_REQUEST),this.packetStream.sendPacket()),i+=30):i+=75;let r=!1;i+=35,this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.settingsBlockChat=1-this.settingsBlockChat,r=!0),i+=15,this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.settingsBlockPrivate=1-this.settingsBlockPrivate,r=!0),i+=15,this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.settingsBlockTrade=1-this.settingsBlockTrade,r=!0),i+=15,this.members&&this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&(this.settingsBlockDuel=1-this.settingsBlockDuel,r=!0),i+=15,r&&this.sendPrivacySettings(this.settingsBlockChat,this.settingsBlockPrivate,this.settingsBlockTrade,this.settingsBlockDuel),i+=20,this.mouseX>t&&this.mouseX<t+196&&this.mouseY>i-12&&this.mouseY<i+4&&1===this.mouseButtonClick&&this.sendLogout(),this.mouseButtonClick=0}}}})),V=t((function(t,e){const i=it({});t.exports={drawOptionMenu:function(){if(0!==this.mouseButtonClick){for(let t=0;t<this.optionMenuCount;t++)if(!(this.mouseX>=this.surface.textWidth(this.optionMenuEntry[t],1)||this.mouseY<=12*t||this.mouseY>=12+12*t)){this.packetStream.newPacket(ls.CHOOSE_OPTION),this.packetStream.putByte(t),this.packetStream.sendPacket();break}return this.mouseButtonClick=0,void(this.showOptionMenu=!1)}for(let t=0;t<this.optionMenuCount;t++){let e=i.cyan;this.mouseX<this.surface.textWidth(this.optionMenuEntry[t],1)&&this.mouseY>12*t&&this.mouseY<12+12*t&&(e=i.red),this.surface.drawString(this.optionMenuEntry[t],6,12+12*t,1,e)}}}})),G=t((function(t,e){const i={uiLeft:"./ui-left.png",uiRight:"./ui-right.png"};for(const s of Object.keys(i)){const t=new Image;t.src=i[s],i[s]=t}t.exports={drawMobileUI:function(){const t=this.gameWidth-32-3,e=this.gameHeight/2-49;this.graphics.ctx.globalAlpha=.5;let s=e;for(let r=0;r<6;r+=1){const n=this.showUITab===r+1,o=r>2?3:t;n&&(this.graphics.ctx.globalAlpha=1),this.graphics.ctx.fillStyle=n?"#000083":"#b5b5b4",this.graphics.ctx.fillRect(o,s,32,32),n&&(this.graphics.ctx.drawImage(r>2?i.uiLeft:i.uiRight,0,r>2?33*(r-3):33*r,32,32,o,s,32,32),this.graphics.ctx.globalAlpha=.5),2===r?s=e:s+=33}this.graphics.ctx.drawImage(i.uiRight,t,e),this.graphics.ctx.drawImage(i.uiLeft,3,e),this.graphics.ctx.globalAlpha=1}}})),Z=t((function(t,e){const i=it({});t.exports={drawMinimapEntity:function(t,e,i){this.surface.setPixel(t,e,i),this.surface.setPixel(t-1,e,i),this.surface.setPixel(t+1,e,i),this.surface.setPixel(t,e-1,i),this.surface.setPixel(t,e+1,i)},drawUiTabMinimap:function(t){let e=this.gameWidth-156-3,s=36;this.options.mobile?(e-=32,s=this.gameHeight/2-76):this.surface._drawSprite_from3(this.gameWidth-245-3,3,this.spriteMedia+2),this.uiOpenX=e,this.uiOpenY=s,this.uiOpenWidth=156,this.uiOpenHeight=152,this.surface.drawBox(e,s,156,152,0),this.surface.setBounds(e,s,e+156,s+152);const r=192+this.minimapRandom2,n=this.cameraRotation+this.minimapRandom1&255;let o=3*(this.localPlayer.currentX-6040)*r/2048|0,a=3*(this.localPlayer.currentY-6040)*r/2048|0;const h=Ts.sinCosCache[1024-4*n&1023],l=Ts.sinCosCache[1024+(1024-4*n&1023)],c=a*h+o*l>>18;a=a*l-o*h>>18,o=c,this.surface.drawMinimapSprite(e+78-o,s+76+a,this.spriteMedia-1,n+64&255,r);for(let m=0;m<this.objectCount;m++){let t=3*(this.objectX[m]*this.magicLoc+64-this.localPlayer.currentX)*r/2048|0,n=3*(this.objectY[m]*this.magicLoc+64-this.localPlayer.currentY)*r/2048|0;const o=n*h+t*l>>18;n=n*l-t*h>>18,t=o,this.drawMinimapEntity(e+78+t,s+76-n,i.cyan)}for(let m=0;m<this.groundItemCount;m++){let t=3*(this.groundItemX[m]*this.magicLoc+64-this.localPlayer.currentX)*r/2048|0,n=3*(this.groundItemY[m]*this.magicLoc+64-this.localPlayer.currentY)*r/2048|0;const o=n*h+t*l>>18;n=n*l-t*h>>18,t=o,this.drawMinimapEntity(e+78+t,s+76-n,i.red)}for(let m=0;m<this.npcCount;m++){const t=this.npcs[m];let n=3*(t.currentX-this.localPlayer.currentX)*r/2048|0,o=3*(t.currentY-this.localPlayer.currentY)*r/2048|0;const a=o*h+n*l>>18;o=o*l-n*h>>18,n=a,this.drawMinimapEntity(e+78+n,s+76-o,i.yellow)}for(let m=0;m<this.playerCount;m++){const t=this.players[m];let n=3*(t.currentX-this.localPlayer.currentX)*r/2048|0,o=3*(t.currentY-this.localPlayer.currentY)*r/2048|0;const a=o*h+n*l>>18;o=o*l-n*h>>18,n=a;let c=i.white;for(let e=0;e<this.friendListCount;e++)if(t.hash.equals(this.friendListHashes[e])&&255===this.friendListOnline[e]){c=i.green;break}this.drawMinimapEntity(e+78+n,s+76-o,c)}if(this.surface.drawCircle(e+78,s+76,2,i.white,255),this.surface.drawMinimapSprite(e+19,s+19,this.spriteMedia+24,this.cameraRotation+128&255,128),this.surface.setBounds(0,0,this.gameWidth,this.gameHeight+12),!t)return;const u=this.mouseX-e,d=this.mouseY-s;if(this.options.resetCompass&&1===this.mouseButtonClick&&u>0&&u<=32&&d>0&&d<=32)return this.cameraRotation=128,void(this.mouseButtonClick=0);if(u>=0&&d>=0&&u<196&&d<152){let t=16384*(this.mouseX-(e+78))/(3*r)|0,i=16384*(this.mouseY-(s+76))/(3*r)|0;const n=i*h+t*l>>15;i=i*l-t*h>>15,t=n,t+=this.localPlayer.currentX,i=this.localPlayer.currentY-i,1===this.mouseButtonClick&&(this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t/128|0,i/128|0,!1),this.mouseButtonClick=0)}}}})),z=t((function(t,e){const i=it({}),s=["Magic","Prayers"];t.exports={drawUiTabMagic:function(t){let e=this.gameWidth-196-3,r=36;if(this.options.mobile?(e=35,r=this.gameHeight/2-91):this.surface._drawSprite_from3(this.gameWidth-245-3,3,this.spriteMedia+4),this.uiOpenX=e,this.uiOpenY=r,this.uiOpenWidth=196,this.uiOpenHeight=182,this.surface.drawBoxAlpha(e,r+24,196,158,i.lightGrey,128),this.surface.drawLineHoriz(e,r+113,196,i.black),this.surface.drawTabs(e,r,196,24,s,this.uiTabMagicSubTab),0===this.uiTabMagicSubTab){this.panelMagic.clearList(this.controlListMagic);const t=this.playerStatCurrent[6];for(let e=0;e<bs.spellCount;e++){let i="@yel@";for(let t=0;t<bs.spellRunesRequired[e];t++){const s=bs.spellRunesId[e][t],r=bs.spellRunesCount[e][t];if(!this.hasInventoryItems(s,r)){i="@whi@";break}}bs.spellLevel[e]>t&&(i="@bla@"),this.panelMagic.addListEntry(this.controlListMagic,e,`${i}Level ${bs.spellLevel[e]}: `+bs.spellName[e])}this.panelMagic.drawPanel();const s=this.panelMagic.getListEntryIndex(this.controlListMagic);if(-1!==s){this.surface.drawString("Level "+bs.spellLevel[s]+": "+bs.spellName[s],e+2,r+124,1,i.yellow),this.surface.drawString(bs.spellDescription[s],e+2,r+136,0,i.white);for(let t=0;t<bs.spellRunesRequired[s];t++){const n=bs.spellRunesId[s][t],o=this.getInventoryCount(n),a=bs.spellRunesCount[s][t];let h="@red@";this.hasInventoryItems(n,a)&&(h="@gre@"),this.surface._drawSprite_from3(e+2+44*t,r+150,this.spriteItem+bs.itemPicture[n]),this.surface.drawString(`${h}${o}/${a}`,e+2+44*t,r+150,1,i.white)}}else this.surface.drawString("Point at a spell for a description",e+2,r+124,1,i.black)}else if(1===this.uiTabMagicSubTab){this.panelMagic.clearList(this.controlListMagic);for(let e=0;e<bs.prayerCount;e++){let t="@whi@";bs.prayerLevel[e]>this.playerStatBase[5]&&(t="@bla@"),this.prayerOn[e]&&(t="@gre@"),this.panelMagic.addListEntry(this.controlListMagic,e,`${t}Level ${bs.prayerLevel[e]}: `+bs.prayerName[e])}this.panelMagic.drawPanel();const t=this.panelMagic.getListEntryIndex(this.controlListMagic);-1!==t?(this.surface.drawStringCenter(`Level ${bs.prayerLevel[t]}: `+bs.prayerName[t],e+98,r+130,1,i.yellow),this.surface.drawStringCenter(bs.prayerDescription[t],e+98,r+145,0,i.white),this.surface.drawStringCenter("Drain rate: "+bs.prayerDrain[t],e+98,r+160,1,i.black)):this.surface.drawString("Point at a prayer for a description",e+2,r+124,1,i.black)}if(!t)return;const n=this.mouseX-e,o=this.mouseY-r;if(n>=0&&o>=0&&n<196&&o<182){if(this.panelMagic.handleMouse(n+e,o+r,this.lastMouseButtonDown,this.mouseButtonDown,this.mouseScrollDelta),o<=24&&1===this.mouseButtonClick&&(n<98&&1===this.uiTabMagicSubTab?(this.uiTabMagicSubTab=0,this.panelMagic.resetListProps(this.controlListMagic)):n>98&&0===this.uiTabMagicSubTab&&(this.uiTabMagicSubTab=1,this.panelMagic.resetListProps(this.controlListMagic))),1===this.mouseButtonClick&&0===this.uiTabMagicSubTab){const t=this.panelMagic.getListEntryIndex(this.controlListMagic);if(-1!==t){const e=this.playerStatCurrent[6];if(bs.spellLevel[t]>e)this.showMessage("Your magic ability is not high enough for this spell",3);else{let e=0;for(e=0;e<bs.spellRunesRequired[t];e++){const i=bs.spellRunesId[t][e];if(!this.hasInventoryItems(i,bs.spellRunesCount[t][e])){this.showMessage("You don't have all the reagents you need for this spell",3),e=-1;break}}e===bs.spellRunesRequired[t]&&(this.selectedSpell=t,this.selectedItemInventoryIndex=-1)}}}if(1===this.mouseButtonClick&&1===this.uiTabMagicSubTab){const t=this.panelMagic.getListEntryIndex(this.controlListMagic);if(-1!==t){const e=this.playerStatBase[5];bs.prayerLevel[t]>e?this.showMessage("Your prayer ability is not high enough for this prayer",3):0===this.playerStatCurrent[5]?this.showMessage("You have run out of prayer points. Return to a church to recharge",3):this.prayerOn[t]?(this.packetStream.newPacket(ls.PRAYER_OFF),this.packetStream.putByte(t),this.packetStream.sendPacket(),this.prayerOn[t]=!1,this.playSoundFile("prayeroff")):(this.packetStream.newPacket(ls.PRAYER_ON),this.packetStream.putByte(t),this.packetStream.sendPacket(),this.prayerOn[t]=!0,this.playSoundFile("prayeron"))}}this.mouseButtonClick=0}},uiTabMagicSubTab:0}})),q=t((function(t,e){const i=it({});t.exports={drawDialogLogout:function(){this.surface.drawBox(126,137,260,60,i.black),this.surface.drawBoxEdge(126,137,260,60,i.white),this.surface.drawStringCenter("Logging out...",256,173,5,i.white)}}})),$=t((function(t,e){t.exports={controlRecoverQuestions:new Int32Array(5),controlRecoverAnswers:new Int32Array(5),loginScreen:0,createLoginPanels:function(){this.panelLoginWelcome=new As(this.surface,50);const t=this.gameWidth/2|0;let e=40;const i=this.options.mobile?"Tap":"Click";if(this.members?(this.panelLoginWelcome.addTextCentre(t,200+e,"Welcome to RuneScape",4,!0),this.panelLoginWelcome.addTextCentre(t,215+e,"You need a members account to use this server",4,!0),this.panelLoginWelcome.addButtonBackground(t,250+e,200,35),this.panelLoginWelcome.addTextCentre(t,250+e,i+" here to login",5,!1),this.controlWelcomeExistingUser=this.panelLoginWelcome.addButton(t,250+e,200,35)):(this.panelLoginWelcome.addTextCentre(t,200+e,i+" on an option",5,!0),this.panelLoginWelcome.addButtonBackground(t-100,240+e,120,35),this.panelLoginWelcome.addTextCentre(t-100,240+e,"New User",5,!1),this.controlWelcomeNewUser=this.panelLoginWelcome.addButton(t-100,240+e,120,35),this.panelLoginWelcome.addButtonBackground(t+100,240+e,120,35),this.panelLoginWelcome.addTextCentre(t+100,240+e,"Existing User",5,!1),this.controlWelcomeExistingUser=this.panelLoginWelcome.addButton(t+100,240+e,120,35)),this.panelLoginNewUser=new As(this.surface,50),this.options.accountManagement){e=70,this.controlRegisterStatus=this.panelLoginNewUser.addTextCentre(t,e+8,"To create an account please enter all the requested details",4,!0);let i=e+25;this.panelLoginNewUser.addButtonBackground(t,i+17,250,34),this.panelLoginNewUser.addTextCentre(t,i+8,"Choose a Username",4,!1),this.controlRegisterUser=this.panelLoginNewUser.addTextInput(t,i+25,200,40,4,12,!1,!1),i+=40,this.panelLoginNewUser.addButtonBackground(t-115,i+17,220,34),this.panelLoginNewUser.addTextCentre(t-115,i+8,"Choose a Password",4,!1),this.controlRegisterPassword=this.panelLoginNewUser.addTextInput(t-115,i+25,220,40,4,20,!0,!1),this.panelLoginNewUser.addButtonBackground(t+115,i+17,220,34),this.panelLoginNewUser.addTextCentre(t+115,i+8,"Confirm Password",4,!1),this.controlRegisterConfirmPassword=this.panelLoginNewUser.addTextInput(t+115,i+25,220,40,4,20,!0,!1),i+=60,this.controlRegisterCheckbox=this.panelLoginNewUser.addCheckbox(t-196-7,i-7,14,14),this.panelLoginNewUser.addText(t-181,i,"I have read and agreed to the terms and conditions",4,!0),i+=15,this.panelLoginNewUser.addTextCentre(t,i,"(to view these click the relevant link below this game window)",4,!0),i+=20,this.panelLoginNewUser.addButtonBackground(t-100,i+17,150,34),this.panelLoginNewUser.addTextCentre(t-100,i+17,"Submit",5,!1),this.controlRegisterSubmit=this.panelLoginNewUser.addButton(t-100,i+17,150,34),this.panelLoginNewUser.addButtonBackground(t+100,i+17,150,34),this.panelLoginNewUser.addTextCentre(t+100,i+17,"Cancel",5,!1),this.controlRegisterCancel=this.panelLoginNewUser.addButton(t+100,i+17,150,34)}else e=230,0===this.referID?(this.panelLoginNewUser.addTextCentre(t,e+8,"To create an account please go back to the",4,!0),e+=20,this.panelLoginNewUser.addTextCentre(t,e+8,"www.runescape.com front page, and choose 'create account'",4,!0)):1===this.referID?(this.panelLoginNewUser.addTextCentre(t,e+8,"To create an account please click on the",4,!0),e+=20,this.panelLoginNewUser.addTextCentre(t,e+8,"'create account' link below the game window",4,!0)):(this.panelLoginNewUser.addTextCentre(t,e+8,"To create an account please go back to the",4,!0),e+=20,this.panelLoginNewUser.addTextCentre(t,e+8,"runescape front webpage and choose 'create account'",4,!0)),e+=30,this.panelLoginNewUser.addButtonBackground(t,e+17,150,34),this.panelLoginNewUser.addTextCentre(t,e+17,"Ok",5,!1),this.controlLoginNewOK=this.panelLoginNewUser.addButton(t,e+17,150,34);this.panelLoginExistingUser=new As(this.surface,50),e=230,this.controlLoginStatus=this.panelLoginExistingUser.addTextCentre(t,e-10,"Please enter your username and password",4,!0),e+=28,this.panelLoginExistingUser.addButtonBackground(t-116,e,200,40),this.panelLoginExistingUser.addTextCentre(t-116,e-10,"Username:",4,!1),this.controlLoginUser=this.panelLoginExistingUser.addTextInput(t-116,e+10,200,40,4,12,!1,!1),e+=47,this.panelLoginExistingUser.addButtonBackground(t-66,e,200,40),this.panelLoginExistingUser.addTextCentre(t-66,e-10,"Password:",4,!1),this.controlLoginPassword=this.panelLoginExistingUser.addTextInput(t-66,e+10,200,40,4,20,!0,!1),e-=55,this.panelLoginExistingUser.addButtonBackground(t+154,e,120,25),this.panelLoginExistingUser.addTextCentre(t+154,e,"Ok",4,!1),this.controlLoginOk=this.panelLoginExistingUser.addButton(t+154,e,120,25),e+=30,this.panelLoginExistingUser.addButtonBackground(t+154,e,120,25),this.panelLoginExistingUser.addTextCentre(t+154,e,"Cancel",4,!1),this.controlLoginCancel=this.panelLoginExistingUser.addButton(t+154,e,120,25),this.options.accountManagement&&(e+=30,this.panelLoginExistingUser.addButtonBackground(t+154,e,160,25),this.panelLoginExistingUser.addTextCentre(t+154,e,"I've lost my password",4,!1),this.controlLoginRecover=this.panelLoginExistingUser.addButton(t+154,e,160,25))},drawLoginScreens:function(){let t;if(this.welcomScreenAlreadyShown=!1,this.surface.interlace=!1,this.surface.blackScreen(),t=this.options.accountManagement?0===this.loginScreen||2===this.loginScreen:this.loginScreen>=0&&this.loginScreen<=3){const t=2*this.loginTimer%3072;t<1024?(this.surface._drawSprite_from3(0,10,this.spriteLogo),t>768&&this.surface._drawSpriteAlpha_from4(0,10,this.spriteLogo+1,t-768)):t<2048?(this.surface._drawSprite_from3(0,10,this.spriteLogo+1),t>1792&&this.surface._drawSpriteAlpha_from4(0,10,this.spriteMedia+10,t-1792)):(this.surface._drawSprite_from3(0,10,this.spriteMedia+10),t>2816&&this.surface._drawSpriteAlpha_from4(0,10,this.spriteLogo,t-2816))}0===this.loginScreen?this.panelLoginWelcome.drawPanel():1===this.loginScreen?this.panelLoginNewUser.drawPanel():2===this.loginScreen&&this.panelLoginExistingUser.drawPanel(),this.surface._drawSprite_from3(0,this.gameHeight-4,this.spriteMedia+22),this.surface.draw(this.graphics,0,0)},handleLoginScreenInput:async function(){if(this.worldFullTimeout>0&&this.worldFullTimeout--,0===this.loginScreen){if(this.panelLoginWelcome.handleMouse(this.mouseX,this.mouseY,this.lastMouseButtonDown,this.mouseButtonDown),this.panelLoginWelcome.isClicked(this.controlWelcomeNewUser)&&(this.loginScreen=1,this.options.accountManagement&&(this.panelLoginNewUser.updateText(this.controlRegisterUser,""),this.panelLoginNewUser.updateText(this.controlRegisterPassword,""),this.panelLoginNewUser.updateText(this.controlRegisterConfirmPassword,""),this.panelLoginNewUser.setFocus(this.controlRegisterUser),this.panelLoginNewUser.toggleCheckbox(this.controlRegisterCheckbox,!1),this.panelLoginNewUser.updateText(this.controlRegisterStatus,"To create an account please enter all the requested details"))),this.panelLoginWelcome.isClicked(this.controlWelcomeExistingUser))return this.loginScreen=2,this.panelLoginExistingUser.updateText(this.controlLoginStatus,"Please enter your username and password"),this.panelLoginExistingUser.updateText(this.controlLoginUser,""),this.panelLoginExistingUser.updateText(this.controlLoginPassword,""),void this.panelLoginExistingUser.setFocus(this.controlLoginUser)}else if(1===this.loginScreen)if(this.panelLoginNewUser.handleMouse(this.mouseX,this.mouseY,this.lastMouseButtonDown,this.mouseButtonDown),this.options.accountManagement){if(this.options.mobile&&1===this.lastMouseButtonDown&&this.mouseX>=74&&this.mouseX<=474&&this.mouseY>=188&&this.mouseY<=216)return this.panelLoginNewUser.toggleCheckbox(this.controlRegisterCheckbox,!this.panelLoginNewUser.isActivated(this.controlRegisterCheckbox)),void(this.lastMouseButtonDown=0);if(this.panelLoginNewUser.isClicked(this.controlRegisterCancel))return void(this.loginScreen=0);if(this.panelLoginNewUser.isClicked(this.controlRegisterUser))return void this.panelLoginNewUser.setFocus(this.controlRegisterPassword);if(this.panelLoginNewUser.isClicked(this.controlRegisterPassword))return void this.panelLoginNewUser.setFocus(this.controlRegisterConfirmPassword);if(this.panelLoginNewUser.isClicked(this.controlRegisterConfirmPassword)||this.panelLoginNewUser.isClicked(this.controlRegisterSubmit)){const t=this.panelLoginNewUser.getText(this.controlRegisterUser),e=this.panelLoginNewUser.getText(this.controlRegisterPassword),i=this.panelLoginNewUser.getText(this.controlRegisterConfirmPassword);if(!t||0===t.length||!e||0===e.length||!i||0===i.length)return void this.panelLoginNewUser.updateText(this.controlRegisterStatus,"@yel@Please fill in ALL requested information to continue!");if(e!==i)return void this.panelLoginNewUser.updateText(this.controlRegisterStatus,"@yel@The two passwords entered are not the same as each other!");if(e.length<5)return void this.panelLoginNewUser.updateText(this.controlRegisterStatus,"@yel@Your password must be at least 5 letters long");if(!this.panelLoginNewUser.isActivated(this.controlRegisterCheckbox))return void this.panelLoginNewUser.updateText(this.controlRegisterStatus,"@yel@You must agree to the terms+conditions to continue");this.panelLoginNewUser.updateText(this.controlRegisterStatus,"Please wait... Creating new account"),this.drawLoginScreens(),this.resetTimings(),this.registerUser=this.panelLoginNewUser.getText(this.controlRegisterUser),this.registerPassword=this.panelLoginNewUser.getText(this.controlRegisterPassword),await this.register(this.registerUser,this.registerPassword)}}else this.panelLoginNewUser.isClicked(this.controlLoginNewOk)&&(this.loginScreen=0);else if(2===this.loginScreen)if(this.panelLoginExistingUser.handleMouse(this.mouseX,this.mouseY,this.lastMouseButtonDown,this.mouseButtonDown),this.panelLoginExistingUser.isClicked(this.controlLoginCancel))this.loginScreen=0;else if(this.panelLoginExistingUser.isClicked(this.controlLoginUser))this.panelLoginExistingUser.setFocus(this.controlLoginPassword);else if(this.panelLoginExistingUser.isClicked(this.controlLoginPassword)||this.panelLoginExistingUser.isClicked(this.controlLoginOk))this.loginUser=this.panelLoginExistingUser.getText(this.controlLoginUser),this.loginPass=this.panelLoginExistingUser.getText(this.controlLoginPassword),await this.login(this.loginUser,this.loginPass,!1);else if(this.panelLoginExistingUser.isClicked(this.controlLoginRecover)){if(this.loginUser=this.panelLoginExistingUser.getText(this.controlLoginUser),0===this.loginUser.trim().length)return void this.showLoginScreenStatus("You must enter your username to recover your password","");await this.recoverAttempt(this.loginUser)}},renderLoginScreenViewports:function(){this.world._loadSection_from3(2423,2423,0),this.world.addModels(this.gameModels);let t=9728,e=6400,i=1100,s=888;this.scene.clipFar3d=4100,this.scene.clipFar2d=4100,this.scene.fogZFalloff=1,this.scene.fogZDistance=4e3,this.surface.blackScreen(),this.scene.setCamera(t,-this.world.getElevation(t,e),e,912,s,0,2*i),this.scene.render(),this.surface.fadeToBlack(),this.surface.fadeToBlack(),this.surface.drawBox(0,0,this.gameWidth,6,0);for(let r=6;r>=1;r--)this.surface.drawLineAlpha(0,r,0,r,this.gameWidth,8);this.surface.drawBox(0,194,512,20,0);for(let r=6;r>=1;r--)this.surface.drawLineAlpha(0,r,0,194-r,this.gameWidth,8);this.surface._drawSprite_from3((this.gameWidth/2|0)-(this.surface.spriteWidth[this.spriteMedia+10]/2|0),15,this.spriteMedia+10),this.surface._drawSprite_from5(this.spriteLogo,0,0,this.gameWidth,200),this.surface.drawWorld(this.spriteLogo),t=9216,e=9216,i=1100,s=888,this.scene.clipFar3d=4100,this.scene.clipFar2d=4100,this.scene.fogZFalloff=1,this.scene.fogZDistance=4e3,this.surface.blackScreen(),this.scene.setCamera(t,-this.world.getElevation(t,e),e,912,s,0,2*i),this.scene.render(),this.surface.fadeToBlack(),this.surface.fadeToBlack(),this.surface.drawBox(0,0,this.gameWidth,6,0);for(let r=6;r>=1;r--)this.surface.drawLineAlpha(0,r,0,r,this.gameWidth,8);this.surface.drawBox(0,194,this.gameWidth,20,0);for(let r=6;r>=1;r--)this.surface.drawLineAlpha(0,r,0,194-r,this.gameWidth,8);this.surface._drawSprite_from3((this.gameWidth/2|0)-(this.surface.spriteWidth[this.spriteMedia+10]/2|0),15,this.spriteMedia+10),this.surface._drawSprite_from5(this.spriteLogo+1,0,0,this.gameWidth,200),this.surface.drawWorld(this.spriteLogo+1);for(let r=0;r<64;r++)this.scene.removeModel(this.world.roofModels[0][r]),this.scene.removeModel(this.world.wallModels[1][r]),this.scene.removeModel(this.world.roofModels[1][r]),this.scene.removeModel(this.world.wallModels[2][r]),this.scene.removeModel(this.world.roofModels[2][r]);t=11136,e=10368,i=500,s=376,this.scene.clipFar3d=4100,this.scene.clipFar2d=4100,this.scene.fogZFalloff=1,this.scene.fogZDistance=4e3,this.surface.blackScreen(),this.scene.setCamera(t,-this.world.getElevation(t,e),e,912,s,0,2*i),this.scene.render(),this.surface.fadeToBlack(),this.surface.fadeToBlack(),this.surface.drawBox(0,0,this.gameWidth,6,0);for(let r=6;r>=1;r--)this.surface.drawLineAlpha(0,r,0,r,this.gameWidth,8);this.surface.drawBox(0,194,this.gameWidth,20,0);for(let r=6;r>=1;r--)this.surface.drawLineAlpha(0,r,0,194,this.gameWidth,8);this.surface._drawSprite_from3((this.gameWidth/2|0)-(this.surface.spriteWidth[this.spriteMedia+10]/2|0),15,this.spriteMedia+10),this.surface._drawSprite_from5(this.spriteMedia+10,0,0,this.gameWidth,200),this.surface.drawWorld(this.spriteMedia+10)}}})),K=t((function(t,e){const i=it({});t.exports={drawUiTabInventory:function(t){let e=this.gameWidth-245-3,s=36;this.options.mobile?(e-=32,s=this.gameHeight/2-102):this.surface._drawSprite_from3(this.gameWidth-245-3,3,this.spriteMedia+1),this.uiOpenX=e,this.uiOpenY=s,this.uiOpenWidth=245,this.uiOpenHeight=204;for(let o=0;o<this.inventoryMaxItemCount;o++){const t=e+o%5*49,r=s+34*(o/5|0);if(o<this.inventoryItemsCount&&1===this.inventoryEquipped[o]?this.surface.drawBoxAlpha(t,r,49,34,i.red,128):this.surface.drawBoxAlpha(t,r,49,34,i.darkGrey,128),o<this.inventoryItemsCount){const e=this.spriteItem+bs.itemPicture[this.inventoryItemId[o]],s=bs.itemMask[this.inventoryItemId[o]];this.surface._spriteClipping_from9(t,r,49,32,e,s,0,0,!1),0===bs.itemStackable[this.inventoryItemId[o]]&&this.surface.drawString(this.inventoryItemStackCount[o].toString(),t+1,r+10,1,i.yellow)}}for(let o=1;o<=4;o++)this.surface.drawLineVert(e+49*o,s,34*(this.inventoryMaxItemCount/5|0),i.black);for(let o=1;o<=(this.inventoryMaxItemCount/5|0)-1;o++)this.surface.drawLineHoriz(e,s+34*o,245,i.black);if(!t)return;const r=this.mouseX-e,n=this.mouseY-s;if(r>=0&&n>=0&&r<245&&n<34*(this.inventoryMaxItemCount/5|0)){const t=(r/49|0)+5*(n/34|0);if(t<this.inventoryItemsCount){const e=this.inventoryItemId[t],i="@lre@"+bs.itemName[e];if(this.selectedSpell>=0){if(3===bs.spellType[this.selectedSpell])return this.menuItemText1[this.menuItemsCount]=`Cast ${bs.spellName[this.selectedSpell]} on`,this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=600,this.menuIndex[this.menuItemsCount]=t,this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,void this.menuItemsCount++}else{if(this.selectedItemInventoryIndex>=0)return this.menuItemText1[this.menuItemsCount]=`Use ${this.selectedItemName} with:`,this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=610,this.menuIndex[this.menuItemsCount]=t,this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,void this.menuItemsCount++;1===this.inventoryEquipped[t]?(this.menuItemText1[this.menuItemsCount]="Remove",this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=620,this.menuIndex[this.menuItemsCount]=t,this.menuItemsCount++):0!==bs.itemWearable[e]&&(0!=(24&bs.itemWearable[e])?this.menuItemText1[this.menuItemsCount]="Wield":this.menuItemText1[this.menuItemsCount]="Wear",this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=630,this.menuIndex[this.menuItemsCount]=t,this.menuItemsCount++),""!==bs.itemCommand[e]&&(this.menuItemText1[this.menuItemsCount]=bs.itemCommand[e],this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=640,this.menuIndex[this.menuItemsCount]=t,this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Use",this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=650,this.menuIndex[this.menuItemsCount]=t,this.menuItemsCount++,this.menuItemText1[this.menuItemsCount]="Drop",this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=660,this.menuIndex[this.menuItemsCount]=t,this.menuItemsCount++,this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]=i,this.menuType[this.menuItemsCount]=3600,this.menuIndex[this.menuItemsCount]=e,this.menuItemsCount++}}}}}})),Q=t((function(t,e){const i=it({}),s=["Controlled (+1 of each)","Aggressive (+3 strength)","Accurate (+3 attack)","Defensive (+3 defense)"];t.exports={combatStyle:0,drawDialogCombatStyle:function(){if(0!==this.mouseButtonClick)for(let e=0;e<s.length+1;e++)if(!(e<=0||this.mouseX<=7||this.mouseX>=182||this.mouseY<=15+20*e||this.mouseY>=15+20*e+20)){this.combatStyle=e-1,this.mouseButtonClick=0,this.packetStream.newPacket(ls.COMBAT_STYLE),this.packetStream.putByte(this.combatStyle),this.packetStream.sendPacket();break}for(let e=0;e<s.length+1;e++){const t=e===this.combatStyle+1?i.red:12500670;this.surface.drawBoxAlpha(7,15+20*e,175,20,t,128),this.surface.drawLineHoriz(7,15+20*e,175,i.black),this.surface.drawLineHoriz(7,15+20*e+20,175,i.black)}let t=16;this.surface.drawStringCenter("Select combat style",94,15+t,3,i.white),t+=20;for(const e of s)this.surface.drawStringCenter(e,94,15+t,3,i.black),t+=20}}})),J=t((function(t,e){const i=it({});t.exports={createMessageTabPanel:function(){this.panelMessageTabs=new As(this.surface,10),this.controlTextListAll=this.panelMessageTabs.addTextListInput(7,324,498,14,1,80,!1,!0),this.controlTextListChat=this.panelMessageTabs.addTextList(5,269,502,56,1,20,!0),this.controlTextListQuest=this.panelMessageTabs.addTextList(5,269,502,56,1,20,!0),this.controlTextListPrivate=this.panelMessageTabs.addTextList(5,269,502,56,1,20,!0),this.options.mobile||this.panelMessageTabs.setFocus(this.controlTextListAll)},drawChatMessageTabs:function(){let t=this.gameWidth/2-256|0,e=this.gameHeight-4;this.options.mobile?(e=8,this.surface.drawMinimapSprite(t+256-103,e,this.spriteMedia+23,128,128),this.surface.drawMinimapSprite(t+256+404,e,this.spriteMedia+23,128,128),e=10):(this.surface._drawSprite_from3(t,e,this.spriteMedia+23),e=this.gameHeight+6);let s=i.chatPurple;0===this.messageTabSelected&&(s=i.chatOrange),this.messageTabFlashAll%30>15&&(s=i.chatRed),this.surface.drawStringCenter("All messages",t+54,e,0,s),s=i.chatPurple,1===this.messageTabSelected&&(s=i.chatOrange),this.messageTabFlashHistory%30>15&&(s=i.chatRed),this.surface.drawStringCenter("Chat history",t+155,e,0,s),s=i.chatPurple,2===this.messageTabSelected&&(s=i.chatOrange),this.messageTabFlashQuest%30>15&&(s=i.chatRed),this.surface.drawStringCenter("Quest history",t+255,e,0,s),s=i.chatPurple,3===this.messageTabSelected&&(s=i.chatOrange),this.messageTabFlashPrivate%30>15&&(s=i.chatRed),this.surface.drawStringCenter("Private history",t+355,e,0,s),this.surface.drawStringCenter("Report abuse",t+457,e,0,i.white)},handleMesssageTabsInput:async function(){if(this.mouseY>this.gameHeight-4&&(this.mouseX>15&&this.mouseX<96&&1===this.lastMouseButtonDown&&(this.messageTabSelected=0),this.mouseX>110&&this.mouseX<194&&1===this.lastMouseButtonDown&&(this.messageTabSelected=1,this.panelMessageTabs.controlFlashText[this.controlTextListChat]=999999),this.mouseX>215&&this.mouseX<295&&1===this.lastMouseButtonDown&&(this.messageTabSelected=2,this.panelMessageTabs.controlFlashText[this.controlTextListQuest]=999999),this.mouseX>315&&this.mouseX<395&&1===this.lastMouseButtonDown&&(this.messageTabSelected=3,this.panelMessageTabs.controlFlashText[this.controlTextListPrivate]=999999),this.mouseX>417&&this.mouseX<497&&1===this.lastMouseButtonDown&&(this.showDialogReportAbuseStep=1,this.reportAbuseOffence=0,this.inputTextCurrent="",this.inputTextFinal=""),this.lastMouseButtonDown=0,this.mouseButtonDown=0),this.panelMessageTabs.handleMouse(this.mouseX,this.mouseY,this.lastMouseButtonDown,this.mouseButtonDown,this.mouseScrollDelta),this.messageTabSelected>0&&this.mouseX>=494&&this.mouseY>=this.gameHeight-66&&(this.lastMouseButtonDown=0),this.panelMessageTabs.isClicked(this.controlTextListAll)){let t=this.panelMessageTabs.getText(this.controlTextListAll);if(this.panelMessageTabs.updateText(this.controlTextListAll,""),/^::/.test(t))/^::closecon$/i.test(t)?this.packetStream.closeStream():/^::logout/i.test(t)?this.closeConnection():/^::lostcon$/i.test(t)?await this.lostConnection():this.sendCommandString(t.substring(2));else{const e=Cr.scramble(t);this.sendChatMessage(Cr.scrambledBytes,e),t=Cr.descramble(Cr.scrambledBytes,0,e),this.options.wordFilter&&(t=Ks.filter(t)),this.localPlayer.messageTimeout=150,this.localPlayer.message=t,this.showMessage(`${this.localPlayer.name}: ${t}`,2)}}if(0===this.messageTabSelected)for(let t=0;t<5;t++)this.messageHistoryTimeout[t]>0&&this.messageHistoryTimeout[t]--}}})),tt=t((function(t,e){const i=it({});t.exports={drawDialogBank:function(){if(this.bankActivePage>0&&this.bankItemCount<=48&&(this.bankActivePage=0),this.bankActivePage>1&&this.bankItemCount<=96&&(this.bankActivePage=1),this.bankActivePage>2&&this.bankItemCount<=144&&(this.bankActivePage=2),(this.bankSelectedItemSlot>=this.bankItemCount||this.bankSelectedItemSlot<0)&&(this.bankSelectedItemSlot=-1),-1!==this.bankSelectedItemSlot&&this.bankItems[this.bankSelectedItemSlot]!==this.bankSelectedItem&&(this.bankSelectedItemSlot=-1,this.bankSelectedItem=-2),0!==this.mouseButtonClick){this.mouseButtonClick=0;let t=this.mouseX-((this.gameWidth/2|0)-204),e=this.mouseY-((this.gameHeight/2|0)-167);if(t>=0&&e>=12&&t<408&&e<280){let i=48*this.bankActivePage;for(let r=0;r<6;r++)for(let s=0;s<8;s++){const n=7+49*s,o=28+34*r;t>n&&t<n+49&&e>o&&e<o+34&&i<this.bankItemCount&&-1!==this.bankItems[i]&&(this.bankSelectedItem=this.bankItems[i],this.bankSelectedItemSlot=i),i++}t=52,e=3;let s=0;if(-1!==(s=this.bankSelectedItemSlot<0?-1:this.bankItems[this.bankSelectedItemSlot])){let i=this.bankItemsCount[this.bankSelectedItemSlot];1===bs.itemStackable[s]&&i>1&&(i=1),i>=1&&this.mouseX>=t+220&&this.mouseY>=e+238&&this.mouseX<t+250&&this.mouseY<=e+249&&(this.packetStream.newPacket(ls.BANK_WITHDRAW),this.packetStream.putShort(s),this.packetStream.putShort(1),this.packetStream.putInt(305419896),this.packetStream.sendPacket()),i>=5&&this.mouseX>=t+250&&this.mouseY>=e+238&&this.mouseX<t+280&&this.mouseY<=e+249&&(this.packetStream.newPacket(ls.BANK_WITHDRAW),this.packetStream.putShort(s),this.packetStream.putShort(5),this.packetStream.putInt(305419896),this.packetStream.sendPacket()),i>=25&&this.mouseX>=t+280&&this.mouseY>=e+238&&this.mouseX<t+305&&this.mouseY<=e+249&&(this.packetStream.newPacket(ls.BANK_WITHDRAW),this.packetStream.putShort(s),this.packetStream.putShort(25),this.packetStream.putInt(305419896),this.packetStream.sendPacket()),i>=100&&this.mouseX>=t+305&&this.mouseY>=e+238&&this.mouseX<t+335&&this.mouseY<=e+249&&(this.packetStream.newPacket(ls.BANK_WITHDRAW),this.packetStream.putShort(s),this.packetStream.putShort(100),this.packetStream.putInt(305419896),this.packetStream.sendPacket()),i>=500&&this.mouseX>=t+335&&this.mouseY>=e+238&&this.mouseX<t+368&&this.mouseY<=e+249&&(this.packetStream.newPacket(ls.BANK_WITHDRAW),this.packetStream.putShort(s),this.packetStream.putShort(500),this.packetStream.putInt(305419896),this.packetStream.sendPacket()),i>=2500&&this.mouseX>=t+370&&this.mouseY>=e+238&&this.mouseX<t+400&&this.mouseY<=e+249&&(this.packetStream.newPacket(ls.BANK_WITHDRAW),this.packetStream.putShort(s),this.packetStream.putShort(2500),this.packetStream.putInt(305419896),this.packetStream.sendPacket()),this.getInventoryCount(s)>=1&&this.mouseX>=t+220&&this.mouseY>=e+263&&this.mouseX<t+250&&this.mouseY<=e+274&&(this.packetStream.newPacket(ls.BANK_DEPOSIT),this.packetStream.putShort(s),this.packetStream.putShort(1),this.packetStream.putInt(2271560481),this.packetStream.sendPacket()),this.getInventoryCount(s)>=5&&this.mouseX>=t+250&&this.mouseY>=e+263&&this.mouseX<t+280&&this.mouseY<=e+274&&(this.packetStream.newPacket(ls.BANK_DEPOSIT),this.packetStream.putShort(s),this.packetStream.putShort(5),this.packetStream.putInt(2271560481),this.packetStream.sendPacket()),this.getInventoryCount(s)>=25&&this.mouseX>=t+280&&this.mouseY>=e+263&&this.mouseX<t+305&&this.mouseY<=e+274&&(this.packetStream.newPacket(ls.BANK_DEPOSIT),this.packetStream.putShort(s),this.packetStream.putShort(25),this.packetStream.putInt(2271560481),this.packetStream.sendPacket()),this.getInventoryCount(s)>=100&&this.mouseX>=t+305&&this.mouseY>=e+263&&this.mouseX<t+335&&this.mouseY<=e+274&&(this.packetStream.newPacket(ls.BANK_DEPOSIT),this.packetStream.putShort(s),this.packetStream.putShort(100),this.packetStream.putInt(2271560481),this.packetStream.sendPacket()),this.getInventoryCount(s)>=500&&this.mouseX>=t+335&&this.mouseY>=e+263&&this.mouseX<t+368&&this.mouseY<=e+274&&(this.packetStream.newPacket(ls.BANK_DEPOSIT),this.packetStream.putShort(s),this.packetStream.putShort(500),this.packetStream.putInt(2271560481),this.packetStream.sendPacket()),this.getInventoryCount(s)>=2500&&this.mouseX>=t+370&&this.mouseY>=e+263&&this.mouseX<t+400&&this.mouseY<=e+274&&(this.packetStream.newPacket(ls.BANK_DEPOSIT),this.packetStream.putShort(s),this.packetStream.putShort(2500),this.packetStream.putInt(2271560481),this.packetStream.sendPacket())}}else if(this.bankItemCount>48&&t>=50&&t<=115&&e<=12)this.bankActivePage=0;else if(this.bankItemCount>48&&t>=115&&t<=180&&e<=12)this.bankActivePage=1;else if(this.bankItemCount>96&&t>=180&&t<=245&&e<=12)this.bankActivePage=2;else{if(!(this.bankItemCount>144&&t>=245&&t<=310&&e<=12))return this.packetStream.newPacket(ls.BANK_CLOSE),this.packetStream.sendPacket(),void(this.showDialogBank=!1);this.bankActivePage=3}}const t=(this.gameWidth/2|0)-204,e=(this.gameHeight/2|0)-167;this.surface.drawBox(t,e,408,12,192),this.surface.drawBoxAlpha(t,e+12,408,17,i.grey,160),this.surface.drawBoxAlpha(t,e+29,8,204,i.grey,160),this.surface.drawBoxAlpha(t+399,e+29,9,204,i.grey,160),this.surface.drawBoxAlpha(t,e+233,408,47,i.grey,160),this.surface.drawString("Bank",t+1,e+10,1,i.white);let s=50;if(this.bankItemCount>48){let r=i.white;0===this.bankActivePage?r=i.red:this.mouseX>t+s&&this.mouseY>=e&&this.mouseX<t+s+65&&this.mouseY<e+12&&(r=i.yellow),this.surface.drawString("<page 1>",t+s,e+10,1,r),s+=65,r=i.white,1===this.bankActivePage?r=i.red:this.mouseX>t+s&&this.mouseY>=e&&this.mouseX<t+s+65&&this.mouseY<e+12&&(r=i.yellow),this.surface.drawString("<page 2>",t+s,e+10,1,r),s+=65}if(this.bankItemCount>96){let r=i.white;2===this.bankActivePage?r=i.red:this.mouseX>t+s&&this.mouseY>=e&&this.mouseX<t+s+65&&this.mouseY<e+12&&(r=i.yellow),this.surface.drawString("<page 3>",t+s,e+10,1,r),s+=65}if(this.bankItemCount>144){let r=i.white;3===this.bankActivePage?r=i.red:this.mouseX>t+s&&this.mouseY>=e&&this.mouseX<t+s+65&&this.mouseY<e+12&&(r=i.yellow),this.surface.drawString("<page 4>",t+s,e+10,1,r),s+=65}let r=i.white;this.mouseX>t+320&&this.mouseY>=e&&this.mouseX<t+408&&this.mouseY<e+12&&(r=i.red),this.surface.drawStringRight("Close window",t+406,e+10,1,r),this.surface.drawString("Number in bank in green",t+7,e+24,1,i.green),this.surface.drawString("Number held in blue",t+289,e+24,1,i.cyan);let n=48*this.bankActivePage;for(let a=0;a<6;a++)for(let s=0;s<8;s++){const r=t+7+49*s,o=e+28+34*a;this.bankSelectedItemSlot===n?this.surface.drawBoxAlpha(r,o,49,34,i.red,160):this.surface.drawBoxAlpha(r,o,49,34,i.lightGrey2,160),this.surface.drawBoxEdge(r,o,50,35,0),n<this.bankItemCount&&-1!==this.bankItems[n]&&(this.surface._spriteClipping_from9(r,o,48,32,this.spriteItem+bs.itemPicture[this.bankItems[n]],bs.itemMask[this.bankItems[n]],0,0,!1),this.surface.drawString(this.bankItemsCount[n].toString(),r+1,o+10,1,i.green),this.surface.drawStringRight(this.getInventoryCount(this.bankItems[n]).toString(),r+47,o+29,1,i.cyan)),n++}if(this.surface.drawLineHoriz(t+5,e+256,398,0),-1===this.bankSelectedItemSlot)return void this.surface.drawStringCenter("Select an object to withdraw or deposit",t+204,e+248,3,i.yellow);let o=0;if(-1!==(o=this.bankSelectedItemSlot<0?-1:this.bankItems[this.bankSelectedItemSlot])){let s=this.bankItemsCount[this.bankSelectedItemSlot];1===bs.itemStackable[o]&&s>1&&(s=1),s>0&&(this.surface.drawString("Withdraw "+bs.itemName[o],t+2,e+248,1,i.white),r=i.white,this.mouseX>=t+220&&this.mouseY>=e+238&&this.mouseX<t+250&&this.mouseY<=e+249&&(r=i.red),this.surface.drawString("One",t+222,e+248,1,r),s>=5&&(r=i.white,this.mouseX>=t+250&&this.mouseY>=e+238&&this.mouseX<t+280&&this.mouseY<=e+249&&(r=i.red),this.surface.drawString("Five",t+252,e+248,1,r)),s>=25&&(r=i.white,this.mouseX>=t+280&&this.mouseY>=e+238&&this.mouseX<t+305&&this.mouseY<=e+249&&(r=i.red),this.surface.drawString("25",t+282,e+248,1,r)),s>=100&&(r=i.white,this.mouseX>=t+305&&this.mouseY>=e+238&&this.mouseX<t+335&&this.mouseY<=e+249&&(r=i.red),this.surface.drawString("100",t+307,e+248,1,r)),s>=500&&(r=i.white,this.mouseX>=t+335&&this.mouseY>=e+238&&this.mouseX<t+368&&this.mouseY<=e+249&&(r=i.red),this.surface.drawString("500",t+337,e+248,1,r)),s>=2500&&(r=i.white,this.mouseX>=t+370&&this.mouseY>=e+238&&this.mouseX<t+400&&this.mouseY<=e+249&&(r=i.red),this.surface.drawString("2500",t+370,e+248,1,r))),this.getInventoryCount(o)>0&&(this.surface.drawString("Deposit "+bs.itemName[o],t+2,e+273,1,i.white),r=i.white,this.mouseX>=t+220&&this.mouseY>=e+263&&this.mouseX<t+250&&this.mouseY<=e+274&&(r=i.red),this.surface.drawString("One",t+222,e+273,1,r),this.getInventoryCount(o)>=5&&(r=i.white,this.mouseX>=t+250&&this.mouseY>=e+263&&this.mouseX<t+280&&this.mouseY<=e+274&&(r=i.red),this.surface.drawString("Five",t+252,e+273,1,r)),this.getInventoryCount(o)>=25&&(r=i.white,this.mouseX>=t+280&&this.mouseY>=e+263&&this.mouseX<t+305&&this.mouseY<=e+274&&(r=i.red),this.surface.drawString("25",t+282,e+273,1,r)),this.getInventoryCount(o)>=100&&(r=i.white,this.mouseX>=t+305&&this.mouseY>=e+263&&this.mouseX<t+335&&this.mouseY<=e+274&&(r=i.red),this.surface.drawString("100",t+307,e+273,1,r)),this.getInventoryCount(o)>=500&&(r=i.white,this.mouseX>=t+335&&this.mouseY>=e+263&&this.mouseX<t+368&&this.mouseY<=e+274&&(r=i.red),this.surface.drawString("500",t+337,e+273,1,r)),this.getInventoryCount(o)>=2500&&(r=i.white,this.mouseX>=t+370&&this.mouseY>=e+263&&this.mouseX<t+400&&this.mouseY<=e+274&&(r=i.red),this.surface.drawString("2500",t+370,e+273,1,r)))}}}})),et=t((function(t,e){function i(t,e,i,s){t.addBoxRounded(i,s,53,41);const r=e.split("\n");1===r.length?t.addTextCentre(i,s,e,1,!0):(t.addTextCentre(i,s-8,r[0],1,!0),t.addTextCentre(i,s+8,r[1],1,!0));const n=t.addButton(i-40,s,20,20);t.addSprite(i-40,s,As.baseSpriteStart+7);const o=t.addButton(i+40,s,20,20);return t.addSprite(i+40,s,As.baseSpriteStart+6),{leftButton:n,rightButton:o}}t.exports={createAppearancePanel:function(){this.panelAppearance=new As(this.surface,100);const t=256;this.panelAppearance.addTextCentre(t,10,"Please design Your Character",4,!0);let e=24;this.panelAppearance.addTextCentre(201,e+110,"Front",3,!0),this.panelAppearance.addTextCentre(t,e+110,"Side",3,!0),this.panelAppearance.addTextCentre(311,e+110,"Back",3,!0),e+=145;const{leftButton:s,rightButton:r}=i(this.panelAppearance,"Head\nType",202,e);this.controlButtonAppearanceHeadLeft=s,this.controlButtonAppearanceHeadRight=r;const{leftButton:n,rightButton:o}=i(this.panelAppearance,"Hair\nColor",310,e);this.controlButtonAppearanceHairLeft=n,this.controlButtonAppearanceHairRight=o,e+=50;const{leftButton:a,rightButton:h}=i(this.panelAppearance,"Gender",202,e);this.controlButtonAppearanceGenderLeft=a,this.controlButtonAppearanceGenderRight=h;const{leftButton:l,rightButton:c}=i(this.panelAppearance,"Top\nColor",310,e);this.controlButtonAppearanceTopLeft=l,this.controlButtonAppearanceTopRight=c,e+=50;const{leftButton:u,rightButton:d}=i(this.panelAppearance,"Skin\nColor",202,e);this.controlButtonAppearanceSkinLeft=u,this.controlButtonAppearanceSkinRight=d;const{leftButton:m,rightButton:p}=i(this.panelAppearance,"Bottom\nColor",310,e);this.controlButtonAppearanceBottomLeft=m,this.controlButtonAppearanceBottomRight=p,e+=47,this.panelAppearance.addButtonBackground(t,e,200,30),this.panelAppearance.addTextCentre(t,e,"Accept",4,!1),this.controlButtonAppearanceAccept=this.panelAppearance.addButton(t,e,200,30)},handleAppearancePanelInput:function(){if(this.panelAppearance.handleMouse(this.mouseX,this.mouseY,this.lastMouseButtonDown,this.mouseButtonDown),this.panelAppearance.isClicked(this.controlButtonAppearanceHeadLeft))do{this.appearanceHeadType=(this.appearanceHeadType-1+bs.animationCount)%bs.animationCount}while(1!=(3&bs.animationGender[this.appearanceHeadType])||0==(bs.animationGender[this.appearanceHeadType]&4*this.appearanceHeadGender));if(this.panelAppearance.isClicked(this.controlButtonAppearanceHeadRight))do{this.appearanceHeadType=(this.appearanceHeadType+1)%bs.animationCount}while(1!=(3&bs.animationGender[this.appearanceHeadType])||0==(bs.animationGender[this.appearanceHeadType]&4*this.appearanceHeadGender));if(this.panelAppearance.isClicked(this.controlButtonAppearanceHairLeft)&&(this.appearanceHairColour=(this.appearanceHairColour-1+this.characterHairColours.length)%this.characterHairColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceHairRight)&&(this.appearanceHairColour=(this.appearanceHairColour+1)%this.characterHairColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceGenderLeft)||this.panelAppearance.isClicked(this.controlButtonAppearanceGenderRight)){for(this.appearanceHeadGender=3-this.appearanceHeadGender;1!=(3&bs.animationGender[this.appearanceHeadType])||0==(bs.animationGender[this.appearanceHeadType]&4*this.appearanceHeadGender);this.appearanceHeadType=(this.appearanceHeadType+1)%bs.animationCount);for(;2!=(3&bs.animationGender[this.appearanceBodyGender])||0==(bs.animationGender[this.appearanceBodyGender]&4*this.appearanceHeadGender);this.appearanceBodyGender=(this.appearanceBodyGender+1)%bs.animationCount);}this.panelAppearance.isClicked(this.controlButtonAppearanceTopLeft)&&(this.appearanceTopColour=(this.appearanceTopColour-1+this.characterTopBottomColours.length)%this.characterTopBottomColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceTopRight)&&(this.appearanceTopColour=(this.appearanceTopColour+1)%this.characterTopBottomColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceSkinLeft)&&(this.appearanceSkinColour=(this.appearanceSkinColour-1+this.characterSkinColours.length)%this.characterSkinColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceSkinRight)&&(this.appearanceSkinColour=(this.appearanceSkinColour+1)%this.characterSkinColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceBottomLeft)&&(this.appearanceBottomColour=(this.appearanceBottomColour-1+this.characterTopBottomColours.length)%this.characterTopBottomColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceBottomRight)&&(this.appearanceBottomColour=(this.appearanceBottomColour+1)%this.characterTopBottomColours.length),this.panelAppearance.isClicked(this.controlButtonAppearanceAccept)&&(this.packetStream.newPacket(ls.APPEARANCE),this.packetStream.putByte(this.appearanceHeadGender),this.packetStream.putByte(this.appearanceHeadType),this.packetStream.putByte(this.appearanceBodyGender),this.packetStream.putByte(this.appearance2Colour),this.packetStream.putByte(this.appearanceHairColour),this.packetStream.putByte(this.appearanceTopColour),this.packetStream.putByte(this.appearanceBottomColour),this.packetStream.putByte(this.appearanceSkinColour),this.packetStream.sendPacket(),this.surface.blackScreen(),this.showAppearanceChange=!1)},drawAppearancePanelCharacterSprites:function(){this.surface.interlace=!1,this.surface.blackScreen(),this.panelAppearance.drawPanel();const t=25;this.surface._spriteClipping_from6(169,t,64,102,bs.animationNumber[this.appearance2Colour],this.characterTopBottomColours[this.appearanceBottomColour]),this.surface._spriteClipping_from9(169,t,64,102,bs.animationNumber[this.appearanceBodyGender],this.characterTopBottomColours[this.appearanceTopColour],this.characterSkinColours[this.appearanceSkinColour],0,!1),this.surface._spriteClipping_from9(169,t,64,102,bs.animationNumber[this.appearanceHeadType],this.characterHairColours[this.appearanceHairColour],this.characterSkinColours[this.appearanceSkinColour],0,!1),this.surface._spriteClipping_from6(224,t,64,102,bs.animationNumber[this.appearance2Colour]+6,this.characterTopBottomColours[this.appearanceBottomColour]),this.surface._spriteClipping_from9(224,t,64,102,bs.animationNumber[this.appearanceBodyGender]+6,this.characterTopBottomColours[this.appearanceTopColour],this.characterSkinColours[this.appearanceSkinColour],0,!1),this.surface._spriteClipping_from9(224,t,64,102,bs.animationNumber[this.appearanceHeadType]+6,this.characterHairColours[this.appearanceHairColour],this.characterSkinColours[this.appearanceSkinColour],0,!1),this.surface._spriteClipping_from6(279,t,64,102,bs.animationNumber[this.appearance2Colour]+12,this.characterTopBottomColours[this.appearanceBottomColour]),this.surface._spriteClipping_from9(279,t,64,102,bs.animationNumber[this.appearanceBodyGender]+12,this.characterTopBottomColours[this.appearanceTopColour],this.characterSkinColours[this.appearanceSkinColour],0,!1),this.surface._spriteClipping_from9(279,t,64,102,bs.animationNumber[this.appearanceHeadType]+12,this.characterHairColours[this.appearanceHairColour],this.characterSkinColours[this.appearanceSkinColour],0,!1),this.surface._drawSprite_from3(0,this.gameHeight,this.spriteMedia+22),this.surface.draw(this.graphics,0,0)}}})),it=t((function(t,e){t.exports={black:0,white:16777215,grey:10000536,darkGrey:11908533,lightGrey:14474460,lightGrey2:13684944,lightGrey3:13224393,red:16711680,yellow:16776960,cyan:65535,green:65280,orange:16744448,chatPurple:13158655,chatOrange:16762930,chatRed:16724530}})),st=t((function(t,e){(function(t){(function(){"use strict";e.Buffer=i,e.INSPECT_MAX_BYTES=50;function t(t){if(t>2147483647)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return e.__proto__=i.prototype,e}function i(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return n(t)}return s(t,e,i)}function s(e,s,r){if("string"==typeof e)return function(e,s){if("string"==typeof s&&""!==s||(s="utf8"),!i.isEncoding(s))throw new TypeError("Unknown encoding: "+s);var r=0|h(e,s),n=t(r),o=n.write(e,s);return o!==r&&(n=n.slice(0,o)),n}(e,s);if(ArrayBuffer.isView(e))return o(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(X(e,ArrayBuffer)||e&&X(e.buffer,ArrayBuffer))return function(t,e,s){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(s||0))throw new RangeError('"length" is outside of buffer bounds');var r;return(r=void 0===e&&void 0===s?new Uint8Array(t):void 0===s?new Uint8Array(t,e):new Uint8Array(t,e,s)).__proto__=i.prototype,r}(e,s,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return i.from(n,s,r);var l=function(e){if(i.isBuffer(e)){var s=0|a(e.length),r=t(s);return 0===r.length||e.copy(r,0,0,s),r}return void 0!==e.length?"number"!=typeof e.length||D(e.length)?t(0):o(e):"Buffer"===e.type&&Array.isArray(e.data)?o(e.data):void 0}(e);if(l)return l;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return i.from(e[Symbol.toPrimitive]("string"),s,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function r(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function n(e){return r(e),t(e<0?0:0|a(e))}function o(e){for(var i=e.length<0?0:0|a(e.length),s=t(i),r=0;r<i;r+=1)s[r]=255&e[r];return s}function a(t){if(t>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t}function h(t,e){if(i.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||X(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var s=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===s)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return E(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return P(t).length;default:if(n)return r?-1:E(t).length;e=(""+e).toLowerCase(),n=!0}}function l(t,e,i){var s=t[e];t[e]=t[i],t[i]=s}function c(t,e,s,r,n){if(0===t.length)return-1;if("string"==typeof s?(r=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),D(s=+s)&&(s=n?0:t.length-1),s<0&&(s=t.length+s),s>=t.length){if(n)return-1;s=t.length-1}else if(s<0){if(!n)return-1;s=0}if("string"==typeof e&&(e=i.from(e,r)),i.isBuffer(e))return 0===e.length?-1:u(t,e,s,r,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,s):Uint8Array.prototype.lastIndexOf.call(t,e,s):u(t,[e],s,r,n);throw new TypeError("val must be string, number or Buffer")}function u(t,e,i,s,r){var n,o=1,a=t.length,h=e.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(t.length<2||e.length<2)return-1;o=2,a/=2,h/=2,i/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){var c=-1;for(n=i;n<a;n++)if(l(t,n)===l(e,-1===c?0:n-c)){if(-1===c&&(c=n),n-c+1===h)return c*o}else-1!==c&&(n-=n-c),c=-1}else for(i+h>a&&(i=a-h),n=i;n>=0;n--){for(var u=!0,d=0;d<h;d++)if(l(t,n+d)!==l(e,d)){u=!1;break}if(u)return n}return-1}function d(t,e,i,s){i=Number(i)||0;var r=t.length-i;s?(s=Number(s))>r&&(s=r):s=r;var n=e.length;s>n/2&&(s=n/2);for(var o=0;o<s;++o){var a=parseInt(e.substr(2*o,2),16);if(D(a))return o;t[i+o]=a}return o}function m(t,e,i,s){return Y(E(e,t.length-i),t,i,s)}function p(t,e,i,s){return Y(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,s)}function f(t,e,i,s){return p(t,e,i,s)}function g(t,e,i,s){return Y(P(e),t,i,s)}function w(t,e,i,s){return Y(function(t,e){for(var i,s,r,n=[],o=0;o<t.length&&!((e-=2)<0);++o)s=(i=t.charCodeAt(o))>>8,r=i%256,n.push(r),n.push(s);return n}(e,t.length-i),t,i,s)}function y(t,e,i){return 0===e&&i===t.length?Xt.fromByteArray(t):Xt.fromByteArray(t.slice(e,i))}function b(t,e,i){i=Math.min(t.length,i);for(var s=[],r=e;r<i;){var n,o,a,h,l=t[r],c=null,u=l>239?4:l>223?3:l>191?2:1;if(r+u<=i)switch(u){case 1:l<128&&(c=l);break;case 2:128==(192&(n=t[r+1]))&&(h=(31&l)<<6|63&n)>127&&(c=h);break;case 3:n=t[r+1],o=t[r+2],128==(192&n)&&128==(192&o)&&(h=(15&l)<<12|(63&n)<<6|63&o)>2047&&(h<55296||h>57343)&&(c=h);break;case 4:n=t[r+1],o=t[r+2],a=t[r+3],128==(192&n)&&128==(192&o)&&128==(192&a)&&(h=(15&l)<<18|(63&n)<<12|(63&o)<<6|63&a)>65535&&h<1114112&&(c=h)}null===c?(c=65533,u=1):c>65535&&(c-=65536,s.push(c>>>10&1023|55296),c=56320|1023&c),s.push(c),r+=u}return function(t){var e=t.length;if(e<=C)return String.fromCharCode.apply(String,t);for(var i="",s=0;s<e;)i+=String.fromCharCode.apply(String,t.slice(s,s+=C));return i}(s)}i.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(Ui){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.buffer}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&i[Symbol.species]===i&&Object.defineProperty(i,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),i.poolSize=8192,i.from=function(t,e,i){return s(t,e,i)},i.prototype.__proto__=Uint8Array.prototype,i.__proto__=Uint8Array,i.alloc=function(e,i,s){return function(e,i,s){return r(e),e<=0?t(e):void 0!==i?"string"==typeof s?t(e).fill(i,s):t(e).fill(i):t(e)}(e,i,s)},i.allocUnsafe=function(t){return n(t)},i.allocUnsafeSlow=function(t){return n(t)},i.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==i.prototype},i.compare=function(t,e){if(X(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),X(e,Uint8Array)&&(e=i.from(e,e.offset,e.byteLength)),!i.isBuffer(t)||!i.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var s=t.length,r=e.length,n=0,o=Math.min(s,r);n<o;++n)if(t[n]!==e[n]){s=t[n],r=e[n];break}return s<r?-1:r<s?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return i.alloc(0);var s;if(void 0===e)for(e=0,s=0;s<t.length;++s)e+=t[s].length;var r=i.allocUnsafe(e),n=0;for(s=0;s<t.length;++s){var o=t[s];if(X(o,Uint8Array)&&(o=i.from(o)),!i.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},i.byteLength=h,i.prototype._isBuffer=!0,i.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)l(this,e,e+1);return this},i.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)l(this,e,e+3),l(this,e+1,e+2);return this},i.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)l(this,e,e+7),l(this,e+1,e+6),l(this,e+2,e+5),l(this,e+3,e+4);return this},i.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?b(this,0,t):function(t,e,i){var s=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,i);case"utf8":case"utf-8":return b(this,e,i);case"ascii":return S(this,e,i);case"latin1":case"binary":return I(this,e,i);case"base64":return y(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,i);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===i.compare(this,t)},i.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,i).replace(/(.{2})/g,"$1 ").trim(),this.length>i&&(t+=" ... "),"<Buffer "+t+">"},i.prototype.compare=function(t,e,s,r,n){if(X(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),!i.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===s&&(s=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||s>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=s)return 0;if(r>=n)return-1;if(e>=s)return 1;if(this===t)return 0;for(var o=(n>>>=0)-(r>>>=0),a=(s>>>=0)-(e>>>=0),h=Math.min(o,a),l=this.slice(r,n),c=t.slice(e,s),u=0;u<h;++u)if(l[u]!==c[u]){o=l[u],a=c[u];break}return o<a?-1:a<o?1:0},i.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},i.prototype.indexOf=function(t,e,i){return c(this,t,e,i,!0)},i.prototype.lastIndexOf=function(t,e,i){return c(this,t,e,i,!1)},i.prototype.write=function(t,e,i,s){if(void 0===e)s="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)s=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===s&&(s="utf8")):(s=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var n=!1;;)switch(s){case"hex":return d(this,t,e,i);case"utf8":case"utf-8":return m(this,t,e,i);case"ascii":return p(this,t,e,i);case"latin1":case"binary":return f(this,t,e,i);case"base64":return g(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,t,e,i);default:if(n)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),n=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function S(t,e,i){var s="";i=Math.min(t.length,i);for(var r=e;r<i;++r)s+=String.fromCharCode(127&t[r]);return s}function I(t,e,i){var s="";i=Math.min(t.length,i);for(var r=e;r<i;++r)s+=String.fromCharCode(t[r]);return s}function T(t,e,i){var s,r=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>r)&&(i=r);for(var n="",o=e;o<i;++o)n+=(s=t[o])<16?"0"+s.toString(16):s.toString(16);return n}function x(t,e,i){for(var s=t.slice(e,i),r="",n=0;n<s.length;n+=2)r+=String.fromCharCode(s[n]+256*s[n+1]);return r}function v(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function k(t,e,s,r,n,o){if(!i.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<o)throw new RangeError('"value" argument is out of bounds');if(s+r>t.length)throw new RangeError("Index out of range")}function A(t,e,i,s,r,n){if(i+s>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function B(t,e,i,s,r){return e=+e,i>>>=0,r||A(t,0,i,4),Ht.write(t,e,i,s,23,4),i+4}function L(t,e,i,s,r){return e=+e,i>>>=0,r||A(t,0,i,8),Ht.write(t,e,i,s,52,8),i+8}i.prototype.slice=function(t,e){var s=this.length;(t=~~t)<0?(t+=s)<0&&(t=0):t>s&&(t=s),(e=void 0===e?s:~~e)<0?(e+=s)<0&&(e=0):e>s&&(e=s),e<t&&(e=t);var r=this.subarray(t,e);return r.__proto__=i.prototype,r},i.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);for(var s=this[t],r=1,n=0;++n<e&&(r*=256);)s+=this[t+n]*r;return s},i.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);for(var s=this[t+--e],r=1;e>0&&(r*=256);)s+=this[t+--e]*r;return s},i.prototype.readUInt8=function(t,e){return t>>>=0,e||v(t,1,this.length),this[t]},i.prototype.readUInt16LE=function(t,e){return t>>>=0,e||v(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUInt16BE=function(t,e){return t>>>=0,e||v(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUInt32LE=function(t,e){return t>>>=0,e||v(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},i.prototype.readUInt32BE=function(t,e){return t>>>=0,e||v(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);for(var s=this[t],r=1,n=0;++n<e&&(r*=256);)s+=this[t+n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},i.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);for(var s=e,r=1,n=this[t+--s];s>0&&(r*=256);)n+=this[t+--s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},i.prototype.readInt8=function(t,e){return t>>>=0,e||v(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},i.prototype.readInt16LE=function(t,e){t>>>=0,e||v(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},i.prototype.readInt16BE=function(t,e){t>>>=0,e||v(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},i.prototype.readInt32LE=function(t,e){return t>>>=0,e||v(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,e){return t>>>=0,e||v(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readFloatLE=function(t,e){return t>>>=0,e||v(t,4,this.length),Ht.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,e){return t>>>=0,e||v(t,4,this.length),Ht.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,e){return t>>>=0,e||v(t,8,this.length),Ht.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,e){return t>>>=0,e||v(t,8,this.length),Ht.read(this,t,!1,52,8)},i.prototype.writeUIntLE=function(t,e,i,s){t=+t,e>>>=0,i>>>=0,s||k(this,t,e,i,Math.pow(2,8*i)-1,0);var r=1,n=0;for(this[e]=255&t;++n<i&&(r*=256);)this[e+n]=t/r&255;return e+i},i.prototype.writeUIntBE=function(t,e,i,s){t=+t,e>>>=0,i>>>=0,s||k(this,t,e,i,Math.pow(2,8*i)-1,0);var r=i-1,n=1;for(this[e+r]=255&t;--r>=0&&(n*=256);)this[e+r]=t/n&255;return e+i},i.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,1,255,0),this[e]=255&t,e+1},i.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},i.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeIntLE=function(t,e,i,s){if(t=+t,e>>>=0,!s){var r=Math.pow(2,8*i-1);k(this,t,e,i,r-1,-r)}var n=0,o=1,a=0;for(this[e]=255&t;++n<i&&(o*=256);)t<0&&0===a&&0!==this[e+n-1]&&(a=1),this[e+n]=(t/o>>0)-a&255;return e+i},i.prototype.writeIntBE=function(t,e,i,s){if(t=+t,e>>>=0,!s){var r=Math.pow(2,8*i-1);k(this,t,e,i,r-1,-r)}var n=i-1,o=1,a=0;for(this[e+n]=255&t;--n>=0&&(o*=256);)t<0&&0===a&&0!==this[e+n+1]&&(a=1),this[e+n]=(t/o>>0)-a&255;return e+i},i.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},i.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},i.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeFloatLE=function(t,e,i){return B(this,t,e,!0,i)},i.prototype.writeFloatBE=function(t,e,i){return B(this,t,e,!1,i)},i.prototype.writeDoubleLE=function(t,e,i){return L(this,t,e,!0,i)},i.prototype.writeDoubleBE=function(t,e,i){return L(this,t,e,!1,i)},i.prototype.copy=function(t,e,s,r){if(!i.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<s&&(r=s),r===s)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-s&&(r=t.length-e+s);var n=r-s;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,s,r);else if(this===t&&s<e&&e<r)for(var o=n-1;o>=0;--o)t[o+e]=this[o+s];else Uint8Array.prototype.set.call(t,this.subarray(s,r),e);return n},i.prototype.fill=function(t,e,s,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,s=this.length):"string"==typeof s&&(r=s,s=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!i.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){var n=t.charCodeAt(0);("utf8"===r&&n<128||"latin1"===r)&&(t=n)}}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<s)throw new RangeError("Out of range index");if(s<=e)return this;var o;if(e>>>=0,s=void 0===s?this.length:s>>>0,t||(t=0),"number"==typeof t)for(o=e;o<s;++o)this[o]=t;else{var a=i.isBuffer(t)?t:i.from(t,r),h=a.length;if(0===h)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<s-e;++o)this[o+e]=a[o%h]}return this};var M=/[^+/0-9A-Za-z-_]/g;function E(t,e){var i;e=e||1/0;for(var s=t.length,r=null,n=[],o=0;o<s;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&n.push(239,191,189);continue}if(o+1===s){(e-=3)>-1&&n.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&n.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&n.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;n.push(i)}else if(i<2048){if((e-=2)<0)break;n.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;n.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;n.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return n}function P(t){return Xt.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(M,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Y(t,e,i,s){for(var r=0;r<s&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}function X(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function D(t){return t!=t}}).call(this)}).call(this,st({}).Buffer)})),rt={};class nt{constructor(t,e,i,s=255){this.r=t,this.g=e,this.b=i,this.a=s}toCanvasStyle(){return`rgba(${this.r},${this.g}, ${this.b}, ${this.a})`}}nt.white=new nt(255,255,255),nt.WHITE=nt.white,nt.lightGray=new nt(192,192,192),nt.LIGHT_GRAY=nt.lightGray,nt.gray=new nt(128,128,128),nt.GRAY=nt.gray,nt.darkGray=new nt(64,64,64),nt.DARK_GRAY=nt.darkGray,nt.black=new nt(0,0,0),nt.BLACK=nt.black,nt.red=new nt(255,0,0),nt.RED=nt.red,nt.pink=new nt(255,175,175),nt.PINK=nt.pink,nt.orange=new nt(255,200,0),nt.ORANGE=nt.orange,nt.yellow=new nt(255,255,0),nt.YELLOW=nt.yellow,nt.green=new nt(0,255,0),nt.GREEN=nt.green,nt.magenta=new nt(255,0,255),nt.MAGENTA=nt.magenta,nt.cyan=new nt(0,255,255),nt.CYAN=nt.cyan,nt.blue=new nt(0,0,255),nt.BLUE=nt.blue,rt=nt;var ot=class{constructor(t,e,i){this.name=t,this.type=e,this.size=i}toCanvasFont(){return`${this.getType()} ${this.size}px ${this.name}`}getType(){return 1===this.type?"bold":2===this.type?"italic":"normal"}},at=class{constructor(t){this.buffer=t,this.offset=0}putByte(t){this.buffer[this.offset++]=t}putInt(t){this.buffer[this.offset++]=t>>24,this.buffer[this.offset++]=t>>16,this.buffer[this.offset++]=t>>8,this.buffer[this.offset++]=t}putString(t){for(let e=0;e<t.length;e++)this.buffer[this.offset++]=t.charCodeAt(e);this.buffer[this.offset++]=10}putBytes(t,e,i){for(let s=e;s<i;s++)this.buffer[this.offset++]=t[s]}getUnsignedByte(){return 255&this.buffer[this.offset++]}getUnsignedShort(){return this.offset+=2,((255&this.buffer[this.offset-2])<<8)+(255&this.buffer[this.offset-1])}getUnsignedInt(){return this.offset+=4,((255&this.buffer[this.offset-4])<<24)+((255&this.buffer[this.offset-3])<<16)+((255&this.buffer[this.offset-2])<<8)+(255&this.buffer[this.offset-1])}getBytes(t,e,i){for(let s=e;s<i;s++)t[e+s]=this.buffer[this.offset++]}},ht=ct,lt=null;try{lt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(Ui){}function ct(t,e,i){this.low=0|t,this.high=0|e,this.unsigned=!!i}function ut(t){return!0===(t&&t.__isLong__)}ct.prototype.__isLong__,Object.defineProperty(ct.prototype,"__isLong__",{value:!0}),ct.isLong=ut;var dt={},mt={};function pt(t,e){var i,s,r;return e?(r=0<=(t>>>=0)&&t<256)&&(s=mt[t])?s:(i=gt(t,(0|t)<0?-1:0,!0),r&&(mt[t]=i),i):(r=-128<=(t|=0)&&t<128)&&(s=dt[t])?s:(i=gt(t,t<0?-1:0,!1),r&&(dt[t]=i),i)}function ft(t,e){if(isNaN(t))return e?vt:xt;if(e){if(t<0)return vt;if(t>=St)return Mt}else{if(t<=-It)return Et;if(t+1>=It)return Lt}return t<0?ft(-t,e).neg():gt(t%Ct|0,t/Ct|0,e)}function gt(t,e,i){return new ct(t,e,i)}ct.fromInt=pt,ct.fromNumber=ft,ct.fromBits=gt;var wt=Math.pow;function yt(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return xt;if("number"==typeof e?(i=e,e=!1):e=!!e,(i=i||10)<2||36<i)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===s)return yt(t.substring(1),e,i).neg();for(var r=ft(wt(i,8)),n=xt,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),h=parseInt(t.substring(o,o+a),i);if(a<8){var l=ft(wt(i,a));n=n.mul(l).add(ft(h))}else n=(n=n.mul(r)).add(ft(h))}return n.unsigned=e,n}function bt(t,e){return"number"==typeof t?ft(t,e):"string"==typeof t?yt(t,e):gt(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}ct.fromString=yt,ct.fromValue=bt;var Ct=4294967296,St=Ct*Ct,It=St/2,Tt=pt(1<<24),xt=pt(0);ct.ZERO=xt;var vt=pt(0,!0);ct.UZERO=vt;var kt=pt(1);ct.ONE=kt;var At=pt(1,!0);ct.UONE=At;var Bt=pt(-1);ct.NEG_ONE=Bt;var Lt=gt(-1,2147483647,!1);ct.MAX_VALUE=Lt;var Mt=gt(-1,-1,!0);ct.MAX_UNSIGNED_VALUE=Mt;var Et=gt(0,-2147483648,!1);ct.MIN_VALUE=Et;var Pt=ct.prototype;Pt.toInt=function(){return this.unsigned?this.low>>>0:this.low},Pt.toNumber=function(){return this.unsigned?(this.high>>>0)*Ct+(this.low>>>0):this.high*Ct+(this.low>>>0)},Pt.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Et)){var e=ft(t),i=this.div(e),s=i.mul(e).sub(this);return i.toString(t)+s.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=ft(wt(t,6),this.unsigned),n=this,o="";;){var a=n.div(r),h=(n.sub(a.mul(r)).toInt()>>>0).toString(t);if((n=a).isZero())return h+o;for(;h.length<6;)h="0"+h;o=""+h+o}},Pt.getHighBits=function(){return this.high},Pt.getHighBitsUnsigned=function(){return this.high>>>0},Pt.getLowBits=function(){return this.low},Pt.getLowBitsUnsigned=function(){return this.low>>>0},Pt.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Et)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},Pt.isZero=function(){return 0===this.high&&0===this.low},Pt.eqz=Pt.isZero,Pt.isNegative=function(){return!this.unsigned&&this.high<0},Pt.isPositive=function(){return this.unsigned||this.high>=0},Pt.isOdd=function(){return 1==(1&this.low)},Pt.isEven=function(){return 0==(1&this.low)},Pt.equals=function(t){return ut(t)||(t=bt(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},Pt.eq=Pt.equals,Pt.notEquals=function(t){return!this.eq(t)},Pt.neq=Pt.notEquals,Pt.ne=Pt.notEquals,Pt.lessThan=function(t){return this.comp(t)<0},Pt.lt=Pt.lessThan,Pt.lessThanOrEqual=function(t){return this.comp(t)<=0},Pt.lte=Pt.lessThanOrEqual,Pt.le=Pt.lessThanOrEqual,Pt.greaterThan=function(t){return this.comp(t)>0},Pt.gt=Pt.greaterThan,Pt.greaterThanOrEqual=function(t){return this.comp(t)>=0},Pt.gte=Pt.greaterThanOrEqual,Pt.ge=Pt.greaterThanOrEqual,Pt.compare=function(t){if(ut(t)||(t=bt(t)),this.eq(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},Pt.comp=Pt.compare,Pt.negate=function(){return!this.unsigned&&this.eq(Et)?Et:this.not().add(kt)},Pt.neg=Pt.negate,Pt.add=function(t){ut(t)||(t=bt(t));var e=this.high>>>16,i=65535&this.high,s=this.low>>>16,r=65535&this.low,n=t.high>>>16,o=65535&t.high,a=t.low>>>16,h=0,l=0,c=0,u=0;return c+=(u+=r+(65535&t.low))>>>16,l+=(c+=s+a)>>>16,h+=(l+=i+o)>>>16,h+=e+n,gt((c&=65535)<<16|(u&=65535),(h&=65535)<<16|(l&=65535),this.unsigned)},Pt.subtract=function(t){return ut(t)||(t=bt(t)),this.add(t.neg())},Pt.sub=Pt.subtract,Pt.multiply=function(t){if(this.isZero())return xt;if(ut(t)||(t=bt(t)),lt)return gt(lt.mul(this.low,this.high,t.low,t.high),lt.get_high(),this.unsigned);if(t.isZero())return xt;if(this.eq(Et))return t.isOdd()?Et:xt;if(t.eq(Et))return this.isOdd()?Et:xt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Tt)&&t.lt(Tt))return ft(this.toNumber()*t.toNumber(),this.unsigned);var e=this.high>>>16,i=65535&this.high,s=this.low>>>16,r=65535&this.low,n=t.high>>>16,o=65535&t.high,a=t.low>>>16,h=65535&t.low,l=0,c=0,u=0,d=0;return u+=(d+=r*h)>>>16,c+=(u+=s*h)>>>16,u&=65535,c+=(u+=r*a)>>>16,l+=(c+=i*h)>>>16,c&=65535,l+=(c+=s*a)>>>16,c&=65535,l+=(c+=r*o)>>>16,l+=e*h+i*a+s*o+r*n,gt((u&=65535)<<16|(d&=65535),(l&=65535)<<16|(c&=65535),this.unsigned)},Pt.mul=Pt.multiply,Pt.divide=function(t){if(ut(t)||(t=bt(t)),t.isZero())throw Error("division by zero");var e,i,s;if(lt)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?gt((this.unsigned?lt.div_u:lt.div_s)(this.low,this.high,t.low,t.high),lt.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?vt:xt;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return vt;if(t.gt(this.shru(1)))return At;s=vt}else{if(this.eq(Et))return t.eq(kt)||t.eq(Bt)?Et:t.eq(Et)?kt:(e=this.shr(1).div(t).shl(1)).eq(xt)?t.isNegative()?kt:Bt:(i=this.sub(t.mul(e)),s=e.add(i.div(t)));if(t.eq(Et))return this.unsigned?vt:xt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=xt}for(i=this;i.gte(t);){e=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var r=Math.ceil(Math.log(e)/Math.LN2),n=r<=48?1:wt(2,r-48),o=ft(e),a=o.mul(t);a.isNegative()||a.gt(i);)a=(o=ft(e-=n,this.unsigned)).mul(t);o.isZero()&&(o=kt),s=s.add(o),i=i.sub(a)}return s},Pt.div=Pt.divide,Pt.modulo=function(t){return ut(t)||(t=bt(t)),lt?gt((this.unsigned?lt.rem_u:lt.rem_s)(this.low,this.high,t.low,t.high),lt.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},Pt.mod=Pt.modulo,Pt.rem=Pt.modulo,Pt.not=function(){return gt(~this.low,~this.high,this.unsigned)},Pt.and=function(t){return ut(t)||(t=bt(t)),gt(this.low&t.low,this.high&t.high,this.unsigned)},Pt.or=function(t){return ut(t)||(t=bt(t)),gt(this.low|t.low,this.high|t.high,this.unsigned)},Pt.xor=function(t){return ut(t)||(t=bt(t)),gt(this.low^t.low,this.high^t.high,this.unsigned)},Pt.shiftLeft=function(t){return ut(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?gt(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):gt(0,this.low<<t-32,this.unsigned)},Pt.shl=Pt.shiftLeft,Pt.shiftRight=function(t){return ut(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?gt(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):gt(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},Pt.shr=Pt.shiftRight,Pt.shiftRightUnsigned=function(t){if(ut(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return t<32?gt(this.low>>>t|e<<32-t,e>>>t,this.unsigned):gt(32===t?e:e>>>t-32,0,this.unsigned)},Pt.shru=Pt.shiftRightUnsigned,Pt.shr_u=Pt.shiftRightUnsigned,Pt.toSigned=function(){return this.unsigned?gt(this.low,this.high,!1):this},Pt.toUnsigned=function(){return this.unsigned?this:gt(this.low,this.high,!0)},Pt.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},Pt.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},Pt.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},ct.fromBytes=function(t,e,i){return i?ct.fromBytesLE(t,e):ct.fromBytesBE(t,e)},ct.fromBytesLE=function(t,e){return new ct(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},ct.fromBytesBE=function(t,e){return new ct(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};for(var Yt=class{constructor(){this.hash=new ht,this.name=null,this.serverIndex=0,this.serverId=0,this.currentX=0,this.currentY=0,this.npcId=0,this.stepCount=0,this.animationCurrent=0,this.animationNext=0,this.movingStep=0,this.waypointCurrent=0,this.message=null,this.messageTimeout=0,this.bubbleItem=0,this.bubbleTimeout=0,this.damageTaken=0,this.healthCurrent=0,this.healthMax=0,this.combatTimer=0,this.level=0,this.colourHair=0,this.colourTop=0,this.colourBottom=0,this.colourSkin=0,this.incomingProjectileSprite=0,this.attackingPlayerServerIndex=0,this.attackingNpcServerIndex=0,this.projectileRange=0,this.skullVisible=0,this.waypointsX=new Int32Array(10),this.waypointsY=new Int32Array(10),this.equippedItem=new Int32Array(12),this.level=-1}},Xt={toByteArray:function(t){var e,i,s=Nt(t),r=s[0],n=s[1],o=new Ot(function(t,e,i){return 3*(e+i)/4-i}(0,r,n)),a=0,h=n>0?r-4:r;for(i=0;i<h;i+=4)e=_t[t.charCodeAt(i)]<<18|_t[t.charCodeAt(i+1)]<<12|_t[t.charCodeAt(i+2)]<<6|_t[t.charCodeAt(i+3)],o[a++]=e>>16&255,o[a++]=e>>8&255,o[a++]=255&e;return 2===n&&(e=_t[t.charCodeAt(i)]<<2|_t[t.charCodeAt(i+1)]>>4,o[a++]=255&e),1===n&&(e=_t[t.charCodeAt(i)]<<10|_t[t.charCodeAt(i+1)]<<4|_t[t.charCodeAt(i+2)]>>2,o[a++]=e>>8&255,o[a++]=255&e),o},fromByteArray:function(t){for(var e,i=t.length,s=i%3,r=[],n=0,o=i-s;n<o;n+=16383)r.push(Ft(t,n,n+16383>o?o:n+16383));return 1===s?(e=t[i-1],r.push(Dt[e>>2]+Dt[e<<4&63]+"==")):2===s&&(e=(t[i-2]<<8)+t[i-1],r.push(Dt[e>>10]+Dt[e>>4&63]+Dt[e<<2&63]+"=")),r.join("")}},Dt=[],_t=[],Ot="undefined"!=typeof Uint8Array?Uint8Array:Array,Rt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jt=0,Ut=Rt.length;jt<Ut;++jt)Dt[jt]=Rt[jt],_t[Rt.charCodeAt(jt)]=jt;function Nt(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.indexOf("=");return-1===i&&(i=e),[i,i===e?0:4-i%4]}function Ft(t,e,i){for(var s,r,n=[],o=e;o<i;o+=3)s=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),n.push(Dt[(r=s)>>18&63]+Dt[r>>12&63]+Dt[r>>6&63]+Dt[63&r]);return n.join("")}_t["-".charCodeAt(0)]=62,_t["_".charCodeAt(0)]=63;var Ht={read:function(t,e,i,s,r){var n,o,a=8*r-s-1,h=(1<<a)-1,l=h>>1,c=-7,u=i?r-1:0,d=i?-1:1,m=t[e+u];for(u+=d,n=m&(1<<-c)-1,m>>=-c,c+=a;c>0;n=256*n+t[e+u],u+=d,c-=8);for(o=n&(1<<-c)-1,n>>=-c,c+=s;c>0;o=256*o+t[e+u],u+=d,c-=8);if(0===n)n=1-l;else{if(n===h)return o?NaN:1/0*(m?-1:1);o+=Math.pow(2,s),n-=l}return(m?-1:1)*o*Math.pow(2,n-s)},write:function(t,e,i,s,r,n){var o,a,h,l=8*n-r-1,c=(1<<l)-1,u=c>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,m=s?0:n-1,p=s?1:-1,f=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-o))<1&&(o--,h*=2),(e+=o+u>=1?d/h:d*Math.pow(2,1-u))*h>=2&&(o++,h/=2),o+u>=c?(a=0,o=c):o+u>=1?(a=(e*h-1)*Math.pow(2,r),o+=u):(a=e*Math.pow(2,u-1)*Math.pow(2,r),o=0));r>=8;t[i+m]=255&a,m+=p,a/=256,r-=8);for(o=o<<r|a,l+=r;l>0;t[i+m]=255&o,m+=p,o/=256,l-=8);t[i+m-p]|=128*f}},Wt={};(function(t){(function(){"use strict";const t="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;Wt.Buffer=i,Wt.INSPECT_MAX_BYTES=50;function e(t){if(t>2147483647)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,i.prototype),e}function i(t,e,i){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return n(t)}return s(t,e,i)}function s(t,s,r){if("string"==typeof t)return function(t,s){if("string"==typeof s&&""!==s||(s="utf8"),!i.isEncoding(s))throw new TypeError("Unknown encoding: "+s);const r=0|l(t,s);let n=e(r);const o=n.write(t,s);return o!==r&&(n=n.slice(0,o)),n}(t,s);if(ArrayBuffer.isView(t))return function(t){if(F(t,Uint8Array)){const e=new Uint8Array(t);return a(e.buffer,e.byteOffset,e.byteLength)}return o(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(F(t,ArrayBuffer)||t&&F(t.buffer,ArrayBuffer))return a(t,s,r);if("undefined"!=typeof SharedArrayBuffer&&(F(t,SharedArrayBuffer)||t&&F(t.buffer,SharedArrayBuffer)))return a(t,s,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return i.from(n,s,r);const c=function(t){if(i.isBuffer(t)){const i=0|h(t.length),s=e(i);return 0===s.length||t.copy(s,0,0,i),s}return void 0!==t.length?"number"!=typeof t.length||H(t.length)?e(0):o(t):"Buffer"===t.type&&Array.isArray(t.data)?o(t.data):void 0}(t);if(c)return c;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return i.from(t[Symbol.toPrimitive]("string"),s,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function r(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function n(t){return r(t),e(t<0?0:0|h(t))}function o(t){const i=t.length<0?0:0|h(t.length),s=e(i);for(let e=0;e<i;e+=1)s[e]=255&t[e];return s}function a(t,e,s){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(s||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===s?new Uint8Array(t):void 0===s?new Uint8Array(t,e):new Uint8Array(t,e,s),Object.setPrototypeOf(r,i.prototype),r}function h(t){if(t>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|t}function l(t,e){if(i.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||F(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const s=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===s)return 0;let n=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return U(t).length;default:if(n)return r?-1:j(t).length;e=(""+e).toLowerCase(),n=!0}}function c(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function u(t,e,s,r,n){if(0===t.length)return-1;if("string"==typeof s?(r=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),H(s=+s)&&(s=n?0:t.length-1),s<0&&(s=t.length+s),s>=t.length){if(n)return-1;s=t.length-1}else if(s<0){if(!n)return-1;s=0}if("string"==typeof e&&(e=i.from(e,r)),i.isBuffer(e))return 0===e.length?-1:d(t,e,s,r,n);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(t,e,s):Uint8Array.prototype.lastIndexOf.call(t,e,s):d(t,[e],s,r,n);throw new TypeError("val must be string, number or Buffer")}function d(t,e,i,s,r){let n,o=1,a=t.length,h=e.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(t.length<2||e.length<2)return-1;o=2,a/=2,h/=2,i/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(r){let s=-1;for(n=i;n<a;n++)if(l(t,n)===l(e,-1===s?0:n-s)){if(-1===s&&(s=n),n-s+1===h)return s*o}else-1!==s&&(n-=n-s),s=-1}else for(i+h>a&&(i=a-h),n=i;n>=0;n--){let i=!0;for(let s=0;s<h;s++)if(l(t,n+s)!==l(e,s)){i=!1;break}if(i)return n}return-1}function m(t,e,i,s){i=Number(i)||0;const r=t.length-i;s?(s=Number(s))>r&&(s=r):s=r;const n=e.length;let o;for(s>n/2&&(s=n/2),o=0;o<s;++o){const s=parseInt(e.substr(2*o,2),16);if(H(s))return o;t[i+o]=s}return o}function p(t,e,i,s){return N(j(e,t.length-i),t,i,s)}function f(t,e,i,s){return N(function(t){const e=[];for(let i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,i,s)}function g(t,e,i,s){return N(U(e),t,i,s)}function w(t,e,i,s){return N(function(t,e){let i,s,r;const n=[];for(let o=0;o<t.length&&!((e-=2)<0);++o)i=t.charCodeAt(o),s=i>>8,r=i%256,n.push(r),n.push(s);return n}(e,t.length-i),t,i,s)}function y(t,e,i){return 0===e&&i===t.length?Xt.fromByteArray(t):Xt.fromByteArray(t.slice(e,i))}function b(t,e,i){i=Math.min(t.length,i);const s=[];let r=e;for(;r<i;){const e=t[r];let n=null,o=e>239?4:e>223?3:e>191?2:1;if(r+o<=i){let i,s,a,h;switch(o){case 1:e<128&&(n=e);break;case 2:128==(192&(i=t[r+1]))&&(h=(31&e)<<6|63&i)>127&&(n=h);break;case 3:i=t[r+1],s=t[r+2],128==(192&i)&&128==(192&s)&&(h=(15&e)<<12|(63&i)<<6|63&s)>2047&&(h<55296||h>57343)&&(n=h);break;case 4:i=t[r+1],s=t[r+2],a=t[r+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(h=(15&e)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&h<1114112&&(n=h)}}null===n?(n=65533,o=1):n>65535&&(n-=65536,s.push(n>>>10&1023|55296),n=56320|1023&n),s.push(n),r+=o}return function(t){const e=t.length;if(e<=C)return String.fromCharCode.apply(String,t);let i="",s=0;for(;s<e;)i+=String.fromCharCode.apply(String,t.slice(s,s+=C));return i}(s)}i.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(Ui){return!1}}(),i.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(i.prototype,"parent",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.buffer}}),Object.defineProperty(i.prototype,"offset",{enumerable:!0,get:function(){if(i.isBuffer(this))return this.byteOffset}}),i.poolSize=8192,i.from=function(t,e,i){return s(t,e,i)},Object.setPrototypeOf(i.prototype,Uint8Array.prototype),Object.setPrototypeOf(i,Uint8Array),i.alloc=function(t,i,s){return function(t,i,s){return r(t),t<=0?e(t):void 0!==i?"string"==typeof s?e(t).fill(i,s):e(t).fill(i):e(t)}(t,i,s)},i.allocUnsafe=function(t){return n(t)},i.allocUnsafeSlow=function(t){return n(t)},i.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==i.prototype},i.compare=function(t,e){if(F(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),F(e,Uint8Array)&&(e=i.from(e,e.offset,e.byteLength)),!i.isBuffer(t)||!i.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let s=t.length,r=e.length;for(let i=0,n=Math.min(s,r);i<n;++i)if(t[i]!==e[i]){s=t[i],r=e[i];break}return s<r?-1:r<s?1:0},i.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},i.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return i.alloc(0);let s;if(void 0===e)for(e=0,s=0;s<t.length;++s)e+=t[s].length;const r=i.allocUnsafe(e);let n=0;for(s=0;s<t.length;++s){let e=t[s];if(F(e,Uint8Array))n+e.length>r.length?(i.isBuffer(e)||(e=i.from(e)),e.copy(r,n)):Uint8Array.prototype.set.call(r,e,n);else{if(!i.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,n)}n+=e.length}return r},i.byteLength=l,i.prototype._isBuffer=!0,i.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)c(this,e,e+1);return this},i.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)c(this,e,e+3),c(this,e+1,e+2);return this},i.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)c(this,e,e+7),c(this,e+1,e+6),c(this,e+2,e+5),c(this,e+3,e+4);return this},i.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?b(this,0,t):function(t,e,i){let s=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return T(this,e,i);case"utf8":case"utf-8":return b(this,e,i);case"ascii":return S(this,e,i);case"latin1":case"binary":return I(this,e,i);case"base64":return y(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return x(this,e,i);default:if(s)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}.apply(this,arguments)},i.prototype.toLocaleString=i.prototype.toString,i.prototype.equals=function(t){if(!i.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===i.compare(this,t)},i.prototype.inspect=function(){let t="";const e=Wt.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},t&&(i.prototype[t]=i.prototype.inspect),i.prototype.compare=function(t,e,s,r,n){if(F(t,Uint8Array)&&(t=i.from(t,t.offset,t.byteLength)),!i.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===s&&(s=t?t.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),e<0||s>t.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&e>=s)return 0;if(r>=n)return-1;if(e>=s)return 1;if(this===t)return 0;let o=(n>>>=0)-(r>>>=0),a=(s>>>=0)-(e>>>=0);const h=Math.min(o,a),l=this.slice(r,n),c=t.slice(e,s);for(let i=0;i<h;++i)if(l[i]!==c[i]){o=l[i],a=c[i];break}return o<a?-1:a<o?1:0},i.prototype.includes=function(t,e,i){return-1!==this.indexOf(t,e,i)},i.prototype.indexOf=function(t,e,i){return u(this,t,e,i,!0)},i.prototype.lastIndexOf=function(t,e,i){return u(this,t,e,i,!1)},i.prototype.write=function(t,e,i,s){if(void 0===e)s="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)s=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(i)?(i>>>=0,void 0===s&&(s="utf8")):(s=i,i=void 0)}const r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");let n=!1;for(;;)switch(s){case"hex":return m(this,t,e,i);case"utf8":case"utf-8":return p(this,t,e,i);case"ascii":case"latin1":case"binary":return f(this,t,e,i);case"base64":return g(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,t,e,i);default:if(n)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),n=!0}},i.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const C=4096;function S(t,e,i){let s="";i=Math.min(t.length,i);for(let r=e;r<i;++r)s+=String.fromCharCode(127&t[r]);return s}function I(t,e,i){let s="";i=Math.min(t.length,i);for(let r=e;r<i;++r)s+=String.fromCharCode(t[r]);return s}function T(t,e,i){const s=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>s)&&(i=s);let r="";for(let n=e;n<i;++n)r+=W[t[n]];return r}function x(t,e,i){const s=t.slice(e,i);let r="";for(let n=0;n<s.length-1;n+=2)r+=String.fromCharCode(s[n]+256*s[n+1]);return r}function v(t,e,i){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function k(t,e,s,r,n,o){if(!i.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>n||e<o)throw new RangeError('"value" argument is out of bounds');if(s+r>t.length)throw new RangeError("Index out of range")}function A(t,e,i,s,r){D(e,s,r,t,i,7);let n=Number(e&BigInt(4294967295));t[i++]=n,n>>=8,t[i++]=n,n>>=8,t[i++]=n,n>>=8,t[i++]=n;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[i++]=o,o>>=8,t[i++]=o,o>>=8,t[i++]=o,o>>=8,t[i++]=o,i}function B(t,e,i,s,r){D(e,s,r,t,i,7);let n=Number(e&BigInt(4294967295));t[i+7]=n,n>>=8,t[i+6]=n,n>>=8,t[i+5]=n,n>>=8,t[i+4]=n;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[i+3]=o,o>>=8,t[i+2]=o,o>>=8,t[i+1]=o,o>>=8,t[i]=o,i+8}function L(t,e,i,s,r,n){if(i+s>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function M(t,e,i,s,r){return e=+e,i>>>=0,r||L(t,0,i,4),Ht.write(t,e,i,s,23,4),i+4}function E(t,e,i,s,r){return e=+e,i>>>=0,r||L(t,0,i,8),Ht.write(t,e,i,s,52,8),i+8}i.prototype.slice=function(t,e){const s=this.length;(t=~~t)<0?(t+=s)<0&&(t=0):t>s&&(t=s),(e=void 0===e?s:~~e)<0?(e+=s)<0&&(e=0):e>s&&(e=s),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,i.prototype),r},i.prototype.readUintLE=i.prototype.readUIntLE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);let s=this[t],r=1,n=0;for(;++n<e&&(r*=256);)s+=this[t+n]*r;return s},i.prototype.readUintBE=i.prototype.readUIntBE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);let s=this[t+--e],r=1;for(;e>0&&(r*=256);)s+=this[t+--e]*r;return s},i.prototype.readUint8=i.prototype.readUInt8=function(t,e){return t>>>=0,e||v(t,1,this.length),this[t]},i.prototype.readUint16LE=i.prototype.readUInt16LE=function(t,e){return t>>>=0,e||v(t,2,this.length),this[t]|this[t+1]<<8},i.prototype.readUint16BE=i.prototype.readUInt16BE=function(t,e){return t>>>=0,e||v(t,2,this.length),this[t]<<8|this[t+1]},i.prototype.readUint32LE=i.prototype.readUInt32LE=function(t,e){return t>>>=0,e||v(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},i.prototype.readUint32BE=i.prototype.readUInt32BE=function(t,e){return t>>>=0,e||v(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},i.prototype.readBigUInt64LE=V((function(t){_(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||O(t,this.length-8);const s=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,r=this[++t]+256*this[++t]+65536*this[++t]+i*2**24;return BigInt(s)+(BigInt(r)<<BigInt(32))})),i.prototype.readBigUInt64BE=V((function(t){_(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||O(t,this.length-8);const s=e*2**24+65536*this[++t]+256*this[++t]+this[++t],r=this[++t]*2**24+65536*this[++t]+256*this[++t]+i;return(BigInt(s)<<BigInt(32))+BigInt(r)})),i.prototype.readIntLE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);let s=this[t],r=1,n=0;for(;++n<e&&(r*=256);)s+=this[t+n]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*e)),s},i.prototype.readIntBE=function(t,e,i){t>>>=0,e>>>=0,i||v(t,e,this.length);let s=e,r=1,n=this[t+--s];for(;s>0&&(r*=256);)n+=this[t+--s]*r;return n>=(r*=128)&&(n-=Math.pow(2,8*e)),n},i.prototype.readInt8=function(t,e){return t>>>=0,e||v(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},i.prototype.readInt16LE=function(t,e){t>>>=0,e||v(t,2,this.length);const i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},i.prototype.readInt16BE=function(t,e){t>>>=0,e||v(t,2,this.length);const i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},i.prototype.readInt32LE=function(t,e){return t>>>=0,e||v(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},i.prototype.readInt32BE=function(t,e){return t>>>=0,e||v(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},i.prototype.readBigInt64LE=V((function(t){_(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||O(t,this.length-8);const s=this[t+4]+256*this[t+5]+65536*this[t+6]+(i<<24);return(BigInt(s)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),i.prototype.readBigInt64BE=V((function(t){_(t>>>=0,"offset");const e=this[t],i=this[t+7];void 0!==e&&void 0!==i||O(t,this.length-8);const s=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(s)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+i)})),i.prototype.readFloatLE=function(t,e){return t>>>=0,e||v(t,4,this.length),Ht.read(this,t,!0,23,4)},i.prototype.readFloatBE=function(t,e){return t>>>=0,e||v(t,4,this.length),Ht.read(this,t,!1,23,4)},i.prototype.readDoubleLE=function(t,e){return t>>>=0,e||v(t,8,this.length),Ht.read(this,t,!0,52,8)},i.prototype.readDoubleBE=function(t,e){return t>>>=0,e||v(t,8,this.length),Ht.read(this,t,!1,52,8)},i.prototype.writeUintLE=i.prototype.writeUIntLE=function(t,e,i,s){t=+t,e>>>=0,i>>>=0,s||k(this,t,e,i,Math.pow(2,8*i)-1,0);let r=1,n=0;for(this[e]=255&t;++n<i&&(r*=256);)this[e+n]=t/r&255;return e+i},i.prototype.writeUintBE=i.prototype.writeUIntBE=function(t,e,i,s){t=+t,e>>>=0,i>>>=0,s||k(this,t,e,i,Math.pow(2,8*i)-1,0);let r=i-1,n=1;for(this[e+r]=255&t;--r>=0&&(n*=256);)this[e+r]=t/n&255;return e+i},i.prototype.writeUint8=i.prototype.writeUInt8=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,1,255,0),this[e]=255&t,e+1},i.prototype.writeUint16LE=i.prototype.writeUInt16LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeUint16BE=i.prototype.writeUInt16BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeUint32LE=i.prototype.writeUInt32LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},i.prototype.writeUint32BE=i.prototype.writeUInt32BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeBigUInt64LE=V((function(t,e=0){return A(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),i.prototype.writeBigUInt64BE=V((function(t,e=0){return B(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),i.prototype.writeIntLE=function(t,e,i,s){if(t=+t,e>>>=0,!s){const s=Math.pow(2,8*i-1);k(this,t,e,i,s-1,-s)}let r=0,n=1,o=0;for(this[e]=255&t;++r<i&&(n*=256);)t<0&&0===o&&0!==this[e+r-1]&&(o=1),this[e+r]=(t/n>>0)-o&255;return e+i},i.prototype.writeIntBE=function(t,e,i,s){if(t=+t,e>>>=0,!s){const s=Math.pow(2,8*i-1);k(this,t,e,i,s-1,-s)}let r=i-1,n=1,o=0;for(this[e+r]=255&t;--r>=0&&(n*=256);)t<0&&0===o&&0!==this[e+r+1]&&(o=1),this[e+r]=(t/n>>0)-o&255;return e+i},i.prototype.writeInt8=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},i.prototype.writeInt16LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},i.prototype.writeInt16BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},i.prototype.writeInt32LE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},i.prototype.writeInt32BE=function(t,e,i){return t=+t,e>>>=0,i||k(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},i.prototype.writeBigInt64LE=V((function(t,e=0){return A(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),i.prototype.writeBigInt64BE=V((function(t,e=0){return B(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),i.prototype.writeFloatLE=function(t,e,i){return M(this,t,e,!0,i)},i.prototype.writeFloatBE=function(t,e,i){return M(this,t,e,!1,i)},i.prototype.writeDoubleLE=function(t,e,i){return E(this,t,e,!0,i)},i.prototype.writeDoubleBE=function(t,e,i){return E(this,t,e,!1,i)},i.prototype.copy=function(t,e,s,r){if(!i.isBuffer(t))throw new TypeError("argument should be a Buffer");if(s||(s=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<s&&(r=s),r===s)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-s&&(r=t.length-e+s);const n=r-s;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,s,r):Uint8Array.prototype.set.call(t,this.subarray(s,r),e),n},i.prototype.fill=function(t,e,s,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,s=this.length):"string"==typeof s&&(r=s,s=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!i.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<s)throw new RangeError("Out of range index");if(s<=e)return this;let n;if(e>>>=0,s=void 0===s?this.length:s>>>0,t||(t=0),"number"==typeof t)for(n=e;n<s;++n)this[n]=t;else{const o=i.isBuffer(t)?t:i.from(t,r),a=o.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(n=0;n<s-e;++n)this[n+e]=o[n%a]}return this};const P={};function Y(t,e,i){P[t]=class extends i{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function X(t){let e="",i=t.length;const s="-"===t[0]?1:0;for(;i>=s+4;i-=3)e=`_${t.slice(i-3,i)}${e}`;return`${t.slice(0,i)}${e}`}function D(t,e,i,s,r,n){if(t>i||t<e){const s="bigint"==typeof e?"n":"";let r;throw r=n>3?0===e||e===BigInt(0)?`>= 0${s} and < 2${s} ** ${8*(n+1)}${s}`:`>= -(2${s} ** ${8*(n+1)-1}${s}) and < 2 ** ${8*(n+1)-1}${s}`:`>= ${e}${s} and <= ${i}${s}`,new P.ERR_OUT_OF_RANGE("value",r,t)}!function(t,e,i){_(e,"offset"),void 0!==t[e]&&void 0!==t[e+i]||O(e,t.length-(i+1))}(s,r,n)}function _(t,e){if("number"!=typeof t)throw new P.ERR_INVALID_ARG_TYPE(e,"number",t)}function O(t,e,i){if(Math.floor(t)!==t)throw _(t,i),new P.ERR_OUT_OF_RANGE(i||"offset","an integer",t);if(e<0)throw new P.ERR_BUFFER_OUT_OF_BOUNDS;throw new P.ERR_OUT_OF_RANGE(i||"offset",`>= ${i?1:0} and <= ${e}`,t)}Y("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?t+" is outside of buffer bounds":"Attempt to access memory outside buffer bounds"}),RangeError),Y("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),Y("ERR_OUT_OF_RANGE",(function(t,e,i){let s=`The value of "${t}" is out of range.`,r=i;return Number.isInteger(i)&&Math.abs(i)>2**32?r=X(String(i)):"bigint"==typeof i&&(r=String(i),(i>BigInt(2)**BigInt(32)||i<-(BigInt(2)**BigInt(32)))&&(r=X(r)),r+="n"),s+` It must be ${e}. Received ${r}`}),RangeError);const R=/[^+/0-9A-Za-z-_]/g;function j(t,e){let i;e=e||1/0;const s=t.length;let r=null;const n=[];for(let o=0;o<s;++o){if((i=t.charCodeAt(o))>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&n.push(239,191,189);continue}if(o+1===s){(e-=3)>-1&&n.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&n.push(239,191,189),r=i;continue}i=65536+(r-55296<<10|i-56320)}else r&&(e-=3)>-1&&n.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;n.push(i)}else if(i<2048){if((e-=2)<0)break;n.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;n.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;n.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return n}function U(t){return Xt.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(R,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function N(t,e,i,s){let r;for(r=0;r<s&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}function F(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function H(t){return t!=t}const W=function(){const t=new Array(256);for(let e=0;e<16;++e){const i=16*e;for(let s=0;s<16;++s)t[i+s]="0123456789abcdef"[e]+"0123456789abcdef"[s]}return t}();function V(t){return"undefined"==typeof BigInt?G:t}function G(){throw new Error("BigInt not supported")}}).call(this)}).call(this,st({}).Buffer);var Vt={};Vt=Object.freeze?Object.freeze:function(t){return t};var Gt={},Zt=function(){};Zt.prototype.readByte=function(){var t=[0];return 0===this.read(t,0,1)?(this._eof=!0,-1):t[0]},Zt.prototype.read=function(t,e,i){for(var s,r=0;r<i;){if(-1===(s=this.readByte())){this._eof=!0;break}t[e+r++]=s}return r},Zt.prototype.eof=function(){return!!this._eof},Zt.prototype.seek=function(t){throw new Error("Stream is not seekable.")},Zt.prototype.tell=function(){throw new Error("Stream is not seekable.")},Zt.prototype.writeByte=function(t){var e=[t];this.write(e,0,1)},Zt.prototype.write=function(t,e,i){var s;for(s=0;s<i;s++)this.writeByte(t[e+s]);return i},Zt.prototype.flush=function(){},Zt.EOF=-1,Gt=Vt(Zt);var zt={},qt=function(t){(function(){var e=256;this.readBit=function(){if(0==(255&e)){var i=t.readByte();if(i===Gt.EOF)return this._eof=!0,i;e=i<<1|1}var s=256&e?1:0;return e<<=1,s},this.seekBit=function(t){var e=t>>>3,i=t-8*e;this.seek(e),this._eof=!1,this.readBits(i)},this.tellBit=function(){for(var i=8*t.tell(),s=e;0!=(255&s);)i--,s<<=1;return i},this.readByte=function(){return 0==(255&e)?t.readByte():this.readBits(8)},this.seek=function(i){t.seek(i),e=256}}).call(this),function(){var e=1;this.writeBit=function(i){e<<=1,i&&(e|=1),256&e&&(t.writeByte(255&e),e=1)},this.writeByte=function(i){1===e?t.writeByte(i):t.writeBits(8,i)},this.flush=function(){for(;1!==e;)this.writeBit(0);t.flush&&t.flush()}}.call(this)};qt.EOF=Gt.EOF,(qt.prototype=Object.create(Gt.prototype)).readBits=function(t){var e,i=0;if(t>31)return(i=65536*this.readBits(t-16))+this.readBits(16);for(e=0;e<t;e++)i<<=1,this.readBit()>0&&i++;return i},qt.prototype.writeBits=function(t,e){if(t>32){var i=65535&e,s=(e-i)/65536;return this.writeBits(t-16,s),void this.writeBits(16,i)}var r;for(r=t-1;r>=0;r--)this.writeBit(e>>>r&1)},zt=qt;var $t,Kt,Qt,Jt=$t={};function te(){throw new Error("setTimeout has not been defined")}function ee(){throw new Error("clearTimeout has not been defined")}function ie(t){if(Kt===setTimeout)return setTimeout(t,0);if((Kt===te||!Kt)&&setTimeout)return Kt=setTimeout,setTimeout(t,0);try{return Kt(t,0)}catch(Ui){try{return Kt.call(null,t,0)}catch(Ui){return Kt.call(this,t,0)}}}!function(){try{Kt="function"==typeof setTimeout?setTimeout:te}catch(Ui){Kt=te}try{Qt="function"==typeof clearTimeout?clearTimeout:ee}catch(Ui){Qt=ee}}();var se,re=[],ne=!1,oe=-1;function ae(){ne&&se&&(ne=!1,se.length?re=se.concat(re):oe=-1,re.length&&he())}function he(){if(!ne){var t=ie(ae);ne=!0;for(var e=re.length;e;){for(se=re,re=[];++oe<e;)se&&se[oe].run();oe=-1,e=re.length}se=null,ne=!1,function(t){if(Qt===clearTimeout)return clearTimeout(t);if((Qt===ee||!Qt)&&clearTimeout)return Qt=clearTimeout,clearTimeout(t);try{Qt(t)}catch(Ui){try{return Qt.call(null,t)}catch(Ui){return Qt.call(this,t)}}}(t)}}function le(t,e){this.fun=t,this.array=e}function ce(){}Jt.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];re.push(new le(t,e)),1!==re.length||ne||ie(he)},le.prototype.run=function(){this.fun.apply(null,this.array)},Jt.title="browser",Jt.browser=!0,Jt.env={},Jt.argv=[],Jt.version="",Jt.versions={},Jt.on=ce,Jt.addListener=ce,Jt.once=ce,Jt.off=ce,Jt.removeListener=ce,Jt.removeAllListeners=ce,Jt.emit=ce,Jt.prependListener=ce,Jt.prependOnceListener=ce,Jt.listeners=function(t){return[]},Jt.binding=function(t){throw new Error("process.binding is not supported")},Jt.cwd=function(){return"/"},Jt.chdir=function(t){throw new Error("process.chdir is not supported")},Jt.umask=function(){return 0};var ue={};(function(t,e){(function(){var i=Object.create(null),s=Gt.EOF;i.coerceInputStream=function(t,e){if("readByte"in t){if(e&&!("read"in t)){var i=t;(t=new Gt).readByte=function(){var t=i.readByte();return t===s&&(this._eof=!0),t},"size"in i&&(t.size=i.size),"seek"in i&&(t.seek=function(t){i.seek(t),this._eof=!1}),"tell"in i&&(t.tell=i.tell.bind(i))}}else{var r=t;(t=new Gt).size=r.length,t.pos=0,t.readByte=function(){return this.pos>=this.size?s:r[this.pos++]},t.read=function(t,e,i){for(var s=0;s<i&&this.pos<r.length;)t[e++]=r[this.pos++],s++;return s},t.seek=function(t){this.pos=t},t.tell=function(){return this.pos},t.eof=function(){return this.pos>=r.length}}return t};var r=function(t,e){this.buffer=t,this.resizeOk=e,this.pos=0};(r.prototype=Object.create(Gt.prototype)).writeByte=function(t){if(this.resizeOk&&this.pos>=this.buffer.length){var e=i.makeU8Buffer(2*this.buffer.length);e.set(this.buffer),this.buffer=e}this.buffer[this.pos++]=t},r.prototype.getBuffer=function(){if(this.pos!==this.buffer.length){if(!this.resizeOk)throw new TypeError("outputsize does not match decoded input");var t=i.makeU8Buffer(this.pos);t.set(this.buffer.subarray(0,this.pos)),this.buffer=t}return this.buffer},i.coerceOutputStream=function(t,e){var s={stream:t,retval:t};if(t){if("object"==typeof t&&"writeByte"in t)return s;s.stream=new r("number"==typeof e?i.makeU8Buffer(e):t,!1)}else s.stream=new r(i.makeU8Buffer(16384),!0);return Object.defineProperty(s,"retval",{get:s.stream.getBuffer.bind(s.stream)}),s},i.compressFileHelper=function(t,e,s){return function(r,n,o){r=i.coerceInputStream(r);var a,h,l=i.coerceOutputStream(n,n);for(n=l.stream,a=0;a<t.length;a++)n.writeByte(t.charCodeAt(a));if(h="size"in r&&r.size>=0?r.size:-1,s){var c=i.coerceOutputStream([]);for(i.writeUnsignedNumber(c.stream,h+1),c=c.retval,a=0;a<c.length-1;a++)n.writeByte(c[a]);s=c[c.length-1]}else i.writeUnsignedNumber(n,h+1);return e(r,n,h,o,s),l.retval}},i.decompressFileHelper=function(t,e){return function(s,r){var n;for(s=i.coerceInputStream(s),n=0;n<t.length;n++)if(t.charCodeAt(n)!==s.readByte())throw new Error("Bad magic");var o=i.readUnsignedNumber(s)-1,a=i.coerceOutputStream(r,o);return r=a.stream,e(s,r,o),a.retval}},i.compressWithModel=function(t,e,i){for(var r=0;r!==e;){var n=t.readByte();if(n===s){i.encode(256);break}i.encode(n),r++}},i.decompressWithModel=function(t,e,i){for(var s=0;s!==e;){var r=i.decode();if(256===r)break;t.writeByte(r),s++}},i.writeUnsignedNumber=function(t,e){var i,s=[];do{s.push(127&e),e=Math.floor(e/128)}while(0!==e);for(s[0]|=128,i=s.length-1;i>=0;i--)t.writeByte(s[i]);return t},i.readUnsignedNumber=function(t){for(var e,i=0;;){if(128&(e=t.readByte())){i+=127&e;break}i=128*(i+e)}return i};var n=function(t){for(var e=0,i=t.length;e<i;e++)t[e]=0;return t},o=function(t){return n(new Array(t))},a=function(t){return t};void 0!==t&&Array.prototype.some.call(new Uint32Array(128),(function(t){return 0!==t}))&&(a=n),i.makeU8Buffer="undefined"!=typeof Uint8Array?function(t){return a(new Uint8Array(t))}:void 0!==e?function(t){var i=new e(t);return i.fill(0),i}:o,i.makeU16Buffer="undefined"!=typeof Uint16Array?function(t){return a(new Uint16Array(t))}:o,i.makeU32Buffer="undefined"!=typeof Uint32Array?function(t){return a(new Uint32Array(t))}:o,i.makeS32Buffer="undefined"!=typeof Int32Array?function(t){return a(new Int32Array(t))}:o,i.arraycopy=function(t,e){for(var i=0,s=e.length;i<s;i++)t[i]=e[i];return t};var h=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],l=i.fls=function(t){return t>4294967295?32+l(Math.floor(t/4294967296)):0!=(4294901760&t)?0!=(4278190080&t)?24+h[t>>>24&255]:16+h[t>>>16]:0!=(65280&t)?8+h[t>>>8]:h[t]};i.log2c=function(t){return 0===t?-1:l(t-1)},ue=Vt(i)}).call(this)}).call(this,$t,st({}).Buffer);var de={},me=console.assert.bind(console),pe=function(t,e,i,s){var r;for(r=0;r<s;r++)e[r]=0;for(r=0;r<i;r++)e[t[r]]++},fe=function(t,e,i,s){var r,n=0;if(s)for(r=0;r<i;r++)n+=t[r],e[r]=n;else for(r=0;r<i;r++)n+=t[r],e[r]=n-t[r]},ge=function(t,e,i,s,r,n){var o,a,h,l,c,u,d,m,p,f,g,w,y,b=0,C=0;for(r<=256?(o=ue.makeS32Buffer(r),r<=i?(a=e.subarray(s+i-r),C=1):(a=ue.makeS32Buffer(r),C=3)):r<=i?(o=e.subarray(s+i-r),r<=i-r?(a=e.subarray(s+i-2*r),C=0):r<=1024?(a=ue.makeS32Buffer(r),C=2):(a=o,C=8)):(o=a=ue.makeS32Buffer(r),C=12),pe(t,o,s,r),fe(o,a,r,!0),l=0;l<s;l++)e[l]=0;u=-1,l=s-1,c=s,d=0,w=t[s-1];do{y=w}while(--l>=0&&(w=t[l])>=y);for(;l>=0;){do{y=w}while(--l>=0&&(w=t[l])<=y);if(l>=0){u>=0&&(e[u]=c),u=--a[y],c=l,++d;do{y=w}while(--l>=0&&(w=t[l])>=y)}}if(d>1?(function(t,e,i,s,r,n){var o,a,h,l,c;for(i===s&&pe(t,i,r,n),fe(i,s,n,!1),o=s[c=t[h=r-1]],h--,e[o++]=t[h]<c?~h:h,a=0;a<r;a++)(h=e[a])>0?(me(t[h]>=t[h+1]),(l=t[h])!==c&&(s[c]=o,o=s[c=l]),me(a<o),h--,e[o++]=t[h]<c?~h:h,e[a]=0):h<0&&(e[a]=~h);for(i===s&&pe(t,i,r,n),fe(i,s,n,1),a=r-1,o=s[c=0];a>=0;a--)(h=e[a])>0&&(me(t[h]<=t[h+1]),(l=t[h])!==c&&(s[c]=o,o=s[c=l]),me(o<=a),h--,e[--o]=t[h]>c?~(h+1):h,e[a]=0)}(t,e,o,a,s,r),f=function(t,e,i,s){var r,n,o,a,h,l,c,u,d,m;for(me(i>0),r=0;(o=e[r])<0;r++)e[r]=~o,me(r+1<i);if(r<s)for(n=r,r++;me(r<i),!((o=e[r])<0&&(e[n++]=~o,e[r]=0,n===s));r++);u=t[r=n=i-1];do{d=u}while(--r>=0&&(u=t[r])>=d);for(;r>=0;){do{d=u}while(--r>=0&&(u=t[r])<=d);if(r>=0){e[s+(r+1>>>1)]=n-r,n=r+1;do{d=u}while(--r>=0&&(u=t[r])>=d)}}for(r=0,c=0,a=i,l=0;r<s;r++){if(m=!0,(h=e[s+((o=e[r])>>>1)])===l&&a+h<i){for(n=0;n<h&&t[o+n]===t[a+n];)n++;n===h&&(m=!1)}m&&(c++,a=o,l=h),e[s+(o>>>1)]=c}return c}(t,e,s,d)):1===d?(e[u]=c+1,f=1):f=0,f<d){for(0!=(4&C)&&(o=null,a=null),0!=(2&C)&&(a=null),g=s+i-2*d,0==(13&C)&&(r+f<=g?g-=r:C|=8),me(s>>>1<=g+d),l=d+(s>>>1)-1,c=2*d+g-1;d<=l;l--)0!==e[l]&&(e[c--]=e[l]-1);h=e.subarray(d+g),ge(h,e,g,d,f,!1),h=null,l=s-1,c=2*d-1,w=t[s-1];do{y=w}while(--l>=0&&(w=t[l])>=y);for(;l>=0;){do{y=w}while(--l>=0&&(w=t[l])<=y);if(l>=0){e[c--]=l+1;do{y=w}while(--l>=0&&(w=t[l])>=y)}}for(l=0;l<d;l++)e[l]=e[d+e[l]];0!=(4&C)&&(o=a=ue.makeS32Buffer(r)),0!=(2&C)&&(a=ue.makeS32Buffer(r))}if(0!=(8&C)&&pe(t,o,s,r),d>1){fe(o,a,r,!0),l=d-1,c=s,y=t[m=e[d-1]];do{for(p=a[w=y];p<c;)e[--c]=0;do{if(e[--c]=m,--l<0)break;m=e[l]}while((y=t[m])===w)}while(l>=0);for(;c>0;)e[--c]=0}return n?b=function(t,e,i,s,r,n){var o,a,h,l,c,u=-1;for(i===s&&pe(t,i,r,n),fe(i,s,n,!1),o=s[c=t[h=r-1]],e[o++]=h>0&&t[h-1]<c?~h:h,a=0;a<r;a++)(h=e[a])>0?(me(t[--h]>=t[h+1]),e[a]=~(l=t[h]),l!==c&&(s[c]=o,o=s[c=l]),me(a<o),e[o++]=h>0&&t[h-1]<c?~h:h):0!==h&&(e[a]=~h);for(i===s&&pe(t,i,r,n),fe(i,s,n,!0),a=r-1,o=s[c=0];a>=0;a--)(h=e[a])>0?(me(t[--h]<=t[h+1]),e[a]=l=t[h],l!==c&&(s[c]=o,o=s[c=l]),me(o<=a),e[--o]=h>0&&t[h-1]>c?~t[h-1]:h):0!==h?e[a]=~h:u=a;return u}(t,e,o,a,s,r):function(t,e,i,s,r,n){var o,a,h,l,c;for(i===s&&pe(t,i,r,n),fe(i,s,n,!1),o=s[c=t[h=r-1]],e[o++]=h>0&&t[h-1]<c?~h:h,a=0;a<r;a++)h=e[a],e[a]=~h,h>0&&(me(t[--h]>=t[h+1]),(l=t[h])!==c&&(s[c]=o,o=s[c=l]),me(a<o),e[o++]=h>0&&t[h-1]<c?~h:h);for(i===s&&pe(t,i,r,n),fe(i,s,n,!0),a=r-1,o=s[c=0];a>=0;a--)(h=e[a])>0?(me(t[--h]<=t[h+1]),(l=t[h])!==c&&(s[c]=o,o=s[c=l]),me(o<=a),e[--o]=0===h||t[h-1]>c?~h:h):e[a]=~h}(t,e,o,a,s,r),o=null,a=null,b},we=Object.create(null);we.suffixsort=function(t,e,i,s){if(me(t&&e&&t.length>=i&&e.length>=i),i<=1)return 1===i&&(e[0]=0),0;if(!s)if(1===t.BYTES_PER_ELEMENT)s=256;else{if(2!==t.BYTES_PER_ELEMENT)throw new Error("Need to specify alphabetSize");s=65536}return me(s>0),t.BYTES_PER_ELEMENT&&me(s<=1<<8*t.BYTES_PER_ELEMENT),ge(t,e,0,i,s,!1)},we.bwtransform=function(t,e,i,s,r){var n,o;if(me(t&&e&&i),me(t.length>=s&&e.length>=s&&i.length>=s),s<=1)return 1===s&&(e[0]=t[0]),s;if(!r)if(1===t.BYTES_PER_ELEMENT)r=256;else{if(2!==t.BYTES_PER_ELEMENT)throw new Error("Need to specify alphabetSize");r=65536}for(me(r>0),t.BYTES_PER_ELEMENT&&me(r<=1<<8*t.BYTES_PER_ELEMENT),o=ge(t,i,0,s,r,!0),e[0]=t[s-1],n=0;n<o;n++)e[n+1]=i[n];for(n+=1;n<s;n++)e[n]=i[n];return o+1},we.unbwtransform=function(t,e,i,s,r){var n,o,a=ue.makeU32Buffer(256);for(n=0;n<256;n++)a[n]=0;for(n=0;n<s;n++)i[n]=a[t[n]]++;for(n=0,o=0;n<256;n++)o+=a[n],a[n]=o-a[n];for(n=s-1,o=0;n>=0;n--)o=i[o]+a[e[n]=t[o]],o+=o<r?1:0;a=null},we.bwtransform2=function(t,e,i,s){var r,n,o,a=0;if(me(t&&e),me(t.length>=i&&e.length>=i),i<=1)return 1===i&&(e[0]=t[0]),0;if(!s)if(1===t.BYTES_PER_ELEMENT)s=256;else{if(2!==t.BYTES_PER_ELEMENT)throw new Error("Need to specify alphabetSize");s=65536}if(me(s>0),t.BYTES_PER_ELEMENT&&me(s<=1<<8*t.BYTES_PER_ELEMENT),(o=t.length>=2*i?t:s<=256?ue.makeU8Buffer(2*i):s<=65536?ue.makeU16Buffer(2*i):ue.makeU32Buffer(2*i))!==t)for(r=0;r<i;r++)o[r]=t[r];for(r=0;r<i;r++)o[i+r]=o[r];var h=ue.makeS32Buffer(2*i);for(ge(o,h,0,2*i,s,!1),r=0,n=0;r<2*i;r++){var l=h[r];l<i&&(0===l&&(a=n),--l<0&&(l=i-1),e[n++]=t[l])}return me(n===i),a},de=Vt(we);var ye={},be=function(t,e,i,s){this.up=t,this.down=e,this.symbol=i,this.weight=s};be.prototype.clone=function(){return new be(this.up,this.down,this.symbol,this.weight)},be.prototype.set=function(t){this.up=t.up,this.down=t.down,this.symbol=t.symbol,this.weight=t.weight};var Ce=function(t,e,i,s){var r;for((!e||e>t)&&(e=t),(e<<=1)&&e--,this.table=[],r=0;r<=e;r++)this.table[r]=new be(0,0,0,0);if(this.map=[],this.size=t)for(r=0;r<t;r++)this.map[r]=0;this.esc=this.root=e,i&&(this.readBit=i.readBit.bind(i),this.writeBit=i.writeBit.bind(i)),this.max_weight=s};Ce.factory=function(t,e){return function(i){return new Ce(i,i,t,e)}},Ce.prototype.split=function(t){var e,i;return(e=this.esc)?(this.esc--,(i=this.esc)?(this.table[e].down=i,this.table[e].weight=1,this.table[i].up=e,this.esc--):(e=0,i=1),this.table[i].symbol=t,this.table[i].weight=0,this.table[i].down=0,this.map[t]=i,this.table[this.esc].weight=0,this.table[this.esc].down=0,this.table[this.esc].up=e,i):0},Ce.prototype.leader=function(t){for(var e,i,s=this.table[t].weight,r=t;s===this.table[r+1].weight;)r++;return r===t?t:(i=this.table[t].symbol,e=this.table[r].symbol,this.table[r].symbol=i,this.table[t].symbol=e,this.map[i]=r,this.map[e]=t,r)},Ce.prototype.slide=function(t){var e,i=t;if(1&(e=this.table[i++].clone()).weight)for(;e.weight>this.table[i+1].weight;)i++;return this.table[t].set(this.table[i]),this.table[i].set(e),this.table[i].up=this.table[t].up,this.table[t].up=e.up,1&e.weight?(this.table[e.down].up=i,this.table[e.down-1].up=i,this.map[this.table[t].symbol]=t):(this.table[this.table[t].down-1].up=t,this.table[this.table[t].down].up=t,this.map[e.symbol]=i),i},Ce.prototype.increment=function(t){var e;for(this.table[t].up===t+1?(this.table[t].weight+=2,t++):t=this.leader(t);this.table[t].weight+=2,e=this.table[t].up;){for(;this.table[t].weight>this.table[t+1].weight;)t=this.slide(t);t=1&this.table[t].weight?e:this.table[t].up}this.max_weight&&this.table[this.root].weight>=this.max_weight&&this.scale(1)},Ce.prototype.scale=function(t){for(var e,i,s=this.esc;++s<=this.root;)for(1&this.table[s].weight?(e=-2&this.table[this.table[s].down].weight)&&(e+=1|this.table[this.table[s].down-1].weight):(e=this.table[s].weight>>t&-2)||(this.map[this.table[s].symbol]=0,this.esc++&&this.esc++),this.table[s].weight=e,i=s;e<this.table[--i].weight;)this.slide(i);this.table[this.esc].down=0},Ce.prototype.sendid=function(t){for(var e,i=0;t--;)this.map[t]||i++;if(e=this.size-Math.floor((this.root-this.esc)/2)-1)do{this.writeBit(1&i),i>>=1}while(e>>=1)},Ce.prototype.encode=function(t){var e,i,s,r,n=1;if(t<this.size&&((s=r=this.map[t])||(s=this.esc))){for(;i=this.table[s].up;)n<<=1,n|=1&s,s=i;for(;e=1&n,n>>=1;)this.writeBit(e);r||(this.sendid(t),r=this.split(t)),this.increment(r)}},Ce.prototype.readid=function(){var t,e,i=0,s=1;if(t=this.size-Math.floor((this.root-this.esc)/2)-1)do{i|=this.readBit()?s:0,s<<=1}while(t>>=1);for(e=0;e<this.size;e++)if(!this.map[e]&&!i--)return e;return 0},Ce.prototype.decode=function(){for(var t,e,i=this.root;e=this.table[i].down;)i=this.readBit()?e-1:e;if(i===this.esc){if(!this.esc)return 0;t=this.readid(),i=this.split(t)}else t=this.table[i].symbol;return this.increment(i),t},Ce.MAGIC="huff",Ce.compressFile=ue.compressFileHelper(Ce.MAGIC,(function(t,e,i,s){var r=new zt(e),n=256;i<0&&n++;var o=new Ce(257,n,r,8191);ue.compressWithModel(t,i,o),r.flush()})),Ce.decompressFile=ue.decompressFileHelper(Ce.MAGIC,(function(t,e,i){var s=new zt(t),r=256;i<0&&r++;var n=new Ce(257,r,s,8191);ue.decompressWithModel(e,i,n)})),ye=Ce;var Se={},Ie=function(t,e,i){var s;for(this.literalModel=[],s=0;s<e;s++)this.literalModel[s]=t(i)};Ie.prototype.encode=function(t,e){this.literalModel[e].encode(t)},Ie.prototype.decode=function(t){return this.literalModel[t].decode()},Ie.MAGIC="ctx1",Ie.compressFile=ue.compressFileHelper(Ie.MAGIC,(function(t,e,i,s){var r=new zt(e),n=256;i<0&&n++;var o=ye.factory(r,8191),a=new Ie(o,256,n),h=32,l={encode:function(t){a.encode(t,h),h=t}};ue.compressWithModel(t,i,l),r.flush()})),Ie.decompressFile=ue.decompressFileHelper(Ie.MAGIC,(function(t,e,i){var s=new zt(t),r=256;i<0&&r++;var n=ye.factory(s,8191),o=new Ie(n,256,r),a=32,h={decode:function(){var t=o.decode(a);return a=t,t}};ue.decompressWithModel(e,i,h)})),Se=Ie;var Te={},xe=Math.pow(2,31),ve=xe>>>8,ke=Math.pow(2,32)-1,Ae=function(t){this.low=0,this.range=xe,this.buffer=0,this.help=0,this.bytecount=0,this.stream=t},Be=function(t,e){for(;t.range<=ve;){if(t.low<255<<23){for(e.writeByte(t.buffer);t.help;t.help--)e.writeByte(255);t.buffer=t.low>>>23&255}else if(t.low&xe){for(e.writeByte(t.buffer+1);t.help;t.help--)e.writeByte(0);t.buffer=t.low>>>23&255}else if(t.help++,t.help>ke)throw new Error("Too many bytes outstanding, file too large!");t.range=t.range<<8>>>0,t.low=(t.low<<8&xe-1)>>>0,t.bytecount++}};Ae.prototype.encodeStart=function(t,e){this.low=0,this.range=xe,this.buffer=t,this.help=0,this.bytecount=e},Ae.prototype.encodeFreq=function(t,e,i){Be(this,this.stream);var s=this.range/i>>>0,r=s*e;this.low+=r,e+t<i?this.range=s*t:this.range-=r},Ae.prototype.encodeShift=function(t,e,i){Be(this,this.stream);var s=this.range>>>i,r=s*e;this.low+=r,e+t>>>i?this.range-=r:this.range=s*t},Ae.prototype.encodeBit=function(t){this.encodeShift(1,t?1:0,1)},Ae.prototype.encodeByte=function(t){this.encodeShift(1,t,8)},Ae.prototype.encodeShort=function(t){this.encodeShift(1,t,16)},Ae.prototype.encodeFinish=function(){var t=this.stream;Be(this,t),this.bytecount+=5;var e=this.low>>>23;if((this.low&ve-1)>=(16777215&this.bytecount)>>>1&&e++,e>255)for(t.writeByte(this.buffer+1);this.help;this.help--)t.writeByte(0);else for(t.writeByte(this.buffer);this.help;this.help--)t.writeByte(255);return t.writeByte(255&e),t.writeByte(this.bytecount>>>16&255),t.writeByte(this.bytecount>>>8&255),t.writeByte(255&this.bytecount),this.bytecount},Ae.prototype.decodeStart=function(t){var e=t?0:this.stream.readByte();return"number"!=typeof e||e<0||(this.buffer=this.stream.readByte(),this.low=this.buffer>>>1,this.range=128),e};var Le=function(t,e){for(;t.range<=ve;)t.low=t.low<<8|t.buffer<<7&255,t.buffer=e.readByte(),t.low|=t.buffer>>>1,t.low=t.low>>>0,t.range=t.range<<8>>>0};Ae.prototype.decodeCulFreq=function(t){Le(this,this.stream),this.help=this.range/t>>>0;var e=this.low/this.help>>>0;return e>=t?t-1:e},Ae.prototype.decodeCulShift=function(t){Le(this,this.stream),this.help=this.range>>>t;var e=this.low/this.help>>>0;return e>>>t?(1<<t)-1:e},Ae.prototype.decodeUpdate=function(t,e,i){var s=this.help*e;this.low-=s,e+t<i?this.range=this.help*t:this.range-=s},Ae.prototype.decodeBit=function(){var t=this.decodeCulShift(1);return this.decodeUpdate(1,t,2),t},Ae.prototype.decodeByte=function(){var t=this.decodeCulShift(8);return this.decodeUpdate(1,t,256),t},Ae.prototype.decodeShort=function(){var t=this.decodeCulShift(16);return this.decodeUpdate(1,t,65536),t},Ae.prototype.decodeFinish=function(){Le(this,this.stream)},Ae.prototype.writeBit=Ae.prototype.encodeBit,Ae.prototype.readBit=Ae.prototype.decodeBit,Ae.prototype.writeByte=Ae.prototype.encodeByte,Ae.prototype.readByte=Ae.prototype.decodeByte,Te=Ae;var Me={};const Ee=ue;var Pe=function(t,e,i){var s,r=this.numSyms=e;for(this.coder=t,this.prob=Ee.makeU16Buffer(e+2),this.escape=Ee.makeU16Buffer(e+1),this.update=Ee.makeU16Buffer(e+1),this.prob[r+1]=256,s=0;s<=this.numSyms;s++)this.escape[s]=s;if(this.updateCount=0,this.updateThresh=256-Math.floor(128),i){for(this.probToSym=Ee.makeU16Buffer(256),this.escProbToSym=Ee.makeU16Buffer(this.numSyms),s=0;s<256;s++)this.probToSym[s]=r;for(s=0;s<this.numSyms;s++)this.escProbToSym[s]=s}};Pe.factory=function(t,e){return function(i){return new Pe(t,i,e)}},Pe.prototype._update=function(t,e){if(t===this.numSyms){if(this.update[t]>=40)return;if(this.updateCount>=this.updateThresh-1)return}if(this.update[t]++,this.updateCount++,!(this.updateCount<this.updateThresh)){var i,s,r,n,o,a;for(this.escape[0]=this.prob[0]=i=s=r=0,n=0;n<this.numSyms+1;n++){var h=(this.prob[n+1]-this.prob[n]>>>1)+this.update[n];h?(this.prob[n]=i,i+=h,1&h&&r++,this.escape[n]=s):(this.prob[n]=i,this.escape[n]=s,s++)}for(this.prob[n]=i,this.updateThresh=256-Math.floor((i-r)/2),n=0;n<this.numSyms+1;n++)this.update[n]=0;if(this.update[this.numSyms]=1,this.updateCount=1,e)for(n=0,o=0,a=0;n<this.numSyms+1;n++){for(var l=this.prob[n+1];o<l;o++)this.probToSym[o]=n;for(var c=this.escape[n+1];a<c;a++)this.escProbToSym[a]=n}}},Pe.prototype.encode=function(t){var e=this.prob[t],i=this.prob[t+1]-e;if(i)return this.coder.encodeShift(i,e,8),this._update(t);this.encode(this.numSyms),e=this.escape[t],i=this.escape[t+1]-e;var s=this.escape[this.numSyms];return this.coder.encodeFreq(i,e,s),this._update(t)},Pe.prototype.decode=function(){var t=this.coder.decodeCulShift(8),e=this.probToSym[t],i=this.prob[e],s=this.prob[e+1]-i;if(this.coder.decodeUpdate(s,i,256),this._update(e,!0),e!==this.numSyms)return e;var r=this.escape[this.numSyms];return t=this.coder.decodeCulFreq(r),e=this.escProbToSym[t],i=this.escape[e],s=this.escape[e+1]-i,this.coder.decodeUpdate(s,i,r),this._update(e,!0),e},Pe.MAGIC="dfsm",Pe.compressFile=Ee.compressFileHelper(Pe.MAGIC,(function(t,e,i,s,r){var n=new Te(e);n.encodeStart(r,1);var o=new Pe(n,i<0?257:256);Ee.compressWithModel(t,i,o),n.encodeFinish()}),!0),Pe.decompressFile=Ee.decompressFileHelper(Pe.MAGIC,(function(t,e,i){var s=new Te(t);s.decodeStart(!0);var r=new Pe(s,i<0?257:256,!0);Ee.decompressWithModel(e,i,r),s.decodeFinish()})),Me=Pe;var Ye={};const Xe=ue;var De=function(t,e,i,s){var r;for(this.coder=t,this.numSyms=e+1,this.tree=Xe.makeU32Buffer(2*this.numSyms),this.increment=+s||256,this.max_prob=+i||65280,r=0;r<e;r++)this.tree[this.numSyms+r]=1;this.tree[this.numSyms+r]=0|this.increment<<16,this._sumTree()};De.factory=function(t,e,i){return function(s){return new De(t,s,e,i)}},De.prototype.clone=function(){var t,e=new De(this.coder,this.size,this.max_prob,this.increment);for(t=1;t<this.tree.length;t++)e.tree[t]=this.tree[t];return e},De.prototype.encode=function(t){var e=this.numSyms+t,i=this.tree[e],s=4294901760,r=16,n=this.increment<<16;0==(4294901760&i)?(this.encode(this.numSyms-1),s=65535,n-=1,r=0):t===this.numSyms-1&&(65535&this.tree[1])>>>0==1&&(n=-this.tree[e]);for(var o=0;e>1;){var a=e>>>1;1&e&&(o+=this.tree[2*a]),this.tree[e]+=n,e=a}var h=this.tree[1];this.tree[1]+=n,i=(i&s)>>>r,o=(o&s)>>>r,h=(h&s)>>>r,this.coder.encodeFreq(i,o,h),(4294901760&this.tree[1])>>>16>=this.max_prob&&this._rescale()},De.prototype._decode=function(t){var e=4294901760,i=16,s=this.increment<<16;t&&(e=65535,s-=1,i=0);for(var r=(this.tree[1]&e)>>>i,n=this.coder.decodeCulFreq(r),o=1,a=0;o<this.numSyms;){this.tree[o]+=s;var h=(this.tree[2*o]&e)>>>i;o*=2,n-a>=h&&(a+=h,o++)}var l=o-this.numSyms,c=(this.tree[o]&e)>>>i;if(this.tree[o]+=s,this.coder.decodeUpdate(c,a,r),l===this.numSyms-1&&(65535&this.tree[1])>>>0==1)for(s=-this.tree[o];o>=1;)this.tree[o]+=s,o>>>=1;return(4294901760&this.tree[1])>>>16>=this.max_prob&&this._rescale(),l},De.prototype.decode=function(){var t=this._decode(!1);return t===this.numSyms-1&&(t=this._decode(!0)),t},De.prototype._rescale=function(){var t,e,i=!0;for(t=0;t<this.numSyms-1;t++)0==(65535&(e=this.tree[this.numSyms+t]))?(0==(e=(4294901758&e)>>>1)&&(e=1,i=!1),this.tree[this.numSyms+t]=e):i=!1;e=(4294901758&(e=this.tree[this.numSyms+t]))>>>1,i?e=0:0===e&&(e=65536),this.tree[this.numSyms+t]=e,this._sumTree()},De.prototype._sumTree=function(){var t;for(t=this.numSyms-1;t>0;t--)this.tree[t]=this.tree[2*t]+this.tree[2*t+1]},De.MAGIC="fenw",De.compressFile=Xe.compressFileHelper(De.MAGIC,(function(t,e,i,s,r){var n=new Te(e);n.encodeStart(r,1);var o=new De(n,i<0?257:256);Xe.compressWithModel(t,i,o),n.encodeFinish()}),!0),De.decompressFile=Xe.decompressFileHelper(De.MAGIC,(function(t,e,i){var s=new Te(t);s.decodeStart(!0);var r=new De(s,i<0?257:256);Xe.decompressWithModel(e,i,r),s.decodeFinish()})),Ye=De;var _e={};const Oe=ue;var Re=function(t,e){return t-e},je=function(t,e,i,s,r){this.coder=t,this.increment=+s||256,this.max_prob=+i||65280,this.sym=Oe.makeU16Buffer(e+1),this.prob=Oe.makeU16Buffer(e+2),this.sym[0]=e,this.prob[0]=0,this.seenSyms=1,this.prob[this.seenSyms]=this.increment,this.numSyms=e,r&&(this.sortedSeen=[e])};je.factory=function(t,e,i,s){return function(r){return new je(t,r,e,i,s)}},je.prototype.clone=function(){var t,e=new je(this.coder,this.numSyms,this.max_prob,this.increment,!!this.sortedSeen);for(t=0;t<this.seenSyms;t++)e.sym[t]=this.sym[t],e.prob[t]=this.prob[t];return e.prob[t]=this.prob[t],e.seenSyms=this.seenSyms,this.sortedSeen&&(e.sortedSeen=this.sortedSeen.slice(0)),e},je.prototype._update=function(t,e,i){var s,r;for(s=e;s<this.seenSyms-1;s++)this.sym[s]=this.sym[s+1],this.prob[s]=this.prob[s+1]-i;e<this.seenSyms?(this.sym[s]=t,this.prob[s]=this.prob[s+1]-i,this.prob[this.seenSyms]=r=this.prob[this.seenSyms]+this.increment,t===this.numSyms&&this.seenSyms>=this.numSyms&&(r=this.prob[--this.seenSyms],this.sortedSeen&&this.sortedSeen.length--)):(r=this.prob[this.seenSyms],this.sym[e]=t,this.prob[e]=r,r+=this.increment,this.prob[++this.seenSyms]=r,this.sortedSeen&&(this.sortedSeen.push(t),this.sortedSeen.sort(Re))),r>=this.max_prob&&this._rescale()},je.prototype._rescale=function(){var t,e,i=0,s=!0;for(this.sortedSeen&&(this.sortedSeen.length=0),t=0,e=0;t<this.seenSyms;t++){var r=this.sym[t],n=this.prob[t+1]-this.prob[t];(n>>>=1)>0&&(r===this.numSyms&&(s=!1),this.sym[e]=r,this.prob[e++]=i,i+=n,this.sortedSeen&&this.sortedSeen.push(r))}this.prob[e]=i,this.seenSyms=e,this.sortedSeen&&this.sortedSeen.sort(Re),s&&this.seenSyms<this.numSyms&&this._update(this.numSyms,this.seenSyms)},je.prototype.decode=function(){var t,e=this.prob[this.seenSyms],i=this.coder.decodeCulFreq(e);for(t=this.seenSyms-1;t>=0&&!(this.prob[t]<=i);t--);var s=this.sym[t],r=this.prob[t],n=this.prob[t+1]-r;if(this.coder.decodeUpdate(n,r,e),this._update(s,t,n),s===this.numSyms){if(n=1,e=this.numSyms,this.sortedSeen){var o=this.sortedSeen;for(e=this.numSyms-this.seenSyms,o[o.length-1]===this.numSyms&&e++,s=r=this.coder.decodeCulFreq(e),t=0;t<o.length&&o[t]<=s;t++)s++}else s=r=this.coder.decodeCulFreq(e);this.coder.decodeUpdate(n,r,e),this._update(s,this.seenSyms)}return s},je.prototype.encode=function(t){var e,i,s,r;for(e=this.seenSyms-1;e>=0;e--)if(t===this.sym[e])return s=this.prob[e],i=this.prob[e+1]-s,r=this.prob[this.seenSyms],this.coder.encodeFreq(i,s,r),this._update(t,e,i);if(this.encode(this.numSyms),i=1,s=t,r=this.numSyms,this.sortedSeen){var n=this.sortedSeen;for(r-=this.seenSyms,n[n.length-1]===this.numSyms&&r++,e=0;e<n.length&&n[e]<t;e++)s--}return this.coder.encodeFreq(i,s,r),this._update(t,this.seenSyms)},je.MAGIC="mtfm",je.compressFile=Oe.compressFileHelper(je.MAGIC,(function(t,e,i,s,r){var n=new Te(e);n.encodeStart(r,1);var o=new je(n,i<0?257:256);Oe.compressWithModel(t,i,o),n.encodeFinish()}),!0),je.decompressFile=Oe.decompressFileHelper(je.MAGIC,(function(t,e,i){var s=new Te(t);s.decodeStart(!0);var r=new je(s,i<0?257:256);Oe.decompressWithModel(e,i,r),s.decodeFinish()})),_e=je;var Ue={},Ne=function(t,e){this.bitstream=t,this.bits=ue.fls(e-1)};Ne.factory=function(t){return function(e){return new Ne(t,e)}},Ne.prototype.encode=function(t){var e;for(e=this.bits-1;e>=0;e--){var i=t>>>e&1;this.bitstream.writeBit(i)}},Ne.prototype.decode=function(){var t,e=0;for(t=this.bits-1;t>=0;t--)e<<=1,this.bitstream.readBit()&&e++;return e},Ne.MAGIC="nomo",Ne.compressFile=ue.compressFileHelper(Ne.MAGIC,(function(t,e,i,s){var r=new zt(e),n=new Ne(r,i<0?257:256);ue.compressWithModel(t,i,n),r.flush()})),Ne.decompressFile=ue.decompressFileHelper(Ne.MAGIC,(function(t,e,i){var s=new zt(t),r=new Ne(s,i<0?257:256);ue.decompressWithModel(e,i,r)})),Ue=Ne;var Fe={},He=function(t,e,i,s){var r,n=ue.fls(t-1);for(this.extraStates=+e||0,this.lgDistanceModel=i(1+n+e),this.distanceModel=[],r=2;r<=n;r++){var o=r-1;this.distanceModel[r]=s(1<<o)}};He.prototype.encode=function(t){if(t<2)this.lgDistanceModel.encode(t+this.extraStates);else{var e=ue.fls(t);this.lgDistanceModel.encode(e+this.extraStates);var i=t&(1<<e-1)-1;this.distanceModel[e].encode(i)}},He.prototype.decode=function(){var t=this.lgDistanceModel.decode()-this.extraStates;return t<2?t:(1<<t-1)+this.distanceModel[t].decode()},Fe=He;var We;Gt.EOF,BWTC=Object.create(null),BWTC.MAGIC="bwtc",BWTC.compressFile=ue.compressFileHelper(BWTC.MAGIC,(function(t,e,i,s,r){var n=new Te(e);n.encodeStart(r,1);var o=9;"number"==typeof s&&s>=1&&s<=9&&(o=s),n.encodeByte(o);var a=o<=5;o*=1e5;var h,l,c,u,d,m,p=ue.makeU8Buffer(o),f=function(){var e;for(e=0;e<o;){var i=t.readByte();if(i<0)break;p[e++]=i}return e},g=ue.makeU8Buffer(o),w=ue.makeS32Buffer(o),y=ue.makeU8Buffer(256),b=Ue.factory(n),C=new Fe(o,0,b,b);do{if(0===(h=f()))break;h===p.length?(n.encodeFreq(1,0,3),l=p):(n.encodeFreq(1,1,3),C.encode(h),l=p.subarray(0,h)),u=de.bwtransform(l,g,w,h,256),C.encode(u);var S=ue.makeU16Buffer(512);for(d=0;d<h;d++)S[256+(c=g[d])]=1;for(d=255;d>0;d--)S[d]=S[2*d]+S[2*d+1];for(S[0]=1,d=1;d<512;d++){var I=d>>>1,T=1<<9-ue.fls(d);if(0===S[I]||S[I]===2*T);else if(d>=256)n.encodeBit(S[d]);else{var x=S[d];x=0===x?0:x===T?2:1,n.encodeFreq(1,x,3)}}var v=0;for(d=0;d<256;d++)S[256+d]&&(y[v++]=d);for(S=null,d=0;d<h;d++){for(c=g[d],m=0;m<v&&y[m]!==c;m++);for(g[d]=m;m>0;m--)y[m]=y[m-1];y[0]=c}var k=new Ye(n,v+1,65280,256);a&&(k=new Me(n,v+1));var A=0,B=function(){for(;0!==A;)1&A?(k.encode(0),A-=1):(k.encode(1),A-=2),A>>>=1};for(d=0;d<h;d++)0===(c=g[d])?A++:(B(),k.encode(c+1),A=0);B()}while(h===p.length);n.encodeFreq(1,2,3),n.encodeFinish()}),!0),BWTC.decompressFile=ue.decompressFileHelper(BWTC.MAGIC,(function(t,e,i){var s=new Te(t);s.decodeStart(!0);var r=s.decodeByte(),n=r<=5;r*=1e5;for(var o,a,h,l,c,u=ue.makeU8Buffer(r),d=ue.makeU8Buffer(r),m=ue.makeS32Buffer(r),p=ue.makeU8Buffer(256),f=Ue.factory(s),g=new Fe(r,0,f,f);;){var w=s.decodeCulFreq(3);if(s.decodeUpdate(1,w,3),0===w)a=r,o=u;else if(1===w)a=g.decode(),o=u.subarray(0,a);else if(2===w)break;var y=g.decode(),b=ue.makeU16Buffer(512);for(b[0]=1,h=1;h<512;h++){var C=h>>>1,S=1<<9-ue.fls(h);if(0===b[C]||b[C]===2*S)b[h]=b[C]>>>1;else if(h>=256)b[h]=s.decodeBit();else{var I=s.decodeCulFreq(3);s.decodeUpdate(1,I,3),b[h]=2===I?S:I}}var T=0;for(h=0;h<256;h++)b[256+h]&&(p[T++]=h);b=null;var x=new Ye(s,T+1,65280,256);n&&(x=new Me(s,T+1,!0));var v=1;for(h=0;h<a;)if(0===(c=x.decode())){for(l=0;l<v;l++)o[h++]=0;v*=2}else if(1===c){for(l=0;l<v;l++)o[h++]=0,o[h++]=0;v*=2}else v=1,o[h++]=c-1;for(h=0;h<a;h++){for(l=o[h],o[h]=c=p[l];l>0;l--)p[l]=p[l-1];p[0]=c}de.unbwtransform(u,d,m,a,y),e.write(d,0,a)}s.decodeFinish()})),We=BWTC;var Ve,Ge=ue.arraycopy(ue.makeU32Buffer(256),[0,79764919,159529838,222504665,319059676,398814059,445009330,507990021,638119352,583659535,797628118,726387553,890018660,835552979,1015980042,944750013,1276238704,1221641927,1167319070,1095957929,1595256236,1540665371,1452775106,1381403509,1780037320,1859660671,1671105958,1733955601,2031960084,2111593891,1889500026,1952343757,2552477408,2632100695,2443283854,2506133561,2334638140,2414271883,2191915858,2254759653,3190512472,3135915759,3081330742,3009969537,2905550212,2850959411,2762807018,2691435357,3560074640,3505614887,3719321342,3648080713,3342211916,3287746299,3467911202,3396681109,4063920168,4143685023,4223187782,4286162673,3779000052,3858754371,3904687514,3967668269,881225847,809987520,1023691545,969234094,662832811,591600412,771767749,717299826,311336399,374308984,453813921,533576470,25881363,88864420,134795389,214552010,2023205639,2086057648,1897238633,1976864222,1804852699,1867694188,1645340341,1724971778,1587496639,1516133128,1461550545,1406951526,1302016099,1230646740,1142491917,1087903418,2896545431,2825181984,2770861561,2716262478,3215044683,3143675388,3055782693,3001194130,2326604591,2389456536,2200899649,2280525302,2578013683,2640855108,2418763421,2498394922,3769900519,3832873040,3912640137,3992402750,4088425275,4151408268,4197601365,4277358050,3334271071,3263032808,3476998961,3422541446,3585640067,3514407732,3694837229,3640369242,1762451694,1842216281,1619975040,1682949687,2047383090,2127137669,1938468188,2001449195,1325665622,1271206113,1183200824,1111960463,1543535498,1489069629,1434599652,1363369299,622672798,568075817,748617968,677256519,907627842,853037301,1067152940,995781531,51762726,131386257,177728840,240578815,269590778,349224269,429104020,491947555,4046411278,4126034873,4172115296,4234965207,3794477266,3874110821,3953728444,4016571915,3609705398,3555108353,3735388376,3664026991,3290680682,3236090077,3449943556,3378572211,3174993278,3120533705,3032266256,2961025959,2923101090,2868635157,2813903052,2742672763,2604032198,2683796849,2461293480,2524268063,2284983834,2364738477,2175806836,2238787779,1569362073,1498123566,1409854455,1355396672,1317987909,1246755826,1192025387,1137557660,2072149281,2135122070,1912620623,1992383480,1753615357,1816598090,1627664531,1707420964,295390185,358241886,404320391,483945776,43990325,106832002,186451547,266083308,932423249,861060070,1041341759,986742920,613929101,542559546,756411363,701822548,3316196985,3244833742,3425377559,3370778784,3601682597,3530312978,3744426955,3689838204,3819031489,3881883254,3928223919,4007849240,4037393693,4100235434,4180117107,4259748804,2310601993,2373574846,2151335527,2231098320,2596047829,2659030626,2470359227,2550115596,2947551409,2876312838,2788305887,2733848168,3165939309,3094707162,3040238851,2985771188]),Ze=function(){var t=4294967295;this.getCRC=function(){return~t>>>0},this.updateCRC=function(e){t=t<<8^Ge[255&(t>>>24^e)]},this.updateCRCRun=function(e,i){for(;i-- >0;)t=t<<8^Ge[255&(t>>>24^e)]}},ze=function(t,e,i){for(var s=t.length,r=e,n=t.length-2;e>=i&&t[e]%s>r;)n=e,e-=r-e+1;for(e=Math.max(i-1,e);n>e+1;){var o=e+n>>1;t[o]%s>r?n=o:e=o}return n},qe=Vt({allocateHuffmanCodeLengths:function(t,e){switch(t.length){case 2:t[1]=1;case 1:return void(t[0]=1)}!function(t){var e,i,s,r,n=t.length;for(t[0]+=t[1],e=0,i=1,s=2;i<n-1;i++)s>=n||t[e]<t[s]?(r=t[e],t[e++]=i):r=t[s++],s>=n||e<i&&t[e]<t[s]?(r+=t[e],t[e++]=i+n):r+=t[s++],t[i]=r}(t);var i=function(t,e){var i,s=t.length-2;for(i=1;i<e-1&&s>1;i++)s=ze(t,s-1,0);return s}(t,e);t[0]%t.length>=i?function(t){var e,i,s,r,n=t.length-2,o=t.length-1;for(e=1,i=2;i>0;e++){for(r=i-((s=n)-(n=ze(t,s-1,0)));r>0;r--)t[o--]=e;i=s-n<<1}}(t):function(t,e,i){var s,r,n,o,a=t.length-2,h=t.length-1,l=1==i?2:1,c=1==i?e-2:e;for(s=l<<1;s>0;l++){for(r=a,a=a<=e?a:ze(t,r-1,e),n=0,l>=i?n=Math.min(c,1<<l-i):l==i-1&&(n=1,t[a]==r&&a++),o=s-(r-a+n);o>0;o--)t[h--]=l;c-=n,s=r-a+n<<1}}(t,i,e-ue.fls(i-1))}}),$e=Gt.EOF,Ke=function(t,e){var i,s=t[e];for(i=e;i>0;i--)t[i]=t[i-1];return t[0]=s,s},Qe={OK:0,LAST_BLOCK:-1,NOT_BZIP_DATA:-2,UNEXPECTED_INPUT_EOF:-3,UNEXPECTED_OUTPUT_EOF:-4,DATA_ERROR:-5,OUT_OF_MEMORY:-6,OBSOLETE_INPUT:-7,END_OF_BLOCK:-8},Je={};Je[Qe.LAST_BLOCK]="Bad file checksum",Je[Qe.NOT_BZIP_DATA]="Not bzip data",Je[Qe.UNEXPECTED_INPUT_EOF]="Unexpected input EOF",Je[Qe.UNEXPECTED_OUTPUT_EOF]="Unexpected output EOF",Je[Qe.DATA_ERROR]="Data error",Je[Qe.OUT_OF_MEMORY]="Out of memory",Je[Qe.OBSOLETE_INPUT]="Obsolete (pre 0.9.5) bzip format not supported.";var ti=function(t,e){var i=Je[t]||"unknown error";e&&(i+=": "+e);var s=new TypeError(i);throw s.errorCode=t,s},ei=function(t,e){this.writePos=this.writeCurrent=this.writeCount=0,this._start_bunzip(t,e)};ei.prototype._init_block=function(){return this._get_next_block()?(this.blockCRC=new Ze,!0):(this.writeCount=-1,!1)},ei.prototype._start_bunzip=function(t,e){var i=ue.makeU8Buffer(4);4===t.read(i,0,4)&&"BZh"===String.fromCharCode(i[0],i[1],i[2])||ti(Qe.NOT_BZIP_DATA,"bad magic");var s=i[3]-48;(s<1||s>9)&&ti(Qe.NOT_BZIP_DATA,"level out of range"),this.reader=new zt(t),this.dbufSize=1e5*s,this.nextoutput=0,this.outputStream=e,this.streamCRC=0},ei.prototype._get_next_block=function(){var t,e,i,s=this.reader,r=s.readBits(48);if(25779555029136===r)return!1;54156738319193!==r&&ti(Qe.NOT_BZIP_DATA),this.targetBlockCRC=s.readBits(32),this.streamCRC=(this.targetBlockCRC^(this.streamCRC<<1|this.streamCRC>>>31))>>>0,s.readBits(1)&&ti(Qe.OBSOLETE_INPUT);var n=s.readBits(24);n>this.dbufSize&&ti(Qe.DATA_ERROR,"initial position out of bounds");var o=s.readBits(16),a=ue.makeU8Buffer(256),h=0;for(t=0;t<16;t++)if(o&1<<15-t){var l=16*t;for(i=s.readBits(16),e=0;e<16;e++)i&1<<15-e&&(a[h++]=l+e)}var c=s.readBits(3);(c<2||c>6)&&ti(Qe.DATA_ERROR);var u=s.readBits(15);0===u&&ti(Qe.DATA_ERROR);var d=ue.makeU8Buffer(256);for(t=0;t<c;t++)d[t]=t;var m=ue.makeU8Buffer(u);for(t=0;t<u;t++){for(e=0;s.readBits(1);e++)e>=c&&ti(Qe.DATA_ERROR);m[t]=Ke(d,e)}var p,f=h+2,g=[];for(e=0;e<c;e++){var w,y,b=ue.makeU8Buffer(f),C=ue.makeU16Buffer(21);for(o=s.readBits(5),t=0;t<f;t++){for(;(o<1||o>20)&&ti(Qe.DATA_ERROR),s.readBits(1);)s.readBits(1)?o--:o++;b[t]=o}for(w=y=b[0],t=1;t<f;t++)b[t]>y?y=b[t]:b[t]<w&&(w=b[t]);p={},g.push(p),p.permute=ue.makeU16Buffer(258),p.limit=ue.makeU32Buffer(22),p.base=ue.makeU32Buffer(21),p.minLen=w,p.maxLen=y;var S=0;for(t=w;t<=y;t++)for(C[t]=p.limit[t]=0,o=0;o<f;o++)b[o]===t&&(p.permute[S++]=o);for(t=0;t<f;t++)C[b[t]]++;for(S=o=0,t=w;t<y;t++)S+=C[t],p.limit[t]=S-1,S<<=1,o+=C[t],p.base[t+1]=S-o;p.limit[y+1]=Number.MAX_VALUE,p.limit[y]=S+C[y]-1,p.base[w]=0}var I=ue.makeU32Buffer(256);for(t=0;t<256;t++)d[t]=t;var T,x=0,v=0,k=0,A=this.dbuf=ue.makeU32Buffer(this.dbufSize);for(f=0;;){for(f--||(f=49,k>=u&&ti(Qe.DATA_ERROR),p=g[m[k++]]),t=p.minLen,e=s.readBits(t);t>p.maxLen&&ti(Qe.DATA_ERROR),!(e<=p.limit[t]);t++)e=e<<1|s.readBits(1);((e-=p.base[t])<0||e>=258)&&ti(Qe.DATA_ERROR);var B=p.permute[e];if(0!==B&&1!==B){if(x)for(x=0,v+o>this.dbufSize&&ti(Qe.DATA_ERROR),I[T=a[d[0]]]+=o;o--;)A[v++]=T;if(B>h)break;v>=this.dbufSize&&ti(Qe.DATA_ERROR),I[T=a[T=Ke(d,t=B-1)]]++,A[v++]=T}else x||(x=1,o=0),o+=0===B?x:2*x,x<<=1}for((n<0||n>=v)&&ti(Qe.DATA_ERROR),e=0,t=0;t<256;t++)i=e+I[t],I[t]=e,e=i;for(t=0;t<v;t++)A[I[T=255&A[t]]]|=t<<8,I[T]++;var L=0,M=0,E=0;return v&&(M=255&(L=A[n]),L>>=8,E=-1),this.writePos=L,this.writeCurrent=M,this.writeCount=v,this.writeRun=E,!0},ei.prototype._read_bunzip=function(t,e){var i,s,r;if(this.writeCount<0)return 0;for(var n=this.dbuf,o=this.writePos,a=this.writeCurrent,h=this.writeCount,l=(this.outputsize,this.writeRun);h;){for(h--,s=a,a=255&(o=n[o]),o>>=8,3==l++?(i=a,r=s,a=-1):(i=1,r=a),this.blockCRC.updateCRCRun(r,i);i--;)this.outputStream.writeByte(r),this.nextoutput++;a!=s&&(l=0)}return this.writeCount=h,this.blockCRC.getCRC()!==this.targetBlockCRC&&ti(Qe.DATA_ERROR,"Bad block CRC (got "+this.blockCRC.getCRC().toString(16)+" expected "+this.targetBlockCRC.toString(16)+")"),this.nextoutput},ei.Err=Qe,ei.decode=function(t,e,i){for(var s=ue.coerceInputStream(t),r=ue.coerceOutputStream(e,e),n=r.stream,o=new ei(s,n);!("eof"in s)||!s.eof();)if(o._init_block())o._read_bunzip();else{var a=o.reader.readBits(32);if(a!==o.streamCRC&&ti(Qe.DATA_ERROR,"Bad stream CRC (got "+o.streamCRC.toString(16)+" expected "+a.toString(16)+")"),!i||!("eof"in s)||s.eof())break;o._start_bunzip(s,n)}return r.retval},ei.decodeBlock=function(t,e,i){var s=ue.coerceInputStream(t),r=ue.coerceOutputStream(i,i),n=r.stream,o=new ei(s,n);return o.reader.seekBit(e),o._get_next_block()&&(o.blockCRC=new Ze,o.writeCopies=0,o._read_bunzip()),r.retval},ei.table=function(t,e,i){var s=new Gt;s.delegate=ue.coerceInputStream(t),s.pos=0,s.readByte=function(){return this.pos++,this.delegate.readByte()},s.tell=function(){return this.pos},s.delegate.eof&&(s.eof=s.delegate.eof.bind(s.delegate));var r=new Gt;r.pos=0,r.writeByte=function(){this.pos++};var n=new ei(s,r);for(n.dbufSize;!("eof"in s)||!s.eof();){var o=n.reader.tellBit();if(n._init_block()){var a=r.pos;n._read_bunzip(),e(o,r.pos-a)}else{if(n.reader.readBits(32),!i||!("eof"in s)||s.eof())break;n._start_bunzip(s,r)}}};var ii=function(t,e){var i,s=[];for(i=0;i<e;i++)s[i]=t[i]<<9|i;s.sort((function(t,e){return t-e}));var r=s.map((function(t){return t>>>9}));for(qe.allocateHuffmanCodeLengths(r,20),this.codeLengths=ue.makeU8Buffer(e),i=0;i<e;i++){var n=511&s[i];this.codeLengths[n]=r[i]}};ii.prototype.computeCanonical=function(){var t,e=this.codeLengths.length,i=[];for(t=0;t<e;t++)i[t]=this.codeLengths[t]<<9|t;i.sort((function(t,e){return t-e})),this.code=ue.makeU32Buffer(e);var s=0,r=0;for(t=0;t<e;t++){var n=i[t]>>>9,o=511&i[t];s<<=n-r,this.code[o]=s++,r=n}},ii.prototype.cost=function(t,e,i){var s,r=0;for(s=0;s<i;s++)r+=this.codeLengths[t[e+s]];return r},ii.prototype.emit=function(t){var e,i=this.codeLengths[0];for(t.writeBits(5,i),e=0;e<this.codeLengths.length;e++){var s,r,n=this.codeLengths[e];for(i<n?(s=2,r=n-i):(s=3,r=i-n);r-- >0;)t.writeBits(2,s);t.writeBit(0),i=n}},ii.prototype.encode=function(t,e){t.writeBits(this.codeLengths[e],this.code[e])};var si=function(t,e,i,s){for(var r=0,n=-1,o=0;r<i&&!(4===o&&(e[r++]=0,r>=i));){var a=t.readByte();if(a===$e)break;if(s.updateCRC(a),a!==n)n=a,o=1;else if(++o>4){if(o<256){e[r-1]++;continue}o=1}e[r++]=a}return r},ri=function(t,e,i){var s,r,n;for(s=0,n=0;s<i.length;s+=50){var o=Math.min(50,i.length-s),a=0,h=e[0].cost(i,s,o);for(r=1;r<e.length;r++){var l=e[r].cost(i,s,o);l<h&&(a=r,h=l)}t[n++]=a}},ni=function(t,e,i){var s,r,n,o,a=ue.makeU8Buffer(e),h=de.bwtransform2(t,a,e,256);i.writeBit(0),i.writeBits(24,h);var l=[],c=[];for(r=0;r<e;r++)l[s=t[r]]=!0,c[s>>>4]=!0;for(r=0;r<16;r++)i.writeBit(!!c[r]);for(r=0;r<16;r++)if(c[r])for(n=0;n<16;n++)i.writeBit(!!l[r<<4|n]);var u=0;for(r=0;r<256;r++)l[r]&&u++;var d=ue.makeU16Buffer(e+1),m=u+1,p=[];for(r=0;r<=m;r++)p[r]=0;var f=ue.makeU8Buffer(u);for(r=0,n=0;r<256;r++)l[r]&&(f[n++]=r);l=null,c=null;var g=0,w=0,y=function(t){d[g++]=t,p[t]++},b=function(){for(;0!==w;)1&w?(y(0),w-=1):(y(1),w-=2),w>>>=1};for(r=0;r<a.length;r++){for(s=a[r],n=0;n<u&&f[n]!==s;n++);Ke(f,n),0===n?w++:(b(),y(n+1),w=0)}b(),y(m),d=d.subarray(0,g);var C,S=[];for(C=g>=2400?6:g>=1200?5:g>=600?4:g>=200?3:2,S.push(new ii(p,m+1)),r=0;r<=m;r++)p[r]=1;S.push(new ii(p,m+1)),p=null;var I=ue.makeU8Buffer(Math.ceil(g/50));for(function(t,e,i,s,r){for(var n,o,a,h=[];t.length<e;){for(ri(s,t,i),n=0;n<t.length;n++)h[n]=0;for(n=0;n<s.length;n++)h[s[n]]++;var l=h.indexOf(Math.max.apply(Math,h)),c=[];for(n=0,o=0;n<s.length;n++)if(s[n]===l){var u=50*n,d=Math.min(u+50,i.length);c.push({index:n,cost:t[l].cost(i,u,d-u)})}for(c.sort((function(t,e){return t.cost-e.cost})),n=c.length>>>1;n<c.length;n++)s[c[n].index]=t.length;t.push(null);var m,p=[];for(n=0;n<t.length;n++)for(m=p[n]=[],o=0;o<r;o++)m[o]=0;for(n=0,o=0;n<i.length;)for(m=p[s[o++]],a=0;a<50&&n<i.length;a++)m[i[n++]]++;for(n=0;n<t.length;n++)t[n]=new ii(p[n],r)}}(S,C,d,I,m+1),ri(I,S,d),i.writeBits(3,S.length),i.writeBits(15,I.length),r=0;r<S.length;r++)f[r]=r;for(r=0;r<I.length;r++){var T=I[r];for(n=0;n<S.length&&f[n]!==T;n++);for(Ke(f,n);n>0;n--)i.writeBit(1);i.writeBit(0)}for(r=0;r<S.length;r++)S[r].emit(i),S[r].computeCanonical();for(r=0,o=0;r<g;){var x=S[I[o++]];for(n=0;n<50&&r<g;n++)x.encode(i,d[r++])}},oi=Object.create(null);oi.compressFile=function(t,e,i){t=ue.coerceInputStream(t);var s=ue.coerceOutputStream(e,e);e=new zt(s.stream);var r=9;if("number"==typeof i&&(r=i),r<1||r>9)throw new Error("Invalid block size multiplier");var n=1e5*r;n-=19,e.writeByte("B".charCodeAt(0)),e.writeByte("Z".charCodeAt(0)),e.writeByte("h".charCodeAt(0)),e.writeByte("0".charCodeAt(0)+r);var o,a=ue.makeU8Buffer(n),h=0;do{var l=new Ze;(o=si(t,a,n,l))>0&&(h=((h<<1|h>>>31)^l.getCRC())>>>0,e.writeBits(48,54156738319193),e.writeBits(32,l.getCRC()),ni(a,o,e))}while(o===n);return e.writeBits(48,25779555029136),e.writeBits(32,h),e.flush(),s.retval},oi.decompressFile=ei.decode,oi.decompressBlock=ei.decodeBlock,oi.table=ei.table,Ve=oi;var ai,hi=Object.create(null);hi.MAGIC="dmc!";var li=function(t,e,i){this.out=[],this.model=i?i.clone():new _e(t,e,65280,256),this.count=ue.makeU16Buffer(e),this.sum=0};li.prototype.clone=function(t,e){var i,s=new li(t,e,null);for(i=0;i<e;i++)s.out[i]=this.out[i];return s};var ci=function(t,e,i,s){var r,n;for(this.coder=t,this.size=e,this.MIN_CNT1=i||8,this.MIN_CNT2=s||128,this.nodes=[],r=0;r<e;r++)this.nodes[r]=new li(t,e);for(r=0;r<e;r++)for(n=0;n<e;n++)this.nodes[r].out[n]=this.nodes[n];this.current=this.nodes[0]};ci.prototype.maybeSplit=function(t,e,i){var s,r=t.count[e],n=i.sum;if(r<=this.MIN_CNT1||n-r<=this.MIN_CNT2)return i;var o=i.clone(this.coder,this.size);for(this.nodes.push(o),t.out[e]=o,o.sum=i.sum=0,s=0;s<this.size;s++)o.count[s]=i.count[s]*r/n,o.sum+=o.count[s],i.count[s]-=o.count[s],i.sum+=i.count[s];return o},ci.prototype.encode=function(t){var e=this.current;e.model.encode(t);var i=e.out[t];65535!==e.count[t]&&(e.count[t]++,e.sum++),this.current=this.maybeSplit(e,t,i)},ci.prototype.decode=function(){var t=this.current,e=t.model.decode(),i=t.out[e];return 65535!==t.count[e]&&(t.count[e]++,t.sum++),this.current=this.maybeSplit(t,e,i),e},hi.compressFile=ue.compressFileHelper(hi.MAGIC,(function(t,e,i,s){var r=+(s=s||{}).m||8,n=+s.n||128;ue.writeUnsignedNumber(e,r),ue.writeUnsignedNumber(e,n);var o=new Te(e);o.encodeStart(202,0);for(var a=new ci(o,i<0?257:256,r,n),h=0;h!==i;){var l=t.readByte();if(l===Gt.EOF){a.encode(256);break}a.encode(l),h++}o.encodeFinish()})),hi.decompressFile=ue.decompressFileHelper(hi.MAGIC,(function(t,e,i){var s=ue.readUnsignedNumber(t),r=ue.readUnsignedNumber(t),n=new Te(t);n.decodeStart();for(var o=new ci(n,i<0?257:256,s,r),a=0;a!==i;){var h=o.decode();if(256===h)break;e.writeByte(h),a++}n.decodeFinish()})),ai=hi;var ui,di=Object.create(null);di.MAGIC="lzjb";var mi=Gt.EOF;di.compressFile=ue.compressFileHelper(di.MAGIC,(function(t,e,i,s){var r,n,o,a,h,l,c,u=1024,d=1;"number"==typeof s&&(u*=2,s=Math.max(1,Math.min(9,s))-1,d=1<<Math.floor(s/2),1&s&&(d=Math.round(1.5*d)),s>=2&&s<=4&&d++),l=ue.makeU16Buffer(u*d);for(var m=ue.makeU8Buffer(1024),p=0,f=function(t){return m[p++]=t,p>=m.length&&(p=0),t},g=ue.makeU8Buffer(17),w=0,y=function(){var t;for(t=0;t<w;t++)e.writeByte(g[t]);w=0},b=[],C=function(){return b.length?b.pop():t.readByte()},S=function(t){b.push(t)},I=128,T=[];;){var x=C();if(x===mi)break;256==(I<<=1)&&(y(),I=1,g[0]=0,w=1);var v=C();if(v===mi){g[w++]=f(x);break}var k=C();if(k!==mi){for(a=(x<<16)+(v<<8)+k,a^=a>>9,a+=a>>5,h=((a^=x)&u-1)*d,T.length=0,c=0;c<d;c++){o=p-l[h+c]&1023,r=m.length+p-o;var A=m[1023&r],B=m[r+1&1023],L=m[r+2&1023];0===o?A=1^x:1==o?(B=x,L=v):2==o&&(L=x),x===A&&v===B&&k===L&&T.push(o)}for(c=d-1;c>0;c--)l[h+c]=l[h+c-1];if(l[h]=p,0===T.length)g[w++]=f(x),S(k),S(v);else{g[0]|=I,f(x),f(v),f(k);var M=C(),E=T[0],P=m.length+p;for(n=3;n<66&&M!==mi;n++,P++){for(c=0;c<T.length;)M!==m[P-T[c]&1023]?(E=T[c],T.splice(c,1)):c++;if(0===T.length)break;f(M),M=C()}0!==T.length&&(E=T[0]),S(M),g[w++]=n-3<<2|E>>8,g[w++]=255&E}}else g[w++]=f(x),S(v)}y()})),di.decompressFile=ue.decompressFileHelper(di.MAGIC,(function(t,e,i){for(var s,r,n,o,a=ue.makeU8Buffer(1024),h=0,l=128;0!==i&&(o=t.readByte())!==mi;)if(256==(l<<=1)&&(l=1,r=o,o=t.readByte()),r&l)for(n=3+(o>>2),(s=h-(1023&(o<<8|t.readByte())))<0&&(s+=a.length),i>=0&&(i-=n);--n>=0;)o=a[h++]=a[s++],e.writeByte(o),h>=a.length&&(h=0),s>=a.length&&(s=0);else e.writeByte(o),a[h++]=o,h>=a.length&&(h=0),i>=0&&i--})),ui=di;var pi,fi=Object.create(null);fi.MAGIC="lzjR",fi.compressFile=ue.compressFileHelper(fi.MAGIC,(function(t,e,i,s,r){var n,o,a,h,l,c,u,d=1024,m=1;"number"==typeof s&&(d*=2,s=Math.max(1,Math.min(9,s))-1,m=1<<Math.floor(s/2),1&s&&(m=Math.round(1.5*m)),s>=2&&s<=4&&m++);var p=new Te(e);p.encodeStart(r,1),c=ue.makeU16Buffer(d*m);for(var f=ue.makeU8Buffer(1024),g=0,w=function(t){return f[g++]=t,g>=f.length&&(g=0),t},y=[],b=function(){return y.length?y.pop():t.readByte()},C=function(t){y.push(t)},S=[],I=Ue.factory(p),T=Ye.factory(p,65280,256),x=new Se(T,256,1+(i<0?257:256)),v=function(t){return t<=32?T(t):I(t)},k=new Fe(64,0,T,v),A=new Fe(1024,1,T,v),B=32,L=0;;){var M=g,E=b();if(E===Gt.EOF)break;var P=b();if(P===Gt.EOF){x.encode(w(E),B);break}var Y=b();if(Y!==Gt.EOF){for(h=(E<<16)+(P<<8)+Y,h^=h>>9,h+=h>>5,l=((h^=E)&d-1)*m,S.length=0,u=0;u<m;u++){a=g-c[l+u]&1023,n=f.length+g-a;var X=f[1023&n],D=f[n+1&1023],_=f[n+2&1023];1==a?(D=E,_=P):2==a&&(_=E),E===X&&P===D&&Y===_&&S.push(a)}for(u=m-1;u>0;u--)c[l+u]=c[l+u-1];if(c[l]=g,0===S.length)x.encode(w(E),B),C(Y),C(P),B=E;else{x.encode(256,B),w(E),w(P),w(Y),B=Y;var O=b(),R=S[0],j=f.length+g;for(o=3;o<66&&O!==Gt.EOF;o++,j++){for(u=0;u<S.length;)O!==f[j-S[u]&1023]?(R=S[u],S.splice(u,1)):u++;if(0===S.length)break;w(O),B=O,O=b()}0!==S.length&&(R=S[0]),C(O),k.encode(o-3),(a=M-R&1023)===L?A.encode(-1):(A.encode(a),L=a)}}else x.encode(w(E),B),C(P),B=E}i<0&&x.encode(257,B),p.encodeFinish()}),!0),fi.decompressFile=ue.decompressFileHelper(fi.MAGIC,(function(t,e,i){var s,r,n,o=ue.makeU8Buffer(1024),a=0,h=new Te(t);h.decodeStart(!0);for(var l=Ue.factory(h),c=Ye.factory(h,65280,256),u=new Se(c,256,1+(i<0?257:256)),d=function(t){return t<=32?c(t):l(t)},m=new Fe(64,0,c,d),p=new Fe(1024,1,c,d),f=32,g=0;0!==i&&257!==(n=u.decode(f));)if(256===n)for(r=m.decode()+3,(s=p.decode())<0?s=g:g=s,i>=0&&(i-=r);--r>=0;)n=f=o[a++]=o[s++],e.writeByte(n),a>=o.length&&(a=0),s>=o.length&&(s=0);else e.writeByte(n),o[a++]=f=n,a>=o.length&&(a=0),i>=0&&i--;h.decodeFinish()})),pi=fi;var gi;const wi=Ye;var yi=Object.create(null);yi.MAGIC="lzp3";var bi=function(t){this.buffer=ue.makeU8Buffer(Math.min(t+4,1<<20)),this.pos=0,this.ctxt4=ue.makeU32Buffer(65536),this.ctxt3=ue.makeU32Buffer(4096),this.ctxt2=ue.makeU32Buffer(65536),this.put(99),this.put(83),this.put(97),this.put(32)};bi.prototype.put=function(t){return this.buffer[this.pos++]=t,this.pos>=1<<20&&(this.pos=0),t},bi.prototype.get=function(t){return this.buffer[1048575&t]},bi.prototype.context=function(t,e){var i,s=0;for(t=t-e&1048575,i=0;i<e;i++)s=s<<8|this.buffer[t++],t>=1<<20&&(t=0);return s},bi.prototype.getIndex=function(t,e){var i=this.context(t,4),s=65535&(i>>>15^i),r=4095&(i>>>11^i),n=65535&i,o=0;return 0===e&&(0!==(o=this.ctxt4[s])&&i!==this.context(o-1,4)&&(o=0),0===o&&(0!==(o=this.ctxt3[r])&&(16777215&i)!==this.context(o-1,3)&&(o=0),0===o&&0!==(o=this.ctxt2[n])&&(i&&65535)!==this.context(o-1,2)&&(o=0))),e&&e--,this.ctxt4[s]=this.ctxt3[r]=this.ctxt2[n]=1+(t|e<<20),o},yi.compressFile=ue.compressFileHelper(yi.MAGIC,(function(t,e,i,s){var r,n,o,a=new bi(i>=0?i:1<<20),h=new Te(e);h.encodeStart(0,0),r=wi.factory(h,65280,256);var l=Ue.factory(h);n=function(t){return t>256?l(t):r(t)},o=function(){h.encodeFinish()};var c,u=new Se(r,256,i<0?257:256),d=[];for(c=0;c<16;c++)d[c]=new Fe(1048576,1,r,n);for(var m,p=0,f=0;p!==i;){var g=t.readByte();m=a.pos;var w=a.getIndex(m,0);if(0!==w){for(var y=1+(--w>>>20),b=0;a.get(w+b)===g&&b<1048575;)b++,a.put(g),g=t.readByte();y===b?d[15&f].encode(-1):d[15&f].encode(b),a.getIndex(m,b),p+=b,f<<=1,b>0&&(f|=1)}var C=a.get(a.pos-1);if(g===Gt.EOF){i<0&&u.encode(256,C);break}u.encode(g,C),a.put(g),p++}o&&o()})),yi.decompressFile=ue.decompressFileHelper(yi.MAGIC,(function(t,e,i){var s,r,n,o=!!(128&t.readByte()),a=new bi(i>=0?i:1<<20);if(o){var h=new zt(t);s=ye.factory(h,65535),r=Ue.factory(h)}else{var l=new Te(t);l.decodeStart(!0),s=wi.factory(l,65280,256);var c=Ue.factory(l);r=function(t){return t>256?c(t):s(t)},n=function(){l.decodeFinish()}}var u,d=new Se(s,256,i<0?257:256),m=[];for(u=0;u<16;u++)m[u]=new Fe(1048576,1,s,r);for(var p,f,g=0,w=0;g!==i;){p=a.pos;var y=a.getIndex(p,0);if(0!==y){var b=1+(--y>>>20),C=m[15&w].decode();for(C<0&&(C=b),u=0;u<C;u++)f=a.get(y+u),e.writeByte(a.put(f));a.getIndex(p,C),g+=C,w<<=1,C>0&&(w|=1)}if(g===i)break;var S=a.get(a.pos-1);if(256===(f=d.decode(S)))break;e.writeByte(a.put(f)),g++}n&&n()})),gi=yi;var Ci,Si=function(){this.buffer=ue.makeU8Buffer(1<<18),this.pos=0,this.firstPass=!0;for(var t=0;t<5;t++)this.put("cSaCsA".charCodeAt(t%6))};Si.prototype.put=function(t){return this.buffer[this.pos++]=t,this.pos>=1<<18&&(this.pos=0,this.firstPass=!1),t},Si.prototype.get=function(t){return this.buffer[262143&t]},Si.prototype.context=function(t,e){var i,s=[];for(t=t-e&262143,i=0;i<e;i++)s.push(this.buffer[t++]),t>=1<<18&&(t=0);return String.fromCharCode.apply(String,s)};var Ii=function(t,e){this.window=new Si,this.contexts=Object.create(null);var i=function(){};i.prototype.encode=function(i,s){var r,n=0;for(r=0;r<i;r++)s[r]||n++;var o=e-s.total;t.encodeFreq(1,n,o)},i.prototype.decode=function(i){var s,r,n,o=e-i.total;for(r=n=t.decodeCulFreq(o),s=0;s<=r;s++)i[s]&&r++;return t.decodeUpdate(1,n,o),r},this.cm1coder=new i;var s=function(){this.sym=[e],this.prob=[0,256],this.refcount=0};s.prototype._rescale=function(){var t,i,s=this.sym.length,r=0,n=!0;for(t=0,i=0;t<s;t++){var o=this.sym[t],a=this.prob[t+1]-this.prob[t];(a>>>=1)>0&&(o===e&&(n=!1),this.sym[i]=o,this.prob[i++]=r,r+=a)}return this.prob[i]=r,s=this.sym.length=i,this.prob.length=s+1,n&&s<e&&(r=this._update(e,s,0,1)),r},s.prototype.update=function(t,e){var i=0;for(i=0;i<this.sym.length;i++)if(this.sym[i]===t)return this._update(t,i,this.prob[i+1]-this.prob[i],e);return this._update(t,i,0,e)},s.prototype._update=function(t,i,s,r){var n,o,a,h=this.sym.length;for(o=i;o<h-1;o++)this.sym[o]=this.sym[o+1],this.prob[o]=this.prob[o+1]-s;if(i<h)this.sym[o]=t,this.prob[o]=this.prob[o+1]-s,this.prob[h]=a=this.prob[h]+r;else if(a=this.prob[h],this.sym[i]=t,this.prob[i]=a,a+=r,this.prob[++h]=a,this.sym.length>e)for(n=0;n<h;n++)e===this.sym[n]&&(this._update(e,n,this.prob[n+1]-this.prob[n],-1),this.sym.length--,this.prob.length--,a=this.prob[this.prob.length-1]);return a>=65280&&(a=this._rescale()),a},s.prototype.encode=function(i,s){var r,n,o,a,h,l,c=this.sym.length,u=0,d=0,m=0;for(r=c-1;r>=0;r--){if(a=this.prob[r],o=this.prob[r+1]-a,i===this.sym[r]){for(n=r-1;n>=0&&u<s.total;n--)s[this.sym[n]]&&(u+=1,d+=l=this.prob[n+1]-this.prob[n],m+=l);return h=this.prob[c],a-=d,h-=m,t.encodeFreq(o,a,h),i!==e||(this._update(i,r,o,128),!1)}s[this.sym[r]]&&(u+=1,m+=o)}for(this.encode(e,s),r=0;r<this.sym.length-1;r++)s[this.sym[r]]||(s[this.sym[r]]=!0,s.total++)},s.prototype.decode=function(i){var s,r,n=this.sym.length,o=this.prob[n],a=0,h=0,l=0;for(r=n-1;r>=0&&a<i.total;r--)i[this.sym[r]]&&(a+=1,l+=this.prob[r+1]-this.prob[r]);var c=t.decodeCulFreq(o-l)+l;for(h=l,r=n-1;r>=0;r--)if(i[this.sym[r]])h-=s=this.prob[r+1]-this.prob[r],c-=s;else if(this.prob[r]<=c)break;var u=this.sym[r],d=this.prob[r],m=this.prob[r+1]-d;if(t.decodeUpdate(m,d-h,o-l),u<e)return u;for(this._update(u,r,m,128),r=0;r<this.sym.length-1;r++)i[this.sym[r]]||(i[this.sym[r]]=!0,i.total++);return-1},this.newContext=function(t){return new s},this.newExclude=function(){var t=Object.create(null);return t.total=0,t},function(){var t,e;for(t=0;t<5;t++)for(e=0;e<=t;e++){var i=this.window.context(e+(4-t),e);this.contexts[i]||(this.contexts[i]=this.newContext()),this.contexts[i].refcount++}}.call(this)};Ii.prototype.update=function(t,e,i){var s,r,n;for(r=0;r<=5;r++)n=e.slice(5-r),(s=this.contexts[n])||(s=this.contexts[n]=this.newContext()),r>=i&&s.update(t,128),s.refcount++;e=this.window.context(this.window.pos+5,5);var o=this.window.firstPass;for(r=5;r>=0&&!o;r--)n=e.slice(0,r),--(s=this.contexts[n]).refcount<=0&&delete this.contexts[n];this.window.put(t)},Ii.prototype.decode=function(){var t,e,i,s,r=this.window.context(this.window.pos,5),n=this.newExclude();for(e=5;e>=0;e--)if(i=r.slice(5-e),(t=this.contexts[i])&&(s=t.decode(n))>=0)return this.update(s,r,e),s;return s=this.cm1coder.decode(n),this.update(s,r,e),s},Ii.prototype.encode=function(t){var e,i=this.window.context(this.window.pos,5),s=this.newExclude();for(e=5;e>=0;e--){var r=i.slice(5-e),n=this.contexts[r];if(n&&n.encode(t,s))return void this.update(t,i,e)}this.cm1coder.encode(t,s),this.update(t,i,e)},Ii.MAGIC="ppm2",Ii.compressFile=ue.compressFileHelper(Ii.MAGIC,(function(t,e,i,s,r){var n=new Te(e);n.encodeStart(r,1);var o=new Ii(n,i<0?257:256);ue.compressWithModel(t,i,o),n.encodeFinish()}),!0),Ii.decompressFile=ue.decompressFileHelper(Ii.MAGIC,(function(t,e,i){var s=new Te(t);s.decodeStart(!0);var r=new Ii(s,i<0?257:256);ue.decompressWithModel(e,i,r),s.decodeFinish()})),Ci=Ii;var Ti=Object.create(null);Ti.MAGIC="smpl",Ti.compressFile=ue.compressFileHelper(Ti.MAGIC,(function(t,e,i,s,r){var n=new Te(e);n.encodeStart(r,1);for(var o=ue.makeU8Buffer(1<<17),a=[],h=0,l=!1,c=function(){var e=0;for(e=0;e<256;e++)a[e]=0;if(l)h=0;else{for(e=0;e<1<<17;){var i=t.readByte();if(i===Gt.EOF){l=!0;break}if(o[e++]=i,a[i]++,65535===a[i])break}h=e}};;){var u;if(c(),l&&0===h)break;for(n.encodeBit(!0),u=0;u<256;u++)n.encodeShort(a[u]);for(a[256]=h,u=256;u;u--)a[u-1]=a[u]-a[u-1];for(u=0;u<h;u++){var d=o[u];n.encodeFreq(a[d+1]-a[d],a[d],a[256])}}n.encodeBit(!1),n.encodeFinish()}),!0),Ti.decompressFile=ue.decompressFileHelper(Ti.MAGIC,(function(t,e,i){var s=new Te(t);for(s.decodeStart(!0);s.decodeBit();){var r,n=[];for(r=0;r<256;r++)n[r]=s.decodeShort();var o=0;for(r=0;r<256;r++){var a=n[r];n[r]=o,o+=a}for(n[256]=o,r=0;r<o;r++){var h,l=s.decodeCulFreq(o);for(h=0;h<256&&!(n[h]<=l&&l<n[h+1]);h++);s.decodeUpdate(n[h+1]-n[h],n[h],o),e.writeByte(h)}}s.decodeFinish()}));var xi=Vt({version:"1.2.0",BitStream:zt,Stream:Gt,BWT:de,Context1Model:Se,DefSumModel:Me,FenwickModel:Ye,MTFModel:_e,NoModel:Ue,Huffman:ye,RangeCoder:Te,BWTC:We,Bzip2:Ve,Dmc:ai,Lzjb:ui,LzjbR:pi,Lzp3:gi,PPM:Ci,Simple:Ti}),vi={};const ki=Wt.Buffer,{Bzip2:Ai}=xi,Bi=ki.from("BZh1".split("").map(t=>t.charCodeAt(0)));vi.decompress=function(t,e,i,s,r){const n=ki.from(i.slice(r,s+r)),o=Ai.decompressFile(ki.concat([Bi,n]));t.set(o)};var Li={};const Mi="0".charCodeAt(0),Ei="9".charCodeAt(0),Pi="a".charCodeAt(0),Yi="A".charCodeAt(0),Xi="Z".charCodeAt(0),Di="z".charCodeAt(0);class _i{static openFile(t){return new class{constructor(t){this.url=t,this.xhr=new XMLHttpRequest,this.xhr.responseType="arraybuffer",this.xhr.open("GET",t,!0),this.buffer=null,this.pos=0}_loadResBytes(){return new Promise((t,e)=>{this.xhr.onerror=t=>e(t),this.xhr.onload=()=>{/^2/.test(this.xhr.status)?t(new Int8Array(this.xhr.response)):e(new Error(`unable to download ${this.url}.\n                        status code = ${this.xhr.status}`))},this.xhr.send()})}async readFully(t,e=0,i){void 0===i&&(i=t.length),this.buffer||(this.buffer=await this._loadResBytes()),t.set(this.buffer.slice(this.pos,this.pos+i),e),this.pos+=i}}(t)}static getUnsignedByte(t){return 255&t}static getUnsignedShort(t,e){return((255&t[e])<<8)+(255&t[e+1])}static getUnsignedInt(t,e){return((255&t[e])<<24)+((255&t[e+1])<<16)+((255&t[e+2])<<8)+(255&t[e+3])}static getUnsignedLong(t,e){return ht.fromInt(4294967295&_i.getUnsignedInt(t,e)).shiftLeft(32).add(new ht(4294967295&_i.getUnsignedInt(t,e+4)))}static getSignedShort(t,e){let i=256*_i.getUnsignedByte(t[e])+_i.getUnsignedByte(t[e+1])|0;return i>32767&&(i-=65536),i}static getStackInt(t,e){return(255&t[e])<128?t[e]:((255&t[e])-128<<24)+((255&t[e+1])<<16)+((255&t[e+2])<<8)+(255&t[e+3])}static getBitMask(t,e,i){let s=e>>3,r=8-(7&e),n=0;for(;i>r;r=8)n+=(t[s++]&_i.bitmask[r])<<i-r,i-=r;return n+(i===r?t[s]&_i.bitmask[r]:t[s]>>r-i&_i.bitmask[i])}static formatAuthString(t,e){let i="";for(let s=0;s<e;s++)if(s>=t.length)i+=" ";else{let e=t.charCodeAt(s);i+=e>=Pi&&e<=Di||e>=Yi&&e<=Xi||e>=Mi&&e<=Ei?String.fromCharCode(e):"_"}return i}static ipToString(t){return(t>>24&255)+"."+(t>>16&255)+"."+(t>>8&255)+"."+(255&t)}static usernameToHash(t){let e="";for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);e+=i>=Pi&&i<=Di?String.fromCharCode(i):i>=Yi&&i<=Xi?String.fromCharCode(i+97-65):i>=Mi&&i<=Ei?String.fromCharCode(i):" "}(e=e.trim()).length>12&&(e=e.slice(0,12));let i=new ht(0);for(let s=0;s<e.length;s++){let t=e.charCodeAt(s);i=i.multiply(37),t>=Pi&&t<=Di?i=i.add(1+t-97):t>=Mi&&t<=Ei&&(i=i.add(27+t-48))}return i}static hashToUsername(t){if(t.lessThan(0))return"invalidName";let e="";for(;!t.equals(0);){let i=t.modulo(37).toInt();t=t.divide(37),e=0===i?" "+e:i<27?t.modulo(37).equals(0)?String.fromCharCode(i+65-1)+e:String.fromCharCode(i+97-1)+e:String.fromCharCode(i+48-27)+e}return e}static getDataFileOffset(t,e){let i=_i.getUnsignedShort(e,0),s=0;t=t.toUpperCase();for(let n=0;n<t.length;n++)s=(61*s|0)+t.charCodeAt(n)-32;let r=2+10*i;for(let n=0;n<i;n++){let t=16777216*(255&e[10*n+2])+65536*(255&e[10*n+3])+256*(255&e[10*n+4])+(255&e[10*n+5])|0,i=65536*(255&e[10*n+9])+256*(255&e[10*n+10])+(255&e[10*n+11])|0;if(t===s)return r;r+=i}return 0}static getDataFileLength(t,e){const i=_i.getUnsignedShort(e,0);let s=0;t=t.toUpperCase();for(let r=0;r<t.length;r++)s=(61*s|0)+t.charCodeAt(r)-32;for(let r=0;r<i;r++){let t=16777216*(255&e[10*r+2])+65536*(255&e[10*r+3])+256*(255&e[10*r+4])+(255&e[10*r+5])|0,i=65536*(255&e[10*r+6])+256*(255&e[10*r+7])+(255&e[10*r+8])|0;if(t===s)return i}return 0}static loadData(t,e,i){return _i.unpackData(t,e,i,null)}static unpackData(t,e,i,s){const r=256*(255&i[0])+(255&i[1])|0;let n=0;t=t.toUpperCase();for(let a=0;a<t.length;a++)n=(61*n|0)+t.charCodeAt(a)-32;let o=2+10*r;for(let a=0;a<r;a++){const t=16777216*(255&i[10*a+2])+65536*(255&i[10*a+3])+256*(255&i[10*a+4])+(255&i[10*a+5])|0,r=65536*(255&i[10*a+6])+256*(255&i[10*a+7])+(255&i[10*a+8])|0,h=65536*(255&i[10*a+9])+256*(255&i[10*a+10])+(255&i[10*a+11])|0;if(t===n){if(null===s&&(s=new Int8Array(r+e)),r!==h)vi.decompress(s,r,i,h,o);else for(let t=0;t<r;t++)s[t]=i[o+t];return s}o+=h}return null}static formatConfirmAmount(t){let e=t.toString();for(let i=e.length-3;i>0;i-=3)e=e.substring(0,i)+","+e.substring(i);return e.length>8?e="@gre@"+e.substring(0,e.length-8)+` million @whi@(${e})`:e.length>4&&(e="@cya@"+e.substring(0,e.length-4)+`K @whi@(${e})`),e}}_i.bitmask=new Int32Array([0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215,33554431,67108863,134217727,268435455,536870911,1073741823,2147483647,-1]),Li=_i;const Oi="0".charCodeAt(0),Ri="9".charCodeAt(0);class ji{constructor(t,e,i,s){this.mudclient=s,this.image=null,this.anIntArray340=null,this.anIntArray341=null,this.anIntArray342=null,this.anIntArray343=null,this.anIntArray344=null,this.anIntArray345=null,this.boundsTopY=0,this.boundsTopX=0,this.interlace=!1,this.loggedIn=!1,this.boundsBottomY=e,this.boundsBottomX=t,this.width1=this.width2=t,this.height1=this.height2=e,this.area=t*e,this.pixels=new Int32Array(t*e),this.surfacePixels=[],this.surfacePixels.length=i,this.surfacePixels.fill(null),this.spriteColoursUsed=[],this.spriteColoursUsed.length=i,this.spriteColoursUsed.fill(null),this.spriteColourList=[],this.spriteColourList.length=i,this.spriteColourList.fill(null),this.spriteTranslate=new Int8Array(i),this.spriteWidth=new Int32Array(i),this.spriteHeight=new Int32Array(i),this.spriteWidthFull=new Int32Array(i),this.spriteHeightFull=new Int32Array(i),this.spriteTranslateX=new Int32Array(i),this.spriteTranslateY=new Int32Array(i),this.imageData=s._graphics.ctx.getImageData(0,0,t,e),this.bufferedPixels=new Int32Array(t*e),this.pixelBytes=new Uint8ClampedArray(this.bufferedPixels.buffer),this.setComplete()}static rgbToInt(t,e,i){return(t<<16)+(e<<8)+i}static createFont(t,e){ji.gameFonts[e]=t}setComplete(){for(let e=0;e<this.area;e+=1)this.bufferedPixels[e]=(255<<24)+((255&(t=this.pixels[e]))<<16)+((t>>8&255)<<8)+(t>>16&255);var t;this.imageData.data.set(this.pixelBytes,0,0)}setBounds(t,e,i,s){t<0&&(t=0),e<0&&(e=0),i>this.width2&&(i=this.width2),s>this.height2&&(s=this.height2),this.boundsTopX=t,this.boundsTopY=e,this.boundsBottomX=i,this.boundsBottomY=s}resetBounds(){this.boundsTopX=0,this.boundsTopY=0,this.boundsBottomX=this.width2,this.boundsBottomY=this.height2}draw(t,e,i){this.setComplete(),t.drawImage(this.imageData,e,i)}blackScreen(){const t=this.width2*this.height2;if(!this.interlace){for(let e=0;e<t;e++)this.pixels[e]=0;return}let e=0;for(let i=-this.height2;i<0;i+=2){for(let t=-this.width2;t<0;t++)this.pixels[e++]=0;e+=this.width2}}drawCircle(t,e,i,s,r){const n=256-r,o=(s>>16&255)*r,a=(s>>8&255)*r,h=(255&s)*r;let l=e-i;l<0&&(l=0);let c=e+i;c>=this.height2&&(c=this.height2-1);let u=1;this.interlace&&(u=2,0!=(1&l)&&l++);for(let d=l;d<=c;d+=u){const s=d-e,r=0|Math.sqrt(i*i-s*s);let l=t-r;l<0&&(l=0);let c=t+r;c>=this.width2&&(c=this.width2-1);let u=l+d*this.width2;for(let t=l;t<=c;t++){const t=(o+(this.pixels[u]>>16&255)*n>>8<<16)+(a+(this.pixels[u]>>8&255)*n>>8<<8)+(h+(255&this.pixels[u])*n>>8);this.pixels[u++]=t}}}drawBoxAlpha(t,e,i,s,r,n){t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),e<this.boundsTopY&&(s-=this.boundsTopY-e,e=this.boundsTopY),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t),e+s>this.boundsBottomY&&(s=this.boundsBottomY-e);const o=256-n,a=(r>>16&255)*n,h=(r>>8&255)*n,l=(255&r)*n;let c=this.width2-i,u=1;this.interlace&&(u=2,c+=this.width2,0!=(1&e)&&(e++,s--));let d=t+e*this.width2;for(let m=0;m<s;m+=u){for(let t=-i;t<0;t++){const t=(a+(this.pixels[d]>>16&255)*o>>8<<16)+(h+(this.pixels[d]>>8&255)*o>>8<<8)+(l+(255&this.pixels[d])*o>>8);this.pixels[d++]=t}d+=c}}drawGradient(t,e,i,s,r,n){t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t);const o=n>>16&255,a=n>>8&255,h=255&n,l=r>>16&255,c=r>>8&255,u=255&r;let d=this.width2-i,m=1;this.interlace&&(m=2,d+=this.width2,0!=(1&e)&&(e++,s--));let p=t+e*this.width2;for(let f=0;f<s;f+=m)if(f+e>=this.boundsTopY&&f+e<this.boundsBottomY){const t=((o*f+l*(s-f))/s<<16)+((a*f+c*(s-f))/s<<8)+((h*f+u*(s-f))/s|0);for(let e=-i;e<0;e++)this.pixels[p++]=t;p+=d}else p+=this.width2}drawBox(t,e,i,s,r){t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),e<this.boundsTopY&&(s-=this.boundsTopY-e,e=this.boundsTopY),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t),e+s>this.boundsBottomY&&(s=this.boundsBottomY-e);let n=this.width2-i,o=1;this.interlace&&(o=2,n+=this.width2,0!=(1&e)&&(e++,s--));let a=t+e*this.width2;for(let h=-s;h<0;h+=o){for(let t=-i;t<0;t++)this.pixels[a++]=r;a+=n}}drawBoxEdge(t,e,i,s,r){this.drawLineHoriz(t,e,i,r),this.drawLineHoriz(t,e+s-1,i,r),this.drawLineVert(t,e,s,r),this.drawLineVert(t+i-1,e,s,r)}drawLineHoriz(t,e,i,s){if(e<this.boundsTopY||e>=this.boundsBottomY)return;t<this.boundsTopX&&(i-=this.boundsTopX-t,t=this.boundsTopX),t+i>this.boundsBottomX&&(i=this.boundsBottomX-t);let r=t+e*this.width2;for(let n=0;n<i;n++)this.pixels[r+n]=s}drawLineVert(t,e,i,s){if(t<this.boundsTopX||t>=this.boundsBottomX)return;e<this.boundsTopY&&(i-=this.boundsTopY-e,e=this.boundsTopY),e+i>this.boundsBottomX&&(i=this.boundsBottomY-e);let r=t+e*this.width2;for(let n=0;n<i;n++)this.pixels[r+n*this.width2]=s}setPixel(t,e,i){t<this.boundsTopX||e<this.boundsTopY||t>=this.boundsBottomX||e>=this.boundsBottomY||(this.pixels[t+e*this.width2]=i)}fadeToBlack(){let t=this.width2*this.height2;for(let e=0;e<t;e++){let t=16777215&this.pixels[e];this.pixels[e]=(t>>>1&8355711)+(t>>>2&4144959)+(t>>>3&2039583)+(t>>>4&986895)}}drawLineAlpha(t,e,i,s,r,n){for(let o=i;o<i+r;o++)for(let i=s;i<s+n;i++){let s=0,r=0,n=0,a=0;for(let h=o-t;h<=o+t;h++)if(h>=0&&h<this.width2)for(let t=i-e;t<=i+e;t++)if(t>=0&&t<this.height2){let e=this.pixels[h+this.width2*t];s+=e>>16&255,r+=e>>8&255,n+=255&e,a++}this.pixels[o+this.width2*i]=(s/a<<16)+(r/a<<8)+(n/a|0)}}clear(){for(let t=0;t<this.surfacePixels.length;t++)this.surfacePixels[t]=null,this.spriteWidth[t]=0,this.spriteHeight[t]=0,this.spriteColoursUsed[t]=null,this.spriteColourList[t]=null}parseSprite(t,e,i,s){let r=Li.getUnsignedShort(e,0);const n=Li.getUnsignedShort(i,r);r+=2;const o=Li.getUnsignedShort(i,r);r+=2;const a=255&i[r++],h=new Int32Array(a);h[0]=16711935;for(let c=0;c<a-1;c++)h[c+1]=((255&i[r])<<16)+((255&i[r+1])<<8)+(255&i[r+2]),r+=3;let l=2;for(let c=t;c<t+s;c++){this.spriteTranslateX[c]=255&i[r++],this.spriteTranslateY[c]=255&i[r++],this.spriteWidth[c]=Li.getUnsignedShort(i,r),r+=2,this.spriteHeight[c]=Li.getUnsignedShort(i,r),r+=2;const t=255&i[r++],s=this.spriteWidth[c]*this.spriteHeight[c];if(this.spriteColoursUsed[c]=new Int8Array(s),this.spriteColourList[c]=h,this.spriteWidthFull[c]=n,this.spriteHeightFull[c]=o,this.surfacePixels[c]=null,this.spriteTranslate[c]=!1,0===this.spriteTranslateX[c]&&0===this.spriteTranslateY[c]||(this.spriteTranslate[c]=!0),0===t)for(let i=0;i<s;i++)this.spriteColoursUsed[c][i]=e[l++],0===this.spriteColoursUsed[c][i]&&(this.spriteTranslate[c]=!0);else if(1===t)for(let i=0;i<this.spriteWidth[c];i++)for(let t=0;t<this.spriteHeight[c];t++)this.spriteColoursUsed[c][i+t*this.spriteWidth[c]]=e[l++],0===this.spriteColoursUsed[c][i+t*this.spriteWidth[c]]&&(this.spriteTranslate[c]=!0)}}readSleepWord(t,e){const i=this.surfacePixels[t]=new Int32Array(10200);this.spriteWidth[t]=255,this.spriteHeight[t]=40,this.spriteTranslateX[t]=0,this.spriteTranslateY[t]=0,this.spriteWidthFull[t]=255,this.spriteHeightFull[t]=40,this.spriteTranslate[t]=!1;let s=0,r=1,n=0;for(n=0;n<255;){const t=255&e[r++];for(let e=0;e<t;e++)i[n++]=s;s=16777215-s}for(let o=1;o<40;o++)for(let t=0;t<255;){const s=255&e[r++];for(let e=0;e<s;e++)i[n]=i[n-255],n++,t++;t<255&&(i[n]=16777215-i[n-255],n++,t++)}}drawWorld(t){let e=this.spriteWidth[t]*this.spriteHeight[t],i=this.surfacePixels[t],s=new Int32Array(32768);for(let a=0;a<e;a++){let t=i[a];s[((16252928&t)>>9)+((63488&t)>>6)+((248&t)>>3)]++}let r=new Int32Array(256);r[0]=16711935;let n=new Int32Array(256);for(let a=0;a<32768;a++){let t=s[a];if(t>n[255])for(let e=1;e<256;e++)if(!(t<=n[e])){for(let t=255;t>e;t--)r[t]=r[t-1],n[t]=n[t-1];r[e]=((31744&a)<<9)+((992&a)<<6)+((31&a)<<3)+263172,n[e]=t;break}s[a]=-1}let o=new Int8Array(e);for(let a=0;a<e;a++){let t=i[a],e=((16252928&t)>>9)+((63488&t)>>6)+((248&t)>>3),n=s[e];if(-1===n){let i=999999999,o=t>>16&255,a=t>>8&255,h=255&t;for(let t=0;t<256;t++){let e=r[t],s=e>>16&255,l=e>>8&255,c=255&e,u=(o-s)*(o-s)+(a-l)*(a-l)+(h-c)*(h-c);u<i&&(i=u,n=t)}s[e]=n}o[a]=255&n}this.spriteColoursUsed[t]=o,this.spriteColourList[t]=r,this.surfacePixels[t]=null}loadSprite(t){if(null===this.spriteColoursUsed[t])return;const e=this.spriteWidth[t]*this.spriteHeight[t],i=this.spriteColoursUsed[t],s=this.spriteColourList[t],r=new Int32Array(e);for(let n=0;n<e;n++){let t=s[255&i[n]];0===t?t=1:16711935===t&&(t=0),r[n]=t}this.surfacePixels[t]=r,this.spriteColoursUsed[t]=null,this.spriteColourList[t]=null}drawSpriteMinimap(t,e,i,s,r){this.spriteWidth[t]=s,this.spriteHeight[t]=r,this.spriteTranslate[t]=!1,this.spriteTranslateX[t]=0,this.spriteTranslateY[t]=0,this.spriteWidthFull[t]=s,this.spriteHeightFull[t]=r,this.surfacePixels[t]=new Int32Array(s*r);let n=0;for(let o=e;o<e+s;o++)for(let e=i;e<i+r;e++)this.surfacePixels[t][n++]=this.pixels[o+e*this.width2]}_drawSprite_from5(t,e,i,s,r){this.spriteWidth[t]=s,this.spriteHeight[t]=r,this.spriteTranslate[t]=!1,this.spriteTranslateX[t]=0,this.spriteTranslateY[t]=0,this.spriteWidthFull[t]=s,this.spriteHeightFull[t]=r,this.surfacePixels[t]=new Int32Array(s*r);let n=0;for(let o=i;o<i+r;o++)for(let i=e;i<e+s;i++)this.surfacePixels[t][n++]=this.pixels[i+o*this.width2]}_drawSprite_from3(t,e,i){this.spriteTranslate[i]&&(t+=this.spriteTranslateX[i],e+=this.spriteTranslateY[i]);let s=t+e*this.width2,r=0,n=this.spriteHeight[i],o=this.spriteWidth[i],a=this.width2-o,h=0;if(e<this.boundsTopY){let t=this.boundsTopY-e;n-=t,e=this.boundsTopY,r+=t*o,s+=t*this.width2}if(e+n>=this.boundsBottomY&&(n-=e+n-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;o-=e,t=this.boundsTopX,r+=e,s+=e,h+=e,a+=e}if(t+o>=this.boundsBottomX){let e=t+o-this.boundsBottomX+1;o-=e,h+=e,a+=e}if(o<=0||n<=0)return;let l=1;this.interlace&&(l=2,a+=this.width2,h+=this.spriteWidth[i],0!=(1&e)&&(s+=this.width2,n--)),null===this.surfacePixels[i]?this._drawSprite_from10A(this.pixels,this.spriteColoursUsed[i],this.spriteColourList[i],r,s,o,n,a,h,l):this._drawSprite_from10(this.pixels,this.surfacePixels[i],0,r,s,o,n,a,h,l)}_spriteClipping_from5(t,e,i,s,r){try{const n=this.spriteWidth[r],o=this.spriteHeight[r];let a=0,h=0,l=(n<<16)/i|0,c=(o<<16)/s|0;if(this.spriteTranslate[r]){let n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];l=(n<<16)/i|0,c=(o<<16)/s|0,t+=(this.spriteTranslateX[r]*i+n-1)/n|0,e+=(this.spriteTranslateY[r]*s+o-1)/o|0,this.spriteTranslateX[r]*i%n!=0&&(a=(n-this.spriteTranslateX[r]*i%n<<16)/i|0),this.spriteTranslateY[r]*s%o!=0&&(h=(o-this.spriteTranslateY[r]*s%o<<16)/s|0),i=i*(this.spriteWidth[r]-(a>>16))/n|0,s=s*(this.spriteHeight[r]-(h>>16))/o|0}let u=t+e*this.width2,d=this.width2-i;if(e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=0,u+=t*this.width2,h+=c*t}if(e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;i-=e,t=0,u+=e,a+=l*e,d+=e}if(t+i>=this.boundsBottomX){let e=t+i-this.boundsBottomX+1;i-=e,d+=e}let m=1;this.interlace&&(m=2,d+=this.width2,c+=c,0!=(1&e)&&(u+=this.width2,s--)),this._plotScale_from13(this.pixels,this.surfacePixels[r],0,a,h,u,d,i,s,l,c,n,m)}catch(Ui){console.error(Ui)}}_spriteClipping_from7(t,e,i,s,r,n,o){r>=5e4?this.mudclientref.drawTeleportBubble(t,e,i,s,r-5e4,n,o):r>=4e4?this.mudclientref.drawItem(t,e,i,s,r-4e4,n,o):r>=2e4?this.mudclientref.drawNpc(t,e,i,s,r-2e4,n,o):r>=5e3?this.mudclientref.drawPlayer(t,e,i,s,r-5e3,n,o):this._spriteClipping_from5(t,e,i,s,r)}_drawSpriteAlpha_from4(t,e,i,s){this.spriteTranslate[i]&&(t+=this.spriteTranslateX[i],e+=this.spriteTranslateY[i]);let r=t+e*this.width2,n=0,o=this.spriteHeight[i],a=this.spriteWidth[i],h=this.width2-a,l=0;if(e<this.boundsTopY){let t=this.boundsTopY-e;o-=t,e=this.boundsTopY,n+=t*a,r+=t*this.width2}if(e+o>=this.boundsBottomY&&(o-=e+o-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;a-=e,t=this.boundsTopX,n+=e,r+=e,l+=e,h+=e}if(t+a>=this.boundsBottomX){let e=t+a-this.boundsBottomX+1;a-=e,l+=e,h+=e}if(a<=0||o<=0)return;let c=1;this.interlace&&(c=2,h+=this.width2,l+=this.spriteWidth[i],0!=(1&e)&&(r+=this.width2,o--)),null===this.surfacePixels[i]?this._drawSpriteAlpha_from11A(this.pixels,this.spriteColoursUsed[i],this.spriteColourList[i],n,r,a,o,h,l,c,s):this._drawSpriteAlpha_from11(this.pixels,this.surfacePixels[i],0,n,r,a,o,h,l,c,s)}drawActionBubble(t,e,i,s,r,n){try{const o=this.spriteWidth[r],a=this.spriteHeight[r];let h=0,l=0,c=(o<<16)/i|0,u=(a<<16)/s|0;if(this.spriteTranslate[r]){const n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];c=(n<<16)/i|0,u=(o<<16)/s|0,t+=(this.spriteTranslateX[r]*i+n-1)/n|0,e+=(this.spriteTranslateY[r]*s+o-1)/o|0,this.spriteTranslateX[r]*i%n!=0&&(h=(n-this.spriteTranslateX[r]*i%n<<16)/i|0),this.spriteTranslateY[r]*s%o!=0&&(l=(o-this.spriteTranslateY[r]*s%o<<16)/s|0),i=i*(this.spriteWidth[r]-(h>>16))/n|0,s=s*(this.spriteHeight[r]-(l>>16))/o|0}let d=t+e*this.width2,m=this.width2-i;if(e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=0,d+=t*this.width2,l+=u*t}if(e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;i-=e,t=0,d+=e,h+=c*e,m+=e}if(t+i>=this.boundsBottomX){let e=t+i-this.boundsBottomX+1;i-=e,m+=e}let p=1;this.interlace&&(p=2,m+=this.width2,u+=u,0!=(1&e)&&(d+=this.width2,s--)),this.transparentScale(this.pixels,this.surfacePixels[r],0,h,l,d,m,i,s,c,u,o,p,n)}catch(Ui){console.error(Ui)}}_spriteClipping_from6(t,e,i,s,r,n){try{let o=this.spriteWidth[r],a=this.spriteHeight[r],h=0,l=0,c=(o<<16)/i|0,u=(a<<16)/s|0;if(this.spriteTranslate[r]){let n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];c=(n<<16)/i|0,u=(o<<16)/s|0,t+=(this.spriteTranslateX[r]*i+n-1)/n|0,e+=(this.spriteTranslateY[r]*s+o-1)/o|0,this.spriteTranslateX[r]*i%n!=0&&(h=(n-this.spriteTranslateX[r]*i%n<<16)/i|0),this.spriteTranslateY[r]*s%o!=0&&(l=(o-this.spriteTranslateY[r]*s%o<<16)/s|0),i=i*(this.spriteWidth[r]-(h>>16))/n|0,s=s*(this.spriteHeight[r]-(l>>16))/o|0}let d=t+e*this.width2,m=this.width2-i;if(e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=0,d+=t*this.width2,l+=u*t}if(e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1),t<this.boundsTopX){let e=this.boundsTopX-t;i-=e,t=0,d+=e,h+=c*e,m+=e}if(t+i>=this.boundsBottomX){let e=t+i-this.boundsBottomX+1;i-=e,m+=e}let p=1;this.interlace&&(p=2,m+=this.width2,u+=u,0!=(1&e)&&(d+=this.width2,s--)),this._plotScale_from14(this.pixels,this.surfacePixels[r],0,h,l,d,m,i,s,c,u,o,p,n)}catch(Ui){console.error(Ui)}}_drawSprite_from10(t,e,i,s,r,n,o,a,h,l){let c=-(n>>2);n=-(3&n);for(let u=-o;u<0;u+=l){for(let n=c;n<0;n++)0!==(i=e[s++])?t[r++]=i:r++,0!==(i=e[s++])?t[r++]=i:r++,0!==(i=e[s++])?t[r++]=i:r++,0!==(i=e[s++])?t[r++]=i:r++;for(let o=n;o<0;o++)0!==(i=e[s++])?t[r++]=i:r++;r+=a,s+=h}}_drawSprite_from10A(t,e,i,s,r,n,o,a,h,l){let c=-(n>>2);n=-(3&n);for(let u=-o;u<0;u+=l){for(let n=c;n<0;n++){let n=e[s++];0!==n?t[r++]=i[255&n]:r++,0!==(n=e[s++])?t[r++]=i[255&n]:r++,0!==(n=e[s++])?t[r++]=i[255&n]:r++,0!==(n=e[s++])?t[r++]=i[255&n]:r++}for(let o=n;o<0;o++){let n=e[s++];0!==n?t[r++]=i[255&n]:r++}r+=a,s+=h}}_plotScale_from13(t,e,i,s,r,n,o,a,h,l,c,u,d){try{let m=s;for(let p=-h;p<0;p+=d){let h=(r>>16)*u;for(let r=-a;r<0;r++)0!==(i=e[(s>>16)+h])?t[n++]=i:n++,s+=l;r+=c,s=m,n+=o}}catch(Ui){console.error(Ui)}}_drawSpriteAlpha_from11(t,e,i,s,r,n,o,a,h,l,c){let u=256-c;for(let d=-o;d<0;d+=l){for(let o=-n;o<0;o++)if(0!==(i=e[s++])){let e=t[r];t[r++]=((16711935&i)*c+(16711935&e)*u&-16711936)+((65280&i)*c+(65280&e)*u&16711680)>>8}else r++;r+=a,s+=h}}_drawSpriteAlpha_from11A(t,e,i,s,r,n,o,a,h,l,c){let u=256-c;for(let d=-o;d<0;d+=l){for(let o=-n;o<0;o++){let n=e[s++];if(0!==n){n=i[255&n];let e=t[r];t[r++]=((16711935&n)*c+(16711935&e)*u&-16711936)+((65280&n)*c+(65280&e)*u&16711680)>>8}else r++}r+=a,s+=h}}transparentScale(t,e,i,s,r,n,o,a,h,l,c,u,d,m){let p=256-m;try{let f=s;for(let g=-h;g<0;g+=d){let h=(r>>16)*u;for(let r=-a;r<0;r++){if(0!==(i=e[(s>>16)+h])){let e=t[n];t[n++]=((16711935&i)*m+(16711935&e)*p&-16711936)+((65280&i)*m+(65280&e)*p&16711680)>>8}else n++;s+=l}r+=c,s=f,n+=o}}catch(Ui){console.error(Ui)}}_plotScale_from14(t,e,i,s,r,n,o,a,h,l,c,u,d,m){let p=m>>16&255,f=m>>8&255,g=255&m;try{let m=s;for(let w=-h;w<0;w+=d){let h=(r>>16)*u;for(let r=-a;r<0;r++){if(0!==(i=e[(s>>16)+h])){let e=i>>16&255,s=i>>8&255,r=255&i;t[n++]=e===s&&s===r?(e*p>>8<<16)+(s*f>>8<<8)+(r*g>>8):i}else n++;s+=l}r+=c,s=m,n+=o}}catch(Ui){console.error(Ui)}}drawMinimapSprite(t,e,i,s,r){let n=this.width2,o=this.height2;if(!this.sinCosCache){this.sinCosCache=new Int32Array(512);for(let t=0;t<256;t++)this.sinCosCache[t]=32768*Math.sin(.02454369*t)|0,this.sinCosCache[t+256]=32768*Math.cos(.02454369*t)|0}let a=-(this.spriteWidthFull[i]/2|0),h=-(this.spriteHeightFull[i]/2|0);this.spriteTranslate[i]&&(a+=this.spriteTranslateX[i],h+=this.spriteTranslateY[i]);let l=a+this.spriteWidth[i],c=h+this.spriteHeight[i],u=l,d=h,m=a,p=c;s&=255;let f=this.sinCosCache[s]*r,g=this.sinCosCache[s+256]*r,w=t+(h*f+a*g>>22),y=e+(h*g-a*f>>22),b=t+(d*f+u*g>>22),C=e+(d*g-u*f>>22),S=t+(c*f+l*g>>22),I=e+(c*g-l*f>>22),T=t+(p*f+m*g>>22),x=e+(p*g-m*f>>22);192===r&&(63&s)==(63&ji.anInt348)?ji.anInt346++:128===r?ji.anInt348=s:ji.anInt347++;let v=y,k=y;C<v?v=C:C>k&&(k=C),I<v?v=I:I>k&&(k=I),x<v?v=x:x>k&&(k=x),v<this.boundsTopY&&(v=this.boundsTopY),k>this.boundsBottomY&&(k=this.boundsBottomY),null!==this.anIntArray340&&this.anIntArray340.length===o+1||(this.anIntArray340=new Int32Array(o+1),this.anIntArray341=new Int32Array(o+1),this.anIntArray342=new Int32Array(o+1),this.anIntArray343=new Int32Array(o+1),this.anIntArray344=new Int32Array(o+1),this.anIntArray345=new Int32Array(o+1));for(let j=v;j<=k;j++)this.anIntArray340[j]=99999999,this.anIntArray341[j]=-99999999;let A=0,B=0,L=0,M=this.spriteWidth[i],E=this.spriteHeight[i];a=0,h=0,u=M-1,d=0,l=M-1,c=E-1,m=0,p=E-1,x!==y&&(A=(T-w<<8)/(x-y)|0,L=(p-h<<8)/(x-y)|0);let P=0,Y=0,X=0,D=0;y>x?(X=T<<8,D=p<<8,P=x,Y=y):(X=w<<8,D=h<<8,P=y,Y=x),P<0&&(X-=A*P,D-=L*P,P=0),Y>o-1&&(Y=o-1);for(let j=P;j<=Y;j++)this.anIntArray340[j]=this.anIntArray341[j]=X,X+=A,this.anIntArray342[j]=this.anIntArray343[j]=0,this.anIntArray344[j]=this.anIntArray345[j]=D,D+=L;C!==y&&(A=(b-w<<8)/(C-y)|0,B=(u-a<<8)/(C-y)|0);let _=0;y>C?(X=b<<8,_=u<<8,P=C,Y=y):(X=w<<8,_=a<<8,P=y,Y=C),P<0&&(X-=A*P,_-=B*P,P=0),Y>o-1&&(Y=o-1);for(let j=P;j<=Y;j++)X<this.anIntArray340[j]&&(this.anIntArray340[j]=X,this.anIntArray342[j]=_,this.anIntArray344[j]=0),X>this.anIntArray341[j]&&(this.anIntArray341[j]=X,this.anIntArray343[j]=_,this.anIntArray345[j]=0),X+=A,_+=B;I!==C&&(A=(S-b<<8)/(I-C)|0,L=(c-d<<8)/(I-C)|0),C>I?(X=S<<8,_=l<<8,D=c<<8,P=I,Y=C):(X=b<<8,_=u<<8,D=d<<8,P=C,Y=I),P<0&&(X-=A*P,D-=L*P,P=0),Y>o-1&&(Y=o-1);for(let j=P;j<=Y;j++)X<this.anIntArray340[j]&&(this.anIntArray340[j]=X,this.anIntArray342[j]=_,this.anIntArray344[j]=D),X>this.anIntArray341[j]&&(this.anIntArray341[j]=X,this.anIntArray343[j]=_,this.anIntArray345[j]=D),X+=A,D+=L;x!==I&&(A=(T-S<<8)/(x-I)|0,B=(m-l<<8)/(x-I)|0),I>x?(X=T<<8,_=m<<8,D=p<<8,P=x,Y=I):(X=S<<8,_=l<<8,D=c<<8,P=I,Y=x),P<0&&(X-=A*P,_-=B*P,P=0),Y>o-1&&(Y=o-1);for(let j=P;j<=Y;j++)X<this.anIntArray340[j]&&(this.anIntArray340[j]=X,this.anIntArray342[j]=_,this.anIntArray344[j]=D),X>this.anIntArray341[j]&&(this.anIntArray341[j]=X,this.anIntArray343[j]=_,this.anIntArray345[j]=D),X+=A,_+=B;let O=v*n,R=this.surfacePixels[i];for(let j=v;j<k;j++){let t=this.anIntArray340[j]>>8,e=this.anIntArray341[j]>>8;if(e-t<=0)O+=n;else{let s=this.anIntArray342[j]<<9,r=((this.anIntArray343[j]<<9)-s)/(e-t)|0,o=this.anIntArray344[j]<<9,a=((this.anIntArray345[j]<<9)-o)/(e-t)|0;t<this.boundsTopX&&(s+=(this.boundsTopX-t)*r,o+=(this.boundsTopX-t)*a,t=this.boundsTopX),e>this.boundsBottomX&&(e=this.boundsBottomX),this.interlace&&0!=(1&j)||(this.spriteTranslate[i]?this.drawMinimapTranslate(this.pixels,R,0,O+t,s,o,r,a,t-e,M):this.drawMinimap(this.pixels,R,0,O+t,s,o,r,a,t-e,M)),O+=n}}}drawMinimap(t,e,i,s,r,n,o,a,h,l){for(i=h;i<0;i++)this.pixels[s++]=e[(r>>17)+(n>>17)*l],r+=o,n+=a}drawMinimapTranslate(t,e,i,s,r,n,o,a,h,l){for(let c=h;c<0;c++)0!==(i=e[(r>>17)+(n>>17)*l])?this.pixels[s++]=i:s++,r+=o,n+=a}_spriteClipping_from9(t,e,i,s,r,n,o,a,h){try{0===n&&(n=16777215),0===o&&(o=16777215);const l=this.spriteWidth[r],c=this.spriteHeight[r];let u=0,d=0,m=a<<16,p=(l<<16)/i|0,f=(c<<16)/s|0,g=-((a<<16)/s|0);if(this.spriteTranslate[r]){const n=this.spriteWidthFull[r],o=this.spriteHeightFull[r];p=(n<<16)/i|0,f=(o<<16)/s|0;let a=this.spriteTranslateX[r],l=this.spriteTranslateY[r];h&&(a=n-this.spriteWidth[r]-a),t+=(a*i+n-1)/n|0;let c=(l*s+o-1)/o|0;e+=c,m+=c*g,a*i%n!=0&&(u=(n-a*i%n<<16)/i|0),l*s%o!=0&&(d=(o-l*s%o<<16)/s|0),i=((this.spriteWidth[r]<<16)-u+p-1)/p|0,s=((this.spriteHeight[r]<<16)-d+f-1)/f|0}let w=e*this.width2;if(m+=t<<16,e<this.boundsTopY){let t=this.boundsTopY-e;s-=t,e=this.boundsTopY,w+=t*this.width2,d+=f*t,m+=g*t}e+s>=this.boundsBottomY&&(s-=e+s-this.boundsBottomY+1);let y=w/this.width2&1;if(this.interlace||(y=2),16777215===o)return null!==this.surfacePixels[r]?h?void this._transparentSpritePlot_from15(this.pixels,this.surfacePixels[r],0,(this.spriteWidth[r]<<16)-u-1,d,w,i,s,-p,f,l,n,m,g,y):void this._transparentSpritePlot_from15(this.pixels,this.surfacePixels[r],0,u,d,w,i,s,p,f,l,n,m,g,y):h?void this._transparentSpritePlot_from16A(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,(this.spriteWidth[r]<<16)-u-1,d,w,i,s,-p,f,l,n,m,g,y):void this._transparentSpritePlot_from16A(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,u,d,w,i,s,p,f,l,n,m,g,y);if(null!==this.surfacePixels[r])return h?void this._transparentSpritePlot_from16(this.pixels,this.surfacePixels[r],0,(this.spriteWidth[r]<<16)-u-1,d,w,i,s,-p,f,l,n,o,m,g,y):void this._transparentSpritePlot_from16(this.pixels,this.surfacePixels[r],0,u,d,w,i,s,p,f,l,n,o,m,g,y);h?this._transparentSpritePlot_from17(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,(this.spriteWidth[r]<<16)-u-1,d,w,i,s,-p,f,l,n,o,m,g,y):this._transparentSpritePlot_from17(this.pixels,this.spriteColoursUsed[r],this.spriteColourList[r],0,u,d,w,i,s,p,f,l,n,o,m,g,y)}catch(Ui){console.error(Ui)}}_transparentSpritePlot_from15(t,e,i,s,r,n,o,a,h,l,c,u,d,m,p){let f=u>>16&255,g=u>>8&255,w=255&u;try{let u=s;for(let y=-a;y<0;y++){let a=(r>>16)*c,y=d>>16,b=o;if(y<this.boundsTopX){let t=this.boundsTopX-y;b-=t,y=this.boundsTopX,s+=h*t}if(y+b>=this.boundsBottomX&&(b-=y+b-this.boundsBottomX),0!=(p=1-p))for(let r=y;r<y+b;r++){if(0!==(i=e[(s>>16)+a])){let e=i>>16&255,s=i>>8&255,o=255&i;t[r+n]=e===s&&s===o?(e*f>>8<<16)+(s*g>>8<<8)+(o*w>>8):i}s+=h}r+=l,s=u,n+=this.width2,d+=m}}catch(Ui){console.error(Ui)}}_transparentSpritePlot_from16(t,e,i,s,r,n,o,a,h,l,c,u,d,m,p,f){let g=u>>16&255,w=u>>8&255,y=255&u,b=d>>16&255,C=d>>8&255,S=255&d;try{let u=s;for(let d=-a;d<0;d++){let a=(r>>16)*c,d=m>>16,I=o;if(d<this.boundsTopX){let t=this.boundsTopX-d;I-=t,d=this.boundsTopX,s+=h*t}if(d+I>=this.boundsBottomX&&(I-=d+I-this.boundsBottomX),0!=(f=1-f))for(let r=d;r<d+I;r++){if(0!==(i=e[(s>>16)+a])){let e=i>>16&255,s=i>>8&255,o=255&i;t[r+n]=e===s&&s===o?(e*g>>8<<16)+(s*w>>8<<8)+(o*y>>8):255===e&&s===o?(e*b>>8<<16)+(s*C>>8<<8)+(o*S>>8):i}s+=h}r+=l,s=u,n+=this.width2,m+=p}}catch(Ui){console.error(Ui)}}_transparentSpritePlot_from16A(t,e,i,s,r,n,o,a,h,l,c,u,d,m,p,f){let g=d>>16&255,w=d>>8&255,y=255&d;try{let d=r;for(let b=-h;b<0;b++){let h=(n>>16)*u,b=m>>16,C=a;if(b<this.boundsTopX){let t=this.boundsTopX-b;C-=t,b=this.boundsTopX,r+=l*t}if(b+C>=this.boundsBottomX&&(C-=b+C-this.boundsBottomX),0!=(f=1-f))for(let n=b;n<b+C;n++){if(0!=(s=255&e[(r>>16)+h])){let e=(s=i[s])>>16&255,r=s>>8&255,a=255&s;t[n+o]=e===r&&r===a?(e*g>>8<<16)+(r*w>>8<<8)+(a*y>>8):s}r+=l}n+=c,r=d,o+=this.width2,m+=p}}catch(Ui){console.error(Ui)}}_transparentSpritePlot_from17(t,e,i,s,r,n,o,a,h,l,c,u,d,m,p,f,g){let w=d>>16&255,y=d>>8&255,b=255&d,C=m>>16&255,S=m>>8&255,I=255&m;try{let d=r;for(let m=-h;m<0;m++){let h=(n>>16)*u,m=p>>16,T=a;if(m<this.boundsTopX){let t=this.boundsTopX-m;T-=t,m=this.boundsTopX,r+=l*t}if(m+T>=this.boundsBottomX&&(T-=m+T-this.boundsBottomX),0!=(g=1-g))for(let n=m;n<m+T;n++){if(0!=(s=255&e[(r>>16)+h])){let e=(s=i[s])>>16&255,r=s>>8&255,a=255&s;t[n+o]=e===r&&r===a?(e*w>>8<<16)+(r*y>>8<<8)+(a*b>>8):255===e&&r===a?(e*C>>8<<16)+(r*S>>8<<8)+(a*I>>8):s}r+=l}n+=c,r=d,o+=this.width2,p+=f}}catch(Ui){console.error(Ui)}}drawStringRight(t,e,i,s,r){this.drawString(t,e-this.textWidth(t,s),i,s,r)}drawStringCenter(t,e,i,s,r){this.drawString(t,e-(this.textWidth(t,s)/2|0),i,s,r)}drawParagraph(t,e,i,s,r,n){try{let o=0;const a=ji.gameFonts[s];let h=0,l=0;for(let c=0;c<t.length;c++)"@"===t[c]&&c+4<t.length&&"@"===t[c+4]||"~"===t[c]&&c+4<t.length&&"~"===t[c+4]?c+=4:o+=a[ji.characterWidth[t.charCodeAt(c)]+7]," "===t[c]&&(l=c),"%"===t[c]&&(l=c,o=1e3),o>n&&(l<=h&&(l=c),this.drawStringCenter(t.slice(h,l),e,i,s,r),o=0,h=c=l+1,i+=this.textHeight(s));o>0&&this.drawStringCenter(t.slice(h),e,i,s,r)}catch(Ui){console.error(Ui)}}drawString(t,e,i,s,r){try{const n=ji.gameFonts[s];for(let s=0;s<t.length;s++)if("@"===t[s]&&s+4<t.length&&"@"===t[s+4])"red"===t.slice(s+1,s+4).toLowerCase()?r=16711680:"lre"===t.slice(s+1,s+4).toLowerCase()?r=16748608:"yel"===t.slice(s+1,s+4).toLowerCase()?r=16776960:"gre"===t.slice(s+1,s+4).toLowerCase()?r=65280:"blu"===t.slice(s+1,s+4).toLowerCase()?r=255:"cya"===t.slice(s+1,s+4).toLowerCase()?r=65535:"mag"===t.slice(s+1,s+4).toLowerCase()?r=16711935:"whi"===t.slice(s+1,s+4).toLowerCase()?r=16777215:"bla"===t.slice(s+1,s+4).toLowerCase()?r=0:"dre"===t.slice(s+1,s+4).toLowerCase()?r=12582912:"ora"===t.slice(s+1,s+4).toLowerCase()?r=16748608:"ran"===t.slice(s+1,s+4).toLowerCase()?r=16777215*Math.random()|0:"or1"===t.slice(s+1,s+4).toLowerCase()?r=16756736:"or2"===t.slice(s+1,s+4).toLowerCase()?r=16740352:"or3"===t.slice(s+1,s+4).toLowerCase()?r=16723968:"gr1"===t.slice(s+1,s+4).toLowerCase()?r=12648192:"gr2"===t.slice(s+1,s+4).toLowerCase()?r=8453888:"gr3"===t.slice(s+1,s+4).toLowerCase()&&(r=4259584),s+=4;else if("~"===t[s]&&s+4<t.length&&"~"===t[s+4]){let i=t.charCodeAt(s+1),r=t.charCodeAt(s+2),n=t.charCodeAt(s+3);i>=Oi&&i<=Ri&&r>=Oi&&r<=Ri&&n>=Oi&&n<=Ri&&(e=0|Number(t.substring(s+1,s+4))),s+=4}else{const o=ji.characterWidth[t.charCodeAt(s)];this.loggedIn&&0!==r&&(this.drawCharacter(o,e+1,i,0,n),this.drawCharacter(o,e,i+1,0,n)),this.drawCharacter(o,e,i,r,n),e+=n[o+7]}}catch(Ui){console.error(Ui)}}drawCharacter(t,e,i,s,r){let n=e+r[t+5],o=i-r[t+6],a=r[t+3],h=r[t+4],l=16384*r[t]+128*r[t+1]+r[t+2],c=n+o*this.width2,u=this.width2-a,d=0;if(o<this.boundsTopY){let t=this.boundsTopY-o;h-=t,o=this.boundsTopY,l+=t*a,c+=t*this.width2}if(o+h>=this.boundsBottomY&&(h-=o+h-this.boundsBottomY+1),n<this.boundsTopX){let t=this.boundsTopX-n;a-=t,n=this.boundsTopX,l+=t,c+=t,d+=t,u+=t}if(n+a>=this.boundsBottomX){let t=n+a-this.boundsBottomX+1;a-=t,d+=t,u+=t}a>0&&h>0&&this.plotLetter(this.pixels,r,s,l,c,a,h,u,d)}plotLetter(t,e,i,s,r,n,o,a,h){try{let l=-(n>>2);n=-(3&n);for(let c=-o;c<0;c++){for(let n=l;n<0;n++)0!==e[s++]?t[r++]=i:r++,0!==e[s++]?t[r++]=i:r++,0!==e[s++]?t[r++]=i:r++,0!==e[s++]?t[r++]=i:r++;for(let o=n;o<0;o++)0!==e[s++]?t[r++]=i:r++;r+=a,s+=h}}catch(Ui){console.error(Ui)}}method259(t,e,i,s,r,n,o,a,h){for(let l=-o;l<0;l++){for(let o=-n;o<0;o++){let n=255&e[s++];if(n>30)if(n>=230)t[r++]=i;else{let e=t[r];t[r++]=((16711935&i)*n+(16711935&e)*(256-n)&4278255360)+((65280&i)*n+(65280&e)*(256-n)&16711680)>>8}else r++}r+=a,s+=h}}textHeight(t){return 0===t?12:1===t||2===t?14:3===t||4===t?15:5===t?19:6===t?24:7===t?29:this.textHeightFont(t)}textHeightFont(t){return 0===t?ji.gameFonts[t][8]-2:ji.gameFonts[t][8]-1}textWidth(t,e){let i=0;const s=ji.gameFonts[e];for(let r=0;r<t.length;r++)"@"===t[r]&&r+4<t.length&&"@"===t[r+4]||"~"===t[r]&&r+4<t.length&&"~"===t[r+4]?r+=4:i+=s[ji.characterWidth[t.charCodeAt(r)]+7];return i}drawTabs(t,e,i,s,r,n){const o=i/r.length|0;let a=0;for(let h=0;h<r.length;h+=1){const i=n===h?14474460:10526880;this.drawBoxAlpha(t+a,e,o,s,i,128),this.drawStringCenter(r[h],t+a+(o/2|0),e+16,4,0),h>0&&this.drawLineVert(t+a,e,s,0),a+=o}this.drawLineHoriz(t,e+s,i,0)}}ji.anInt346=0,ji.anInt347=0,ji.anInt348=0,ji.gameFonts=[],ji.gameFonts.length=50,ji.gameFonts.fill(null),ji.characterWidth=new Int32Array(256);for(let Dr=0;Dr<256;Dr++){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!\"\xa3$%^&*()-_=+[{]};:'@#~,<.>/?\\| ".indexOf(String.fromCharCode(Dr));-1===t&&(t=74),ji.characterWidth[Dr]=9*t}var Ui,Ni,Fi=ji,Hi={exports:{}};Ui=this,Ni=function(){"use strict";return function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e;return(e=[{key:"_checkHeader",value:function(){var t=this.header;if(0===t.imageType)throw Error("No data");if(t.hasColorMap){if(t.colorMapLength>256||24!==t.colorMapDepth||1!==t.colorMapType)throw Error("Invalid colormap for indexed type")}else if(t.colorMapType)throw Error("Why does the image contain a palette ?");if(!t.width||!t.height)throw Error("Invalid image size");if(8!==t.pixelDepth&&16!==t.pixelDepth&&24!==t.pixelDepth&&32!==t.pixelDepth)throw Error('Invalid pixel size "'+t.pixelDepth+'"')}},{key:"_decodeRLE",value:function(t,e,i,s){for(var r=new Uint8Array(s),n=new Uint8Array(i),o=0;o<s;){var a=t[e++],h=1+(127&a);if(128&a){for(var l=0;l<i;++l)n[l]=t[e+l];e+=i;for(var c=0;c<h;++c)r.set(n,o),o+=i}else{h*=i;for(var u=0;u<h;++u)r[o+u]=t[e+u];o+=h,e+=h}}return r}},{key:"_getImageData8bits",value:function(t,e,i,s,r,n,o,a,h,l){for(var c=0,u=r;u!==o;u+=n)for(var d=a;d!==l;d+=h,c++){var m=e[c];t[4*(d+s*u)+3]=255,t[4*(d+s*u)+2]=i[3*m+0],t[4*(d+s*u)+1]=i[3*m+1],t[4*(d+s*u)+0]=i[3*m+2]}return t}},{key:"_getImageData16bits",value:function(t,e,i,s,r,n,o,a,h,l){for(var c=0,u=r;u!==o;u+=n)for(var d=a;d!==l;d+=h,c+=2){var m=e[c+0]|e[c+1]<<8;t[4*(d+s*u)+0]=(31744&m)>>7,t[4*(d+s*u)+1]=(992&m)>>2,t[4*(d+s*u)+2]=(31&m)>>3,t[4*(d+s*u)+3]=32768&m?0:255}return t}},{key:"_getImageData24bits",value:function(t,e,i,s,r,n,o,a,h,l){for(var c=0,u=r;u!==o;u+=n)for(var d=a;d!==l;d+=h,c+=3)t[4*(d+s*u)+3]=255,t[4*(d+s*u)+2]=e[c+0],t[4*(d+s*u)+1]=e[c+1],t[4*(d+s*u)+0]=e[c+2];return t}},{key:"_getImageData32bits",value:function(t,e,i,s,r,n,o,a,h,l){for(var c=0,u=r;u!==o;u+=n)for(var d=a;d!==l;d+=h,c+=4)t[4*(d+s*u)+2]=e[c+0],t[4*(d+s*u)+1]=e[c+1],t[4*(d+s*u)+0]=e[c+2],t[4*(d+s*u)+3]=e[c+3];return t}},{key:"_getImageDataGrey8bits",value:function(t,e,i,s,r,n,o,a,h,l){for(var c=0,u=r;u!==o;u+=n)for(var d=a;d!==l;d+=h,c++){var m=e[c];t[4*(d+s*u)+0]=m,t[4*(d+s*u)+1]=m,t[4*(d+s*u)+2]=m,t[4*(d+s*u)+3]=255}return t}},{key:"_getImageDataGrey16bits",value:function(t,e,i,s,r,n,o,a,h,l){for(var c=0,u=r;u!==o;u+=n)for(var d=a;d!==l;d+=h,c+=2)t[4*(d+s*u)+0]=e[c+0],t[4*(d+s*u)+1]=e[c+0],t[4*(d+s*u)+2]=e[c+0],t[4*(d+s*u)+3]=e[c+1];return t}},{key:"open",value:function(t,e){var i=this,s=new XMLHttpRequest;s.responseType="arraybuffer",s.open("GET",t,!0),s.onload=function(){200===s.status&&(i.load(new Uint8Array(s.response)),e&&e())},s.send(null)}},{key:"load",value:function(t){var e=0;if(t.length<18)throw Error("Not enough data to contain header");var i={idLength:t[e++],colorMapType:t[e++],imageType:t[e++],colorMapIndex:t[e++]|t[e++]<<8,colorMapLength:t[e++]|t[e++]<<8,colorMapDepth:t[e++],offsetX:t[e++]|t[e++]<<8,offsetY:t[e++]|t[e++]<<8,width:t[e++]|t[e++]<<8,height:t[e++]|t[e++]<<8,pixelDepth:t[e++],flags:t[e++]};if(i.hasEncoding=9===i.imageType||10===i.imageType||11===i.imageType,i.hasColorMap=9===i.imageType||1===i.imageType,i.isGreyColor=11===i.imageType||3===i.imageType,this.header=i,this._checkHeader(),(e+=i.idLength)>=t.length)throw Error("No data");if(i.hasColorMap){var s=i.colorMapLength*(i.colorMapDepth>>3);this.palette=t.subarray(e,e+s),e+=s}var r=i.pixelDepth>>3,n=i.width*i.height,o=n*r;i.hasEncoding?this.imageData=this._decodeRLE(t,e,r,o):this.imageData=t.subarray(e,e+(i.hasColorMap?n:o))}},{key:"getImageData",value:function(t){var e,i,s,r,n,o,a,h=this.header,l=h.width,c=h.height,u=h.flags,d=h.pixelDepth,m=h.isGreyColor,p=(48&u)>>4;switch(t||(t=document?document.createElement("canvas").getContext("2d").createImageData(l,c):{width:l,height:c,data:new Uint8ClampedArray(l*c*4)}),2===p||3===p?(r=0,n=1,o=c):(r=c-1,n=-1,o=-1),2===p||0===p?(e=0,i=1,s=l):(e=l-1,i=-1,s=-1),d){case 8:a=m?this._getImageDataGrey8bits:this._getImageData8bits;break;case 16:a=m?this._getImageDataGrey16bits:this._getImageData16bits;break;case 24:a=this._getImageData24bits;break;case 32:a=this._getImageData32bits}return a.call(this,t.data,this.imageData,this.palette,l,r,n,o,e,i,s),t}},{key:"getCanvas",value:function(){var t=this.header,e=t.width,i=t.height,s=document.createElement("canvas"),r=s.getContext("2d"),n=r.createImageData(e,i);return s.width=e,s.height=i,r.putImageData(this.getImageData(n),0,0),s}},{key:"getDataURL",value:function(t){return this.getCanvas().toDataURL(t||"image/png")}}])&&function(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}(t.prototype,e),t}()},"object"==typeof Hi.exports?Hi.exports=Ni():"function"==typeof define&&define.amd?define(Ni):(Ui=Ui||self).TgaLoader=Ni(),Hi=Hi.exports;var Wi={BACKSPACE:8,ENTER:13,SPACE:32,CTRL:17,PAGE_UP:33,PAGE_DOWN:34,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,F1:112},Vi=204,Gi=85,Zi=24,zi=2,qi=1,$i=63,Ki=58,Qi=36,Ji=1,ts=17,es=setTimeout;function is(t,e){var i=e.useCachedSetTimeout?es:setTimeout;return new Promise((function(e){i(e,t)}))}var ss=function(t){var e=is(t,{useCachedSetTimeout:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).useCachedSetTimeout});function i(t){return e.then((function(){return t}))}return i.then=function(){return e.then.apply(e,arguments)},i.catch=Promise.resolve().catch,i};const rs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!\"\xa3$%^&*()-_=+[{]};:'@#~,<.>/?\\| ",ns=["h11p.jf","h12b.jf","h12p.jf","h13b.jf","h14b.jf","h16b.jf","h20b.jf","h24b.jf"],os={position:"absolute",display:"none",padding:0,border:0,outline:0,opacity:0,textAlign:"center",fontFamily:"sans",fontSize:"14px"};var as={};class hs{constructor(t){this.socket=t,this.closed=!1,this.closing=!1,this.delay=0,this.isaacIncoming=null,this.isaacOutgoing=null,this.length=0,this.maxReadTries=0,this.packet8Check=8,this.packetData=null,this.packetEnd=3,this.packetMaxLength=5e3,this.packetStart=0,this.readTries=0,this.socketException=!1,this.socketExceptionMessage=""}async readBytes(t,e){await this.readStreamBytes(t,0,e)}async readPacket(t){try{if(this.readTries++,this.maxReadTries>0&&this.readTries>this.maxReadTries)return this.socketException=!0,this.socketExceptionMessage="time-out",this.maxReadTries+=this.maxReadTries,0;if(0===this.length&&this.availableStream()>=2&&(this.length=await this.readStream(),this.length>=160&&(this.length=256*(this.length-160)+await this.readStream())),this.length>0&&this.availableStream()>=this.length){this.length>=160?await this.readBytes(this.length,t):(t[this.length-1]=255&await this.readStream(),this.length>1&&await this.readBytes(this.length-1,t));let e=this.length;return this.length=0,this.readTries=0,e}}catch(Ui){this.socketException=!0,this.socketExceptionMessage=Ui.message}return 0}hasPacket(){return this.packetStart>0}writePacket(t){if(this.socketException)throw this.packetetStart=0,this.packetetEnd=3,this.socketException=!1,Error(this.socketExceptionMessage);this.delay++,this.delay<t||(this.packetStart>0&&(this.delay=0,this.writeStreamBytes(this.packetData,0,this.packetStart)),this.packetStart=0,this.packetEnd=3)}sendPacket(){if(null!==this.isaacOutgoing){let t=255&this.packetData[this.packetStart+2];this.packetData[this.packetStart+2]=t+this.isaacOutgoing.getNextValue()&255}8!==this.packet8Check&&this.packetEnd++;const t=this.packetEnd-this.packetStart-2;if(t>=160?(this.packetData[this.packetStart]=160+(t/256|0)&255,this.packetData[this.packetStart+1]=255&t):(this.packetData[this.packetStart]=255&t,this.packetEnd--,this.packetData[this.packetStart+1]=this.packetData[this.packetEnd]),this.packetMaxLength<=1e4){let t=255&this.packetData[this.packetStart+2];hs.anIntArray537[t]++,hs.anIntArray541[t]+=this.packetEnd-this.packetStart}this.packetStart=this.packetEnd}putBytes(t,e,i){for(let s=0;s<i;s++)this.packetData[this.packetEnd++]=255&t[e+s]}putLong(t){this.putInt(t.shiftRight(32).toInt()),this.putInt(t.toInt())}newPacket(t){if(this.packetStart>(4*this.packetMaxLength/5|0))try{this.writePacket(0)}catch(Ui){this.socketException=!0,this.socketExceptionMessage=Ui.message}null===this.packetData&&(this.packetData=new Int8Array(this.packetMaxLength)),this.packetData[this.packetStart+2]=255&t,this.packetData[this.packetStart+3]=0,this.packetEnd=this.packetStart+3,this.packet8Check=8}async getLong(){let t=await this.getShort(),e=await this.getShort(),i=await this.getShort(),s=await this.getShort();return ht.fromInt(t).shiftLeft(48).add(ht.fromInt(e).shiftLeft(32)).add(i<<16).add(s)}putShort(t){this.packetData[this.packetEnd++]=t>>8&255,this.packetData[this.packetEnd++]=255&t}putInt(t){this.packetData[this.packetEnd++]=t>>24&255,this.packetData[this.packetEnd++]=t>>16&255,this.packetData[this.packetEnd++]=t>>8&255,this.packetData[this.packetEnd++]=255&t}async getShort(){return 256*await this.getByte()+await this.getByte()}putString(t){this.putBytes(function(t){const e=new Uint16Array(t.length);for(let i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e}(t),0,t.length)}putByte(t){this.packetData[this.packetEnd++]=255&t}isaacCommand(t){return t}async getByte(){return 255&await this.readStream()}flushPacket(){this.sendPacket(),this.writePacket(0)}closeStream(){this.closing=!0,this.socket.close(),this.closed=!0}async readStream(){return this.closing?0:await this.socket.read()}availableStream(){return this.closing?0:this.socket.available()}async readStreamBytes(t,e,i){this.closing||await this.socket.readBytes(i,e,t)}writeStreamBytes(t,e,i){this.closing||this.socket.write(t,e,i)}}hs.anIntArray537=new Int32Array(256),hs.anIntArray541=new Int32Array(256),as=hs;var ls={APPEARANCE:235,BANK_CLOSE:212,BANK_DEPOSIT:23,BANK_WITHDRAW:22,CAST_GROUND:158,CAST_GROUNDITEM:249,CAST_INVITEM:4,CAST_NPC:50,CAST_OBJECT:99,CAST_PLAYER:229,CAST_SELF:137,CAST_WALLOBJECT:180,CHAT:216,CHOOSE_OPTION:116,CLOSE_CONNECTION:31,COMBAT_STYLE:29,COMMAND:38,DUEL_ACCEPT:176,DUEL_CONFIRM_ACCEPT:77,DUEL_DECLINE:197,DUEL_ITEM_UPDATE:33,DUEL_SETTINGS:8,FRIEND_ADD:195,FRIEND_REMOVE:167,GROUNDITEM_TAKE:247,IGNORE_ADD:132,IGNORE_REMOVE:241,INV_CMD:90,INV_DROP:246,INV_UNEQUIP:170,INV_WEAR:169,KNOWN_PLAYERS:163,LOGIN:0,LOGOUT:102,NPC_ATTACK:190,NPC_CMD:202,NPC_TALK:153,OBJECT_CMD1:136,OBJECT_CMD2:79,PACKET_EXCEPTION:3,PING:67,PLAYER_ATTACK:171,PLAYER_DUEL:103,PLAYER_FOLLOW:165,PLAYER_TRADE:142,PM:218,PRAYER_OFF:254,PRAYER_ON:60,RECOVER_SET_REQUEST:203,REGISTER:2,REPORT_ABUSE:206,SESSION:32,SETTINGS_GAME:111,SETTINGS_PRIVACY:64,SHOP_BUY:236,SHOP_CLOSE:166,SHOP_SELL:221,SLEEP_WORD:45,TRADE_ACCEPT:55,TRADE_CONFIRM_ACCEPT:104,TRADE_DECLINE:230,TRADE_ITEM_UPDATE:46,USEWITH_GROUNDITEM:53,USEWITH_INVITEM:91,USEWITH_NPC:135,USEWITH_OBJECT:115,USEWITH_PLAYER:113,USEWITH_WALLOBJECT:161,WALK:187,WALK_ACTION:16,WALL_OBJECT_COMMAND1:14,WALL_OBJECT_COMMAND2:127},cs={};class us extends class{constructor(t){this._canvas=t,this._graphics=new class{constructor(t){this.canvas=t,this.ctx=t.getContext("2d",{alpha:!1})}setColor(t){this.ctx.fillStyle=t.toCanvasStyle(),this.ctx.strokeStyle=t.toCanvasStyle()}fillRect(t,e,i,s){this.ctx.fillRect(t,e,i,s)}drawRect(t,e,i,s){this.ctx.strokeRect(t,e,i,s)}setFont(t){this.ctx.font=t.toCanvasFont()}drawString(t,e,i){this.ctx.fillText(t,e,i)}measureTextWidth(t){return this.ctx.measureText(t).width}drawImage(t,e,i){this.ctx.putImageData(t,e,i)}getImage(t,e){return this.ctx.getImageData(0,0,t,e)}}(this._canvas),this.options={middleClickCamera:!1,mouseWheel:!1,resetCompass:!1,zoomCamera:!1,showRoofs:!0,remainingExperience:!1,totalExperience:!1,wordFilter:!0,accountManagement:!0,messageScrollBack:!0,retroFPSCounter:!0,retryLoginOnDisconnect:!0,mobile:!0},this.middleButtonDown=!1,this.mouseScrollDelta=0,this.mouseActionTimeout=0,this.loadingStep=0,this.logoHeaderText=null,this.mouseX=0,this.mouseY=0,this.mouseButtonDown=0,this.lastMouseButtonDown=0,this.timings=[],this.resetTimings(),this.stopTimeout=0,this.interlaceTimer=0,this.loadingProgressPercent=0,this.imageLogo=null,this.graphics=null,this.appletWidth=512,this.appletHeight=346,this.targetFPS=20,this.maxDrawTime=1e3,this.timings=[],this.loadingStep=1,this.hasRefererLogoNotUsed=!1,this.loadingProgessText="Loading",this.fontTimesRoman15=new ot("TimesRoman",0,15),this.fontHelvetica13b=new ot("Helvetica",ot.BOLD,13),this.fontHelvetica12=new ot("Helvetica",0,12),this.keyLeft=!1,this.keyRight=!1,this.keyUp=!1,this.keyDown=!1,this.keySpace=!1,this.keyHome=!1,this.keyPgUp=!1,this.keyPgDown=!1,this.ctrl=!1,this.threadSleep=1,this.interlace=!1,this.inputTextCurrent="",this.inputTextFinal="",this.inputPMCurrent="",this.inputPMFinal=""}async startApplication(t,e,i){window.document.title=i,this._canvas.tabIndex=0,this._canvas.width=t,this._canvas.height=e,console.log("Started application"),this.appletWidth=t,this.appletHeight=e,this._canvas.addEventListener("mousedown",this.mousePressed.bind(this)),this._canvas.addEventListener("mousemove",this.mouseMoved.bind(this)),this._canvas.addEventListener("mouseup",this.mouseReleased.bind(this)),this._canvas.addEventListener("mouseout",this.mouseOut.bind(this)),this._canvas.addEventListener("wheel",this.mouseWheel.bind(this)),this._canvas.addEventListener("contextmenu",t=>(t.preventDefault(),!1)),this._canvas.addEventListener("keydown",this.keyPressed.bind(this)),this._canvas.addEventListener("keyup",this.keyReleased.bind(this)),window.addEventListener("beforeunload",()=>this.onClosing()),this.options.mobile&&(this.toggleKeyboard=!1,this.mobileInput=document.createElement("input"),Object.assign(this.mobileInput.style,os),this.mobilePassword=document.createElement("input"),this.mobilePassword.type="password",Object.assign(this.mobilePassword.style,os),this.mobileInput.addEventListener("keydown",this.mobileKeyDown.bind(this)),this.mobilePassword.addEventListener("keydown",this.mobileKeyDown.bind(this)),this.mobileInput.addEventListener("blur",this.closeKeyboard.bind(this)),this.mobilePassword.addEventListener("blur",this.closeKeyboard.bind(this)),document.body.appendChild(this.mobileInput),document.body.appendChild(this.mobilePassword)),this.loadingStep=1,await this.run()}closeKeyboard(){clearInterval(this.keyboardUpdateInterval),this.mobileInputEl.style.display="none",this._canvas.focus()}openKeyboard(t="text",e,i,s=0,r=0,n=100,o=20){this.mobileInputCaret=-1,this.lastMobileInput=e,this.toggleKeyboard=!0,this.mobileInputEl="password"===t?this.mobilePassword:this.mobileInput,this.mobileInputEl.value=e,this.mobileInputEl.maxLength=i,this.mobileInputEl.style.display="block",this.mobileInputEl.style.top=r-Math.floor(o/2)+"px",this.mobileInputEl.style.left=s-Math.floor(n/2)+"px",this.mobileInputEl.style.width=n+"px",this.mobileInputEl.style.height=o+"px",this.keyboardUpdateInterval=setInterval(()=>{this.mobileKeyboardUpdate()},125)}mobileKeyDown(t){t.keyCode===Wi.ENTER&&(this.closeKeyboard(),this.keyPressed(t))}mobileKeyboardUpdate(){this.mobileInputCaret=this.mobileInputEl.selectionStart;const t=this.mobileInputEl.value;if(t!==this.lastMobileInput){for(let t=0;t<this.lastMobileInput.length;t+=1)this.keyPressed({keyCode:Wi.BACKSPACE});for(let e=0;e<t.length;e+=1)this.keyPressed({key:t[e]});this.lastMobileInput=t}}keyPressed(t){const e=t.keyCode;let i=t.key&&1===t.key.length?t.key.charCodeAt(0):65535;t.preventDefault&&t.preventDefault(),([8,10,13,9].includes(e)||this.options.messageScrollBack&&[Wi.UP_ARROW,Wi.DOWN_ARROW].includes(e)&&this.ctrl)&&(i=e),this.handleKeyPress(i),e===Wi.LEFT_ARROW?this.keyLeft=!0:e===Wi.RIGHT_ARROW?this.keyRight=!0:e===Wi.UP_ARROW?this.keyUp=!0:e===Wi.DOWN_ARROW?this.keyDown=!0:e===Wi.SPACE?this.keySpace=!0:e===Wi.F1?this.interlace=!this.interlace:e===Wi.HOME?this.keyHome=!0:e===Wi.PAGE_UP?this.keyPgUp=!0:e===Wi.PAGE_DOWN?this.keyPgDown=!0:e===Wi.CTRL&&(this.ctrl=!0);let s=!1;for(let r=0;r<rs.length;r++)if(rs.charCodeAt(r)===i){s=!0;break}s&&(this.inputTextCurrent.length<20&&(this.inputTextCurrent+=String.fromCharCode(i)),this.inputPMCurrent.length<80&&(this.inputPMCurrent+=String.fromCharCode(i))),e===Wi.ENTER?(this.inputTextFinal=this.inputTextCurrent,this.inputPMFinal=this.inputPMCurrent):e===Wi.BACKSPACE&&(this.inputTextCurrent.length>0&&(this.inputTextCurrent=this.inputTextCurrent.substring(0,this.inputTextCurrent.length-1)),this.inputPMCurrent.length>0&&(this.inputPMCurrent=this.inputPMCurrent.substring(0,this.inputPMCurrent.length-1))),this.options.mobile&&setTimeout(()=>{this.toggleKeyboard&&(this.toggleKeyboard=!1,this.mobileInputEl.focus())},125)}keyReleased(t){t.preventDefault();const e=t.keyCode;e===Wi.LEFT_ARROW?this.keyLeft=!1:e===Wi.RIGHT_ARROW?this.keyRight=!1:e===Wi.UP_ARROW?this.keyUp=!1:e===Wi.DOWN_ARROW?this.keyDown=!1:e===Wi.SPACE?this.keySpace=!1:e===Wi.HOME?this.keyHome=!1:e===Wi.PAGE_UP?this.keyPgUp=!1:e===Wi.PAGE_DOWN?this.keyPgDown=!1:e===Wi.CTRL&&(this.ctrl=!1)}mouseMoved(t){this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseActionTimeout=0}mouseReleased(t){this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseButtonDown=0,1===t.button&&(this.middleButtonDown=!1)}mouseOut(t){this.mouseX=t.offsetX,this.mouseY=t.offsetY,this.mouseButtonDown=0,this.middleButtonDown=!1}mousePressed(t){this.options.mobile&&setTimeout(()=>{this.toggleKeyboard&&(this.toggleKeyboard=!1,this.mobileInputEl.focus())},125);const e=t.offsetX,i=t.offsetY;if(this.mouseX=e,this.mouseY=i,this.options.middleClickCamera&&1===t.button)return this.middleButtonDown=!0,this.originRotation=this.cameraRotation,void(this.originMouseX=this.mouseX);t.metaKey||2===t.button?this.mouseButtonDown=2:this.mouseButtonDown=1,this.lastMouseButtonDown=this.mouseButtonDown,this.mouseActionTimeout=0,this.handleMouseDown(this.mouseButtonDown,e,i)}mouseWheel(t){if(this.options.mouseWheel)return t.preventDefault(),0===t.deltaMode?this.mouseScrollDelta=Math.floor(t.deltaY/14):1===t.deltaMode&&(this.mouseScrollDelta=Math.floor(t.deltaY)),!1}setTargetFps(t){this.targetFPS=1e3/t}resetTimings(){for(let t=0;t<10;t+=1)this.timings[t]=0}start(){this.stopTimeout>=0&&(this.stopTimeout=0)}stop(){this.stopTimeout>=0&&(this.stopTimeout=4e3/this.targetFPS)}async run(){1===this.loadingStep&&(this.loadingStep=2,this.graphics=this.getGraphics(),await this.loadJagex(),this.drawLoadingScreen(0,"Loading..."),await this.startGame(),this.loadingStep=0);let t=0,e=256,i=1,s=0;for(let r=0;r<10;r++)this.timings[r]=Date.now();for(;this.stopTimeout>=0;){if(this.stopTimeout>0&&(this.stopTimeout--,0===this.stopTimeout))return void this.onClosing();const r=e,n=i;e=300,i=1;const o=Date.now();if(0===this.timings[t]?(e=r,i=n):o>this.timings[t]&&(e=2560*this.targetFPS/(o-this.timings[t])|0),e<25&&(e=25),e>256&&(e=256,(i=this.targetFPS-(o-this.timings[t])/10|0)<this.threadSleep&&(i=this.threadSleep)),await ss(i),this.timings[t]=o,t=(t+1)%10,i>1)for(let t=0;t<10;t++)0!==this.timings[t]&&(this.timings[t]+=i);let a=0;for(;s<256;)if(await this.handleInputs(),s+=e,++a>this.maxDrawTime){s=0,this.interlaceTimer+=6,this.interlaceTimer>25&&(this.interlaceTimer=0,this.interlace=!0);break}this.interlaceTimer--,s&=255,this.draw(),this.fps=1e3*e/(256*this.targetFPS),this.mouseScrollDelta=0}}update(t){this.paint(t)}paint(){2===this.loadingStep&&this.imageLogo&&this.drawLoadingScreen(this.loadingProgressPercent,this.loadingProgessText)}async loadJagex(){this.graphics.setColor(rt.black),this.graphics.fillRect(0,0,this.appletWidth,this.appletHeight);const t=await this.readDataFile("jagex.jag","Jagex library",0);if(t){const e=Li.loadData("logo.tga",0,t);this.imageLogo=this.parseTGA(e)}const e=await this.readDataFile(`fonts${qi}.jag`,"Game fonts",5);if(t)for(let i=0;i<ns.length;i+=1){const t=ns[i];Fi.createFont(Li.loadData(t,0,e),i)}}drawLoadingScreen(t,e){let i=(this.appletWidth-281)/2|0,s=(this.appletHeight-148)/2|0;this.graphics.setColor(rt.black),this.graphics.fillRect(0,0,this.appletWidth,this.appletHeight),this.hasRefererLogoNotUsed||this.graphics.drawImage(this.imageLogo,i,s),i+=2,s+=90,this.loadingProgressPercent=t,this.loadingProgessText=e,this.graphics.setColor(new rt(132,132,132)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new rt(220,0,0)),this.graphics.drawRect(i-2,s-2,280,23),this.graphics.fillRect(i,s,277*t/100|0,20),this.graphics.setColor(new rt(198,198,198)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new rt(255,255,255)),this.drawString(this.graphics,e,this.fontTimesRoman15,i+138,s+10),this.hasRefererLogoNotUsed?(this.graphics.setColor(new rt(132,132,152)),this.drawString(this.graphics,"\xa92001-2002 Andrew Gower and Jagex Ltd",this.fontHelvetica12,i+138,this.appletHeight-20)):(this.drawString(this.graphics,"Created by JAGeX - visit www.jagex.com",this.fontHelvetica13b,i+138,s+30),this.drawString(this.graphics,"\xa92001-2002 Andrew Gower and Jagex Ltd",this.fontHelvetica13b,i+138,s+44)),null!==this.logoHeaderText&&(this.graphics.setColor(rt.white),this.drawString(this.graphics,this.logoHeaderText,this.fontHelvetica13b,i+138,s-120))}showLoadingProgress(t,e){const i=2+((this.appletWidth-281)/2|0),s=90+((this.appletHeight-148)/2|0);this.loadingProgressPercent=t,this.loadingProgessText=e,this.graphics.setColor(new rt(132,132,132)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new rt(220,0,0));const r=277*t/100|0;this.graphics.fillRect(i,s,r,20),this.graphics.setColor(rt.black),this.graphics.fillRect(i+r,s,277-r,20),this.graphics.setColor(new rt(198,198,198)),this.hasRefererLogoNotUsed&&this.graphics.setColor(new rt(255,255,255)),this.drawString(this.graphics,e,this.fontTimesRoman15,i+138,s+10)}drawString(t,e,i,s,r){t.setFont(i);const{width:n,height:o}=t.ctx.measureText(e);t.drawString(e,s-(n/2|0),r+(o/4|0))}parseTGA(t){const e=new Hi;e.load(new Uint8Array(t.buffer));const i=e.getCanvas();return i.getContext("2d").getImageData(0,0,i.width,i.height)}async readDataFile(t,e,i){t="./data204/"+t,this.showLoadingProgress(i,`Loading ${e} - 0%`);const s=Li.openFile(t),r=new Int8Array(6);await s.readFully(r,0,6);const n=((255&r[0])<<16)+((255&r[1])<<8)+(255&r[2]),o=((255&r[3])<<16)+((255&r[4])<<8)+(255&r[5]);this.showLoadingProgress(i,`Loading ${e} - 5%`);let a=0;const h=new Int8Array(o);for(;a<o;){let t=o-a;t>1e3&&(t=1e3),await s.readFully(h,a,t),a+=t,this.showLoadingProgress(i,`Loading ${e} - `+(5+95*a/o|0)+"%")}if(this.showLoadingProgress(i,"Unpacking "+e),o!==n){const t=new Int8Array(n);return vi.decompress(t,n,h,o,0),t}return h}getGraphics(){return this._graphics}async createSocket(t,e){const i=new class{constructor(t,e){this.host=t,this.port=e,this.client=null,this.connected=!1,this.bytesAvailable=0,this.buffers=[],this.currentBuffer=null,this.offset=0,this.bytesLeft=0}connect(){return new Promise((t,e)=>{this.client=new WebSocket(`ws://${this.host}:${this.port}`,"binary");const i=setTimeout(()=>{this.connected||(this.client.close(),e(new Error("websocket connect timeout")))},5e3);this.client.binaryType="arraybuffer",this.client.addEventListener("error",t=>{this.onError&&(this.onError(t),this.onError=void 0),e(t)}),this.client.addEventListener("close",()=>{this.onClose&&(this.onClose(-1),this.onClose=void 0),this.connected=!1,this.clear()}),this.client.addEventListener("message",t=>{this.buffers.push(new Int8Array(t.data)),this.bytesAvailable+=t.data.byteLength,this.refreshCurrentBuffer(),this.onNextMessage&&(this.onNextMessage(t.data.byteLength),this.onNextMessage=void 0)}),this.client.addEventListener("open",()=>{this.connected=!0,clearTimeout(i),t()})})}write(t,e=0,i=-1){if(!this.connected)throw new Error("attempting to write to closed socket");i=-1===i?t.length:i,this.client.send(t.slice(e,e+i))}refreshCurrentBuffer(){0===this.bytesLeft&&this.bytesAvailable>0&&(this.currentBuffer=this.buffers.shift(),this.offset=0,this.currentBuffer&&this.currentBuffer.length?this.bytesLeft=this.currentBuffer.length:this.bytesLeft=0)}async read(){return this.connected?this.bytesLeft>0?(this.bytesLeft--,this.bytesAvailable--,255&this.currentBuffer[this.offset++]):-1===await new Promise((t,e)=>{this.onClose=t,this.onError=e,this.onNextMessage=t})?-1:await this.read():-1}async readBytes(t,e=0,i=-1){if(!this.connected)return-1;if(i=-1===i?t.length:i,!(this.bytesAvailable>=i))return-1===await new Promise((t,e)=>{this.onClose=t,this.onError=e,this.onNextMessage=t})?-1:await this.readBytes(t,e,i);for(;i>0;)t[e++]=255&this.currentBuffer[this.offset++],this.bytesLeft-=1,this.bytesAvailable-=1,i-=1,0===this.bytesLeft&&this.refreshCurrentBuffer()}close(){this.connected&&this.client.close()}available(){return this.bytesAvailable}clear(){this.connected&&this.client.close(),this.currentBuffer=null,this.buffers.length=0,this.bytesLeft=0}}(t,e);return await i.connect(),i}}{constructor(t){super(t),this.friendListCount=0,this.ignoreListCount=0,this.settingsBlockChat=0,this.settingsBlockPrivate=0,this.settingsBlockTrade=0,this.settingsBlockDuel=0,this.sessionID=new ht(0),this.worldFullTimeout=0,this.moderatorLevel=0,this.autoLoginTImeout=0,this.packetLastRead=0,this.messageIndex=0,this.server="127.0.0.1",this.port=43594,this.username="",this.password="",this.incomingPacket=new Int8Array(5e3),this.friendListOnline=new Int32Array(200),this.friendListHashes=[];for(let e=0;e<200;e+=1)this.friendListHashes.push(new ht(0));this.ignoreList=[];for(let e=0;e<us.maxSocialListSize;e+=1)this.ignoreList.push(new ht(0));this.messageTokens=new Int32Array(us.maxSocialListSize)}async register(t,e){if(this.worldFullTimeout>0)return this.showLoginScreenStatus("Please wait...","Connecting to server"),await ss(2e3),void this.showLoginScreenStatus("Sorry! The server is currently full.","Please try again later");try{t=Li.formatAuthString(t,20),e=Li.formatAuthString(e,20),this.showLoginScreenStatus("Please wait...","Connecting to server"),this.packetStream=new as(await this.createSocket(this.server,this.port),this);const i=Li.usernameToHash(t);this.packetStream.newPacket(ls.SESSION),this.packetStream.putByte(i.shiftRight(16).and(31).toInt()),this.packetStream.flushPacket();const s=await this.packetStream.getLong();if(this.sessionID=s,s.equals(0))return void this.showLoginScreenStatus("Login server offline.","Please try again in a few mins");console.log("Verb: Session id: "+s),this.packetStream.newPacket(ls.REGISTER),this.packetStream.putShort(us.clientVersion),this.packetStream.putString(t),this.packetStream.putString(e),this.packetStream.flushPacket();const r=await this.packetStream.readStream();switch(this.packetStream.closeStream(),console.log("Newplayer response: "+r),r){case 2:return void this.resetLoginVars();case 13:case 3:return void this.showLoginScreenStatus("Username already taken.","Please choose another username");case 4:return void this.showLoginScreenStatus("That username is already in use.","Wait 60 seconds then retry");case 5:return void this.showLoginScreenStatus("The client has been updated.","Please reload this page");case 6:return void this.showLoginScreenStatus("You may only use 1 character at once.","Your ip-address is already in use");case 7:return void this.showLoginScreenStatus("Login attempts exceeded!","Please try again in 5 minutes");case 11:return void this.showLoginScreenStatus("Account has been temporarily disabled","for cheating or abuse");case 12:return void this.showLoginScreenStatus("Account has been permanently disabled","for cheating or abuse");case 14:return this.showLoginScreenStatus("Sorry! The server is currently full.","Please try again later"),void(this.worldFullTimeout=1500);case 15:return void this.showLoginScreenStatus("You need a members account","to login to this server");case 16:return void this.showLoginScreenStatus("Please login to a members server","to access member-only features");default:return void this.showLoginScreenStatus("Error unable to create username.","Unrecognised response code")}}catch(Ui){console.error(Ui),this.showLoginScreenStatus("Error unable to create user.","Unrecognised response code")}}async login(t,e,i){if(this.worldFullTimeout>0)return this.showLoginScreenStatus("Please wait...","Connecting to server"),await ss(2e3),void this.showLoginScreenStatus("Sorry! The server is currently full.","Please try again later");try{if(this.username=t,t=Li.formatAuthString(t,20),this.password=e,e=Li.formatAuthString(e,20),0===t.trim().length)return void this.showLoginScreenStatus("You must enter both a username","and a password - Please try again");i?this.drawTextBox("Connection lost! Please wait...","Attempting to re-establish"):this.showLoginScreenStatus("Please wait...","Connecting to server"),this.packetStream=new as(await this.createSocket(this.server,this.port),this),this.packetStream.maxReadTries=us.maxReadTries,this.packetStream.newPacket(ls.SESSION);const s=Li.usernameToHash(t);this.packetStream.putByte(s.shiftRight(16).and(31).toInt()),this.packetStream.flushPacket();const r=await this.packetStream.getLong();if(this.sessionID=r,r.equals(0))return void this.showLoginScreenStatus("Login server offline.","Please try again in a few mins");console.log("Verb: Session id: "+r);const n=new Int32Array(4);n[0]=99999999*Math.random()|0,n[1]=99999999*Math.random()|0,n[2]=r.shiftRight(32).toInt(),n[3]=r.toInt(),this.packetStream.newPacket(ls.LOGIN),this.packetStream.putByte(+i),this.packetStream.putShort(us.clientVersion),this.packetStream.putByte(0),this.packetStream.putByte(10),this.packetStream.putInt(n[0]),this.packetStream.putInt(n[1]),this.packetStream.putInt(n[2]),this.packetStream.putInt(n[3]),this.packetStream.putInt(0),this.packetStream.putString(t),this.packetStream.putString(e),this.packetStream.flushPacket();const o=await this.packetStream.readStream();if(console.log("login response:"+o),25===o)return this.moderatorLevel=1,this.autoLoginTimeout=0,void this.resetGame();if(0===o)return this.moderatorLevel=0,this.autoLoginTimeout=0,void this.resetGame();if(1===o)return void(this.autoLoginTimeout=0);if(i)return t="",e="",void this.resetLoginVars();switch(o){case-1:return void this.showLoginScreenStatus("Error unable to login.","Server timed out");case 3:return void this.showLoginScreenStatus("Invalid username or password.","Try again, or create a new account");case 4:return void this.showLoginScreenStatus("That username is already logged in.","Wait 60 seconds then retry");case 5:return void this.showLoginScreenStatus("The client has been updated.","Please reload this page");case 6:return void this.showLoginScreenStatus("You may only use 1 character at once.","Your ip-address is already in use");case 7:return void this.showLoginScreenStatus("Login attempts exceeded!","Please try again in 5 minutes");case 8:return void this.showLoginScreenStatus("Error unable to login.","Server rejected session");case 9:return void this.showLoginScreenStatus("Error unable to login.","Loginserver rejected session");case 10:return void this.showLoginScreenStatus("That username is already in use.","Wait 60 seconds then retry");case 11:return void this.showLoginScreenStatus("Account temporarily disabled.","Check your message inbox for details");case 12:return void this.showLoginScreenStatus("Account permanently disabled.","Check your message inbox for details");case 14:return this.showLoginScreenStatus("Sorry! This world is currently full.","Please try a different world"),void(this.worldFullTimeout=1500);case 15:return void this.showLoginScreenStatus("You need a members account","to login to this world");case 16:return void this.showLoginScreenStatus("Error - no reply from loginserver.","Please try again");case 17:return void this.showLoginScreenStatus("Error - failed to decode profile.","Contact customer support");case 18:return void this.showLoginScreenStatus("Account suspected stolen.","Press 'recover a locked account' on front page.");case 20:return void this.showLoginScreenStatus("Error - loginserver mismatch","Please try a different world");case 21:return void this.showLoginScreenStatus("Unable to login.","That is not an RS-Classic account");case 22:return void this.showLoginScreenStatus("Password suspected stolen.","Press 'change your password' on front page.");default:return void this.showLoginScreenStatus("Error unable to login.","Unrecognised response code")}}catch(Ui){console.error(Ui)}this.autoLoginTimeout>0&&(await ss(5e3),this.autoLoginTimeout--,await this.login(this.username,this.password,i)),i?(this.username="",this.password="",this.resetLoginVars()):this.showLoginScreenStatus("Sorry! Unable to connect.","Check internet settings or try another world")}async recoverAttempt(t){this.showLoginScreenStatus("Please wait...","Connecting to server");try{this.packetStream=new as(await this.createSocket(this.server,this.port),this),this.packetStream.maxReadTries=this.maxReadTries,this.packetStream.newPacket(),this.packetStream.putLong(Li.usernameToHash(t)),this.packetStream.flushPacket();const i=await this.packetStream.readStream();if(console.log("Getpq response: "+i),0===i)return void this.showLoginScreenStatus("Sorry, the recovery questions for this user have not been set","");for(let t=0;t<5;t++){const i=await this.packetStream.readStream();if(i<0)throw new Error("invalid recovery question length");const s=new Int8Array(i);await this.packetStream.readBytes(i,s);const r=(e=s.slice(0,i),Array.from(e).map(t=>String.fromCharCode(t)).join(""));this.panelRecoverUser.updateText(this.controlRecoverQuestions[t],r)}if(this.recentRecoverFail)return void this.showLoginScreenStatus("Sorry, you have already attempted 1 recovery, try again later","");this.loginScreen=3,this.panelRecoverUser.updateText(this.controlRecoverInfo1,"@yel@To prove this is your account please provide the answers to"),this.panelRecoverUser.updateText(this.controlRecoverInfo2,"@yel@your security questions. You will then be able to reset your password");for(let t=0;t<5;t++)this.panelRecoverUser.updateText(this.controlRecoverAnswers[t],"");this.panelRecoverUser.updateText(this.controlRecoverOldPassword,""),this.panelRecoverUser.updateText(this.controlRecoverNewPassword,""),this.panelRecoverUser.updateText(this.controlRecoverConfirmPassword,"")}catch(Ui){return console.error(Ui),void this.showLoginScreenStatus("Sorry! Unable to connect.","Check leternet settings or try another world")}var e}closeConnection(){if(null!==this.packetStream)try{this.packetStream.newPacket(ls.CLOSE_CONNECTION),this.packetStream.flushPacket()}catch(Ui){console.error(Ui)}this.username="",this.password="",this.resetLoginVars()}async lostConnection(){try{throw new Error("")}catch(Ui){console.error(Ui)}this.options.retryLoginOnDisconnect&&(this.autoLoginTimeout=10),await this.login(this.username,this.password,!0)}drawTextBox(t,e){const i=this.getGraphics(),s=new ot("Helvetica",1,15);i.setColor(rt.black),i.fillRect(116,147,280,50),i.setColor(rt.white),i.drawRect(116,147,280,50),this.drawString(i,t,s,256,162),this.drawString(i,e,s,256,182)}async checkConnection(){const t=Date.now();this.packetStream.hasPacket()&&(this.packetLastRead=t),t-this.packetLastRead>5e3&&(this.packetLastRead=t,this.packetStream.newPacket(ls.PING),this.packetStream.sendPacket());try{this.packetStream.writePacket(20)}catch(Ui){return void await this.lostConnection()}const e=await this.packetStream.readPacket(this.incomingPacket);if(e>0){const t=this.packetStream.isaacCommand(255&this.incomingPacket[0]);console.log("opcode:"+t+" psize:"+e),this.handleIncomingPacket(t,e,this.incomingPacket)}}sortFriendsList(){let t=!0;for(;t;){t=!1;for(let e=0;e<this.friendListCount-1;e++)if(255!==this.friendListOnline[e]&&255===this.friendListOnline[e+1]||0===this.friendListOnline[e]&&0!==this.friendListOnline[e+1]){const i=this.friendListOnline[e];this.friendListOnline[e]=this.friendListOnline[e+1],this.friendListOnline[e+1]=i;const s=this.friendListHashes[e];this.friendListHashes[e]=this.friendListHashes[e+1],this.friendListHashes[e+1]=s,t=!0}}}sendPrivacySettings(t,e,i,s){this.packetStream.newPacket(ls.SETTINGS_PRIVACY),this.packetStream.putByte(t),this.packetStream.putByte(e),this.packetStream.putByte(i),this.packetStream.putByte(s),this.packetStream.sendPacket()}ignoreAdd(t){const e=Li.usernameToHash(t);this.packetStream.newPacket(ls.IGNORE_ADD),this.packetStream.putLong(e),this.packetStream.sendPacket();for(let i=0;i<this.ignoreListCount;i++)if(this.ignoreList[i].equals(e))return;return this.ignoreListCount>=us.maxSocialListSize?void 0:void(this.ignoreList[this.ignoreListCount++]=e)}ignoreRemove(t){this.packetStream.newPacket(ls.IGNORE_REMOVE),this.packetStream.putLong(t),this.packetStream.sendPacket();for(let e=0;e<this.ignoreListCount;e++)if(this.ignoreList[e].equals(t)){this.ignoreListCount--;for(let t=e;t<this.ignoreListCount;t++)this.ignoreList[t]=this.ignoreList[t+1];return}}friendAdd(t){this.packetStream.newPacket(ls.FRIEND_ADD),this.packetStream.putLong(Li.usernameToHash(t)),this.packetStream.sendPacket();const e=Li.usernameToHash(t);for(let i=0;i<this.friendListCount;i++)if(this.friendListHashes[i].equals(e))return;return this.friendListCount>=us.maxSocialListSize?void 0:(this.friendListHashes[this.friendListCount]=e,this.friendListOnline[this.friendListCount]=0,void this.friendListCount++)}friendRemove(t){this.packetStream.newPacket(ls.FRIEND_REMOVE),this.packetStream.putLong(t),this.packetStream.sendPacket();for(let e=0;e<this.friendListCount;e++)if(this.friendListHashes[e].equals(t)){this.friendListCount--;for(let t=e;t<this.friendListCount;t++)this.friendListHashes[t]=this.friendListHashes[t+1],this.friendListOnline[t]=this.friendListOnline[t+1];break}this.showServerMessage(`@pri@${Li.hashToUsername(t)} has been removed from your friends list`)}sendPrivateMessage(t,e,i){this.packetStream.newPacket(ls.PM),this.packetStream.putLong(t),this.packetStream.putBytes(e,0,i),this.packetStream.sendPacket()}sendChatMessage(t,e){this.packetStream.newPacket(ls.CHAT),this.packetStream.putBytes(t,0,e),this.packetStream.sendPacket()}sendCommandString(t){this.packetStream.newPacket(ls.COMMAND),this.packetStream.putString(t),this.packetStream.sendPacket()}}us.clientVersion=1,us.maxReadTries=0,us.maxSocialListSize=100,cs=us;function ds(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var ms="undefined"!=typeof Float64Array;function ps(t,e){return t[0]-e[0]}function fs(){var t,e=this.stride,i=new Array(e.length);for(t=0;t<i.length;++t)i[t]=[Math.abs(e[t]),t];i.sort(ps);var s=new Array(i.length);for(t=0;t<s.length;++t)s[t]=i[t][1];return s}function gs(t,e){var i=["View",e,"d",t].join("");e<0&&(i="View_Nil"+t);var s="generic"===t;if(-1===e){var r="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(r)()}if(0===e)return r="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(s?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(s?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}",new Function("TrivialArray",r)(ws[t][0]);r=["'use strict'"];var n=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=i;return e}(e),o=n.map((function(t){return"i"+t})),a="this.offset+"+n.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),h=n.map((function(t){return"b"+t})).join(","),l=n.map((function(t){return"c"+t})).join(",");r.push("function "+i+"(a,"+h+","+l+",d){this.data=a","this.shape=["+h+"]","this.stride=["+l+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),r.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+n.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===e?r.push("proto.order=[0]"):(r.push("Object.defineProperty(proto,'order',{get:"),e<4?(r.push("function "+i+"_order(){"),2===e?r.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&r.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):r.push("ORDER})")),r.push("proto.set=function "+i+"_set("+o.join(",")+",v){"),s?r.push("return this.data.set("+a+",v)}"):r.push("return this.data["+a+"]=v}"),r.push("proto.get=function "+i+"_get("+o.join(",")+"){"),s?r.push("return this.data.get("+a+")}"):r.push("return this.data["+a+"]}"),r.push("proto.index=function "+i+"_index(",o.join(),"){return "+a+"}"),r.push("proto.hi=function "+i+"_hi("+o.join(",")+"){return new "+i+"(this.data,"+n.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+n.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var c=n.map((function(t){return"a"+t+"=this.shape["+t+"]"})),u=n.map((function(t){return"c"+t+"=this.stride["+t+"]"}));r.push("proto.lo=function "+i+"_lo("+o.join(",")+"){var b=this.offset,d=0,"+c.join(",")+","+u.join(","));for(var d=0;d<e;++d)r.push("if(typeof i"+d+"==='number'&&i"+d+">=0){d=i"+d+"|0;b+=c"+d+"*d;a"+d+"-=d}");for(r.push("return new "+i+"(this.data,"+n.map((function(t){return"a"+t})).join(",")+","+n.map((function(t){return"c"+t})).join(",")+",b)}"),r.push("proto.step=function "+i+"_step("+o.join(",")+"){var "+n.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+n.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil"),d=0;d<e;++d)r.push("if(typeof i"+d+"==='number'){d=i"+d+"|0;if(d<0){c+=b"+d+"*(a"+d+"-1);a"+d+"=ceil(-a"+d+"/d)}else{a"+d+"=ceil(a"+d+"/d)}b"+d+"*=d}");r.push("return new "+i+"(this.data,"+n.map((function(t){return"a"+t})).join(",")+","+n.map((function(t){return"b"+t})).join(",")+",c)}");var m=new Array(e),p=new Array(e);for(d=0;d<e;++d)m[d]="a[i"+d+"]",p[d]="b[i"+d+"]";for(r.push("proto.transpose=function "+i+"_transpose("+o+"){"+o.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+m.join(",")+","+p.join(",")+",this.offset)}"),r.push("proto.pick=function "+i+"_pick("+o+"){var a=[],b=[],c=this.offset"),d=0;d<e;++d)r.push("if(typeof i"+d+"==='number'&&i"+d+">=0){c=(c+this.stride["+d+"]*i"+d+")|0}else{a.push(this.shape["+d+"]);b.push(this.stride["+d+"])}");return r.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),r.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+n.map((function(t){return"shape["+t+"]"})).join(",")+","+n.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",r.join("\n"))(ws[t],fs)}var ws={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]},ys=function(t,e,i,s){if(void 0===t)return(0,ws.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var r=e.length;if(void 0===i){i=new Array(r);for(var n=r-1,o=1;n>=0;--n)i[n]=o,o*=e[n]}if(void 0===s)for(s=0,n=0;n<r;++n)i[n]<0&&(s-=(e[n]-1)*i[n]);for(var a=function(t){if(null!=(e=t)&&(ds(e)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&ds(t.slice(0,0))}(e)||e._isBuffer))return"buffer";var e;if(ms)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),h=ws[a];h.length<=r+1;)h.push(gs(a,h.length-1));return(0,h[r+1])(t,e,i,s)},bs={};class Cs{static getModelIndex(t){if(/^na$/i.test(t))return 0;for(let e=0;e<Cs.modelCount;e++)if(Cs.modelName[e].toLowerCase()===t.toLowerCase())return e;return Cs.modelName[Cs.modelCount++]=t,Cs.modelCount-1}static getUnsignedByte(){let t=255&Cs.dataInteger[Cs.offset];return Cs.offset++,t}static getUnsignedShort(){let t=Li.getUnsignedShort(Cs.dataInteger,Cs.offset);return Cs.offset+=2,t}static getUnsignedInt(){let t=Li.getUnsignedInt(Cs.dataInteger,Cs.offset);return Cs.offset+=4,t>99999999&&(t=99999999-t),t}static getString(){let t="";for(t="";0!==Cs.dataString[Cs.stringOffset];t+=String.fromCharCode(Cs.dataString[Cs.stringOffset++]));return Cs.stringOffset++,t}static loadData(t,e){Cs.dataString=Li.loadData("string.dat",0,t),Cs.stringOffset=0,Cs.dataInteger=Li.loadData("integer.dat",0,t),Cs.offset=0;let i=0;for(Cs.itemCount=Cs.getUnsignedShort(),Cs.itemName=[],Cs.itemDescription=[],Cs.itemCommand=[],Cs.itemPicture=new Int32Array(Cs.itemCount),Cs.itemBasePrice=new Int32Array(Cs.itemCount),Cs.itemStackable=new Int32Array(Cs.itemCount),Cs.itemUnused=new Int32Array(Cs.itemCount),Cs.itemWearable=new Int32Array(Cs.itemCount),Cs.itemMask=new Int32Array(Cs.itemCount),Cs.itemSpecial=new Int32Array(Cs.itemCount),Cs.itemMembers=new Int32Array(Cs.itemCount),i=0;i<Cs.itemCount;i++)Cs.itemName.push(Cs.getString());for(i=0;i<Cs.itemCount;i++)Cs.itemDescription.push(Cs.getString());for(i=0;i<Cs.itemCount;i++)Cs.itemCommand.push(Cs.getString());for(i=0;i<Cs.itemCount;i++)Cs.itemPicture[i]=Cs.getUnsignedShort(),Cs.itemPicture[i]+1>Cs.itemSpriteCount&&(Cs.itemSpriteCount=Cs.itemPicture[i]+1);for(i=0;i<Cs.itemCount;i++)Cs.itemBasePrice[i]=Cs.getUnsignedInt();for(i=0;i<Cs.itemCount;i++)Cs.itemStackable[i]=Cs.getUnsignedByte();for(i=0;i<Cs.itemCount;i++)Cs.itemUnused[i]=Cs.getUnsignedByte();for(i=0;i<Cs.itemCount;i++)Cs.itemWearable[i]=Cs.getUnsignedShort();for(i=0;i<Cs.itemCount;i++)Cs.itemMask[i]=Cs.getUnsignedInt();for(i=0;i<Cs.itemCount;i++)Cs.itemSpecial[i]=Cs.getUnsignedByte();for(i=0;i<Cs.itemCount;i++)Cs.itemMembers[i]=Cs.getUnsignedByte();for(i=0;i<Cs.itemCount;i++)e||1!==Cs.itemMembers[i]||(Cs.itemName[i]="Members object",Cs.itemDescription[i]="You need to be a member to use this object",Cs.itemBasePrice[i]=0,Cs.itemCommand[i]="",Cs.itemUnused[0]=0,Cs.itemWearable[i]=0,Cs.itemSpecial[i]=1);for(Cs.npcCount=Cs.getUnsignedShort(),Cs.npcName=[],Cs.npcDescription=[],Cs.npcCommand=[],Cs.npcAttack=new Int32Array(Cs.npcCount),Cs.npcStrength=new Int32Array(Cs.npcCount),Cs.npcHits=new Int32Array(Cs.npcCount),Cs.npcDefense=new Int32Array(Cs.npcCount),Cs.npcAttackable=new Int32Array(Cs.npcCount),Cs.npcSprite=ys(new Int32Array(12*Cs.npcCount),[Cs.npcCount,12]),Cs.npcColourHair=new Int32Array(Cs.npcCount),Cs.npcColourTop=new Int32Array(Cs.npcCount),Cs.npcColorBottom=new Int32Array(Cs.npcCount),Cs.npcColourSkin=new Int32Array(Cs.npcCount),Cs.npcWidth=new Int32Array(Cs.npcCount),Cs.npcHeight=new Int32Array(Cs.npcCount),Cs.npcWalkModel=new Int32Array(Cs.npcCount),Cs.npcCombatModel=new Int32Array(Cs.npcCount),Cs.npcCombatAnimation=new Int32Array(Cs.npcCount),i=0;i<Cs.npcCount;i++)Cs.npcName.push(Cs.getString());for(i=0;i<Cs.npcCount;i++)Cs.npcDescription.push(Cs.getString());for(i=0;i<Cs.npcCount;i++)Cs.npcAttack[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)Cs.npcStrength[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)Cs.npcHits[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)Cs.npcDefense[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)Cs.npcAttackable[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)for(let t=0;t<12;t++)Cs.npcSprite.set(i,t,Cs.getUnsignedByte()),255===Cs.npcSprite.get(i,t)&&Cs.npcSprite.set(i,t,-1);for(i=0;i<Cs.npcCount;i++)Cs.npcColourHair[i]=Cs.getUnsignedInt();for(i=0;i<Cs.npcCount;i++)Cs.npcColourTop[i]=Cs.getUnsignedInt();for(i=0;i<Cs.npcCount;i++)Cs.npcColorBottom[i]=Cs.getUnsignedInt();for(i=0;i<Cs.npcCount;i++)Cs.npcColourSkin[i]=Cs.getUnsignedInt();for(i=0;i<Cs.npcCount;i++)Cs.npcWidth[i]=Cs.getUnsignedShort();for(i=0;i<Cs.npcCount;i++)Cs.npcHeight[i]=Cs.getUnsignedShort();for(i=0;i<Cs.npcCount;i++)Cs.npcWalkModel[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)Cs.npcCombatModel[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)Cs.npcCombatAnimation[i]=Cs.getUnsignedByte();for(i=0;i<Cs.npcCount;i++)Cs.npcCommand[i]=Cs.getString();for(Cs.textureCount=Cs.getUnsignedShort(),Cs.textureName=[],Cs.textureSubtypeName=[],i=0;i<Cs.textureCount;i++)Cs.textureName.push(Cs.getString());for(i=0;i<Cs.textureCount;i++)Cs.textureSubtypeName.push(Cs.getString());for(Cs.animationCount=Cs.getUnsignedShort(),Cs.animationName=[],Cs.animationCharacterColour=new Int32Array(Cs.animationCount),Cs.animationGender=new Int32Array(Cs.animationCount),Cs.animationHasA=new Int32Array(Cs.animationCount),Cs.animationHasF=new Int32Array(Cs.animationCount),Cs.animationNumber=new Int32Array(Cs.animationCount),i=0;i<Cs.animationCount;i++)Cs.animationName.push(Cs.getString());for(i=0;i<Cs.animationCount;i++)Cs.animationCharacterColour[i]=Cs.getUnsignedInt();for(i=0;i<Cs.animationCount;i++)Cs.animationGender[i]=Cs.getUnsignedByte();for(i=0;i<Cs.animationCount;i++)Cs.animationHasA[i]=Cs.getUnsignedByte();for(i=0;i<Cs.animationCount;i++)Cs.animationHasF[i]=Cs.getUnsignedByte();for(i=0;i<Cs.animationCount;i++)Cs.animationNumber[i]=Cs.getUnsignedByte();for(Cs.objectCount=Cs.getUnsignedShort(),Cs.objectName=[],Cs.objectDescription=[],Cs.objectCommand1=[],Cs.objectCommand2=[],Cs.objectModelIndex=new Int32Array(Cs.objectCount),Cs.objectWidth=new Int32Array(Cs.objectCount),Cs.objectHeight=new Int32Array(Cs.objectCount),Cs.objectType=new Int32Array(Cs.objectCount),Cs.objectElevation=new Int32Array(Cs.objectCount),i=0;i<Cs.objectCount;i++)Cs.objectName.push(Cs.getString());for(i=0;i<Cs.objectCount;i++)Cs.objectDescription.push(Cs.getString());for(i=0;i<Cs.objectCount;i++)Cs.objectCommand1.push(Cs.getString());for(i=0;i<Cs.objectCount;i++)Cs.objectCommand2.push(Cs.getString());for(i=0;i<Cs.objectCount;i++)Cs.objectModelIndex[i]=Cs.getModelIndex(Cs.getString());for(i=0;i<Cs.objectCount;i++)Cs.objectWidth[i]=Cs.getUnsignedByte();for(i=0;i<Cs.objectCount;i++)Cs.objectHeight[i]=Cs.getUnsignedByte();for(i=0;i<Cs.objectCount;i++)Cs.objectType[i]=Cs.getUnsignedByte();for(i=0;i<Cs.objectCount;i++)Cs.objectElevation[i]=Cs.getUnsignedByte();for(Cs.wallObjectCount=Cs.getUnsignedShort(),Cs.wallObjectName=[],Cs.wallObjectDescription=[],Cs.wallObjectCommand1=[],Cs.wallObjectCommand2=[],Cs.wallObjectHeight=new Int32Array(Cs.wallObjectCount),Cs.wallObjectTextureFront=new Int32Array(Cs.wallObjectCount),Cs.wallObjectTextureBack=new Int32Array(Cs.wallObjectCount),Cs.wallObjectAdjacent=new Int32Array(Cs.wallObjectCount),Cs.wallObjectInvisible=new Int32Array(Cs.wallObjectCount),i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectName.push(Cs.getString());for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectDescription.push(Cs.getString());for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectCommand1.push(Cs.getString());for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectCommand2.push(Cs.getString());for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectHeight[i]=Cs.getUnsignedShort();for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectTextureFront[i]=Cs.getUnsignedInt();for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectTextureBack[i]=Cs.getUnsignedInt();for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectAdjacent[i]=Cs.getUnsignedByte();for(i=0;i<Cs.wallObjectCount;i++)Cs.wallObjectInvisible[i]=Cs.getUnsignedByte();for(Cs.roofCount=Cs.getUnsignedShort(),Cs.roofHeight=new Int32Array(Cs.roofCount),Cs.roofNumVertices=new Int32Array(Cs.roofCount),i=0;i<Cs.roofCount;i++)Cs.roofHeight[i]=Cs.getUnsignedByte();for(i=0;i<Cs.roofCount;i++)Cs.roofNumVertices[i]=Cs.getUnsignedByte();for(Cs.tileCount=Cs.getUnsignedShort(),Cs.tileDecoration=new Int32Array(Cs.tileCount),Cs.tileType=new Int32Array(Cs.tileCount),Cs.tileAdjacent=new Int32Array(Cs.tileCount),i=0;i<Cs.tileCount;i++)Cs.tileDecoration[i]=Cs.getUnsignedInt();for(i=0;i<Cs.tileCount;i++)Cs.tileType[i]=Cs.getUnsignedByte();for(i=0;i<Cs.tileCount;i++)Cs.tileAdjacent[i]=Cs.getUnsignedByte();for(Cs.projectileSprite=Cs.getUnsignedShort(),Cs.spellCount=Cs.getUnsignedShort(),Cs.spellName=[],Cs.spellDescription=[],Cs.spellLevel=new Int32Array(Cs.spellCount),Cs.spellRunesRequired=new Int32Array(Cs.spellCount),Cs.spellType=new Int32Array(Cs.spellCount),Cs.spellRunesId=[],Cs.spellRunesCount=[],i=0;i<Cs.spellCount;i++)Cs.spellName.push(Cs.getString());for(i=0;i<Cs.spellCount;i++)Cs.spellDescription.push(Cs.getString());for(i=0;i<Cs.spellCount;i++)Cs.spellLevel[i]=Cs.getUnsignedByte();for(i=0;i<Cs.spellCount;i++)Cs.spellRunesRequired[i]=Cs.getUnsignedByte();for(i=0;i<Cs.spellCount;i++)Cs.spellType[i]=Cs.getUnsignedByte();for(i=0;i<Cs.spellCount;i++){const t=Cs.getUnsignedByte();Cs.spellRunesId.push(new Int32Array(t));for(let e=0;e<t;e++)Cs.spellRunesId[i][e]=Cs.getUnsignedShort()}for(i=0;i<Cs.spellCount;i++){let t=Cs.getUnsignedByte();Cs.spellRunesCount.push(new Int32Array(t));for(let e=0;e<t;e++)Cs.spellRunesCount[i][e]=Cs.getUnsignedByte()}for(Cs.prayerCount=Cs.getUnsignedShort(),Cs.prayerName=[],Cs.prayerDescription=[],Cs.prayerLevel=new Int32Array(Cs.prayerCount),Cs.prayerDrain=new Int32Array(Cs.prayerCount),i=0;i<Cs.prayerCount;i++)Cs.prayerName.push(Cs.getString());for(i=0;i<Cs.prayerCount;i++)Cs.prayerDescription.push(Cs.getString());for(i=0;i<Cs.prayerCount;i++)Cs.prayerLevel[i]=Cs.getUnsignedByte();for(i=0;i<Cs.prayerCount;i++)Cs.prayerDrain[i]=Cs.getUnsignedByte();Cs.dataString=null,Cs.dataInteger=null}}Cs.modelName=[],Cs.modelName.length=5e3,Cs.modelName.fill(null),Cs.spellCount=0,Cs.itemCount=0,Cs.itemSpriteCount=0,Cs.tileCount=0,Cs.wallObjectCount=0,Cs.modelCount=0,Cs.prayerCount=0,Cs.projectileSprite=0,Cs.npcCount=0,Cs.textureCount=0,Cs.roofCount=0,Cs.objectCount=0,Cs.animationCount=0,Cs.stringOffset=0,Cs.offset=0,bs=Cs;var Ss=class{constructor(){this.minPlaneX=0,this.minPlaneY=0,this.maxPlaneX=0,this.maxPlaneY=0,this.minZ=0,this.maxZ=0,this.model=null,this.face=0,this.depth=0,this.normalX=0,this.normalY=0,this.normalZ=0,this.visibility=0,this.facefill=0,this.skipSomething=!1,this.index=0,this.index2=0}},Is=class{constructor(){this.startX=0,this.endX=0,this.startS=0,this.endS=0}},Ts={};class xs{constructor(t,e,i,s){this.lastVisiblePolygonsCount=0,this.anIntArray377=null,this.textureCount=0,this.textureColoursUsed=null,this.textureColourList=null,this.textureDimension=null,this.textureLoadedNumber=null,this.texturePixels=null,this.textureBackTransparent=null,this.textureColours64=null,this.textureColours128=null,this.scanlines=null,this.minY=0,this.maxY=0,this.interlace=!1,this.mouseX=0,this.mouseY=0,this.mousePickedCount=0,this.newStart=0,this.newEnd=0,this.cameraX=0,this.cameraY=0,this.cameraZ=0,this.cameraYaw=0,this.cameraPitch=0,this.cameraRoll=0,this.rampCount=50,this.gradientBase=new Int32Array(this.rampCount),this.gradientRamps=[];for(let r=0;r<this.rampCount;r+=1)this.gradientRamps.push(new Int32Array(256));this.clipNear=5,this.clipFar3d=1e3,this.clipFar2d=1e3,this.fogZFalloff=20,this.fogZDistance=10,this.wideBand=!1,this.mousePickingActive=!1,this.mousePickedMax=100,this.mousePickedModels=[],this.mousePickedModels.length=this.mousePickedMax,this.mousePickedModels.fill(null),this.mousePickedFaces=new Int32Array(this.mousePickedMax),this.width=512,this.clipX=256,this.clipY=192,this.baseX=256,this.baseY=256,this.viewDistance=8,this.normalMagnitude=4,this.planeX=new Int32Array(40),this.planeY=new Int32Array(40),this.vertexShade=new Int32Array(40),this.vertexX=new Int32Array(40),this.vertexY=new Int32Array(40),this.vertexZ=new Int32Array(40),this.interlace=!1,this.surface=t,this.clipX=t.width2/2|0,this.clipY=t.height2/2|0,this.raster=t.pixels,this.modelCount=0,this.maxModelCount=e,this.models=[],this.models.length=this.maxModelCount,this.models.fill(null),this.visiblePolygonsCount=0,this.visiblePolygons=[];for(let r=0;r<i;r++)this.visiblePolygons.push(new Ss);this.spriteCount=0,this.spriteId=new Int32Array(s),this.spriteWidth=new Int32Array(s),this.spriteHeight=new Int32Array(s),this.spriteX=new Int32Array(s),this.spriteZ=new Int32Array(s),this.spriteY=new Int32Array(s),this.spriteTranslateX=new Int32Array(s),null===this.aByteArray434&&(this.aByteArray434=new Int8Array(17691)),this.cameraX=0,this.cameraY=0,this.cameraZ=0,this.cameraYaw=0,this.cameraPitch=0,this.cameraRoll=0;for(let r=0;r<256;r++)xs.sin512Cache[r]=32768*Math.sin(.02454369*r)|0,xs.sin512Cache[r+256]=32768*Math.cos(.02454369*r)|0;for(let r=0;r<1024;r++)xs.sinCosCache[r]=32768*Math.sin(.00613592315*r)|0,xs.sinCosCache[r+1024]=32768*Math.cos(.00613592315*r)|0}static textureScanline(t,e,i,s,r,n,o,a,h,l,c,u,d,m){if(c<=0)return;let p=0,f=0,g=0;0!==o&&(i=r/o<<7,s=n/o<<7),i<0?i=0:i>16256&&(i=16256),r+=a,n+=h,0!==(o+=l)&&(p=r/o<<7,f=n/o<<7),p<0?p=0:p>16256&&(p=16256);let w=p-i>>4,y=f-s>>4;for(let b=c>>4;b>0;b--)i+=6291456&d,g=d>>23,d+=m,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,s+=y,i=(16383&(i+=w))+(6291456&d),g=d>>23,d+=m,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,s+=y,i=(16383&(i+=w))+(6291456&d),g=d>>23,d+=m,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,s+=y,i=(16383&(i+=w))+(6291456&d),g=d>>23,d+=m,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y,t[u++]=e[(16256&s)+(i>>7)]>>>g,i=p,s=f,r+=a,n+=h,0!==(o+=l)&&(p=r/o<<7,f=n/o<<7),p<0?p=0:p>16256&&(p=16256),w=p-i>>4,y=f-s>>4;for(let b=0;b<(15&c);b++)0==(3&b)&&(i=(16383&i)+(6291456&d),g=d>>23,d+=m),t[u++]=e[(16256&s)+(i>>7)]>>>g,i+=w,s+=y}static textureTranslucentScanline(t,e,i,s,r,n,o,a,h,l,c,u,d,m){if(c<=0)return;let p=0,f=0,g=0;0!==o&&(i=r/o<<7,s=n/o<<7),i<0?i=0:i>16256&&(i=16256),r+=a,n+=h,0!==(o+=l)&&(p=r/o<<7,f=n/o<<7),p<0?p=0:p>16256&&(p=16256);let w=p-i>>4,y=f-s>>4;for(let b=c>>4;b>0;b--)i+=6291456&d,g=d>>23,d+=m,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),s+=y,i=(16383&(i+=w))+(6291456&d),g=d>>23,d+=m,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),s+=y,i=(16383&(i+=w))+(6291456&d),g=d>>23,d+=m,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),s+=y,i=(16383&(i+=w))+(6291456&d),g=d>>23,d+=m,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y,t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i=p,s=f,r+=a,n+=h,0!==(o+=l)&&(p=r/o<<7,f=n/o<<7),p<0?p=0:p>16256&&(p=16256),w=p-i>>4,y=f-s>>4;for(let b=0;b<(15&c);b++)0==(3&b)&&(i=(16383&i)+(6291456&d),g=d>>23,d+=m),t[u++]=(e[(16256&s)+(i>>7)]>>>g)+(t[u]>>1&8355711),i+=w,s+=y}static textureBackTranslucentScanline(t,e,i,s,r,n,o,a,h,l,c,u,d,m,p){if(u<=0)return;let f=0,g=0;p<<=2,0!==a&&(f=n/a<<7,g=o/a<<7),f<0?f=0:f>16256&&(f=16256);for(let w=u;w>0;w-=16){n+=h,o+=l,i=f,s=g,0!==(a+=c)&&(f=n/a<<7,g=o/a<<7),f<0?f=0:f>16256&&(f=16256);let u=f-i>>4,y=g-s>>4,b=m>>23;if(i+=6291456&m,m+=p,w<16)for(let n=0;n<w;n++)0!=(e=r[(16256&s)+(i>>7)]>>>b)&&(t[d]=e),d++,i+=u,s+=y,3==(3&n)&&(i=(16383&i)+(6291456&m),b=m>>23,m+=p);else 0!=(e=r[(16256&s)+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,i=(16383&(i+=u))+(6291456&m),b=m>>23,m+=p,0!=(e=r[(16256&(s+=y))+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,i=(16383&(i+=u))+(6291456&m),b=m>>23,m+=p,0!=(e=r[(16256&(s+=y))+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,i=(16383&(i+=u))+(6291456&m),b=m>>23,m+=p,0!=(e=r[(16256&(s+=y))+(i>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++,0!=(e=r[(16256&(s+=y))+((i+=u)>>7)]>>>b)&&(t[d]=e),d++}}static textureScanline2(t,e,i,s,r,n,o,a,h,l,c,u,d,m){if(c<=0)return;let p=0,f=0;m<<=2,0!==o&&(p=r/o<<6,f=n/o<<6),p<0?p=0:p>4032&&(p=4032);for(let g=c;g>0;g-=16){r+=a,n+=h,i=p,s=f,0!==(o+=l)&&(p=r/o<<6,f=n/o<<6),p<0?p=0:p>4032&&(p=4032);let c=p-i>>4,w=f-s>>4,y=d>>20;if(i+=786432&d,d+=m,g<16)for(let r=0;r<g;r++)t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,3==(3&r)&&(i=(4095&i)+(786432&d),y=d>>20,d+=m);else t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,s+=w,i=(4095&(i+=c))+(786432&d),y=d>>20,d+=m,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,s+=w,i=(4095&(i+=c))+(786432&d),y=d>>20,d+=m,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,s+=w,i=(4095&(i+=c))+(786432&d),y=d>>20,d+=m,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y,i+=c,s+=w,t[u++]=e[(4032&s)+(i>>6)]>>>y}}static textureTranslucentScanline2(t,e,i,s,r,n,o,a,h,l,c,u,d,m){if(c<=0)return;let p=0,f=0;m<<=2,0!==o&&(p=r/o<<6,f=n/o<<6),p<0?p=0:p>4032&&(p=4032);for(let g=c;g>0;g-=16){r+=a,n+=h,i=p,s=f,0!==(o+=l)&&(p=r/o<<6,f=n/o<<6),p<0?p=0:p>4032&&(p=4032);let c=p-i>>4,w=f-s>>4,y=d>>20;if(i+=786432&d,d+=m,g<16)for(let r=0;r<g;r++)t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,3==(3&r)&&(i=(4095&i)+(786432&d),y=d>>20,d+=m);else t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),s+=w,i=(4095&(i+=c))+(786432&d),y=d>>20,d+=m,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),s+=w,i=(4095&(i+=c))+(786432&d),y=d>>20,d+=m,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),s+=w,i=(4095&(i+=c))+(786432&d),y=d>>20,d+=m,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711),i+=c,s+=w,t[u++]=(e[(4032&s)+(i>>6)]>>>y)+(t[u]>>1&8355711)}}static textureBackTranslucentScanline2(t,e,i,s,r,n,o,a,h,l,c,u,d,m,p){if(u<=0)return;let f=0,g=0;p<<=2,0!==a&&(f=n/a<<6,g=o/a<<6),f<0?f=0:f>4032&&(f=4032);for(let w=u;w>0;w-=16){n+=h,o+=l,i=f,s=g,0!==(a+=c)&&(f=n/a<<6,g=o/a<<6),f<0?f=0:f>4032&&(f=4032);let u=f-i>>4,y=g-s>>4,b=m>>20;if(i+=786432&m,m+=p,w<16)for(let n=0;n<w;n++)0!=(e=r[(4032&s)+(i>>6)]>>>b)&&(t[d]=e),d++,i+=u,s+=y,3==(3&n)&&(i=(4095&i)+(786432&m),b=m>>20,m+=p);else 0!=(e=r[(4032&s)+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,i=(4095&(i+=u))+(786432&m),b=m>>20,m+=p,0!=(e=r[(4032&(s+=y))+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,i=(4095&(i+=u))+(786432&m),b=m>>20,m+=p,0!=(e=r[(4032&(s+=y))+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,i=(4095&(i+=u))+(786432&m),b=m>>20,m+=p,0!=(e=r[(4032&(s+=y))+(i>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++,0!=(e=r[(4032&(s+=y))+((i+=u)>>6)]>>>b)&&(t[d]=e),d++}}static gradientScanline(t,e,i,s,r,n,o){if(e>=0)return;o<<=1,s=r[n>>8&255],n+=o;let a=e/8|0;for(let h=a;h<0;h++)t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o;a=-e%8;for(let h=0;h<a;h++)t[i++]=s,1==(1&h)&&(s=r[n>>8&255],n+=o)}static textureGradientScanline(t,e,i,s,r,n,o){if(e>=0)return;o<<=2,s=r[n>>8&255],n+=o;let a=e/16|0;for(let h=a;h<0;h++)t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o,t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o,t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o,t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),t[i++]=s+(t[i]>>1&8355711),s=r[n>>8&255],n+=o;a=-e%16;for(let h=0;h<a;h++)t[i++]=s+(t[i]>>1&8355711),3==(3&h)&&(s=r[n>>8&255],n+=o,n+=o)}static gradientScanline2(t,e,i,s,r,n,o){if(e>=0)return;o<<=2,s=r[n>>8&255],n+=o;let a=e/16|0;for(let h=a;h<0;h++)t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o,t[i++]=s,t[i++]=s,t[i++]=s,t[i++]=s,s=r[n>>8&255],n+=o;a=-e%16;for(let h=0;h<a;h++)t[i++]=s,3==(3&h)&&(s=r[n>>8&255],n+=o)}static rgb(t,e,i){return-1-1024*(t/8|0)-32*(e/8|0)-(i/8|0)}addModel(t){null===t&&console.log("Warning tried to add null object!"),this.modelCount<this.maxModelCount&&(this.models[this.modelCount++]=t)}removeModel(t){for(let e=0;e<this.modelCount;e++)if(this.models[e]===t){this.modelCount--;for(let t=e;t<this.modelCount;t++)this.models[t]=this.models[t+1]}}dispose(){this.clear();for(let t=0;t<this.modelCount;t++)this.models[t]=null;this.modelCount=0}clear(){this.spriteCount=0,this.view.clear()}reduceSprites(t){this.spriteCount-=t,this.view.reduce(t,2*t),this.spriteCount<0&&(this.spriteCount=0)}addSprite(t,e,i,s,r,n,o){this.spriteId[this.spriteCount]=t,this.spriteX[this.spriteCount]=e,this.spriteZ[this.spriteCount]=i,this.spriteY[this.spriteCount]=s,this.spriteWidth[this.spriteCount]=r,this.spriteHeight[this.spriteCount]=n,this.spriteTranslateX[this.spriteCount]=0;const a=this.view.createVertex(e,i,s),h=this.view.createVertex(e,i-n,s),l=new Int32Array([a,h]);return this.view.createFace(2,l,0,0),this.view.faceTag[this.spriteCount]=o,this.view.isLocalPlayer[this.spriteCount++]=0,this.spriteCount-1}setLocalPlayer(t){this.view.isLocalPlayer[t]=1}setSpriteTranslateX(t,e){this.spriteTranslateX[t]=e}setMouseLoc(t,e){this.mouseX=t-this.baseX,this.mouseY=e,this.mousePickedCount=0,this.mousePickingActive=!0}getMousePickedCount(){return this.mousePickedCount}getMousePickedFaces(){return this.mousePickedFaces}getMousePickedModels(){return this.mousePickedModels}setBounds(t,e,i,s,r,n){this.clipX=i,this.clipY=s,this.baseX=t,this.baseY=e,this.width=r,this.viewDistance=n,this.scanlines=[];for(let o=0;o<s+e;o++)this.scanlines.push(new Is)}polygonsQSort(t,e,i){if(e<i){let s=e-1,r=i+1,n=(e+i)/2|0,o=t[n];t[n]=t[e],t[e]=o;let a=o.depth;for(;s<r;){do{r--}while(t[r].depth<a);do{s++}while(t[s].depth>a);if(s<r){let e=t[s];t[s]=t[r],t[r]=e}}this.polygonsQSort(t,e,r),this.polygonsQSort(t,r+1,i)}}polygonsIntersectSort(t,e,i){for(let r=0;r<=i;r++)e[r].skipSomething=!1,e[r].index=r,e[r].index2=-1;let s=0;for(;;){for(;e[s].skipSomething;)s++;if(s===i)return;let r=e[s];r.skipSomething=!0;let n=s,o=s+t;o>=i&&(o=i-1);for(let t=o;t>=n+1;t--){let i=e[t];r.minPlaneX<i.maxPlaneX&&i.minPlaneX<r.maxPlaneX&&r.minPlaneY<i.maxPlaneY&&i.minPlaneY<r.maxPlaneY&&r.index!==i.index2&&!this.separatePolygon(r,i)&&this.heuristicPolygon(i,r)&&(this.polygonsOrder(e,n,t),e[t]!==i&&t++,n=this.newStart,i.index2=r.index)}}}polygonsOrder(t,e,i){for(;;){let s=t[e];for(let n=e+1;n<=i;n++){let r=t[n];if(!this.separatePolygon(r,s))break;if(t[e]=r,t[n]=s,(e=n)===i)return this.newStart=e,this.newEnd=e-1,!0}let r=t[i];for(let n=i-1;n>=e;n--){let s=t[n];if(!this.separatePolygon(r,s))break;if(t[i]=s,t[n]=r,e===(i=n))return this.newStart=i+1,this.newEnd=i,!0}if(e+1>=i)return this.newStart=e,this.newEnd=i,!1;if(!this.polygonsOrder(t,e+1,i))return this.newStart=e,!1;i=this.newEnd}}setFrustum(t,e,i){let s=1024-this.cameraYaw&1023,r=1024-this.cameraPitch&1023,n=1024-this.cameraRoll&1023;if(0!==n){let i=xs.sinCosCache[n],s=xs.sinCosCache[n+1024],r=e*i+t*s>>15;e=e*s-t*i>>15,t=r}if(0!==s){let t=xs.sinCosCache[s],r=xs.sinCosCache[s+1024],n=e*r-i*t>>15;i=e*t+i*r>>15,e=n}if(0!==r){let e=xs.sinCosCache[r],s=xs.sinCosCache[r+1024],n=i*e+t*s>>15;i=i*s-t*e>>15,t=n}t<xs.frustumMaxX&&(xs.frustumMaxX=t),t>xs.frustumMinX&&(xs.frustumMinX=t),e<xs.frustumMaxY&&(xs.frustumMaxY=e),e>xs.frustumMinY&&(xs.frustumMinY=e),i<xs.frustumFarZ&&(xs.frustumFarZ=i),i>xs.frustumNearZ&&(xs.frustumNearZ=i)}render(){this.interlace=this.surface.interlace;let t=this.clipX*this.clipFar3d>>this.viewDistance,e=this.clipY*this.clipFar3d>>this.viewDistance;xs.frustumMaxX=0,xs.frustumMinX=0,xs.frustumMaxY=0,xs.frustumMinY=0,xs.frustumFarZ=0,xs.frustumNearZ=0,this.setFrustum(-t,-e,this.clipFar3d),this.setFrustum(-t,e,this.clipFar3d),this.setFrustum(t,-e,this.clipFar3d),this.setFrustum(t,e,this.clipFar3d),this.setFrustum(-this.clipX,-this.clipY,0),this.setFrustum(-this.clipX,this.clipY,0),this.setFrustum(this.clipX,-this.clipY,0),this.setFrustum(this.clipX,this.clipY,0),xs.frustumMaxX+=this.cameraX,xs.frustumMinX+=this.cameraX,xs.frustumMaxY+=this.cameraY,xs.frustumMinY+=this.cameraY,xs.frustumFarZ+=this.cameraZ,xs.frustumNearZ+=this.cameraZ,this.models[this.modelCount]=this.view,this.view.transformState=2;for(let s=0;s<this.modelCount;s++)this.models[s].project(this.cameraX,this.cameraY,this.cameraZ,this.cameraYaw,this.cameraPitch,this.cameraRoll,this.viewDistance,this.clipNear);this.models[this.modelCount].project(this.cameraX,this.cameraY,this.cameraZ,this.cameraYaw,this.cameraPitch,this.cameraRoll,this.viewDistance,this.clipNear),this.visiblePolygonsCount=0;for(let s=0;s<this.modelCount;s++){let t=this.models[s];if(t.visible)for(let e=0;e<t.numFaces;e++){let i=t.faceNumVertices[e],s=t.faceVertices[e],r=!1;for(let e=0;e<i;e++){let i=t.projectVertexZ[s[e]];if(!(i<=this.clipNear||i>=this.clipFar3d)){r=!0;break}}if(r){let r=0;for(let e=0;e<i;e++){let i=t.vertexViewX[s[e]];if(i>-this.clipX&&(r|=1),i<this.clipX&&(r|=2),3===r)break}if(3===r){let r=0;for(let e=0;e<i;e++){let i=t.vertexViewY[s[e]];if(i>-this.clipY&&(r|=1),i<this.clipY&&(r|=2),3===r)break}if(3===r){let r=this.visiblePolygons[this.visiblePolygonsCount];r.model=t,r.face=e,this.initialisePolygon3D(this.visiblePolygonsCount);let n=0;if(12345678!==(n=r.visibility<0?t.faceFillFront[e]:t.faceFillBack[e])){let e=0;for(let r=0;r<i;r++)e+=t.projectVertexZ[s[r]];r.depth=(e/i|0)+t.depth,r.facefill=n,this.visiblePolygonsCount++}}}}}}let i=this.view;if(i.visible)for(let s=0;s<i.numFaces;s++){let t=i.faceVertices[s],e=t[0],r=i.vertexViewX[e],n=i.vertexViewY[e],o=i.projectVertexZ[e];if(o>this.clipNear&&o<this.clipFar2d){let e=(this.spriteWidth[s]<<this.viewDistance)/o|0,a=(this.spriteHeight[s]<<this.viewDistance)/o|0;if(r-(e/2|0)<=this.clipX&&r+(e/2|0)>=-this.clipX&&n-a<=this.clipY&&n>=-this.clipY){let e=this.visiblePolygons[this.visiblePolygonsCount];e.model=i,e.face=s,this.initialisePolygon2D(this.visiblePolygonsCount),e.depth=(o+i.projectVertexZ[t[1]])/2|0,this.visiblePolygonsCount++}}}if(0!==this.visiblePolygonsCount){this.lastVisiblePolygonsCount=this.visiblePolygonsCount,this.polygonsQSort(this.visiblePolygons,0,this.visiblePolygonsCount-1);for(let t=0;t<this.visiblePolygonsCount;t++){let e=this.visiblePolygons[t],i=e.model,s=e.face;if(i===this.view){let t=i.faceVertices[s],e=t[0],r=i.vertexViewX[e],n=i.vertexViewY[e],o=i.projectVertexZ[e],a=(this.spriteWidth[s]<<this.viewDistance)/o|0,h=(this.spriteHeight[s]<<this.viewDistance)/o|0,l=i.vertexViewX[t[1]]-r,c=r-(a/2|0),u=this.baseY+n-h;this.surface._spriteClipping_from7(c+this.baseX,u,a,h,this.spriteId[s],l,(256<<this.viewDistance)/o|0),this.mousePickingActive&&this.mousePickedCount<this.mousePickedMax&&(c+=(this.spriteTranslateX[s]<<this.viewDistance)/o|0,this.mouseY>=u&&this.mouseY<=u+h&&this.mouseX>=c&&this.mouseX<=c+a&&!i.unpickable&&0===i.isLocalPlayer[s]&&(this.mousePickedModels[this.mousePickedCount]=i,this.mousePickedFaces[this.mousePickedCount]=s,this.mousePickedCount++))}else{let t=0,r=0,n=i.faceNumVertices[s],o=i.faceVertices[s];12345678!==i.faceIntensity[s]&&(r=e.visibility<0?i.lightAmbience-i.faceIntensity[s]:i.lightAmbience+i.faceIntensity[s]);for(let a=0;a<n;a++){let h=o[a];if(this.vertexX[a]=i.projectVertexX[h],this.vertexY[a]=i.projectVertexY[h],this.vertexZ[a]=i.projectVertexZ[h],12345678===i.faceIntensity[s]&&(r=e.visibility<0?i.lightAmbience-i.vertexIntensity[h]+i.vertexAmbience[h]:i.lightAmbience+i.vertexIntensity[h]+i.vertexAmbience[h]),i.projectVertexZ[h]>=this.clipNear)this.planeX[t]=i.vertexViewX[h],this.planeY[t]=i.vertexViewY[h],this.vertexShade[t]=r,i.projectVertexZ[h]>this.fogZDistance&&(this.vertexShade[t]+=(i.projectVertexZ[h]-this.fogZDistance)/this.fogZFalloff|0),t++;else{let e=0;if(e=0===a?o[n-1]:o[a-1],i.projectVertexZ[e]>=this.clipNear){let s=i.projectVertexZ[h]-i.projectVertexZ[e],n=i.projectVertexX[h]-((i.projectVertexX[h]-i.projectVertexX[e])*(i.projectVertexZ[h]-this.clipNear)/s|0),o=i.projectVertexY[h]-((i.projectVertexY[h]-i.projectVertexY[e])*(i.projectVertexZ[h]-this.clipNear)/s|0);this.planeX[t]=(n<<this.viewDistance)/this.clipNear|0,this.planeY[t]=(o<<this.viewDistance)/this.clipNear|0,this.vertexShade[t]=r,t++}if(e=a===n-1?o[0]:o[a+1],i.projectVertexZ[e]>=this.clipNear){let s=i.projectVertexZ[h]-i.projectVertexZ[e],n=i.projectVertexX[h]-((i.projectVertexX[h]-i.projectVertexX[e])*(i.projectVertexZ[h]-this.clipNear)/s|0),o=i.projectVertexY[h]-((i.projectVertexY[h]-i.projectVertexY[e])*(i.projectVertexZ[h]-this.clipNear)/s|0);this.planeX[t]=(n<<this.viewDistance)/this.clipNear|0,this.planeY[t]=(o<<this.viewDistance)/this.clipNear|0,this.vertexShade[t]=r,t++}}}for(let i=0;i<n;i++)this.vertexShade[i]<0?this.vertexShade[i]=0:this.vertexShade[i]>255&&(this.vertexShade[i]=255),e.facefill>=0&&(1===this.textureDimension[e.facefill]?this.vertexShade[i]<<=9:this.vertexShade[i]<<=6);this.generateScanlines(0,0,0,0,t,this.planeX,this.planeY,this.vertexShade,i,s),this.maxY>this.minY&&this.rasterize(0,0,n,this.vertexX,this.vertexY,this.vertexZ,e.facefill,i)}}this.mousePickingActive=!1}}generateScanlines(t,e,i,s,r,n,o,a,h,l){if(3===r){let r=o[0]+this.baseY,h=o[1]+this.baseY,l=o[2]+this.baseY,c=n[0],u=n[1],d=n[2],m=a[0],p=a[1],f=a[2],g=this.baseY+this.clipY-1,w=0,y=0,b=0,C=0,S=12345678,I=-12345678;l!==r&&(y=(d-c<<8)/(l-r)|0,C=(f-m<<8)/(l-r)|0,r<l?(w=c<<8,b=m<<8,S=r,I=l):(w=d<<8,b=f<<8,S=l,I=r),S<0&&(w-=y*S,b-=C*S,S=0),I>g&&(I=g));let T=0,x=0,v=0,k=0,A=12345678,B=-12345678;h!==r&&(x=(u-c<<8)/(h-r)|0,k=(p-m<<8)/(h-r)|0,r<h?(T=c<<8,v=m<<8,A=r,B=h):(T=u<<8,v=p<<8,A=h,B=r),A<0&&(T-=x*A|0,v-=k*A|0,A=0),B>g&&(B=g));let L=0,M=0,E=0,P=0,Y=12345678,X=-12345678;l!==h&&(M=(d-u<<8)/(l-h)|0,P=(f-p<<8)/(l-h)|0,h<l?(L=u<<8,E=p<<8,Y=h,X=l):(L=d<<8,E=f<<8,Y=l,X=h),Y<0&&(L-=M*Y|0,E-=P*Y|0,Y=0),X>g&&(X=g)),this.minY=S,A<this.minY&&(this.minY=A),Y<this.minY&&(this.minY=Y),this.maxY=I,B>this.maxY&&(this.maxY=B),X>this.maxY&&(this.maxY=X);let D=0;for(i=this.minY;i<this.maxY;i++){i>=S&&i<I?(t=e=w,s=D=b,w+=y,b+=C):(t=655360,e=-655360),i>=A&&i<B&&(T<t&&(t=T,s=v),T>e&&(e=T,D=v),T+=x,v+=k),i>=Y&&i<X&&(L<t&&(t=L,s=E),L>e&&(e=L,D=E),L+=M,E+=P);let r=this.scanlines[i];r.startX=t,r.endX=e,r.startS=s,r.endS=D}this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY)}else if(4===r){let r=o[0]+this.baseY,h=o[1]+this.baseY,l=o[2]+this.baseY,c=o[3]+this.baseY,u=n[0],d=n[1],m=n[2],p=n[3],f=a[0],g=a[1],w=a[2],y=a[3],b=this.baseY+this.clipY-1,C=0,S=0,I=0,T=0,x=12345678,v=-12345678;c!==r&&(S=(p-u<<8)/(c-r)|0,T=(y-f<<8)/(c-r)|0,r<c?(C=u<<8,I=f<<8,x=r,v=c):(C=p<<8,I=y<<8,x=c,v=r),x<0&&(C-=S*x,I-=T*x,x=0),v>b&&(v=b));let k=0,A=0,B=0,L=0,M=12345678,E=-12345678;h!==r&&(A=(d-u<<8)/(h-r)|0,L=(g-f<<8)/(h-r)|0,r<h?(k=u<<8,B=f<<8,M=r,E=h):(k=d<<8,B=g<<8,M=h,E=r),M<0&&(k-=A*M,B-=L*M,M=0),E>b&&(E=b));let P=0,Y=0,X=0,D=0,_=12345678,O=-12345678;l!==h&&(Y=(m-d<<8)/(l-h)|0,D=(w-g<<8)/(l-h)|0,h<l?(P=d<<8,X=g<<8,_=h,O=l):(P=m<<8,X=w<<8,_=l,O=h),_<0&&(P-=Y*_,X-=D*_,_=0),O>b&&(O=b));let R=0,j=0,U=0,N=0,F=12345678,H=-12345678;c!==l&&(j=(p-m<<8)/(c-l)|0,N=(y-w<<8)/(c-l)|0,l<c?(R=m<<8,U=w<<8,F=l,H=c):(R=p<<8,U=y<<8,F=c,H=l),F<0&&(R-=j*F,U-=N*F,F=0),H>b&&(H=b)),this.minY=x,M<this.minY&&(this.minY=M),_<this.minY&&(this.minY=_),F<this.minY&&(this.minY=F),this.maxY=v,E>this.maxY&&(this.maxY=E),O>this.maxY&&(this.maxY=O),H>this.maxY&&(this.maxY=H);let W=0;for(i=this.minY;i<this.maxY;i++){i>=x&&i<v?(t=e=C,s=W=I,C+=S,I+=T):(t=655360,e=-655360),i>=M&&i<E&&(k<t&&(t=k,s=B),k>e&&(e=k,W=B),k+=A,B+=L),i>=_&&i<O&&(P<t&&(t=P,s=X),P>e&&(e=P,W=X),P+=Y,X+=D),i>=F&&i<H&&(R<t&&(t=R,s=U),R>e&&(e=R,W=U),R+=j,U+=N);let r=this.scanlines[i];r.startX=t,r.endX=e,r.startS=s,r.endS=W}this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY)}else{for(this.maxY=this.minY=o[0]+=this.baseY,i=1;i<r;i++){let t=0;(t=o[i]+=this.baseY)<this.minY?this.minY=t:t>this.maxY&&(this.maxY=t)}if(this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY),this.maxY>=this.baseY+this.clipY&&(this.maxY=this.baseY+this.clipY-1),this.minY>=this.maxY)return;for(i=this.minY;i<this.maxY;i++){let t=this.scanlines[i];t.startX=655360,t.endX=-655360}let t=r-1,e=o[0],s=o[t];if(e<s){let r=n[0]<<8,o=(n[t]-n[0]<<8)/(s-e)|0,h=a[0]<<8,l=(a[t]-a[0]<<8)/(s-e)|0;for(e<0&&(r-=o*e,h-=l*e,e=0),s>this.maxY&&(s=this.maxY),i=e;i<=s;i++){let t=this.scanlines[i];t.startX=t.endX=r,t.startS=t.endS=h,r+=o,h+=l}}else if(e>s){let r=n[t]<<8,o=(n[0]-n[t]<<8)/(e-s)|0,h=a[t]<<8,l=(a[0]-a[t]<<8)/(e-s)|0;for(s<0&&(r-=o*s,h-=l*s,s=0),e>this.maxY&&(e=this.maxY),i=s;i<=e;i++){let t=this.scanlines[i];t.startX=t.endX=r,t.startS=t.endS=h,r+=o,h+=l}}for(i=0;i<t;i++){let t=i+1,e=o[i],s=o[t];if(e<s){let r=n[i]<<8,o=(n[t]-n[i]<<8)/(s-e)|0,h=a[i]<<8,l=(a[t]-a[i]<<8)/(s-e)|0;e<0&&(r-=o*e,h-=l*e,e=0),s>this.maxY&&(s=this.maxY);for(let t=e;t<=s;t++){let e=this.scanlines[t];r<e.startX&&(e.startX=r,e.startS=h),r>e.endX&&(e.endX=r,e.endS=h),r+=o,h+=l}}else if(e>s){let r=n[t]<<8,o=(n[i]-n[t]<<8)/(e-s)|0,h=a[t]<<8,l=(a[i]-a[t]<<8)/(e-s)|0;s<0&&(r-=o*s,h-=l*s,s=0),e>this.maxY&&(e=this.maxY);for(let t=s;t<=e;t++){let e=this.scanlines[t];r<e.startX&&(e.startX=r,e.startS=h),r>e.endX&&(e.endX=r,e.endS=h),r+=o,h+=l}}}this.minY<this.baseY-this.clipY&&(this.minY=this.baseY-this.clipY)}if(this.mousePickingActive&&this.mousePickedCount<this.mousePickedMax&&this.mouseY>=this.minY&&this.mouseY<this.maxY){let t=this.scanlines[this.mouseY];this.mouseX>=t.startX>>8&&this.mouseX<=t.endX>>8&&t.startX<=t.endX&&!h.unpickable&&0===h.isLocalPlayer[l]&&(this.mousePickedModels[this.mousePickedCount]=h,this.mousePickedFaces[this.mousePickedCount]=l,this.mousePickedCount++)}}rasterize(t,e,i,s,r,n,o,a){if(-2===o)return;if(o>=0){o>=this.textureCount&&(o=0),this.prepareTexture(o);let h=s[0],l=r[0],c=n[0],u=h-s[1],d=l-r[1],m=c-n[1],p=s[--i]-h,f=r[i]-l,g=n[i]-c;if(1===this.textureDimension[o]){let i=p*l-f*h<<12,s=f*c-g*l<<5-this.viewDistance+7+4,r=g*h-p*c<<5-this.viewDistance+7,n=u*l-d*h<<12,w=d*c-m*l<<5-this.viewDistance+7+4,y=m*h-u*c<<5-this.viewDistance+7,b=d*p-u*f<<5,C=m*f-d*g<<5-this.viewDistance+4,S=u*g-m*p>>this.viewDistance-5,I=s>>4,T=w>>4,x=C>>4,v=this.minY-this.baseY,k=this.width,A=this.baseX+this.minY*k,B=1;if(i+=r*v,n+=y*v,b+=S*v,this.interlace&&(1==(1&this.minY)&&(this.minY++,i+=r,n+=y,b+=S,A+=k),r<<=1,y<<=1,S<<=1,k<<=1,B=2),a.textureTranslucent){for(t=this.minY;t<this.maxY;t+=B){let a=this.scanlines[t];e=a.startX>>8;let h=a.endX>>8,l=h-e;if(l<=0)i+=r,n+=y,b+=S,A+=k;else{let t=a.startS,c=(a.endS-t)/l|0;e<-this.clipX&&(t+=(-this.clipX-e)*c,l=h-(e=-this.clipX)),h>this.clipX&&(l=this.clipX-e),xs.textureTranslucentScanline(this.raster,this.texturePixels[o],0,0,i+I*e,n+T*e,b+x*e,s,w,C,l,A+e,t,c<<2),i+=r,n+=y,b+=S,A+=k}}return}if(!this.textureBackTransparent[o]){for(t=this.minY;t<this.maxY;t+=B){let a=this.scanlines[t];e=a.startX>>8;let h=a.endX>>8,l=h-e;if(l<=0)i+=r,n+=y,b+=S,A+=k;else{let t=a.startS,c=(a.endS-t)/l|0;e<-this.clipX&&(t+=(-this.clipX-e)*c,l=h-(e=-this.clipX)),h>this.clipX&&(l=this.clipX-e),xs.textureScanline(this.raster,this.texturePixels[o],0,0,i+I*e,n+T*e,b+x*e,s,w,C,l,A+e,t,c<<2),i+=r,n+=y,b+=S,A+=k}}return}for(t=this.minY;t<this.maxY;t+=B){let a=this.scanlines[t];e=a.startX>>8;let h=a.endX>>8,l=h-e;if(l<=0)i+=r,n+=y,b+=S,A+=k;else{let t=a.startS,c=(a.endS-t)/l|0;e<-this.clipX&&(t+=(-this.clipX-e)*c,l=h-(e=-this.clipX)),h>this.clipX&&(l=this.clipX-e),xs.textureBackTranslucentScanline(this.raster,0,0,0,this.texturePixels[o],i+I*e,n+T*e,b+x*e,s,w,C,l,A+e,t,c),i+=r,n+=y,b+=S,A+=k}}return}let w=p*l-f*h<<11,y=f*c-g*l<<5-this.viewDistance+6+4,b=g*h-p*c<<5-this.viewDistance+6,C=u*l-d*h<<11,S=d*c-m*l<<5-this.viewDistance+6+4,I=m*h-u*c<<5-this.viewDistance+6,T=d*p-u*f<<5,x=m*f-d*g<<5-this.viewDistance+4,v=u*g-m*p>>this.viewDistance-5,k=y>>4,A=S>>4,B=x>>4,L=this.minY-this.baseY,M=this.width,E=this.baseX+this.minY*M,P=1;if(w+=b*L,C+=I*L,T+=v*L,this.interlace&&(1==(1&this.minY)&&(this.minY++,w+=b,C+=I,T+=v,E+=M),b<<=1,I<<=1,v<<=1,M<<=1,P=2),a.textureTranslucent){for(t=this.minY;t<this.maxY;t+=P){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)w+=b,C+=I,T+=v,E+=M;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),xs.textureTranslucentScanline2(this.raster,this.texturePixels[o],0,0,w+k*e,C+A*e,T+B*e,y,S,x,r,E+e,t,n),w+=b,C+=I,T+=v,E+=M}}return}if(!this.textureBackTransparent[o]){for(t=this.minY;t<this.maxY;t+=P){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)w+=b,C+=I,T+=v,E+=M;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),xs.textureScanline2(this.raster,this.texturePixels[o],0,0,w+k*e,C+A*e,T+B*e,y,S,x,r,E+e,t,n),w+=b,C+=I,T+=v,E+=M}}return}for(t=this.minY;t<this.maxY;t+=P){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)w+=b,C+=I,T+=v,E+=M;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),xs.textureBackTranslucentScanline2(this.raster,0,0,0,this.texturePixels[o],w+k*e,C+A*e,T+B*e,y,S,x,r,E+e,t,n),w+=b,C+=I,T+=v,E+=M}}return}for(let u=0;u<this.rampCount;u++){if(this.gradientBase[u]===o){this.anIntArray377=this.gradientRamps[u];break}if(u===this.rampCount-1){let t=Math.random()*this.rampCount|0;this.gradientBase[t]=o;let e=8*((o=-1-o)>>10&31),i=8*(o>>5&31),s=8*(31&o);for(let r=0;r<256;r++){let n=r*r,o=e*n/65536|0,a=i*n/65536|0,h=s*n/65536|0;this.gradientRamps[t][255-r]=(o<<16)+(a<<8)+h}this.anIntArray377=this.gradientRamps[t]}}let h=this.width,l=this.baseX+this.minY*h,c=1;if(this.interlace&&(1==(1&this.minY)&&(this.minY++,l+=h),h<<=1,c=2),a.transparent)for(t=this.minY;t<this.maxY;t+=c){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)l+=h;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),xs.textureGradientScanline(this.raster,-r,l+e,0,this.anIntArray377,t,n),l+=h}}else if(this.wideBand)for(t=this.minY;t<this.maxY;t+=c){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)l+=h;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),xs.gradientScanline(this.raster,-r,l+e,0,this.anIntArray377,t,n),l+=h}}else for(t=this.minY;t<this.maxY;t+=c){let i=this.scanlines[t];e=i.startX>>8;let s=i.endX>>8,r=s-e;if(r<=0)l+=h;else{let t=i.startS,n=(i.endS-t)/r|0;e<-this.clipX&&(t+=(-this.clipX-e)*n,r=s-(e=-this.clipX)),s>this.clipX&&(r=this.clipX-e),xs.gradientScanline2(this.raster,-r,l+e,0,this.anIntArray377,t,n),l+=h}}}setCamera(t,e,i,s,r,n,o){s&=1023,r&=1023,n&=1023,this.cameraYaw=1024-s&1023,this.cameraPitch=1024-r&1023,this.cameraRoll=1024-n&1023;let a=0,h=0,l=o;if(0!==s){let t=xs.sinCosCache[s],e=xs.sinCosCache[s+1024],i=h*e-l*t>>15;l=h*t+l*e>>15,h=i}if(0!==r){let t=xs.sinCosCache[r],e=xs.sinCosCache[r+1024],i=l*t+a*e>>15;l=l*e-a*t>>15,a=i}if(0!==n){let t=xs.sinCosCache[n],e=xs.sinCosCache[n+1024],i=h*t+a*e>>15;h=h*e-a*t>>15,a=i}this.cameraX=t-a,this.cameraY=e-h,this.cameraZ=i-l}initialisePolygon3D(t){let e=this.visiblePolygons[t],i=e.model,s=e.face,r=i.faceVertices[s],n=i.faceNumVertices[s],o=i.normalScale[s],a=i.projectVertexX[r[0]],h=i.projectVertexY[r[0]],l=i.projectVertexZ[r[0]],c=i.projectVertexX[r[1]]-a,u=i.projectVertexY[r[1]]-h,d=i.projectVertexZ[r[1]]-l,m=i.projectVertexX[r[2]]-a,p=i.projectVertexY[r[2]]-h,f=i.projectVertexZ[r[2]]-l,g=u*f-p*d,w=d*m-f*c,y=c*p-m*u;if(-1===o){for(o=0;g>25e3||w>25e3||y>25e3||g<-25e3||w<-25e3||y<-25e3;y>>=1)o++,g>>=1,w>>=1;i.normalScale[s]=o,i.normalMagnitude[s]=this.normalMagnitude*Math.sqrt(g*g+w*w+y*y)|0}else g>>=o,w>>=o,y>>=o;e.visibility=a*g+h*w+l*y,e.normalX=g,e.normalY=w,e.normalZ=y;let b=i.projectVertexZ[r[0]],C=b,S=i.vertexViewX[r[0]],I=S,T=i.vertexViewY[r[0]],x=T;for(let v=1;v<n;v++){let t=i.projectVertexZ[r[v]];t>C?C=t:t<b&&(b=t),(t=i.vertexViewX[r[v]])>I?I=t:t<S&&(S=t),(t=i.vertexViewY[r[v]])>x?x=t:t<T&&(T=t)}e.minZ=b,e.maxZ=C,e.minPlaneX=S,e.maxPlaneX=I,e.minPlaneY=T,e.maxPlaneY=x}initialisePolygon2D(t){let e=this.visiblePolygons[t],i=e.model,s=e.face,r=i.faceVertices[s],n=i.projectVertexX[r[0]],o=i.projectVertexY[r[0]],a=i.projectVertexZ[r[0]];i.normalMagnitude[s]=1,i.normalScale[s]=0,e.visibility=0*n+0*o+1*a,e.normalX=0,e.normalY=0,e.normalZ=1;let h=i.projectVertexZ[r[0]],l=h,c=i.vertexViewX[r[0]],u=c;i.vertexViewX[r[1]]<c?c=i.vertexViewX[r[1]]:u=i.vertexViewX[r[1]];let d=i.vertexViewY[r[1]],m=i.vertexViewY[r[0]],p=i.projectVertexZ[r[1]];p>l?l=p:p<h&&(h=p),(p=i.vertexViewX[r[1]])>u?u=p:p<c&&(c=p),(p=i.vertexViewY[r[1]])>m?m=p:p<d&&(d=p),e.minZ=h,e.maxZ=l,e.minPlaneX=c-20,e.maxPlaneX=u+20,e.minPlaneY=d,e.maxPlaneY=m}separatePolygon(t,e){if(t.minPlaneX>=e.maxPlaneX)return!0;if(e.minPlaneX>=t.maxPlaneX)return!0;if(t.minPlaneY>=e.maxPlaneY)return!0;if(e.minPlaneY>=t.maxPlaneY)return!0;if(t.minZ>=e.maxZ)return!0;if(e.minZ>t.maxZ)return!1;let i=t.model,s=e.model,r=t.face,n=e.face,o=i.faceVertices[r],a=s.faceVertices[n],h=i.faceNumVertices[r],l=s.faceNumVertices[n],c=s.projectVertexX[a[0]],u=s.projectVertexY[a[0]],d=s.projectVertexZ[a[0]],m=e.normalX,p=e.normalY,f=e.normalZ,g=s.normalMagnitude[n],w=e.visibility,y=!1;for(let T=0;T<h;T++){let t=o[T],e=(c-i.projectVertexX[t])*m+(u-i.projectVertexY[t])*p+(d-i.projectVertexZ[t])*f;if(!(e>=-g||w>=0)||!(e<=g||w<=0)){y=!0;break}}if(!y)return!0;c=i.projectVertexX[o[0]],u=i.projectVertexY[o[0]],d=i.projectVertexZ[o[0]],m=t.normalX,p=t.normalY,f=t.normalZ,g=i.normalMagnitude[r],w=t.visibility,y=!1;for(let T=0;T<l;T++){let t=a[T],e=(c-s.projectVertexX[t])*m+(u-s.projectVertexY[t])*p+(d-s.projectVertexZ[t])*f;if(!(e>=-g||w<=0)||!(e<=g||w>=0)){y=!0;break}}if(!y)return!0;let b=null,C=null;if(2===h){b=new Int32Array(4),C=new Int32Array(4);let t=o[0],e=o[1];b[0]=i.vertexViewX[t]-20,b[1]=i.vertexViewX[e]-20,b[2]=i.vertexViewX[e]+20,b[3]=i.vertexViewX[t]+20,C[0]=C[3]=i.vertexViewY[t],C[1]=C[2]=i.vertexViewY[e]}else{b=new Int32Array(h),C=new Int32Array(h);for(let t=0;t<h;t++){let e=o[t];b[t]=i.vertexViewX[e],C[t]=i.vertexViewY[e]}}let S=null,I=null;if(2===l){S=new Int32Array(4),I=new Int32Array(4);let t=a[0],e=a[1];S[0]=s.vertexViewX[t]-20,S[1]=s.vertexViewX[e]-20,S[2]=s.vertexViewX[e]+20,S[3]=s.vertexViewX[t]+20,I[0]=I[3]=s.vertexViewY[t],I[1]=I[2]=s.vertexViewY[e]}else{S=new Int32Array(l),I=new Int32Array(l);for(let t=0;t<l;t++){let e=a[t];S[t]=s.vertexViewX[e],I[t]=s.vertexViewY[e]}}return!this.intersect(b,C,S,I)}heuristicPolygon(t,e){let i=t.model,s=e.model,r=t.face,n=e.face,o=i.faceVertices[r],a=s.faceVertices[n],h=i.faceNumVertices[r],l=s.faceNumVertices[n],c=s.projectVertexX[a[0]],u=s.projectVertexY[a[0]],d=s.projectVertexZ[a[0]],m=e.normalX,p=e.normalY,f=e.normalZ,g=s.normalMagnitude[n],w=e.visibility,y=!1;for(let b=0;b<h;b++){let t=o[b],e=(c-i.projectVertexX[t])*m+(u-i.projectVertexY[t])*p+(d-i.projectVertexZ[t])*f;if(!(e>=-g||w>=0)||!(e<=g||w<=0)){y=!0;break}}if(!y)return!0;c=i.projectVertexX[o[0]],u=i.projectVertexY[o[0]],d=i.projectVertexZ[o[0]],m=t.normalX,p=t.normalY,f=t.normalZ,g=i.normalMagnitude[r],w=t.visibility,y=!1;for(let b=0;b<l;b++){let t=a[b],e=(c-s.projectVertexX[t])*m+(u-s.projectVertexY[t])*p+(d-s.projectVertexZ[t])*f;if(!(e>=-g||w<=0)||!(e<=g||w>=0)){y=!0;break}}return!y}allocateTextures(t,e,i){this.textureCount=t,this.textureColoursUsed=[],this.textureColoursUsed.length=t,this.textureColoursUsed.fill(null),this.textureColourList=[],this.textureColourList.length=t,this.textureColourList.fill(null),this.textureDimension=new Int32Array(t),this.textureLoadedNumber=[],this.textureLoadedNumber.length=t,this.textureLoadedNumber.fill(null),this.textureBackTransparent=new Int8Array(t),this.texturePixels=[],this.texturePixels.length=t,this.texturePixels.fill(null),xs.textureCountLoaded=new ht(0);for(let s=0;s<t;s+=1)this.textureLoadedNumber.push(new ht(0));this.textureColours64=[],this.textureColours64.length=e,this.textureColours64.fill(null),this.textureColours128=[],this.textureColours128.length=i,this.textureColours128.fill(null)}defineTexture(t,e,i,s){this.textureColoursUsed[t]=e,this.textureColourList[t]=i,this.textureDimension[t]=s,this.textureLoadedNumber[t]=new ht(0),this.textureBackTransparent[t]=!1,this.texturePixels[t]=null,this.prepareTexture(t)}prepareTexture(t){if(t<0)return;if(xs.textureCountLoaded=xs.textureCountLoaded.add(1),this.textureLoadedNumber[t]=new ht(xs.textureCountLoaded),null!==this.texturePixels[t])return;if(0===this.textureDimension[t]){for(let s=0;s<this.textureColours64.length;s++)if(null===this.textureColours64[s])return this.textureColours64[s]=new Int32Array(16384),this.texturePixels[t]=this.textureColours64[s],void this.setTexturePixels(t);let e=new ht(1).shiftLeft(30),i=0;for(let s=0;s<this.textureCount;s++)s!==t&&0===this.textureDimension[s]&&null!==this.texturePixels[s]&&this.textureLoadedNumber[s].lessThan(e)&&(e=this.textureLoadedNumber[s],i=s);return this.texturePixels[t]=this.texturePixels[i],this.texturePixels[i]=null,void this.setTexturePixels(t)}for(let s=0;s<this.textureColours128.length;s++)if(null===this.textureColours128[s])return this.textureColours128[s]=new Int32Array(65536),this.texturePixels[t]=this.textureColours128[s],void this.setTexturePixels(t);let e=new ht(1).shiftLeft(30),i=0;for(let s=0;s<this.textureCount;s++)s!==t&&1===this.textureDimension[s]&&null!==this.texturePixels[s]&&this.textureLoadedNumber[s].lessThan(e)&&(e=this.textureLoadedNumber[s],i=s);this.texturePixels[t]=this.texturePixels[i],this.texturePixels[i]=null,this.setTexturePixels(t)}setTexturePixels(t){let e=0;e=0===this.textureDimension[t]?64:128;let i=this.texturePixels[t],s=0;for(let r=0;r<e;r++)for(let n=0;n<e;n++){let o=this.textureColourList[t][255&this.textureColoursUsed[t][n+r*e]];0==(o&=16316671)?o=1:16253183===o&&(o=0,this.textureBackTransparent[t]=!0),i[s++]=o}for(let r=0;r<s;r++){let t=i[r];i[s+r]=t-(t>>>3)&16316671,i[2*s+r]=t-(t>>>2)&16316671,i[3*s+r]=t-(t>>>2)-(t>>>3)&16316671}}doSOemthingWithTheFuckinFountainFuck(t){if(null===this.texturePixels[t])return;let e=this.texturePixels[t];for(let s=0;s<64;s++){let i=s+4032,r=e[i];for(let t=0;t<63;t++)e[i]=e[i-64],i-=64;this.texturePixels[t][i]=r}let i=4096;for(let s=0;s<i;s++){let t=e[s];e[i+s]=t-(t>>>3)&16316671,e[8192+s]=t-(t>>>2)&16316671,e[3*i+s]=t-(t>>>2)-(t>>>3)&16316671}}method302(t){return 12345678===t?0:(this.prepareTexture(t),t>=0?this.texturePixels[t][0]:t<0?(((t=-(t+1))>>10&31)<<19)+((t>>5&31)<<11)+((31&t)<<3):0)}_setLight_from3(t,e,i){0===t&&0===e&&0===i&&(t=32);for(let s=0;s<this.modelCount;s++)this.models[s]._setLight_from3(t,e,i)}_setLight_from5(t,e,i,s,r){0===i&&0===s&&0===r&&(i=32);for(let n=0;n<this.modelCount;n++)this.models[n]._setLight_from5(t,e,i,s,r)}method306(t,e,i,s,r){return s===e?t:t+((i-t)*(r-e)/(s-e)|0)}method307(t,e,i,s,r){return r&&t<=i||t<i?t>s||e>i||e>s||!r:t<s||e<i||e<s||r}method308(t,e,i,s){return s&&t<=i||t<i?e>i||!s:e<i||s}intersect(t,e,i,s){let r,n,o=t.length,a=i.length,h=0,l=r=e[0],c=0,u=n=s[0],d=0;for(let b=1;b<o;b++)e[b]<r?(r=e[b],c=b):e[b]>l&&(l=e[b]);for(let b=1;b<a;b++)s[b]<n?(n=s[b],d=b):s[b]>u&&(u=s[b]);if(n>=l)return!1;if(r>=u)return!1;let m=0,p=0,f=!1;if(e[c]<s[d]){for(m=c;e[m]<s[d];m=(m+1)%o);for(;e[c]<s[d];c=(c-1+o)%o);let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[d]),l=i[d];if(f=r<l|n<l,this.method308(r,n,l,f))return!0;p=(d+1)%a,d=(d-1+a)%a,c===m&&(h=1)}else{for(p=d;s[p]<e[c];p=(p+1)%a);for(;s[d]<e[c];d=(d-1+a)%a);let r=t[c],n=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[c]),l=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[c]);if(f=r<n|r<l,this.method308(n,l,r,!f))return!0;m=(c+1)%o,c=(c-1+o)%o,d===p&&(h=2)}for(;0===h;)if(e[c]<e[m])if(e[c]<s[d])if(e[c]<s[p]){let r=t[c],n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],e[c]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[c]),u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[c]);if(this.method307(r,n,l,u,f))return!0;(c=(c-1+o)%o)===m&&(h=1)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[p]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[p]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],s[p]),u=i[p];if(this.method307(r,n,l,u,f))return!0;d===(p=(p+1)%a)&&(h=2)}else if(s[d]<s[p]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[d]),l=i[d],u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],s[d]);if(this.method307(r,n,l,u,f))return!0;(d=(d-1+a)%a)===p&&(h=2)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[p]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[p]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],s[p]),u=i[p];if(this.method307(r,n,l,u,f))return!0;d===(p=(p+1)%a)&&(h=2)}else if(e[m]<s[d])if(e[m]<s[p]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],e[m]),n=t[m],l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[m]),u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[m]);if(this.method307(r,n,l,u,f))return!0;c===(m=(m+1)%o)&&(h=1)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[p]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[p]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],s[p]),u=i[p];if(this.method307(r,n,l,u,f))return!0;d===(p=(p+1)%a)&&(h=2)}else if(s[d]<s[p]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[d]),l=i[d],u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],s[d]);if(this.method307(r,n,l,u,f))return!0;(d=(d-1+a)%a)===p&&(h=2)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[p]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[p]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],s[p]),u=i[p];if(this.method307(r,n,l,u,f))return!0;d===(p=(p+1)%a)&&(h=2)}for(;1===h;)if(e[c]<s[d]){if(e[c]<s[p]){let r=t[c],n=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[c]),o=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[c]);return this.method308(n,o,r,!f)}let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[p]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[p]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],s[p]),u=i[p];if(this.method307(r,n,l,u,f))return!0;d===(p=(p+1)%a)&&(h=0)}else if(s[d]<s[p]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[d]),l=i[d],u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],s[d]);if(this.method307(r,n,l,u,f))return!0;(d=(d-1+a)%a)===p&&(h=0)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[p]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[p]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],s[p]),u=i[p];if(this.method307(r,n,l,u,f))return!0;d===(p=(p+1)%a)&&(h=0)}for(;2===h;)if(s[d]<e[c]){if(s[d]<e[m]){let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[d]),a=i[d];return this.method308(r,n,a,f)}let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],e[m]),n=t[m],l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[m]),u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[m]);if(this.method307(r,n,l,u,f))return!0;c===(m=(m+1)%o)&&(h=0)}else if(e[c]<e[m]){let r=t[c],n=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],e[c]),l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[c]),u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[c]);if(this.method307(r,n,l,u,f))return!0;(c=(c-1+o)%o)===m&&(h=0)}else{let r=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],e[m]),n=t[m],l=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[m]),u=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[m]);if(this.method307(r,n,l,u,f))return!0;c===(m=(m+1)%o)&&(h=0)}if(e[c]<s[d]){let r=t[c],n=this.method306(i[(d+1)%a],s[(d+1)%a],i[d],s[d],e[c]),o=this.method306(i[(p-1+a)%a],s[(p-1+a)%a],i[p],s[p],e[c]);return this.method308(n,o,r,!f)}let g=this.method306(t[(c+1)%o],e[(c+1)%o],t[c],e[c],s[d]),w=this.method306(t[(m-1+o)%o],e[(m-1+o)%o],t[m],e[m],s[d]),y=i[d];return this.method308(g,w,y,f)}}xs.aByteArray434=null,xs.frustumFarZ=0,xs.frustumMaxX=0,xs.frustumMaxY=0,xs.frustumMinX=0,xs.frustumMinY=0,xs.frustumNearZ=0,xs.sin512Cache=new Int32Array(512),xs.sinCosCache=new Int32Array(2048),xs.textureCountLoaded=new ht(0),Ts=xs;var vs={};class ks{constructor(){this.numVertices=0,this.numFaces=0,this.transformState=0,this.visible=!1,this.textureTranslucent=!1,this.transparent=!1,this.isolated=!1,this.unlit=!1,this.unpickable=!1,this.projected=!1,this.autocommit=!1,this.depth=0,this.x1=0,this.x2=0,this.y1=0,this.y2=0,this.z1=0,this.z2=0,this.key=0,this.maxVerts=0,this.lightDiffuse=0,this.lightAmbience=0,this.magic=0,this.maxFaces=0,this.baseX=0,this.baseY=0,this.baseZ=0,this.scaleFx=0,this.scaleFy=0,this.scaleFz=0,this.shearXy=0,this.shearXz=0,this.shearYx=0,this.shearYz=0,this.shearZx=0,this.shearZy=0,this.transformKind=0,this.diameter=0,this.lightDirectionX=0,this.lightDirectionY=0,this.lightDirectionZ=0,this.lightDirectionMagnitude=0,this.dataPtr=0,this.orientationYaw=0,this.orientationPitch=0,this.orientationRoll=0,this.projectVertexX=null,this.projectVertexY=null,this.projectVertexZ=null,this.vertexViewX=null,this.vertexViewY=null,this.vertexIntensity=null,this.vertexAmbience=null,this.faceNumVertices=null,this.faceVertices=null,this.faceFillFront=null,this.faceFillBack=null,this.normalMagnitude=null,this.normalScale=null,this.faceIntensity=null,this.faceNormalX=null,this.faceNormalY=null,this.faceNormalZ=null,this.faceTag=null,this.isLocalPlayer=null,this.vertexX=null,this.vertexY=null,this.vertexZ=null,this.vertexTransformedX=null,this.vertexTransformedY=null,this.vertexTransformedZ=null,this.faceTransStateThing=null,this.faceBoundLeft=null,this.faceBoundRight=null,this.faceBoundBottom=null,this.faceBoundTop=null,this.faceBoundNear=null,this.faceBoundFar=null}static _from2(t,e){let i=new ks;i.transformState=1,i.visible=!0,i.textureTranslucent=!1,i.transparent=!1,i.key=-1,i.autocommit=!1,i.isolated=!1,i.unlit=!1,i.unpickable=!1,i.projected=!1,i.magic=12345678,i.diameter=12345678,i.lightDirectionX=180,i.lightDirectionY=155,i.lightDirectionZ=95,i.lightDirectionMagnitude=256,i.lightDiffuse=512,i.lightAmbience=32,i.allocate(t,e),i.faceTransStateThing=[];for(let s=0;s<i.numFaces;s++)i.faceTransStateThing.push(new Int32Array([0]));return i}static _from2A(t,e){let i=new ks;return i.transformState=1,i.visible=!0,i.textureTranslucent=!1,i.transparent=!1,i.key=-1,i.autocommit=!1,i.isolated=!1,i.unlit=!1,i.unpickable=!1,i.projected=!1,i.magic=12345678,i.diameter=12345678,i.lightDirectionX=180,i.lightDirectionY=155,i.lightDirectionZ=95,i.lightDirectionMagnitude=256,i.lightDiffuse=512,i.lightAmbience=32,i.merge(t,e,!0),i}static fromBytes(t,e){let i=new ks;i.transformState=1,i.visible=!0,i.textureTranslucent=!1,i.transparent=!1,i.key=-1,i.autocommit=!1,i.isolated=!1,i.unlit=!1,i.unpickable=!1,i.projected=!1,i.magic=12345678,i.diameter=12345678,i.lightDirectionX=180,i.lightDirectionY=155,i.lightDirectionZ=95,i.lightDirectionMagnitude=256,i.lightDiffuse=512,i.lightAmbience=32;let s=Li.getUnsignedShort(t,e);e+=2;let r=Li.getUnsignedShort(t,e);e+=2,i.allocate(s,r),i.faceTransStateThing=[],i.faceTransStateThing.length=r;for(let n=0;n<r;n+=1)i.faceTransStateThing[n]=[0];for(let n=0;n<s;n++)i.vertexX[n]=Li.getSignedShort(t,e),e+=2;for(let n=0;n<s;n++)i.vertexY[n]=Li.getSignedShort(t,e),e+=2;for(let n=0;n<s;n++)i.vertexZ[n]=Li.getSignedShort(t,e),e+=2;i.numVertices=s;for(let n=0;n<r;n++)i.faceNumVertices[n]=255&t[e++];for(let n=0;n<r;n++)i.faceFillFront[n]=Li.getSignedShort(t,e),e+=2,32767===i.faceFillFront[n]&&(i.faceFillFront[n]=i.magic);for(let n=0;n<r;n++)i.faceFillBack[n]=Li.getSignedShort(t,e),e+=2,32767===i.faceFillBack[n]&&(i.faceFillBack[n]=i.magic);for(let n=0;n<r;n++){let s=255&t[e++];i.faceIntensity[n]=0===s?0:i.magic}for(let n=0;n<r;n++){i.faceVertices[n]=new Int32Array(i.faceNumVertices[n]);for(let r=0;r<i.faceNumVertices[n];r++)s<256?i.faceVertices[n][r]=255&t[e++]:(i.faceVertices[n][r]=Li.getUnsignedShort(t,e),e+=2)}return i.numFaces=r,i.transformState=1,i}static _from6(t,e,i,s,r,n){let o=new ks;return o.transformState=1,o.visible=!0,o.textureTranslucent=!1,o.transparent=!1,o.key=-1,o.projected=!1,o.magic=12345678,o.diameter=12345678,o.lightDirectionX=180,o.lightDirectionY=155,o.lightDirectionZ=95,o.lightDirectionMagnitude=256,o.lightDiffuse=512,o.lightAmbience=32,o.autocommit=i,o.isolated=s,o.unlit=r,o.unpickable=n,o.merge(t,e,!1),o}static _from7(t,e,i,s,r,n,o){let a=new ks;return a.transformState=1,a.visible=!0,a.textureTranslucent=!1,a.transparent=!1,a.key=-1,a.magic=12345678,a.diameter=12345678,a.lightDirectionX=180,a.lightDirectionY=155,a.lightDirectionZ=95,a.lightDirectionMagnitude=256,a.lightDiffuse=512,a.lightAmbience=32,a.autocommit=i,a.isolated=s,a.unlit=r,a.unpickable=n,a.projected=o,a.allocate(t,e),a}allocate(t,e){this.vertexX=new Int32Array(t),this.vertexY=new Int32Array(t),this.vertexZ=new Int32Array(t),this.vertexIntensity=new Int32Array(t),this.vertexAmbience=new Int8Array(t),this.faceNumVertices=new Int32Array(e),this.faceVertices=[],this.faceVertices.length=e,this.faceVertices.fill(null),this.faceFillFront=new Int32Array(e),this.faceFillBack=new Int32Array(e),this.faceIntensity=new Int32Array(e),this.normalScale=new Int32Array(e),this.normalMagnitude=new Int32Array(e),this.projected||(this.projectVertexX=new Int32Array(t),this.projectVertexY=new Int32Array(t),this.projectVertexZ=new Int32Array(t),this.vertexViewX=new Int32Array(t),this.vertexViewY=new Int32Array(t)),this.unpickable||(this.isLocalPlayer=new Int8Array(e),this.faceTag=new Int32Array(e)),this.autocommit?(this.vertexTransformedX=this.vertexX,this.vertexTransformedY=this.vertexY,this.vertexTransformedZ=this.vertexZ):(this.vertexTransformedX=new Int32Array(t),this.vertexTransformedY=new Int32Array(t),this.vertexTransformedZ=new Int32Array(t)),this.unlit&&this.isolated||(this.faceNormalX=new Int32Array(e),this.faceNormalY=new Int32Array(e),this.faceNormalZ=new Int32Array(e)),this.isolated||(this.faceBoundLeft=new Int32Array(e),this.faceBoundRight=new Int32Array(e),this.faceBoundBottom=new Int32Array(e),this.faceBoundTop=new Int32Array(e),this.faceBoundNear=new Int32Array(e),this.faceBoundFar=new Int32Array(e)),this.numFaces=0,this.numVertices=0,this.maxVerts=t,this.maxFaces=e,this.baseX=this.baseY=this.baseZ=0,this.orientationYaw=this.orientationPitch=this.orientationRoll=0,this.scaleFx=this.scaleFy=this.scaleFz=256,this.shearXy=this.shearXz=this.shearYx=this.shearYz=this.shearZx=this.shearZy=256,this.transformKind=0}projectionPrepare(){this.projectVertexX=new Int32Array(this.numVertices),this.projectVertexY=new Int32Array(this.numVertices),this.projectVertexZ=new Int32Array(this.numVertices),this.vertexViewX=new Int32Array(this.numVertices),this.vertexViewY=new Int32Array(this.numVertices)}clear(){this.numFaces=0,this.numVertices=0}reduce(t,e){this.numFaces-=t,this.numFaces<0&&(this.numFaces=0),this.numVertices-=e,this.numVertices<0&&(this.numVertices=0)}merge(t,e,i){let s=0,r=0;for(let n=0;n<e;n++)s+=t[n].numFaces,r+=t[n].numVertices;this.allocate(r,s),i&&(this.faceTransStateThing=[],this.faceTransStateThing.length=s);for(let n=0;n<e;n++){let s=t[n];s.commit(),this.lightAmbience=s.lightAmbience,this.lightDiffuse=s.lightDiffuse,this.lightDirectionX=s.lightDirectionX,this.lightDirectionY=s.lightDirectionY,this.lightDirectionZ=s.lightDirectionZ,this.lightDirectionMagnitude=s.lightDirectionMagnitude;for(let t=0;t<s.numFaces;t++){let r=new Int32Array(s.faceNumVertices[t]),o=s.faceVertices[t];for(let e=0;e<s.faceNumVertices[t];e++)r[e]=this.vertexAt(s.vertexX[o[e]],s.vertexY[o[e]],s.vertexZ[o[e]]);let a=this.createFace(s.faceNumVertices[t],r,s.faceFillFront[t],s.faceFillBack[t]);if(this.faceIntensity[a]=s.faceIntensity[t],this.normalScale[a]=s.normalScale[t],this.normalMagnitude[a]=s.normalMagnitude[t],i)if(e>1){this.faceTransStateThing[a]=new Int32Array(s.faceTransStateThing[t].length+1),this.faceTransStateThing[a][0]=n;for(let e=0;e<s.faceTransStateThing[t].length;e++)this.faceTransStateThing[a][e+1]=s.faceTransStateThing[t][e]}else{this.faceTransStateThing[a]=new Int32Array(s.faceTransStateThing[t].length);for(let e=0;e<s.faceTransStateThing[t].length;e++)this.faceTransStateThing[a][e]=s.faceTransStateThing[t][e]}}}this.transformState=1}vertexAt(t,e,i){for(let s=0;s<this.numVertices;s++)if(this.vertexX[s]===t&&this.vertexY[s]===e&&this.vertexZ[s]===i)return s;return this.numVertices>=this.maxVerts?-1:(this.vertexX[this.numVertices]=t,this.vertexY[this.numVertices]=e,this.vertexZ[this.numVertices]=i,this.numVertices++)}createVertex(t,e,i){return this.numVertices>=this.maxVerts?-1:(this.vertexX[this.numVertices]=t,this.vertexY[this.numVertices]=e,this.vertexZ[this.numVertices]=i,this.numVertices++)}createFace(t,e,i,s){return this.numFaces>=this.maxFaces?-1:(this.faceNumVertices[this.numFaces]=t,this.faceVertices[this.numFaces]=e,this.faceFillFront[this.numFaces]=i,this.faceFillBack[this.numFaces]=s,this.transformState=1,this.numFaces++)}split(t,e,i,s,r,n,o,a){this.commit();let h=new Int32Array(n),l=new Int32Array(n);for(let u=0;u<n;u++)h[u]=0,l[u]=0;for(let u=0;u<this.numFaces;u++){let t=0,e=0,n=this.faceNumVertices[u],o=this.faceVertices[u];for(let i=0;i<n;i++)t+=this.vertexX[o[i]],e+=this.vertexZ[o[i]];let a=(t/(n*i)|0)+(e/(n*s)|0)*r;h[a]+=n,l[a]++}let c=[];for(let u=0;u<n;u++)h[u]>o&&(h[u]=o),c.push(ks._from7(h[u],l[u],!0,!0,!0,a,!0)),c[u].lightDiffuse=this.lightDiffuse,c[u].lightAmbience=this.lightAmbience;for(let u=0;u<this.numFaces;u++){let t=0,e=0,n=this.faceNumVertices[u],o=this.faceVertices[u];for(let i=0;i<n;i++)t+=this.vertexX[o[i]],e+=this.vertexZ[o[i]];let a=(t/(n*i)|0)+(e/(n*s)|0)*r;this.copyLighting(c[a],o,n,u)}for(let u=0;u<n;u++)c[u].projectionPrepare();return c}copyLighting(t,e,i,s){let r=new Int32Array(i);for(let o=0;o<i;o++){let i=r[o]=t.vertexAt(this.vertexX[e[o]],this.vertexY[e[o]],this.vertexZ[e[o]]);t.vertexIntensity[i]=this.vertexIntensity[e[o]],t.vertexAmbience[i]=this.vertexAmbience[e[o]]}let n=t.createFace(i,r,this.faceFillFront[s],this.faceFillBack[s]);t.unpickable||this.unpickable||(t.faceTag[n]=this.faceTag[s]),t.faceIntensity[n]=this.faceIntensity[s],t.normalScale[n]=this.normalScale[s],t.normalMagnitude[n]=this.normalMagnitude[s]}_setLight_from5(t,e,i,s,r){this.lightAmbience=256-4*t,this.lightDiffuse=16*(64-e)+128,this.unlit||(this.lightDirectionX=i,this.lightDirectionY=s,this.lightDirectionZ=r,this.lightDirectionMagnitude=0|Math.sqrt(i*i+s*s+r*r),this.light())}_setLight_from6(t,e,i,s,r,n){if(this.lightAmbience=256-4*e,this.lightDiffuse=16*(64-i)+128,!this.unlit){for(let e=0;e<this.numFaces;e++)this.faceIntensity[e]=t?this.magic:0;this.lightDirectionX=s,this.lightDirectionY=r,this.lightDirectionZ=n,this.lightDirectionMagnitude=0|Math.sqrt(s*s+r*r+n*n),this.light()}}_setLight_from3(t,e,i){this.unlit||(this.lightDirectionX=t,this.lightDirectionY=e,this.lightDirectionZ=i,this.lightDirectionMagnitude=0|Math.sqrt(t*t+e*e+i*i),this.light())}setVertexAmbience(t,e){this.vertexAmbience[t]=255&e}rotate(t,e,i){this.orientationYaw=this.orientationYaw+t&255,this.orientationPitch=this.orientationPitch+e&255,this.orientationRoll=this.orientationRoll+i&255,this.determineTransformKind(),this.transformState=1}orient(t,e,i){this.orientationYaw=255&t,this.orientationPitch=255&e,this.orientationRoll=255&i,this.determineTransformKind(),this.transformState=1}translate(t,e,i){this.baseX+=t,this.baseY+=e,this.baseZ+=i,this.determineTransformKind(),this.transformState=1}place(t,e,i){this.baseX=t,this.baseY=e,this.baseZ=i,this.determineTransformKind(),this.transformState=1}determineTransformKind(){256!==this.shearXy||256!==this.shearXz||256!==this.shearYx||256!==this.shearYz||256!==this.shearZx||256!==this.shearZy?this.transformKind=4:256!==this.scaleFx||256!==this.scaleFy||256!==this.scaleFz?this.transformKind=3:0!==this.orientationYaw||0!==this.orientationPitch||0!==this.orientationRoll?this.transformKind=2:0!==this.baseX||0!==this.baseY||0!==this.baseZ?this.transformKind=1:this.transformKind=0}applyTranslate(t,e,i){for(let s=0;s<this.numVertices;s++)this.vertexTransformedX[s]+=t,this.vertexTransformedY[s]+=e,this.vertexTransformedZ[s]+=i}applyRotation(t,e,i){for(let s=0;s<this.numVertices;s++){if(0!==i){let t=ks.sine9[i],e=ks.sine9[i+256],r=this.vertexTransformedY[s]*t+this.vertexTransformedX[s]*e>>15;this.vertexTransformedY[s]=this.vertexTransformedY[s]*e-this.vertexTransformedX[s]*t>>15,this.vertexTransformedX[s]=r}if(0!==t){let e=ks.sine9[t],i=ks.sine9[t+256],r=this.vertexTransformedY[s]*i-this.vertexTransformedZ[s]*e>>15;this.vertexTransformedZ[s]=this.vertexTransformedY[s]*e+this.vertexTransformedZ[s]*i>>15,this.vertexTransformedY[s]=r}if(0!==e){let t=ks.sine9[e],i=ks.sine9[e+256],r=this.vertexTransformedZ[s]*t+this.vertexTransformedX[s]*i>>15;this.vertexTransformedZ[s]=this.vertexTransformedZ[s]*i-this.vertexTransformedX[s]*t>>15,this.vertexTransformedX[s]=r}}}applyShear(t,e,i,s,r,n){for(let o=0;o<this.numVertices;o++)0!==t&&(this.vertexTransformedX[o]+=this.vertexTransformedY[o]*t>>8),0!==e&&(this.vertexTransformedZ[o]+=this.vertexTransformedY[o]*e>>8),0!==i&&(this.vertexTransformedX[o]+=this.vertexTransformedZ[o]*i>>8),0!==s&&(this.vertexTransformedY[o]+=this.vertexTransformedZ[o]*s>>8),0!==r&&(this.vertexTransformedZ[o]+=this.vertexTransformedX[o]*r>>8),0!==n&&(this.vertexTransformedY[o]+=this.vertexTransformedX[o]*n>>8)}applyScale(t,e,i){for(let s=0;s<this.numVertices;s++)this.vertexTransformedX[s]=this.vertexTransformedX[s]*t>>8,this.vertexTransformedY[s]=this.vertexTransformedY[s]*e>>8,this.vertexTransformedZ[s]=this.vertexTransformedZ[s]*i>>8}computeBounds(){this.x1=this.y1=this.z1=999999,this.diameter=this.x2=this.y2=this.z2=-999999;for(let t=0;t<this.numFaces;t++){let e=this.faceVertices[t],i=e[0],s=this.faceNumVertices[t],r=0,n=r=this.vertexTransformedX[i],o=0,a=o=this.vertexTransformedY[i],h=0,l=h=this.vertexTransformedZ[i];for(let t=0;t<s;t++)i=e[t],this.vertexTransformedX[i]<r?r=this.vertexTransformedX[i]:this.vertexTransformedX[i]>n&&(n=this.vertexTransformedX[i]),this.vertexTransformedY[i]<o?o=this.vertexTransformedY[i]:this.vertexTransformedY[i]>a&&(a=this.vertexTransformedY[i]),this.vertexTransformedZ[i]<h?h=this.vertexTransformedZ[i]:this.vertexTransformedZ[i]>l&&(l=this.vertexTransformedZ[i]);this.isolated||(this.faceBoundLeft[t]=r,this.faceBoundRight[t]=n,this.faceBoundBottom[t]=o,this.faceBoundTop[t]=a,this.faceBoundNear[t]=h,this.faceBoundFar[t]=l),n-r>this.diameter&&(this.diameter=n-r),a-o>this.diameter&&(this.diameter=a-o),l-h>this.diameter&&(this.diameter=l-h),r<this.x1&&(this.x1=r),n>this.x2&&(this.x2=n),o<this.y1&&(this.y1=o),a>this.y2&&(this.y2=a),h<this.z1&&(this.z1=h),l>this.z2&&(this.z2=l)}}light(){if(this.unlit)return;let t=this.lightDiffuse*this.lightDirectionMagnitude>>8;for(let n=0;n<this.numFaces;n++)this.faceIntensity[this.face]!==this.magic&&(this.faceIntensity[this.face]=(this.faceNormalX[n]*this.lightDirectionX+this.faceNormalY[n]*this.lightDirectionY+this.faceNormalZ[n]*this.lightDirectionZ)/t|0);let e=new Int32Array(this.numVertices),i=new Int32Array(this.numVertices),s=new Int32Array(this.numVertices),r=new Int32Array(this.numVertices);for(let n=0;n<this.numVertices;n++)e[n]=0,i[n]=0,s[n]=0,r[n]=0;for(let n=0;n<this.numFaces;n++)if(this.faceIntensity[n]===this.magic)for(let t=0;t<this.faceNumVertices[n];t++){let o=this.faceVertices[n][t];e[o]+=this.faceNormalX[n],i[o]+=this.faceNormalY[n],s[o]+=this.faceNormalZ[n],r[o]++}for(let n=0;n<this.numVertices;n++)r[n]>0&&(this.vertexIntensity[n]=(e[n]*this.lightDirectionX+i[n]*this.lightDirectionY+s[n]*this.lightDirectionZ)/(t*r[n])|0)}relight(){if(!this.unlit||!this.isolated){for(let t=0;t<this.numFaces;t++){let e,i=this.faceVertices[t],s=this.vertexTransformedX[i[0]],r=this.vertexTransformedY[i[0]],n=this.vertexTransformedZ[i[0]],o=this.vertexTransformedX[i[1]]-s,a=this.vertexTransformedY[i[1]]-r,h=this.vertexTransformedZ[i[1]]-n,l=this.vertexTransformedX[i[2]]-s,c=this.vertexTransformedY[i[2]]-r,u=this.vertexTransformedZ[i[2]]-n,d=a*u-c*h,m=h*l-u*o;for(e=o*c-l*a;d>8192||m>8192||e>8192||d<-8192||m<-8192||e<-8192;e>>=1)d>>=1,m>>=1;let p=256*Math.sqrt(d*d+m*m+e*e)|0;p<=0&&(p=1),this.faceNormalX[t]=65536*d/p|0,this.faceNormalY[t]=65536*m/p|0,this.faceNormalZ[t]=65535*e/p|0,this.normalScale[t]=-1}this.light()}}apply(){if(2===this.transformState){this.transformState=0;for(let t=0;t<this.numVertices;t++)this.vertexTransformedX[t]=this.vertexX[t],this.vertexTransformedY[t]=this.vertexY[t],this.vertexTransformedZ[t]=this.vertexZ[t];return this.x1=this.y1=this.z1=-9999999,void(this.diameter=this.x2=this.y2=this.z2=9999999)}if(1===this.transformState){this.transformState=0;for(let t=0;t<this.numVertices;t++)this.vertexTransformedX[t]=this.vertexX[t],this.vertexTransformedY[t]=this.vertexY[t],this.vertexTransformedZ[t]=this.vertexZ[t];this.transformKind>=2&&this.applyRotation(this.orientationYaw,this.orientationPitch,this.orientationRoll),this.transformKind>=3&&this.applyScale(this.scaleFx,this.scaleFy,this.scaleFz),this.transformKind>=4&&this.applyShear(this.shearXy,this.shearXz,this.shearYx,this.shearYz,this.shearZx,this.shearZy),this.transformKind>=1&&this.applyTranslate(this.baseX,this.baseY,this.baseZ),this.computeBounds(),this.relight()}}project(t,e,i,s,r,n,o,a){if(this.apply(),this.z1>Ts.frustumNearZ||this.z2<Ts.frustumFarZ||this.x1>Ts.frustumMinX||this.x2<Ts.frustumMaxX||this.y1>Ts.frustumMinY||this.y2<Ts.frustumMaxY)return void(this.visible=!1);this.visible=!0;let h=0,l=0,c=0,u=0,d=0,m=0;0!==n&&(h=ks.sine11[n],l=ks.sine11[n+1024]),0!==r&&(d=ks.sine11[r],m=ks.sine11[r+1024]),0!==s&&(c=ks.sine11[s],u=ks.sine11[s+1024]);for(let p=0;p<this.numVertices;p++){let f=this.vertexTransformedX[p]-t,g=this.vertexTransformedY[p]-e,w=this.vertexTransformedZ[p]-i;if(0!==n){let t=g*h+f*l>>15;g=g*l-f*h>>15,f=t}if(0!==r){let t=w*d+f*m>>15;w=w*m-f*d>>15,f=t}if(0!==s){let t=g*u-w*c>>15;w=g*c+w*u>>15,g=t}this.vertexViewX[p]=w>=a?(f<<o)/w|0:f<<o,this.vertexViewY[p]=w>=a?(g<<o)/w|0:g<<o,this.projectVertexX[p]=f,this.projectVertexY[p]=g,this.projectVertexZ[p]=w}}commit(){this.apply();for(let t=0;t<this.numVertices;t++)this.vertexX[t]=this.vertexTransformedX[t],this.vertexY[t]=this.vertexTransformedY[t],this.vertexZ[t]=this.vertexTransformedZ[t];this.baseX=this.baseY=this.baseZ=0,this.orientationYaw=this.orientationPitch=this.orientationRoll=0,this.scaleFx=this.scaleFy=this.scaleFz=256,this.shearXy=this.shearXz=this.shearYx=this.shearYz=this.shearZx=this.shearZy=256,this.transformKind=0}copy(...t){if(!t||!t.length){let t=[this],e=ks._from2A(t,1);return e.depth=this.depth,e.transparent=this.transparent,e}const[e,i,s,r]=t;let n=[this],o=ks._from6(n,1,e,i,s,r);return o.depth=this.depth,o}copyPosition(t){this.orientationYaw=t.orientationYaw,this.orientationPitch=t.orientationPitch,this.orientationRoll=t.orientationRoll,this.baseX=t.baseX,this.baseY=t.baseY,this.baseZ=t.baseZ,this.determineTransformKind(),this.transformState=1}readBase64(t){for(;10===t[this.dataPtr]||13===t[this.dataPtr];this.dataPtr++);let e=4096*ks.base64Alphabet[255&t[this.dataPtr++]]+64*ks.base64Alphabet[255&t[this.dataPtr++]]+ks.base64Alphabet[255&t[this.dataPtr++]]-131072|0;return 123456===e&&(e=this.magic),e}}ks.sine9=new Int32Array(512),ks.sine11=new Int32Array(2048),ks.base64Alphabet=new Int32Array(256);for(let Dr=0;Dr<256;Dr++)ks.sine9[Dr]=32768*Math.sin(.02454369*Dr)|0,ks.sine9[Dr+256]=32768*Math.cos(.02454369*Dr)|0;for(let Dr=0;Dr<1024;Dr++)ks.sine11[Dr]=32768*Math.sin(.00613592315*Dr)|0,ks.sine11[Dr+1024]=32768*Math.cos(.00613592315*Dr)|0;for(let Dr=0;Dr<10;Dr++)ks.base64Alphabet[48+Dr]=Dr;for(let Dr=0;Dr<26;Dr++)ks.base64Alphabet[65+Dr]=Dr+10;for(let Dr=0;Dr<26;Dr++)ks.base64Alphabet[97+Dr]=Dr+36;ks.base64Alphabet[163]=62,ks.base64Alphabet[36]=63,vs=ks;var As={};const Bs=0,Ls=1,Ms=2,Es=3,Ps=4,Ys=5,Xs=6,Ds=7,_s=8,Os=9,Rs=10,js=11,Us=12,Ns=14,Fs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!\"\xa3$%^&*()-_=+[{]};:'@#~,<.>/?\\| ";class Hs{constructor(t,e){this.controlCount=0,this.mouseX=0,this.mouseY=0,this.mouseLastButtonDown=0,this.mouseButtonDown=0,this.mouseMetaButtonHeld=0,this.mouseScrollDelta=0,this.focusControlIndex=-1,this.aBoolean219=!0,this.surface=t,this.maxControls=e,this.controlShown=new Int8Array(e),this.controlListScrollbarHandleDragged=new Int8Array(e),this.controlMaskText=new Int8Array(e),this.controlClicked=new Int8Array(e),this.controlUseAlternativeColour=new Int8Array(e),this.controlFlashText=new Int32Array(e),this.controlListEntryCount=new Int32Array(e),this.controlListEntryMouseButtonDown=new Int32Array(e),this.controlListEntryMouseOver=new Int32Array(e),this.controlX=new Int32Array(e),this.controlY=new Int32Array(e),this.controlType=new Int32Array(e),this.controlWidth=new Int32Array(e),this.controlHeight=new Int32Array(e),this.controlInputMaxLen=new Int32Array(e),this.controlTextSize=new Int32Array(e),this.controlText=[],this.controlText.length=e,this.controlListEntries=[];for(let i=0;i<e;i+=1)this.controlListEntries.push([]);this.colourScrollbarTop=this.rgbToIntMod(114,114,176),this.colourScrollbarBottom=this.rgbToIntMod(14,14,62),this.colourScrollbarHandleLeft=this.rgbToIntMod(200,208,232),this.colourScrollbarHandleMid=this.rgbToIntMod(96,129,184),this.colourScrollbarHandleRight=this.rgbToIntMod(53,95,115),this.colourRoundedBoxOut=this.rgbToIntMod(117,142,171),this.colourRoundedBoxMid=this.rgbToIntMod(98,122,158),this.colourRoundedBoxIn=this.rgbToIntMod(86,100,136),this.colourBoxTopNBottom=this.rgbToIntMod(135,146,179),this.colourBoxTopNBottom2=this.rgbToIntMod(97,112,151),this.colourBoxLeftNRight2=this.rgbToIntMod(88,102,136),this.colourBoxLeftNRight=this.rgbToIntMod(84,93,120)}rgbToIntMod(t,e,i){return Fi.rgbToInt(Hs.redMod*t/114|0,Hs.greenMod*e/114|0,Hs.blueMod*i/176|0)}handleMouse(t,e,i,s,r=0){if(this.mouseX=t,this.mouseY=e,this.mouseButtonDown=s,this.mouseScrollDelta=r,0!==i&&(this.mouseLastButtonDown=i),1===i)for(let n=0;n<this.controlCount;n++)this.controlShown[n]&&this.controlType[n]===Rs&&this.mouseX>=this.controlX[n]&&this.mouseY>=this.controlY[n]&&this.mouseX<=this.controlX[n]+this.controlWidth[n]&&this.mouseY<=this.controlY[n]+this.controlHeight[n]&&(this.controlClicked[n]=!0),this.controlShown[n]&&this.controlType[n]===Ns&&this.mouseX>=this.controlX[n]&&this.mouseY>=this.controlY[n]&&this.mouseX<=this.controlX[n]+this.controlWidth[n]&&this.mouseY<=this.controlY[n]+this.controlHeight[n]&&(this.controlListEntryMouseButtonDown[n]=1-this.controlListEntryMouseButtonDown[n]);1===s?this.mouseMetaButtonHeld++:this.mouseMetaButtonHeld=0}isClicked(t){return!(!this.controlShown[t]||!this.controlClicked[t]||(this.controlClicked[t]=!1,0))}keyPress(t){if(0!==t&&-1!==this.focusControlIndex&&null!==this.controlText[this.focusControlIndex]&&this.controlShown[this.focusControlIndex]){const e=this.controlText[this.focusControlIndex].length;if(8===t&&e>0&&(this.controlText[this.focusControlIndex]=this.controlText[this.focusControlIndex].slice(0,e-1)),(10===t||13===t)&&e>0&&(this.controlClicked[this.focusControlIndex]=!0),e<this.controlInputMaxLen[this.focusControlIndex])for(let i=0;i<Fs.length;i++)t===Fs.charCodeAt(i)&&(this.controlText[this.focusControlIndex]+=String.fromCharCode(t));if(9===t)do{this.focusControlIndex=(this.focusControlIndex+1)%this.controlCount}while(5!==this.controlType[this.focusControlIndex]&&6!==this.controlType[this.focusControlIndex])}}drawPanel(){for(let t=0;t<this.controlCount;t++)this.controlShown[t]&&(this.controlType[t]===Bs?this.drawText(t,this.controlX[t],this.controlY[t],this.controlText[t],this.controlTextSize[t]):this.controlType[t]===Ls?this.drawText(t,this.controlX[t]-(this.surface.textWidth(this.controlText[t],this.controlTextSize[t])/2|0),this.controlY[t],this.controlText[t],this.controlTextSize[t]):this.controlType[t]===Ms?this.drawBox(this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t]):this.controlType[t]===Es?this.drawLineHoriz(this.controlX[t],this.controlY[t],this.controlWidth[t]):this.controlType[t]===Ps?this.drawTextList(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t],this.controlTextSize[t],this.controlListEntries[t],this.controlListEntryCount[t],this.controlFlashText[t]):this.controlType[t]===Ys||this.controlType[t]===Xs?this.drawTextInput(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t],this.controlText[t],this.controlTextSize[t]):this.controlType[t]===Ds?this.drawOptionListHoriz(t,this.controlX[t],this.controlY[t],this.controlTextSize[t],this.controlListEntries[t]):this.controlType[t]===_s?this.drawOptionListVert(t,this.controlX[t],this.controlY[t],this.controlTextSize[t],this.controlListEntries[t]):this.controlType[t]===Os?this.drawTextListInteractive(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t],this.controlTextSize[t],this.controlListEntries[t],this.controlListEntryCount[t],this.controlFlashText[t]):this.controlType[t]===js?this.drawRoundedBox(this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t]):this.controlType[t]===Us?this.drawPicture(this.controlX[t],this.controlY[t],this.controlTextSize[t]):this.controlType[t]===Ns&&this.drawCheckbox(t,this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t]));this.mouseLastButtonDown=0}drawCheckbox(t,e,i,s,r){if(this.surface.drawBox(e,i,s,r,16777215),this.surface.drawLineHoriz(e,i,s,this.colourBoxTopNBottom),this.surface.drawLineVert(e,i,r,this.colourBoxTopNBottom),this.surface.drawLineHoriz(e,i+r-1,s,this.colourBoxLeftNRight),this.surface.drawLineVert(e+s-1,i,r,this.colourBoxLeftNRight),1===this.controlListEntryMouseButtonDown[t])for(let n=0;n<r;n++)this.surface.drawLineHoriz(e+n,i+n,1,0),this.surface.drawLineHoriz(e+s-1-n,i+n,1,0)}drawText(t,e,i,s,r){const n=i+(this.surface.textHeight(r)/3|0);this.drawString(t,e,n,s,r)}drawString(t,e,i,s,r){let n;n=this.controlUseAlternativeColour[t]?16777215:0,this.surface.drawString(s,e,i,r,n)}drawTextInput(t,e,i,s,r,n,o){let a=n;if(this.controlMaskText[t]){const t=a.length;a="";for(let e=0;e<t;e++)a+="X"}if(this.controlType[t]===Ys?1===this.mouseLastButtonDown&&this.mouseX>=e&&this.mouseY>=i-(r/2|0)&&this.mouseX<=e+s&&this.mouseY<=i+(r/2|0)&&(this.focusControlIndex=t):this.controlType[t]===Xs&&(1===this.mouseLastButtonDown&&this.mouseX>=e-(s/2|0)&&this.mouseY>=i-(r/2|0)&&this.mouseX<=e+s/2&&this.mouseY<=i+(r/2|0)&&(this.focusControlIndex=t,this.setMobileFocus(t,n)),e-=this.surface.textWidth(a,o)/2|0),this.focusControlIndex===t){const{mudclient:t}=this.surface,e=t.mobileInputCaret;t.options.mobile&&-1!==e?a=a.slice(0,e)+"*"+a.slice(e):a+="*"}const h=i+(this.surface.textHeight(o)/3|0);this.drawString(t,e,h,a,o)}drawBox(t,e,i,s){if(this.surface.setBounds(t,e,t+i,e+s),this.surface.drawGradient(t,e,i,s,this.colourBoxLeftNRight,this.colourBoxTopNBottom),Hs.drawBackgroundArrow)for(let r=t-(63&e);r<t+i;r+=128)for(let t=e-(31&e);t<e+s;t+=128)this.surface.drawSpriteAlpha(r,t,6+Hs.baseSpriteStart,128);this.surface.drawLineHoriz(t,e,i,this.colourBoxTopNBottom),this.surface.drawLineHoriz(t+1,e+1,i-2,this.colourBoxTopNBottom),this.surface.drawLineHoriz(t+2,e+2,i-4,this.colourBoxTopNBottom2),this.surface.drawLineVert(t,e,s,this.colourBoxTopNBottom),this.surface.drawLineVert(t+1,e+1,s-2,this.colourBoxTopNBottom),this.surface.drawLineVert(t+2,e+2,s-4,this.colourBoxTopNBottom2),this.surface.drawLineHoriz(t,e+s-1,i,this.colourBoxLeftNRight),this.surface.drawLineHoriz(t+1,e+s-2,i-2,this.colourBoxLeftNRight),this.surface.drawLineHoriz(t+2,e+s-3,i-4,this.colourBoxLeftNRight2),this.surface.drawLineVert(t+i-1,e,s,this.colourBoxLeftNRight),this.surface.drawLineVert(t+i-2,e+1,s-2,this.colourBoxLeftNRight),this.surface.drawLineVert(t+i-3,e+2,s-4,this.colourBoxLeftNRight2),this.surface.resetBounds()}drawRoundedBox(t,e,i,s){this.surface.drawBox(t,e,i,s,0),this.surface.drawBoxEdge(t,e,i,s,this.colourRoundedBoxOut),this.surface.drawBoxEdge(t+1,e+1,i-2,s-2,this.colourRoundedBoxMid),this.surface.drawBoxEdge(t+2,e+2,i-4,s-4,this.colourRoundedBoxIn),this.surface._drawSprite_from3(t,e,2+Hs.baseSpriteStart),this.surface._drawSprite_from3(t+i-7,e,3+Hs.baseSpriteStart),this.surface._drawSprite_from3(t,e+s-7,4+Hs.baseSpriteStart),this.surface._drawSprite_from3(t+i-7,e+s-7,5+Hs.baseSpriteStart)}drawPicture(t,e,i){this.surface._drawSprite_from3(t,e,i)}drawLineHoriz(t,e,i){this.surface.drawLineHoriz(t,e,i,16777215)}drawTextList(t,e,i,s,r,n,o,a,h){const l=r/this.surface.textHeight(n)|0,c=a-l;if(h>c&&(h=c),h<0&&(h=0),this.controlFlashText[t]=h,l<a){const n=e+s-12;let o=(r-27)*l/a|0;o<6&&(o=6);let u=(r-27-o)*h/c|0;0!==this.mouseScrollDelta&&this.mouseX>e&&this.mouseX<e+s&&this.mouseY>i&&this.mouseY<i+r&&((h+=this.mouseScrollDelta)<0?h=0:h>c&&(h=c),this.controlFlashText[t]=h),1===this.mouseButtonDown&&this.mouseX>=n&&this.mouseX<=n+12&&(this.mouseY>i&&this.mouseY<i+12&&h>0&&h--,this.mouseY>i+r-12&&this.mouseY<i+r&&h<a-l&&h++,this.controlFlashText[t]=h),1===this.mouseButtonDown&&(this.mouseX>=n&&this.mouseX<=n+12||this.mouseX>=n-12&&this.mouseX<=n+24&&this.controlListScrollbarHandleDragged[t])?this.mouseY>i+12&&this.mouseY<i+r-12&&(this.controlListScrollbarHandleDragged[t]=!0,(h=(this.mouseY-i-12-(o/2|0))*a/(r-24)|0)>c&&(h=c),h<0&&(h=0),this.controlFlashText[t]=h):this.controlListScrollbarHandleDragged[t]=!1,u=(r-27-o)*h/(a-l)|0,this.drawListContainer(e,i,s,r,u,o)}const u=r-l*this.surface.textHeight(n);let d=i+(5*this.surface.textHeight(n)/6+u/2)|0;for(let m=h;m<a;m++)if(this.drawString(t,e+2,d,o[m],n),(d+=this.surface.textHeight(n)-Hs.textListEntryHeightMod)>=i+r)return}drawListContainer(t,e,i,s,r,n){const o=t+i-12;this.surface.drawBoxEdge(o,e,12,s,0),this.surface._drawSprite_from3(o+1,e+1,Hs.baseSpriteStart),this.surface._drawSprite_from3(o+1,e+s-12,Hs.baseSpriteStart+1),this.surface.drawLineHoriz(o,e+13,12,0),this.surface.drawLineHoriz(o,e+s-13,12,0),this.surface.drawGradient(o+1,e+14,11,s-27,this.colourScrollbarTop,this.colourScrollbarBottom),this.surface.drawBox(o+3,r+e+14,7,n,this.colourScrollbarHandleMid),this.surface.drawLineVert(o+2,r+e+14,n,this.colourScrollbarHandleLeft),this.surface.drawLineVert(o+2+8,r+e+14,n,this.colourScrollbarHandleRight)}drawOptionListHoriz(t,e,i,s,r){let n=0;const o=r.length;for(let l=0;l<o;l++)n+=this.surface.textWidth(r[l],s),l<o-1&&(n+=this.surface.textWidth("  ",s));let a=e-(n/2|0);const h=i+(this.surface.textHeight(s)/3|0);for(let l=0;l<o;l++){let e;e=this.controlUseAlternativeColour[t]?16777215:0,this.mouseX>=a&&this.mouseX<=a+this.surface.textWidth(r[l],s)&&this.mouseY<=h&&this.mouseY>h-this.surface.textHeight(s)&&(e=this.controlUseAlternativeColour[t]?8421504:16777215,1===this.mouseLastButtonDown&&(this.controlListEntryMouseButtonDown[t]=l,this.controlClicked[t]=!0)),this.controlListEntryMouseButtonDown[t]===l&&(e=this.controlUseAlternativeColour[t]?16711680:12582912),this.surface.drawString(r[l],a,h,s,e),a+=this.surface.textWidth(r[l]+"  ",s)}}drawOptionListVert(t,e,i,s,r){const n=r.length;let o=i-(this.surface.textHeight(s)*(n-1)/2|0);for(let a=0;a<n;a++){let i;i=this.controlUseAlternativeColour[t]?16777215:0;const n=this.surface.textWidth(r[a],s);this.mouseX>=e-(n/2|0)&&this.mouseX<=e+(n/2|0)&&this.mouseY-2<=o&&this.mouseY-2>o-this.surface.textHeight(s)&&(i=this.controlUseAlternativeColour[t]?8421504:16777215,1===this.mouseLastButtonDown&&(this.controlListEntryMouseButtonDown[t]=a,this.controlClicked[t]=!0)),this.controlListEntryMouseButtonDown[t]===a&&(i=this.controlUseAlternativeColour[t]?16711680:12582912),this.surface.drawString(r[a],e-(n/2|0),o,s,i),o+=this.surface.textHeight(s)}}drawTextListInteractive(t,e,i,s,r,n,o,a,h){const l=r/this.surface.textHeight(n)|0,c=a-l;if(l<a){const n=e+s-12;let o=(r-27)*l/a|0;o<6&&(o=6);let u=(r-27-o)*h/c|0;0!==this.mouseScrollDelta&&this.mouseX>e&&this.mouseX<e+s&&this.mouseY>i&&this.mouseY<i+r&&((h+=this.mouseScrollDelta)<0?h=0:h>c&&(h=c),this.controlFlashText[t]=h),1===this.mouseButtonDown&&this.mouseX>=n&&this.mouseX<=n+12&&(this.mouseY>i&&this.mouseY<i+12&&h>0&&h--,this.mouseY>i+r-12&&this.mouseY<i+r&&h<c&&h++,this.controlFlashText[t]=h),1===this.mouseButtonDown&&(this.mouseX>=n&&this.mouseX<=n+12||this.mouseX>=n-12&&this.mouseX<=n+24&&this.controlListScrollbarHandleDragged[t])?this.mouseY>i+12&&this.mouseY<i+r-12&&(this.controlListScrollbarHandleDragged[t]=!0,(h=(this.mouseY-i-12-(o/2|0))*a/(r-24)|0)<0&&(h=0),h>c&&(h=c),this.controlFlashText[t]=h):this.controlListScrollbarHandleDragged[t]=!1,u=(r-27-o)*h/c|0,this.drawListContainer(e,i,s,r,u,o)}else h=0,this.controlFlashText[t]=0;this.controlListEntryMouseOver[t]=-1;const u=r-l*this.surface.textHeight(n);let d=i+((5*this.surface.textHeight(n)/6|0)+u/2|0);for(let m=h;m<a;m++){let a;if(a=this.controlUseAlternativeColour[t]?16777215:0,this.mouseX>=e+2&&this.mouseX<=e+s-12&&this.mouseY-2<=d&&this.mouseY-2>d-this.surface.textHeight(n)&&(a=this.controlUseAlternativeColour[t]?8421504:16777215,this.controlListEntryMouseOver[t]=m,1===this.mouseLastButtonDown&&(this.controlListEntryMouseButtonDown[t]=m,this.controlClicked[t]=!0)),this.controlListEntryMouseButtonDown[t]===m&&this.aBoolean219&&(a=16711680),this.surface.drawString(o[m],e+2,d,n,a),(d+=this.surface.textHeight(n))>=i+r)return}}addText(t,e,i,s,r){return this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=s,this.controlUseAlternativeColour[this.controlCount]=r,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlText[this.controlCount]=i,this.controlCount++}addTextCentre(t,e,i,s,r){return this.controlType[this.controlCount]=Ls,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=s,this.controlUseAlternativeColour[this.controlCount]=r,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlText[this.controlCount]=i,this.controlCount++}addButtonBackground(t,e,i,s){return this.controlType[this.controlCount]=Ms,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(i/2|0),this.controlY[this.controlCount]=e-(s/2|0),this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlCount++}addBoxRounded(t,e,i,s){return this.controlType[this.controlCount]=js,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(i/2|0),this.controlY[this.controlCount]=e-(s/2|0),this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlCount++}addSprite(t,e,i){const s=this.surface.spriteWidth[i],r=this.surface.spriteHeight[i];return this.controlType[this.controlCount]=Us,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(s/2|0),this.controlY[this.controlCount]=e-(r/2|0),this.controlWidth[this.controlCount]=s,this.controlHeight[this.controlCount]=r,this.controlTextSize[this.controlCount]=i,this.controlCount++}addTextList(t,e,i,s,r,n,o){return this.controlType[this.controlCount]=Ps,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlUseAlternativeColour[this.controlCount]=o,this.controlTextSize[this.controlCount]=r,this.controlInputMaxLen[this.controlCount]=n,this.controlListEntryCount[this.controlCount]=0,this.controlFlashText[this.controlCount]=0,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=n,this.controlListEntries[this.controlCount].fill(null),this.controlCount++}addTextListInput(t,e,i,s,r,n,o,a){return this.controlType[this.controlCount]=Ys,this.controlShown[this.controlCount]=!0,this.controlMaskText[this.controlCount]=o,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=r,this.controlUseAlternativeColour[this.controlCount]=a,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlInputMaxLen[this.controlCount]=n,this.controlText[this.controlCount]="",this.controlCount++}addTextInput(t,e,i,s,r,n,o,a){return this.controlType[this.controlCount]=Xs,this.controlShown[this.controlCount]=!0,this.controlMaskText[this.controlCount]=o,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=r,this.controlUseAlternativeColour[this.controlCount]=a,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlInputMaxLen[this.controlCount]=n,this.controlText[this.controlCount]="",this.controlCount++}addTextListInteractive(t,e,i,s,r,n,o){return this.controlType[this.controlCount]=Os,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlTextSize[this.controlCount]=r,this.controlUseAlternativeColour[this.controlCount]=o,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlInputMaxLen[this.controlCount]=n,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=n,this.controlListEntries[this.controlCount].fill(null),this.controlListEntryCount[this.controlCount]=0,this.controlFlashText[this.controlCount]=0,this.controlListEntryMouseButtonDown[this.controlCount]=-1,this.controlListEntryMouseOver[this.controlCount]=-1,this.controlCount++}addButton(t,e,i,s){return this.controlType[this.controlCount]=Rs,this.controlShown[this.controlCount]=!0,this.controlClicked[this.controlCount]=!1,this.controlX[this.controlCount]=t-(i/2|0),this.controlY[this.controlCount]=e-(s/2|0),this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlCount++}addLineHoriz(t,e,i){return this.controlType[this.controlCount]=Es,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlCount++}addOptionListHoriz(t,e,i,s,r){return this.controlType[this.controlCount]=Ds,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlTextSize[this.controlCount]=i,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=s,this.controlListEntries[this.controlCount].fill(null),this.controlListEntryCount[this.controlCount]=0,this.controlUseAlternativeColour[this.controlCount]=r,this.controlClicked[this.controlCount]=!1,this.controlCount++}addOptionListVert(t,e,i,s,r){return this.controlType[this.controlCount]=_s,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlTextSize[this.controlCount]=i,this.controlListEntries[this.controlCount]=[],this.controlListEntries[this.controlCount].length=s,this.controlListEntries[this.controlCount].fill(null),this.controlListEntryCount[this.controlCount]=0,this.controlUseAlternativeColour[this.controlCount]=r,this.controlClicked[this.controlCount]=!1,this.controlCount++}addCheckbox(t,e,i,s){return this.controlType[this.controlCount]=Ns,this.controlShown[this.controlCount]=!0,this.controlX[this.controlCount]=t,this.controlY[this.controlCount]=e,this.controlWidth[this.controlCount]=i,this.controlHeight[this.controlCount]=s,this.controlListEntryMouseButtonDown[this.controlCount]=0,this.controlCount++}toggleCheckbox(t,e){this.controlListEntryMouseButtonDown[t]=+e}isActivated(t){return 0!==this.controlListEntryMouseButtonDown[t]}clearList(t){this.controlListEntryCount[t]=0}resetListProps(t){this.controlFlashText[t]=0,this.controlListEntryMouseOver[t]=-1}addListEntry(t,e,i){this.controlListEntries[t][e]=i,e+1>this.controlListEntryCount[t]&&(this.controlListEntryCount[t]=e+1)}removeListEntry(t,e,i){let s=this.controlListEntryCount[t]++;if(s>=this.controlInputMaxLen[t]){s--,this.controlListEntryCount[t]--;for(let e=0;e<s;e++)this.controlListEntries[t][e]=this.controlListEntries[t][e+1]}this.controlListEntries[t][s]=e,i&&(this.controlFlashText[t]=999999)}updateText(t,e){this.controlText[t]=e}getText(t){return null===this.controlText[t]?"null":this.controlText[t]}show(t){this.controlShown[t]=!0}hide(t){this.controlShown[t]=!1}setFocus(t){this.focusControlIndex=t,this.setMobileFocus(t,"")}getListEntryIndex(t){return this.controlListEntryMouseOver[t]}setMobileFocus(t,e){const{mudclient:i}=this.surface;if(!i.options.mobile)return;const s=this.controlMaskText[t];this.surface.mudclient.openKeyboard(s?"password":"text",e,this.controlInputMaxLen[t],this.controlX[t],this.controlY[t],this.controlWidth[t],this.controlHeight[t])}}Hs.baseSpriteStart=0,Hs.drawBackgroundArrow=!0,Hs.redMod=114,Hs.greenMod=114,Hs.blueMod=176,Hs.textListEntryHeightMod=0,As=Hs;var Ws,Vs,Gs={exports:{}};Ws=this,Vs=function(){"use strict";class t{constructor(t){this.init(t)}init(t){this.option=Object.assign({},{inputCodec:"Int16",channels:1,sampleRate:8e3,flushTime:1e3},t),this.samples=new Float32Array,this.interval=setInterval(this.flush.bind(this),this.option.flushTime),this.convertValue=this.getConvertValue(),this.typedArray=this.getTypedArray(),this.initAudioContext()}getConvertValue(){const t={Int8:128,Int16:32768,Int32:2147483648,Float32:1};if(!t[this.option.inputCodec])throw new Error("wrong codec.please input one of these codecs:Int8,Int16,Int32,Float32");return t[this.option.inputCodec]}getTypedArray(){const t={Int8:Int8Array,Int16:Int16Array,Int32:Int32Array,Float32:Float32Array};if(!t[this.option.inputCodec])throw new Error("wrong codec.please input one of these codecs:Int8,Int16,Int32,Float32");return t[this.option.inputCodec]}initAudioContext(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=10,this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime}static isTypedArray(t){return t.byteLength&&t.buffer&&t.buffer.constructor==ArrayBuffer||t.constructor==ArrayBuffer}isSupported(e){if(!t.isTypedArray(e))throw new Error("\u8bf7\u4f20\u5165ArrayBuffer\u6216\u8005\u4efb\u610fTypedArray");return!0}feed(t){this.isSupported(t),t=this.getFormatedValue(t);const e=new Float32Array(this.samples.length+t.length);e.set(this.samples,0),e.set(t,this.samples.length),this.samples=e}getFormatedValue(t){t=t.constructor==ArrayBuffer?new this.typedArray(t):new this.typedArray(t.buffer);let e=new Float32Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i]/this.convertValue;return e}volume(t){this.gainNode.gain.value=t}destroy(){this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx.close(),this.audioCtx=null}flush(){if(!this.samples.length)return;var t=this.audioCtx.createBufferSource();const e=this.samples.length/this.option.channels,i=this.audioCtx.createBuffer(this.option.channels,e,this.option.sampleRate);for(let s=0;s<this.option.channels;s++){const t=i.getChannelData(s);let r=s,n=50;for(let i=0;i<e;i++)t[i]=this.samples[r],i<50&&(t[i]=t[i]*i/50),i>=e-51&&(t[i]=t[i]*n--/50),r+=this.option.channels}this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),console.log("start vs current "+this.startTime+" vs "+this.audioCtx.currentTime+" duration: "+i.duration),t.buffer=i,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=i.duration,this.samples=new Float32Array}async pause(){await this.audioCtx.suspend()}async continue(){await this.audioCtx.resume()}}return t},"object"==typeof Gs.exports?Gs.exports=Vs():"function"==typeof define&&define.amd?define(Vs):(Ws=Ws||self).PCMPlayer=Vs(),Gs=Gs.exports;var Zs,zs,qs={exports:{}};Zs=this,zs=function(t){function e(t){var e=~(t=-32768==t?-32767:t)>>8&128;if(e||(t*=-1),32635<t&&(t=32635),256<=t){var i=n[t>>8&127];t=i<<4|t>>i+3&15}else t>>=4;return t^e^85}function i(t){var e=0;128&(t^=85)&&(t&=-129,e=-1);var i=4+((240&t)>>4);return t=4!=i?1<<i|(15&t)<<i-4|1<<i-5:t<<1|1,-8*(0===e?t:-t)}function s(t){var e=t>>8&128;0!=e&&(t=-t),32635<(t+=132)&&(t=32635);var i=a[t>>7&255];return~(e|i<<4|t>>i+3&15)}function r(t){var e=(t=~t)>>4&7;return e=h[e]+((15&t)<<e+3),0!=(128&t)&&(e=-e),e}var n=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],o=Object.freeze({__proto__:null,encodeSample:e,decodeSample:i,encode:function(t){for(var i=new Uint8Array(t.length),s=0;s<t.length;s++)i[s]=e(t[s]);return i},decode:function(t){for(var e=new Int16Array(t.length),s=0;s<t.length;s++)e[s]=i(t[s]);return e}}),a=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],h=[0,132,396,924,1980,4092,8316,16764],l=Object.freeze({__proto__:null,encodeSample:s,decodeSample:r,encode:function(t){for(var e=new Uint8Array(t.length),i=0;i<t.length;i++)e[i]=s(t[i]);return e},decode:function(t){for(var e=new Int16Array(t.length),i=0;i<t.length;i++)e[i]=r(t[i]);return e}});t.alaw=o,t.mulaw=l,Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof qs.exports?zs(qs.exports):"function"==typeof define&&define.amd?define(["exports"],zs):zs((Zs=Zs||self).alawmulaw={}),qs=qs.exports;const{mulaw:$s}=qs;var Ks={};const Qs="0".charCodeAt(0),Js="9".charCodeAt(0),tr="a".charCodeAt(0),er="*".charCodeAt(0),ir="\\".charCodeAt(0),sr="A".charCodeAt(0),rr="Z".charCodeAt(0),nr=",".charCodeAt(0),or=".".charCodeAt(0),ar="j".charCodeAt(0),hr="q".charCodeAt(0),lr="'".charCodeAt(0),cr="/".charCodeAt(0),ur=" ".charCodeAt(0),dr="v".charCodeAt(0),mr="x".charCodeAt(0),pr="z".charCodeAt(0);function fr(t){const e=new Uint16Array(t.length);for(let i=0;i<t.length;i+=1)e[i]=t.charCodeAt(i);return e}function gr(t){return Array.from(t).map(t=>String.fromCharCode(t)).join("")}class wr{static loadFilters(t,e,i,s){wr.loadBad(e),wr.loadHost(i),wr.loadFragments(t),wr.loadTLD(s)}static loadTLD(t){const e=t.getUnsignedInt();wr.tldList=[],wr.tldType=new Int32Array(e);for(let i=0;i<e;i++){wr.tldType[i]=t.getUnsignedByte();const e=new Uint16Array(t.getUnsignedByte());for(let i=0;i<e.length;i++)e[i]=t.getUnsignedByte();wr.tldList.push(e)}}static loadBad(t){const e=t.getUnsignedInt();wr.badList=[],wr.badList.length=e,wr.badList.fill(null),wr.badCharIds=[],wr.badCharIds.length=e,wr.badCharIds.fill(null),wr.readBuffer(t,wr.badList,wr.badCharIds)}static loadHost(t){const e=t.getUnsignedInt();wr.hostList=[],wr.hostList.length=e,wr.hostList.fill(null),wr.hostCharIds=[],wr.hostCharIds.length=e,wr.hostCharIds.fill(null),wr.readBuffer(t,wr.hostList,wr.hostCharIds)}static loadFragments(t){wr.hashFragments=new Int32Array(t.getUnsignedInt());for(let e=0;e<wr.hashFragments.length;e++)wr.hashFragments[e]=t.getUnsignedShort()}static readBuffer(t,e,i){for(let s=0;s<e.length;s++){const r=new Uint16Array(t.getUnsignedByte());for(let e=0;e<r.length;e++)r[e]=t.getUnsignedByte();e[s]=r;const n=[];n.length=t.getUnsignedInt();for(let e=0;e<n.length;e++)n[e]=[255&t.getUnsignedByte(),255&t.getUnsignedByte()];n.length>0&&(i[s]=n)}}static filter(t){const e=fr(t.toLowerCase());wr.applyDotSlashFilter(e),wr.applyBadwordFilter(e),wr.applyHostFilter(e),wr.filterDigits(e);for(let i=0;i<wr.ignoreList.length;i++)for(let s=-1;-1!==(s=t.indexOf(wr.ignoreList[i],s+1));){const t=fr(wr.ignoreList[i]);for(let i=0;i<t.length;i++)e[i+s]=t[i]}return wr.forceLowerCase&&(wr.stripLowerCase(fr(t),e),wr.toLowerCase(e)),gr(e)}static stripLowerCase(t,e){for(let i=0;i<t.length;i++)e[i]!==er&&wr.isUpperCase(t[i])&&(e[i]=t[i])}static toLowerCase(t){let e=!0;for(let i=0;i<t.length;i++){const s=t[i];wr.isLetter(s)?e?wr.isLowerCase(s)&&(e=!1):wr.isUpperCase(s)&&(t[i]=s+97-65):e=!0}}static applyBadwordFilter(t){for(let e=0;e<2;e++)for(let i=wr.badList.length-1;i>=0;i--)wr.applyWordFilter(t,wr.badList[i],wr.badCharIds[i])}static applyHostFilter(t){for(let e=wr.hostList.length-1;e>=0;e--)wr.applyWordFilter(t,wr.hostList[e],wr.hostCharIds[e])}static applyDotSlashFilter(t){const e=t.slice(),i=fr("dot");wr.applyWordFilter(e,i,null);const s=t.slice(),r=fr("slash");wr.applyWordFilter(s,r,null);for(let n=0;n<wr.tldList.length;n++)wr.applyTLDFilter(t,e,s,wr.tldList[n],wr.tldType[n])}static applyTLDFilter(t,e,i,s,r){if(!(s.length>t.length))for(let n=0;n<=t.length-s.length;n++){let o=n,a=0;for(;o<t.length;){let e=0;const i=t[o];let r=0;if(o+1<t.length&&(r=t[o+1]),a<s.length&&(e=wr.compareLettersNumbers(s[a],i,r))>0)o+=e,a++;else{if(0===a)break;if((e=wr.compareLettersNumbers(s[a-1],i,r))>0)o+=e;else{if(a>=s.length||!wr.isSpecial(i))break;o++}}}if(a>=s.length){let a=!1;const h=wr.getAsteriskCount(t,e,n),l=wr.getAsteriskCount2(t,i,o-1);if(wr.DEBUGTLD&&console.log(`Potential tld: ${s} at char ${n} (type="${r}, startmatch="${h}, endmatch=${l})`),1===r&&h>0&&l>0&&(a=!0),2===r&&(h>2&&l>0||h>0&&l>2)&&(a=!0),3===r&&h>0&&l>2&&(a=!0),a){wr.DEBUGTLD&&console.log(`Filtered tld: ${s} at char ${n}`);let r=n,a=o-1;if(h>2){if(4===h){let t=!1;for(let i=r-1;i>=0;i--)if(t){if(e[i]!==er)break;r=i}else e[i]===er&&(r=i,t=!0)}let i=!1;for(let e=r-1;e>=0;e--)if(i){if(wr.isSpecial(t[e]))break;r=e}else wr.isSpecial(t[e])||(i=!0,r=e)}if(l>2){if(4===l){let e=!1;for(let s=a+1;s<t.length;s++)if(e){if(i[s]!==er)break;a=s}else i[s]===er&&(a=s,e=!0)}let e=!1;for(let i=a+1;i<t.length;i++)if(e){if(wr.isSpecial(t[i]))break;a=i}else wr.isSpecial(t[i])||(e=!0,a=i)}for(let e=r;e<=a;e++)t[e]=er}}}}static getAsteriskCount(t,e,i){if(0===i)return 2;for(let r=i-1;r>=0&&wr.isSpecial(t[r]);r--)if(t[r]===nr||t[r]===or)return 3;let s=0;for(let r=i-1;r>=0&&wr.isSpecial(e[r]);r--)e[r]===er&&s++;return s>=3?4:wr.isSpecial(t[i-1])?1:0}static getAsteriskCount2(t,e,i){if(i+1===t.length)return 2;for(let r=i+1;r<t.length&&wr.isSpecial(t[r]);r++)if(t[r]===ir||t[r]===cr)return 3;let s=0;for(let r=i+1;r<t.length&&wr.isSpecial(e[r]);r++)e[r]===er&&s++;return s>=5?4:wr.isSpecial(t[i+1])?1:0}static applyWordFilter(t,e,i){if(!(e.length>t.length))for(let s=0;s<=t.length-e.length;s++){let r=s,n=0,o=!1;for(;r<t.length;){let i=0;const s=t[r];let a=0;if(r+1<t.length&&(a=t[r+1]),n<e.length&&(i=wr.compareLettersSymbols(e[n],s,a))>0)r+=i,n++;else{if(0===n)break;if((i=wr.compareLettersSymbols(e[n-1],s,a))>0)r+=i;else{if(n>=e.length||!wr.isNotLowerCase(s))break;wr.isSpecial(s)&&s!==lr&&(o=!0),r++}}}if(n>=e.length){let n=!0;if(wr.DEBUGTLD&&console.log(`Potential word: ${e} at char ${s}`),o){let e=!1,i=!1;if((s-1<0||wr.isSpecial(t[s-1])&&t[s-1]!==lr)&&(e=!0),(r>=t.length||wr.isSpecial(t[r])&&t[r]!==lr)&&(i=!0),!e||!i){let i=!1,o=s-2;for(e&&(o=s);!i&&o<r;o++)if(o>=0&&(!wr.isSpecial(t[o])||t[o]===lr)){const e=new Uint16Array(3);let s;for(s=0;s<3&&!(o+s>=t.length||wr.isSpecial(t[o+s])&&t[o+s]!==lr);s++)e[s]=t[o+s];let r=!0;0===s&&(r=!1),s<3&&o-1>=0&&(!wr.isSpecial(t[o-1])||t[o-1]===lr)&&(r=!1),r&&!wr.containsFragmentHashes(e)&&(i=!0)}i||(n=!1)}}else{let e=ur;s-1>=0&&(e=t[s-1]);let o=ur;r<t.length&&(o=t[r]);const a=wr.getCharId(e),h=wr.getCharId(o);i&&wr.compareCharIds(i,a,h)&&(n=!1)}if(n){wr.DEBUGWORD&&console.log(`Filtered word: ${e} at char ${s}`);for(let e=s;e<r;e++)t[e]=er}}}}static compareCharIds(t,e,i){let s=0;if(t[s][0]===e&&t[s][1]===i)return!0;let r=t.length-1;if(t[r][0]===e&&t[r][1]===i)return!0;for(;s!==r&&s+1!==r;){const n=(s+r)/2|0;if(t[n][0]===e&&t[n][1]===i)return!0;e<t[n][0]||e===t[n][0]&&i<t[n][1]?r=n:s=n}return!1}static compareLettersNumbers(t,e,i){return t=String.fromCharCode(t),e=String.fromCharCode(e),i=String.fromCharCode(i),t===e||"e"===t&&"3"===e?1:("t"!==t||"7"!==e&&"+"!==e)&&("a"!==t||"4"!==e&&"@"!==e)?"o"===t&&"0"===e||"i"===t&&"1"===e||"s"===t&&"5"===e?1:"f"===t&&"p"===e&&"h"===i?2:"g"===t&&"9"===e?1:0:1}static compareLettersSymbols(t,e,i){if(t=String.fromCharCode(t),e=String.fromCharCode(e),i=String.fromCharCode(i),"*"===t)return 0;if(t===e)return 1;if(t>="a"&&t<="z"){if("e"===t)return"3"===e?1:0;if("t"===t)return"7"===e?1:0;if("a"===t)return"4"===e||"@"===e?1:0;if("o"===t)return"0"===e||"*"===e?1:"("===e&&")"===i?2:0;if("i"===t)return"y"===e||"l"===e||"j"===e||"l"===e||"!"===e||":"===e||";"===e?1:0;if("n"===t)return 0;if("s"===t)return"5"===e||"z"===e||"$"===e?1:0;if("r"===t)return 0;if("h"===t)return 0;if("l"===t)return"1"===e?1:0;if("d"===t)return 0;if("c"===t)return"("===e?1:0;if("u"===t)return"v"===e?1:0;if("m"===t)return 0;if("f"===t)return"p"===e&&"h"===i?2:0;if("p"===t)return 0;if("g"===t)return"9"===e||"6"===e?1:0;if("w"===t)return"v"===e&&"v"===i?2:0;if("y"===t)return 0;if("b"===t)return"1"===e&&"3"===i?2:0;if("v"===t)return 0;if("k"===t)return 0;if("x"===t)return")"===e&&"("===i?2:0;if("j"===t)return 0;if("q"===t)return 0;if("z"===t)return 0}if(t>="0"&&t<="9"){if("0"===t)return"o"===e||"O"===e?1:"("===e&&")"===i?2:0;if("1"===t)return"l"!==e?0:1;if("2"===t)return 0;if("3"===t)return 0;if("4"===t)return 0;if("5"===t)return 0;if("6"===t)return 0;if("7"===t)return 0;if("8"===t)return 0;if("9"===t)return 0}return"-"===t?0:","===t?"."===e?1:0:"."===t?","===e?1:0:"("===t||")"===t?0:"!"===t?"i"===e?1:0:("'"===t||wr.DEBUGWORD&&console.log(`Letter=${t} not matched`),0)}static getCharId(t){return t>=tr&&t<=pr?t-97+1:t===lr?28:t>=Qs&&t<=Js?t-48+29:27}static filterDigits(t){let e=0,i=0,s=0,r=0;for(;-1!=(e=wr.indexOfDigit(t,i));){let n=!1;for(let s=i;s>=0&&s<e&&!n;s++)wr.isSpecial(t[s])||wr.isNotLowerCase(t[s])||(n=!0);n&&(s=0),0===s&&(r=e),i=wr.indexOfNonDigit(t,e);let o=0;for(let s=e;s<i;s++)o=10*o+t[s]-48;if(o>255||i-e>8?s=0:s++,4===s){for(let e=r;e<i;e++)t[e]=er;s=0}}}static indexOfDigit(t,e){for(let i=e;i<t.length&&i>=0;i++)if(t[i]>=Qs&&t[i]<=Js)return i;return-1}static indexOfNonDigit(t,e){for(let i=e;i<t.length&&i>=0;i++)if(t[i]<Qs||t[i]>Js)return i;return t.length}static isSpecial(t){return!wr.isLetter(t)&&!wr.isDigit(t)}static isNotLowerCase(t){return t<tr||t>pr||t===dr||t===mr||t===ar||t===hr||t===pr}static isLetter(t){return t>=tr&&t<=pr||t>=sr&&t<=rr}static isDigit(t){return t>=Qs&&t<=Js}static isLowerCase(t){return t>=tr&&t<=pr}static isUpperCase(t){return t>=sr&&t<=rr}static containsFragmentHashes(t){let e=!0;for(let n=0;n<t.length;n++)wr.isDigit(t[n])||0===t[n]||(e=!1);if(e)return!0;const i=wr.wordToHash(t);let s=0,r=wr.hashFragments.length-1;if(i===wr.hashFragments[s]||i===wr.hashFragments[r])return!0;for(;s!=r&&s+1!=r;){const t=(s+r)/2|0;if(i===wr.hashFragments[t])return!0;i<wr.hashFragments[t]?r=t:s=t}return!1}static wordToHash(t){if(t.length>6)return 0;let e=0;for(let i=0;i<t.length;i++){const s=t[t.length-i-1];if(s>=tr&&s<=pr)e=38*e+s-97+1|0;else if(s===lr)e=38*e+27|0;else if(s>=Qs&&s<=Js)e=38*e+s-48+28|0;else if(0!==s)return wr.DEBUGWORD&&console.log("wordToHash failed on "+gr(t)),0}return e}}wr.DEBUGTLD=!1,wr.DEBUGWORD=!1,wr.forceLowerCase=!0,wr.ignoreList=["cook","cook's","cooks","seeks","sheet"],Ks=wr;var yr={};class br{constructor(t,e){this.regionWidth=96,this.regionHeight=96,this.anInt585=128,this.parentModel=null,this.landscapePack=null,this.mapPack=null,this.memberLandscapePack=null,this.memberMapPack=null,this.worldInitialised=!0,this.objectAdjacency=ys(new Int32Array(this.regionWidth*this.regionHeight),[this.regionWidth,this.regionHeight]),this.tileDirection=ys(new Int8Array(9216),[4,2304]),this.wallModels=[],this.roofModels=[];for(let i=0;i<4;i+=1){this.wallModels.push([]),this.roofModels.push([]);for(let t=0;t<64;t+=1)this.wallModels[i].push(null),this.roofModels[i].push(null)}this.terrainColours=new Int32Array(256),this.wallsNorthSouth=ys(new Int8Array(9216),[4,2304]),this.wallsRoof=ys(new Int8Array(9216),[4,2304]),this.terrainHeight=ys(new Int8Array(9216),[4,2304]),this.terrainColour=ys(new Int8Array(9216),[4,2304]),this.localY=new Int32Array(18432),this.tileDecoration=ys(new Int8Array(9216),[4,2304]),this.routeVia=ys(new Int32Array(this.regionWidth*this.regionHeight),[this.regionWidth,this.regionHeight]),this.wallsDiagonal=ys(new Int32Array(9216),[4,2304]),this.wallsEastWest=ys(new Int8Array(9216),[4,2304]),this.aBoolean592=!1,this.playerAlive=!1,this.terrainHeightLocal=ys(new Int32Array(this.regionWidth*this.regionHeight),[this.regionWidth,this.regionHeight]),this.terrainModels=[],this.terrainModels.length=64,this.terrainModels.fill(null),this.localX=new Int32Array(18432),this.baseMediaSprite=750,this.scene=t,this.surface=e;for(let i=0;i<64;i++)this.terrainColours[i]=Ts.rgb(255-4*i,255-(1.75*i|0),255-4*i);for(let i=0;i<64;i++)this.terrainColours[i+64]=Ts.rgb(3*i,144,0);for(let i=0;i<64;i++)this.terrainColours[i+128]=Ts.rgb(192-(1.5*i|0),144-(1.5*i|0),0);for(let i=0;i<64;i++)this.terrainColours[i+192]=Ts.rgb(96-(1.5*i|0),48+(1.5*i|0),0)}getWallEastWest(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.wallsEastWest.get(i,48*t+e)}setTerrainAmbience(t,e,i,s,r){let n=this.terrainModels[t+8*e];for(let o=0;o<n.numVertices;o++)if(n.vertexX[o]===i*this.anInt585&&n.vertexZ[o]===s*this.anInt585)return void n.setVertexAmbience(o,r)}getWallRoof(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),this.wallsRoof.get(i,48*t+e)}getElevation(t,e){let i=t>>7,s=e>>7,r=127&t,n=127&e;if(i<0||s<0||i>=95||s>=95)return 0;let o=0,a=0,h=0;return r<=this.anInt585-n?(o=this.getTerrainHeight(i,s),a=this.getTerrainHeight(i+1,s)-o,h=this.getTerrainHeight(i,s+1)-o):(o=this.getTerrainHeight(i+1,s+1),a=this.getTerrainHeight(i,s+1)-o,h=this.getTerrainHeight(i+1,s)-o,r=this.anInt585-r,n=this.anInt585-n),o+(a*r/this.anInt585|0)+(h*n/this.anInt585|0)}getWallDiagonal(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),this.wallsDiagonal.get(i,48*t+e)}removeObject2(t,e,i){if(!(t<0||e<0||t>=95||e>=95||1!==bs.objectType[i]&&2!==bs.objectType[i])){let s=this.getTileDirection(t,e),r=0,n=0;0===s||4===s?(r=bs.objectWidth[i],n=bs.objectHeight[i]):(n=bs.objectWidth[i],r=bs.objectHeight[i]);for(let o=t;o<t+r;o++)for(let t=e;t<e+n;t++){const e=this.objectAdjacency.get(o,t);1===bs.objectType[i]?this.objectAdjacency.set(o,t,64|e):0===s?(this.objectAdjacency.set(o,t,2|e),o>0&&this._setObjectAdjacency_from3(o-1,t,8)):2===s?(this.objectAdjacency.set(o,t,4|e),t<95&&this._setObjectAdjacency_from3(o,t+1,1)):4===s?(this.objectAdjacency.set(o,t,8|e),o<95&&this._setObjectAdjacency_from3(o+1,t,2)):6===s&&(this.objectAdjacency.set(o,t,1|e),t>0&&this._setObjectAdjacency_from3(o,t-1,4))}this.method404(t,e,r,n)}}removeWallObject(t,e,i,s){if(!(t<0||e<0||t>=95||e>=95)&&1===bs.wallObjectAdjacent[s]){const s=this.objectAdjacency.get(t,e);0===i?(this.objectAdjacency.set(t,e,65534&s),e>0&&this.method407(t,e-1,4)):1===i?(this.objectAdjacency.set(t,e,65533&s),t>0&&this.method407(t-1,e,8)):2===i?this.objectAdjacency.set(t,e,65519&s):3===i&&this.objectAdjacency.set(t,e,65503&s),this.method404(t,e,1,1)}}method402(t,e,i,s,r){let n=3*t,o=3*e,a=this.scene.method302(s),h=this.scene.method302(r);if(a=a>>1&8355711,h=h>>1&8355711,0===i)return this.surface.drawLineHoriz(n,o,3,a),this.surface.drawLineHoriz(n,o+1,2,a),this.surface.drawLineHoriz(n,o+2,1,a),this.surface.drawLineHoriz(n+2,o+1,1,h),void this.surface.drawLineHoriz(n+1,o+2,2,h);1===i&&(this.surface.drawLineHoriz(n,o,3,h),this.surface.drawLineHoriz(n+1,o+1,2,h),this.surface.drawLineHoriz(n+2,o+2,1,h),this.surface.drawLineHoriz(n,o+1,1,a),this.surface.drawLineHoriz(n,o+2,2,a))}_loadSection_from4I(t,e,i,s){let r="m"+i+(t/10|0)+t%10+(e/10|0)+e%10;try{if(null!==this.landscapePack){let t=Li.loadData(r+".hei",0,this.landscapePack);if(null===t&&null!==this.memberLandscapePack&&(t=Li.loadData(r+".hei",0,this.memberLandscapePack)),null!==t&&t.length>0){let e=0,i=0;for(let r=0;r<2304;){let n=255&t[e++];if(n<128&&(this.terrainHeight.set(s,r++,255&n),i=n),n>=128)for(let t=0;t<n-128;t++)this.terrainHeight.set(s,r++,255&i)}i=64;for(let t=0;t<48;t++)for(let e=0;e<48;e++)i=this.terrainHeight.get(s,48*e+t)+i&127,this.terrainHeight.set(s,48*e+t,2*i&255);i=0;for(let r=0;r<2304;){let n=255&t[e++];if(n<128&&(this.terrainColour.set(s,r++,255&n),i=n),n>=128)for(let t=0;t<n-128;t++)this.terrainColour.set(s,r++,255&i)}i=35;for(let t=0;t<48;t++)for(let e=0;e<48;e++)i=this.terrainColour.get(s,48*e+t)+i&127,this.terrainColour.set(s,48*e+t,2*i&255)}else for(let r=0;r<2304;r++)this.terrainHeight.set(s,r,0),this.terrainColour.set(s,r,0);if(null===(t=Li.loadData(r+".dat",0,this.mapPack))&&null!==this.memberMapPack&&(t=Li.loadData(r+".dat",0,this.memberMapPack)),null===t||0===t.length)throw new Error;let e=0;for(let r=0;r<2304;r++)this.wallsNorthSouth.set(s,r,t[e++]);for(let r=0;r<2304;r++)this.wallsEastWest.set(s,r,t[e++]);for(let r=0;r<2304;r++)this.wallsDiagonal.set(s,r,255&t[e++]);for(let r=0;r<2304;r++){let i=255&t[e++];i>0&&this.wallsDiagonal.set(s,r,i+12e3)}for(let r=0;r<2304;){let i=255&t[e++];if(i<128)this.wallsRoof.set(s,r++,255&i);else for(let t=0;t<i-128;t++)this.wallsRoof.set(s,r++,0)}let i=0;for(let r=0;r<2304;){let n=255&t[e++];if(n<128)this.tileDecoration.set(s,r++,255&n),i=n;else for(let t=0;t<n-128;t++)this.tileDecoration.set(s,r++,i)}for(let r=0;r<2304;){let i=255&t[e++];if(i<128)this.tileDirection.set(s,r++,255&i);else for(let t=0;t<i-128;t++)this.tileDirection.set(s,r++,0)}if(null!==(t=Li.loadData(r+".loc",0,this.mapPack))&&t.length>0){e=0;for(let i=0;i<2304;){let r=255&t[e++];r<128?this.wallsDiagonal.set(s,i++,r+48e3):i+=r-128}return}}else console.log("stub. removed reading from ../gamedata/");return}catch(Ui){console.error(Ui)}for(let n=0;n<2304;n++)this.terrainHeight.set(s,n,0),this.terrainColour.set(s,n,0),this.wallsNorthSouth.set(s,n,0),this.wallsEastWest.set(s,n,0),this.wallsDiagonal.set(s,n,0),this.wallsRoof.set(s,n,0),this.tileDecoration.set(s,n,0),0===i&&this.tileDecoration.set(s,n,-6),3===i&&this.tileDecoration.set(s,n,8),this.tileDirection.set(s,n,0)}loadSection(...t){switch(t.length){case 3:return this._loadSection_from3(...t);case 4:return"number"==typeof t[3]?this._loadSection_from4I(...t):this._loadSection_from4(...t)}}method404(t,e,i,s){if(!(t<1||e<1||t+i>=this.regionWidth||e+s>=this.regionHeight))for(let r=t;r<=t+i;r++)for(let t=e;t<=e+s;t++)0!=(99&this.getObjectAdjacency(r,t))||0!=(89&this.getObjectAdjacency(r-1,t))||0!=(86&this.getObjectAdjacency(r,t-1))||0!=(108&this.getObjectAdjacency(r-1,t-1))?this.method425(r,t,35):this.method425(r,t,0)}getObjectAdjacency(t,e){return t<0||e<0||t>=this.regionWidth||e>=this.regionHeight?0:this.objectAdjacency.get(t,e)}hasRoof(t,e){return this.getWallRoof(t,e)>0&&this.getWallRoof(t-1,e)>0&&this.getWallRoof(t-1,e-1)>0&&this.getWallRoof(t,e-1)>0}method407(t,e,i){const s=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,s&65535-i)}getTerrainColour(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.terrainColour.get(i,48*t+e)}reset(){this.worldInitialised&&this.scene.dispose();for(let t=0;t<64;t++){this.terrainModels[t]=null;for(let e=0;e<4;e++)this.wallModels[e][t]=null;for(let e=0;e<4;e++)this.roofModels[e][t]=null}}setTiles(){for(let t=0;t<this.regionWidth;t++)for(let e=0;e<this.regionHeight;e++)250===this.getTileDecoration(t,e,0)&&(47===t&&250!==this.getTileDecoration(t+1,e,0)&&2!==this.getTileDecoration(t+1,e,0)||47===e&&250!==this.getTileDecoration(t,e+1,0)&&2!==this.getTileDecoration(t,e+1,0)?this.setTileDecoration(t,e,9):this.setTileDecoration(t,e,2))}getWallNorthSouth(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.wallsNorthSouth.get(i,48*t+e)}getTileDirection(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),this.tileDirection.get(i,48*t+e)}_getTileDecoration_from4(t,e,i,s){const r=this._getTileDecoration_from3(t,e);return 0===r?s:bs.tileDecoration[r-1]}_getTileDecoration_from3(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),255&this.tileDecoration.get(i,48*t+e)}getTileDecoration(...t){switch(t.length){case 3:return this._getTileDecoration_from3(...t);case 4:return this._getTileDecoration_from4(...t)}}setTileDecoration(t,e,i){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return;let s=0;t>=48&&e<48?(s=1,t-=48):t<48&&e>=48?(s=2,e-=48):t>=48&&e>=48&&(s=3,t-=48,e-=48),this.tileDecoration.set(s,48*t+e,255&i)}route(t,e,i,s,r,n,o,a,h){for(let g=0;g<this.regionWidth;g++)for(let t=0;t<this.regionHeight;t++)this.routeVia.set(g,t,0);let l=0,c=0,u=t,d=e;this.routeVia.set(t,e,99),o[l]=t,a[l++]=e;let m,p=o.length,f=!1;for(;c!==l;){if(u=o[c],d=a[c],c=(c+1)%p,u>=i&&u<=r&&d>=s&&d<=n){f=!0;break}if(h){if(u>0&&u-1>=i&&u-1<=r&&d>=s&&d<=n&&0==(8&this.objectAdjacency.get(u-1,d))){f=!0;break}if(u<95&&u+1>=i&&u+1<=r&&d>=s&&d<=n&&0==(2&this.objectAdjacency.get(u+1,d))){f=!0;break}if(d>0&&u>=i&&u<=r&&d-1>=s&&d-1<=n&&0==(4&this.objectAdjacency.get(u,d-1))){f=!0;break}if(d<95&&u>=i&&u<=r&&d+1>=s&&d+1<=n&&0==(1&this.objectAdjacency.get(u,d+1))){f=!0;break}}u>0&&0===this.routeVia.get(u-1,d)&&0==(120&this.objectAdjacency.get(u-1,d))&&(o[l]=u-1,a[l]=d,l=(l+1)%p,this.routeVia.set(u-1,d,2)),u<95&&0===this.routeVia.get(u+1,d)&&0==(114&this.objectAdjacency.get(u+1,d))&&(o[l]=u+1,a[l]=d,l=(l+1)%p,this.routeVia.set(u+1,d,8)),d>0&&0===this.routeVia.get(u,d-1)&&0==(116&this.objectAdjacency.get(u,d-1))&&(o[l]=u,a[l]=d-1,l=(l+1)%p,this.routeVia.set(u,d-1,1)),d<95&&0===this.routeVia.get(u,d+1)&&0==(113&this.objectAdjacency.get(u,d+1))&&(o[l]=u,a[l]=d+1,l=(l+1)%p,this.routeVia.set(u,d+1,4)),u>0&&d>0&&0==(116&this.objectAdjacency.get(u,d-1))&&0==(120&this.objectAdjacency.get(u-1,d))&&0==(124&this.objectAdjacency.get(u-1,d-1))&&0===this.routeVia.get(u-1,d-1)&&(o[l]=u-1,a[l]=d-1,l=(l+1)%p,this.routeVia.set(u-1,d-1,3)),u<95&&d>0&&0==(116&this.objectAdjacency.get(u,d-1))&&0==(114&this.objectAdjacency.get(u+1,d))&&0==(118&this.objectAdjacency.get(u+1,d-1))&&0===this.routeVia.get(u+1,d-1)&&(o[l]=u+1,a[l]=d-1,l=(l+1)%p,this.routeVia.set(u+1,d-1,9)),u>0&&d<95&&0==(113&this.objectAdjacency.get(u,d+1))&&0==(120&this.objectAdjacency.get(u-1,d))&&0==(121&this.objectAdjacency.get(u-1,d+1))&&0===this.routeVia.get(u-1,d+1)&&(o[l]=u-1,a[l]=d+1,l=(l+1)%p,this.routeVia.set(u-1,d+1,6)),u<95&&d<95&&0==(113&this.objectAdjacency.get(u,d+1))&&0==(114&this.objectAdjacency.get(u+1,d))&&0==(115&this.objectAdjacency.get(u+1,d+1))&&0===this.routeVia.get(u+1,d+1)&&(o[l]=u+1,a[l]=d+1,l=(l+1)%p,this.routeVia.set(u+1,d+1,12))}if(!f)return-1;o[c=0]=u,a[c++]=d;for(let g=m=this.routeVia.get(u,d);u!==t||d!==e;g=this.routeVia.get(u,d))g!==m&&(m=g,o[c]=u,a[c++]=d),0!=(2&g)?u++:0!=(8&g)&&u--,0!=(1&g)?d++:0!=(4&g)&&d--;return c}_setObjectAdjacency_from4(t,e,i,s){if(!(t<0||e<0||t>=95||e>=95)&&1===bs.wallObjectAdjacent[s]){const s=this.objectAdjacency.get(t,e);0===i?(this.objectAdjacency.set(t,e,1|s),e>0&&this._setObjectAdjacency_from3(t,e-1,4)):1===i?(this.objectAdjacency.set(t,e,2|s),t>0&&this._setObjectAdjacency_from3(t-1,e,8)):2===i?this.objectAdjacency.set(t,e,16|s):3===i&&this.objectAdjacency.set(t,e,32|s),this.method404(t,e,1,1)}}setObjectAdjacency(...t){switch(t.length){case 4:return this._setObjectAdjacency_from4(...t);case 3:return this._setObjectAdjacency_from3(...t)}}_loadSection_from4(t,e,i,s){let r=(t+24)/48|0,n=(e+24)/48|0;if(this._loadSection_from4I(r-1,n-1,i,0),this._loadSection_from4I(r,n-1,i,1),this._loadSection_from4I(r-1,n,i,2),this._loadSection_from4I(r,n,i,3),this.setTiles(),null===this.parentModel&&(this.parentModel=vs._from7(18688,18688,!0,!0,!1,!1,!0)),s){this.surface.blackScreen();for(let e=0;e<this.regionWidth;e++)for(let t=0;t<this.regionHeight;t++)this.objectAdjacency.set(e,t,0);let t=this.parentModel;t.clear();for(let e=0;e<this.regionWidth;e++)for(let s=0;s<this.regionHeight;s++){let r=-this.getTerrainHeight(e,s);this.getTileDecoration(e,s,i)>0&&4===bs.tileType[this.getTileDecoration(e,s,i)-1]&&(r=0),this.getTileDecoration(e-1,s,i)>0&&4===bs.tileType[this.getTileDecoration(e-1,s,i)-1]&&(r=0),this.getTileDecoration(e,s-1,i)>0&&4===bs.tileType[this.getTileDecoration(e,s-1,i)-1]&&(r=0),this.getTileDecoration(e-1,s-1,i)>0&&4===bs.tileType[this.getTileDecoration(e-1,s-1,i)-1]&&(r=0);let n=t.vertexAt(e*this.anInt585,r,s*this.anInt585),o=(10*Math.random()|0)-5;t.setVertexAmbience(n,o)}for(let e=0;e<95;e++)for(let s=0;s<95;s++){let r=this.getTerrainColour(e,s),n=this.terrainColours[r],o=n,a=n,h=0;if(1!==i&&2!==i||(n=br.colourTransparent,o=br.colourTransparent,a=br.colourTransparent),this.getTileDecoration(e,s,i)>0){let t=this.getTileDecoration(e,s,i),r=bs.tileType[t-1],l=this.getTileType(e,s,i);if(n=o=bs.tileDecoration[t-1],4===r&&(n=1,o=1,12===t&&(n=31,o=31)),5===r?this.getWallDiagonal(e,s)>0&&this.getWallDiagonal(e,s)<24e3&&(this.getTileDecoration(e-1,s,i,a)!==br.colourTransparent&&this.getTileDecoration(e,s-1,i,a)!==br.colourTransparent?(n=this.getTileDecoration(e-1,s,i,a),h=0):this.getTileDecoration(e+1,s,i,a)!==br.colourTransparent&&this.getTileDecoration(e,s+1,i,a)!==br.colourTransparent?(o=this.getTileDecoration(e+1,s,i,a),h=0):this.getTileDecoration(e+1,s,i,a)!==br.colourTransparent&&this.getTileDecoration(e,s-1,i,a)!==br.colourTransparent?(o=this.getTileDecoration(e+1,s,i,a),h=1):this.getTileDecoration(e-1,s,i,a)!==br.colourTransparent&&this.getTileDecoration(e,s+1,i,a)!==br.colourTransparent&&(n=this.getTileDecoration(e-1,s,i,a),h=1)):(2!==r||this.getWallDiagonal(e,s)>0&&this.getWallDiagonal(e,s)<24e3)&&(this.getTileType(e-1,s,i)!==l&&this.getTileType(e,s-1,i)!==l?(n=a,h=0):this.getTileType(e+1,s,i)!==l&&this.getTileType(e,s+1,i)!==l?(o=a,h=0):this.getTileType(e+1,s,i)!==l&&this.getTileType(e,s-1,i)!==l?(o=a,h=1):this.getTileType(e-1,s,i)!==l&&this.getTileType(e,s+1,i)!==l&&(n=a,h=1)),0!==bs.tileAdjacent[t-1]){const t=this.objectAdjacency.get(e,s);this.objectAdjacency.set(e,s,64|t)}if(2===bs.tileType[t-1]){const t=this.objectAdjacency.get(e,s);this.objectAdjacency.set(e,s,128|t)}}this.method402(e,s,h,n,o);let l=this.getTerrainHeight(e+1,s+1)-this.getTerrainHeight(e+1,s)+this.getTerrainHeight(e,s+1)-this.getTerrainHeight(e,s);if(n!==o||0!==l){let i=new Int32Array(3),r=new Int32Array(3);if(0===h){if(n!==br.colourTransparent){i[0]=s+96*e+96,i[1]=s+96*e,i[2]=s+96*e+1;let r=t.createFace(3,i,br.colourTransparent,n);this.localX[r]=e,this.localY[r]=s,t.faceTag[r]=2e5+r}if(o!==br.colourTransparent){r[0]=s+96*e+1,r[1]=s+96*e+96+1,r[2]=s+96*e+96;let i=t.createFace(3,r,br.colourTransparent,o);this.localX[i]=e,this.localY[i]=s,t.faceTag[i]=2e5+i}}else{if(n!==br.colourTransparent){i[0]=s+96*e+1,i[1]=s+96*e+96+1,i[2]=s+96*e;let r=t.createFace(3,i,br.colourTransparent,n);this.localX[r]=e,this.localY[r]=s,t.faceTag[r]=2e5+r}if(o!==br.colourTransparent){r[0]=s+96*e+96,r[1]=s+96*e,r[2]=s+96*e+96+1;let i=t.createFace(3,r,br.colourTransparent,o);this.localX[i]=e,this.localY[i]=s,t.faceTag[i]=2e5+i}}}else if(n!==br.colourTransparent){let i=new Int32Array(4);i[0]=s+96*e+96,i[1]=s+96*e,i[2]=s+96*e+1,i[3]=s+96*e+96+1;let r=t.createFace(4,i,br.colourTransparent,n);this.localX[r]=e,this.localY[r]=s,t.faceTag[r]=2e5+r}}for(let e=1;e<95;e++)for(let s=1;s<95;s++)if(this.getTileDecoration(e,s,i)>0&&4===bs.tileType[this.getTileDecoration(e,s,i)-1]){let r=bs.tileDecoration[this.getTileDecoration(e,s,i)-1],n=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s),s*this.anInt585),o=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s),s*this.anInt585),a=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s+1),(s+1)*this.anInt585),h=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s+1),(s+1)*this.anInt585),l=new Int32Array([n,o,a,h]),c=t.createFace(4,l,r,br.colourTransparent);this.localX[c]=e,this.localY[c]=s,t.faceTag[c]=2e5+c,this.method402(e,s,0,r,r)}else if(0===this.getTileDecoration(e,s,i)||3!==bs.tileType[this.getTileDecoration(e,s,i)-1]){if(this.getTileDecoration(e,s+1,i)>0&&4===bs.tileType[this.getTileDecoration(e,s+1,i)-1]){let r=bs.tileDecoration[this.getTileDecoration(e,s+1,i)-1],n=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s),s*this.anInt585),o=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s),s*this.anInt585),a=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s+1),(s+1)*this.anInt585),h=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s+1),(s+1)*this.anInt585),l=new Int32Array([n,o,a,h]),c=t.createFace(4,l,r,br.colourTransparent);this.localX[c]=e,this.localY[c]=s,t.faceTag[c]=2e5+c,this.method402(e,s,0,r,r)}if(this.getTileDecoration(e,s-1,i)>0&&4===bs.tileType[this.getTileDecoration(e,s-1,i)-1]){let r=bs.tileDecoration[this.getTileDecoration(e,s-1,i)-1],n=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s),s*this.anInt585),o=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s),s*this.anInt585),a=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s+1),(s+1)*this.anInt585),h=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s+1),(s+1)*this.anInt585),l=new Int32Array([n,o,a,h]),c=t.createFace(4,l,r,br.colourTransparent);this.localX[c]=e,this.localY[c]=s,t.faceTag[c]=2e5+c,this.method402(e,s,0,r,r)}if(this.getTileDecoration(e+1,s,i)>0&&4===bs.tileType[this.getTileDecoration(e+1,s,i)-1]){let r=bs.tileDecoration[this.getTileDecoration(e+1,s,i)-1],n=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s),s*this.anInt585),o=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s),s*this.anInt585),a=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s+1),(s+1)*this.anInt585),h=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s+1),(s+1)*this.anInt585),l=new Int32Array([n,o,a,h]),c=t.createFace(4,l,r,br.colourTransparent);this.localX[c]=e,this.localY[c]=s,t.faceTag[c]=2e5+c,this.method402(e,s,0,r,r)}if(this.getTileDecoration(e-1,s,i)>0&&4===bs.tileType[this.getTileDecoration(e-1,s,i)-1]){let r=bs.tileDecoration[this.getTileDecoration(e-1,s,i)-1],n=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s),s*this.anInt585),o=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s),s*this.anInt585),a=t.vertexAt((e+1)*this.anInt585,-this.getTerrainHeight(e+1,s+1),(s+1)*this.anInt585),h=t.vertexAt(e*this.anInt585,-this.getTerrainHeight(e,s+1),(s+1)*this.anInt585),l=new Int32Array([n,o,a,h]),c=t.createFace(4,l,r,br.colourTransparent);this.localX[c]=e,this.localY[c]=s,t.faceTag[c]=2e5+c,this.method402(e,s,0,r,r)}}t._setLight_from6(!0,40,48,-50,-10,-50),this.terrainModels=this.parentModel.split(0,0,1536,1536,8,64,233,!1);for(let e=0;e<64;e++)this.scene.addModel(this.terrainModels[e]);for(let e=0;e<this.regionWidth;e++)for(let t=0;t<this.regionHeight;t++)this.terrainHeightLocal.set(e,t,this.getTerrainHeight(e,t))}this.parentModel.clear();let o=6316128;for(let a=0;a<95;a++)for(let t=0;t<95;t++){let e=this.getWallEastWest(a,t);if(e>0&&(0===bs.wallObjectInvisible[e-1]||this.aBoolean592)){if(this.method422(this.parentModel,e-1,a,t,a+1,t),s&&0!==bs.wallObjectAdjacent[e-1]){const e=this.objectAdjacency.get(a,t);this.objectAdjacency.set(a,t,1|e),t>0&&this._setObjectAdjacency_from3(a,t-1,4)}s&&this.surface.drawLineHoriz(3*a,3*t,3,o)}if((e=this.getWallNorthSouth(a,t))>0&&(0===bs.wallObjectInvisible[e-1]||this.aBoolean592)){if(this.method422(this.parentModel,e-1,a,t,a,t+1),s&&0!==bs.wallObjectAdjacent[e-1]){const e=this.objectAdjacency.get(a,t);this.objectAdjacency.set(a,t,2|e),a>0&&this._setObjectAdjacency_from3(a-1,t,8)}s&&this.surface.drawLineVert(3*a,3*t,3,o)}if((e=this.getWallDiagonal(a,t))>0&&e<12e3&&(0===bs.wallObjectInvisible[e-1]||this.aBoolean592)){if(this.method422(this.parentModel,e-1,a,t,a+1,t+1),s&&0!==bs.wallObjectAdjacent[e-1]){const e=this.objectAdjacency.get(a,t);this.objectAdjacency.set(a,t,32|e)}s&&(this.surface.setPixel(3*a,3*t,o),this.surface.setPixel(3*a+1,3*t+1,o),this.surface.setPixel(3*a+2,3*t+2,o))}if(e>12e3&&e<24e3&&(0===bs.wallObjectInvisible[e-12001]||this.aBoolean592)){if(this.method422(this.parentModel,e-12001,a+1,t,a,t+1),s&&0!==bs.wallObjectAdjacent[e-12001]){const e=this.objectAdjacency.get(a,t);this.objectAdjacency.set(a,t,16|e)}s&&(this.surface.setPixel(3*a+2,3*t,o),this.surface.setPixel(3*a+1,3*t+1,o),this.surface.setPixel(3*a,3*t+2,o))}}s&&this.surface.drawSpriteMinimap(this.baseMediaSprite-1,0,0,285,285),this.parentModel._setLight_from6(!1,60,24,-50,-10,-50),this.wallModels[i]=this.parentModel.split(0,0,1536,1536,8,64,338,!0);for(let a=0;a<64;a++)this.scene.addModel(this.wallModels[i][a]);for(let a=0;a<95;a++)for(let t=0;t<95;t++){let e=this.getWallEastWest(a,t);e>0&&this.method428(e-1,a,t,a+1,t),(e=this.getWallNorthSouth(a,t))>0&&this.method428(e-1,a,t,a,t+1),(e=this.getWallDiagonal(a,t))>0&&e<12e3&&this.method428(e-1,a,t,a+1,t+1),e>12e3&&e<24e3&&this.method428(e-12001,a+1,t,a,t+1)}for(let a=1;a<95;a++)for(let t=1;t<95;t++)if(this.getWallRoof(a,t)>0){let e=a,i=t,s=a+1,r=t,n=a+1,o=t+1,h=a,l=t+1,c=0,u=this.terrainHeightLocal.get(e,i),d=this.terrainHeightLocal.get(s,r),m=this.terrainHeightLocal.get(n,o),p=this.terrainHeightLocal.get(h,l);if(u>8e4&&(u-=8e4),d>8e4&&(d-=8e4),m>8e4&&(m-=8e4),p>8e4&&(p-=8e4),u>c&&(c=u),d>c&&(c=d),m>c&&(c=m),p>c&&(c=p),c>=8e4&&(c-=8e4),u<8e4)this.terrainHeightLocal.set(e,i,c);else{const t=this.terrainHeightLocal.get(e,i);this.terrainHeightLocal.set(e,i,t-8e4)}if(d<8e4)this.terrainHeightLocal.set(s,r,c);else{const t=this.terrainHeightLocal.get(s,r);this.terrainHeightLocal.set(s,r,t-8e4)}if(m<8e4)this.terrainHeightLocal.set(n,o,c);else{const t=this.terrainHeightLocal.get(n,o);this.terrainHeightLocal.set(n,o,t-8e4)}if(p<8e4)this.terrainHeightLocal.set(h,l,c);else{const t=this.terrainHeightLocal.get(h,l);this.terrainHeightLocal.set(h,l,t-8e4)}}this.parentModel.clear();for(let a=1;a<95;a++)for(let t=1;t<95;t++){let e=this.getWallRoof(a,t);if(e>0){let i=a,s=t,r=a+1,n=t,o=a+1,h=t+1,l=a,c=t+1,u=a*this.anInt585,d=t*this.anInt585,m=u+this.anInt585,p=d+this.anInt585,f=u,g=d,w=m,y=p,b=this.terrainHeightLocal.get(i,s),C=this.terrainHeightLocal.get(r,n),S=this.terrainHeightLocal.get(o,h),I=this.terrainHeightLocal.get(l,c),T=bs.roofHeight[e-1];this.hasRoof(i,s)&&b<8e4&&(b+=T+8e4,this.terrainHeightLocal.set(i,s,b)),this.hasRoof(r,n)&&C<8e4&&(C+=T+8e4,this.terrainHeightLocal.set(r,n,C)),this.hasRoof(o,h)&&S<8e4&&(S+=T+8e4,this.terrainHeightLocal.set(o,h,S)),this.hasRoof(l,c)&&I<8e4&&(I+=T+8e4,this.terrainHeightLocal.set(l,c,I)),b>=8e4&&(b-=8e4),C>=8e4&&(C-=8e4),S>=8e4&&(S-=8e4),I>=8e4&&(I-=8e4);let x=16;if(this.method427(i-1,s)||(u-=x),this.method427(i+1,s)||(u+=x),this.method427(i,s-1)||(d-=x),this.method427(i,s+1)||(d+=x),this.method427(r-1,n)||(m-=x),this.method427(r+1,n)||(m+=x),this.method427(r,n-1)||(g-=x),this.method427(r,n+1)||(g+=x),this.method427(o-1,h)||(w-=x),this.method427(o+1,h)||(w+=x),this.method427(o,h-1)||(p-=x),this.method427(o,h+1)||(p+=x),this.method427(l-1,c)||(f-=x),this.method427(l+1,c)||(f+=x),this.method427(l,c-1)||(y-=x),this.method427(l,c+1)||(y+=x),e=bs.roofNumVertices[e-1],b=-b,C=-C,S=-S,I=-I,this.getWallDiagonal(a,t)>12e3&&this.getWallDiagonal(a,t)<24e3&&0===this.getWallRoof(a-1,t-1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(w,S,p),t[1]=this.parentModel.vertexAt(f,I,y),t[2]=this.parentModel.vertexAt(m,C,g),this.parentModel.createFace(3,t,e,br.colourTransparent)}else if(this.getWallDiagonal(a,t)>12e3&&this.getWallDiagonal(a,t)<24e3&&0===this.getWallRoof(a+1,t+1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(u,b,d),t[1]=this.parentModel.vertexAt(m,C,g),t[2]=this.parentModel.vertexAt(f,I,y),this.parentModel.createFace(3,t,e,br.colourTransparent)}else if(this.getWallDiagonal(a,t)>0&&this.getWallDiagonal(a,t)<12e3&&0===this.getWallRoof(a+1,t-1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(f,I,y),t[1]=this.parentModel.vertexAt(u,b,d),t[2]=this.parentModel.vertexAt(w,S,p),this.parentModel.createFace(3,t,e,br.colourTransparent)}else if(this.getWallDiagonal(a,t)>0&&this.getWallDiagonal(a,t)<12e3&&0===this.getWallRoof(a-1,t+1)){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(m,C,g),t[1]=this.parentModel.vertexAt(w,S,p),t[2]=this.parentModel.vertexAt(u,b,d),this.parentModel.createFace(3,t,e,br.colourTransparent)}else if(b===C&&S===I){let t=new Int32Array(4);t[0]=this.parentModel.vertexAt(u,b,d),t[1]=this.parentModel.vertexAt(m,C,g),t[2]=this.parentModel.vertexAt(w,S,p),t[3]=this.parentModel.vertexAt(f,I,y),this.parentModel.createFace(4,t,e,br.colourTransparent)}else if(b===I&&C===S){let t=new Int32Array(4);t[0]=this.parentModel.vertexAt(f,I,y),t[1]=this.parentModel.vertexAt(u,b,d),t[2]=this.parentModel.vertexAt(m,C,g),t[3]=this.parentModel.vertexAt(w,S,p),this.parentModel.createFace(4,t,e,br.colourTransparent)}else{let i=!0;if(this.getWallRoof(a-1,t-1)>0&&(i=!1),this.getWallRoof(a+1,t+1)>0&&(i=!1),i){let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(u,b,d),t[1]=this.parentModel.vertexAt(m,C,g),t[2]=this.parentModel.vertexAt(f,I,y),this.parentModel.createFace(3,t,e,br.colourTransparent);let i=new Int32Array(3);i[0]=this.parentModel.vertexAt(w,S,p),i[1]=this.parentModel.vertexAt(f,I,y),i[2]=this.parentModel.vertexAt(m,C,g),this.parentModel.createFace(3,i,e,br.colourTransparent)}else{let t=new Int32Array(3);t[0]=this.parentModel.vertexAt(m,C,g),t[1]=this.parentModel.vertexAt(w,S,p),t[2]=this.parentModel.vertexAt(u,b,d),this.parentModel.createFace(3,t,e,br.colourTransparent);let i=new Int32Array(3);i[0]=this.parentModel.vertexAt(f,I,y),i[1]=this.parentModel.vertexAt(u,b,d),i[2]=this.parentModel.vertexAt(w,S,p),this.parentModel.createFace(3,i,e,br.colourTransparent)}}}}this.parentModel._setLight_from6(!0,50,50,-50,-10,-50),this.roofModels[i]=this.parentModel.split(0,0,1536,1536,8,64,169,!0);for(let a=0;a<64;a++)this.scene.addModel(this.roofModels[i][a]);if(null===this.roofModels[i][0])throw new EvalError("null roof!");for(let a=0;a<this.regionWidth;a++)for(let t=0;t<this.regionHeight;t++)if(this.terrainHeightLocal.get(a,t)>=8e4){const e=this.terrainHeightLocal.get(a,t);this.terrainHeightLocal.set(a,t,e-8e4)}}_setObjectAdjacency_from3(t,e,i){const s=this.objectAdjacency.get(t,e);this.objectAdjacency.set(t,e,s|i)}getTileType(t,e,i){let s=this.getTileDecoration(t,e,i);return 0===s?-1:2!==bs.tileType[s-1]?0:1}addModels(t){for(let e=0;e<94;e++)for(let i=0;i<94;i++)if(this.getWallDiagonal(e,i)>48e3&&this.getWallDiagonal(e,i)<6e4){let s=this.getWallDiagonal(e,i)-48001,r=this.getTileDirection(e,i),n=0,o=0;0===r||4===r?(n=bs.objectWidth[s],o=bs.objectHeight[s]):(o=bs.objectWidth[s],n=bs.objectHeight[s]),this.removeObject2(e,i,s);let a=t[bs.objectModelIndex[s]].copy(!1,!0,!1,!1),h=(e+e+n)*this.anInt585/2|0,l=(i+i+o)*this.anInt585/2|0;if(a.translate(h,-this.getElevation(h,l),l),a.orient(0,32*this.getTileDirection(e,i),0),this.scene.addModel(a),a._setLight_from5(48,48,-50,-10,-50),n>1||o>1)for(let t=e;t<e+n;t++)for(let r=i;r<i+o;r++)if((t>e||r>i)&&this.getWallDiagonal(t,r)-48001===s){let e=t,i=r,s=0;e>=48&&i<48?(s=1,e-=48):e<48&&i>=48?(s=2,i-=48):e>=48&&i>=48&&(s=3,e-=48,i-=48),this.wallsDiagonal.set(s,48*e+i,0)}}}method422(t,e,i,s,r,n){this.method425(i,s,40),this.method425(r,n,40);let o=bs.wallObjectHeight[e],a=bs.wallObjectTextureFront[e],h=bs.wallObjectTextureBack[e],l=i*this.anInt585,c=s*this.anInt585,u=r*this.anInt585,d=n*this.anInt585,m=t.vertexAt(l,-this.terrainHeightLocal.get(i,s),c),p=t.vertexAt(l,-this.terrainHeightLocal.get(i,s)-o,c),f=t.vertexAt(u,-this.terrainHeightLocal.get(r,n)-o,d),g=t.vertexAt(u,-this.terrainHeightLocal.get(r,n),d),w=new Int32Array([m,p,f,g]),y=t.createFace(4,w,a,h);return 5===bs.wallObjectInvisible[e]?void(t.faceTag[y]=3e4+e):void(t.faceTag[y]=0)}getTerrainHeight(t,e){if(t<0||t>=this.regionWidth||e<0||e>=this.regionHeight)return 0;let i=0;return t>=48&&e<48?(i=1,t-=48):t<48&&e>=48?(i=2,e-=48):t>=48&&e>=48&&(i=3,t-=48,e-=48),3*(255&this.terrainHeight.get(i,48*t+e))}_loadSection_from3(t,e,i){this.reset();let s=(t+24)/48|0,r=(e+24)/48|0;this._loadSection_from4(t,e,i,!0),0===i&&(this._loadSection_from4(t,e,1,!1),this._loadSection_from4(t,e,2,!1),this._loadSection_from4I(s-1,r-1,i,0),this._loadSection_from4I(s,r-1,i,1),this._loadSection_from4I(s-1,r,i,2),this._loadSection_from4I(s,r,i,3),this.setTiles())}method425(t,e,i){let s=t/12|0,r=e/12|0,n=(t-1)/12|0,o=(e-1)/12|0;this.setTerrainAmbience(s,r,t,e,i),s!==n&&this.setTerrainAmbience(n,r,t,e,i),r!==o&&this.setTerrainAmbience(s,o,t,e,i),s!==n&&r!==o&&this.setTerrainAmbience(n,o,t,e,i)}removeObject(t,e,i){if(!(t<0||e<0||t>=95||e>=95||1!==bs.objectType[i]&&2!==bs.objectType[i])){let s=this.getTileDirection(t,e),r=0,n=0;0===s||4===s?(r=bs.objectWidth[i],n=bs.objectHeight[i]):(n=bs.objectWidth[i],r=bs.objectHeight[i]);for(let o=t;o<t+r;o++)for(let t=e;t<e+n;t++){const e=this.objectAdjacency.get(o,t);1===bs.objectType[i]?this.objectAdjacency.set(o,t,65471&e):0===s?(this.objectAdjacency.set(o,t,65533&e),o>0&&this.method407(o-1,t,8)):2===s?(this.objectAdjacency.set(o,t,65531&e),t<95&&this.method407(o,t+1,1)):4===s?(this.objectAdjacency.set(o,t,65527&e),o<95&&this.method407(o+1,t,2)):6===s&&(this.objectAdjacency.set(o,t,65534&e),t>0&&this.method407(o,t-1,4))}this.method404(t,e,r,n)}}method427(t,e){return this.getWallRoof(t,e)>0||this.getWallRoof(t-1,e)>0||this.getWallRoof(t-1,e-1)>0||this.getWallRoof(t,e-1)>0}method428(t,e,i,s,r){let n=bs.wallObjectHeight[t];const o=this.terrainHeightLocal.get(e,i);o<8e4&&this.terrainHeightLocal.set(e,i,o+8e4+n);const a=this.terrainHeightLocal.get(s,r);a<8e4&&this.terrainHeightLocal.set(s,r,a+8e4+n)}}br.colourTransparent=12345678,yr=br;var Cr={};const Sr="a".charCodeAt(0),Ir="@".charCodeAt(0),Tr=".".charCodeAt(0),xr="!".charCodeAt(0),vr="%".charCodeAt(0),kr=" ".charCodeAt(0),Ar="z".charCodeAt(0),Br="\uffe0".charCodeAt(0);class Lr{static descramble(t,e,i){try{let r=0,n=-1;for(let s=0;s<i;s++){const i=255&t[e++];let s=i>>4&15;-1===n?s<13?Lr.chars[r++]=Lr.charMap[s]:n=s:(Lr.chars[r++]=Lr.charMap[(n<<4)+s-195],n=-1),s=15&i,-1===n?s<13?Lr.chars[r++]=Lr.charMap[s]:n=s:(Lr.chars[r++]=Lr.charMap[(n<<4)+s-195],n=-1)}let o=!0;for(let t=0;t<r;t++){const e=Lr.chars[t];t>4&&e===Ir&&(Lr.chars[t]=kr),e===vr&&(Lr.chars[t]=kr),o&&e>=Sr&&e<=Ar&&(Lr.chars[t]+=Br,o=!1),e!==Tr&&e!==xr||(o=!0)}return s=Lr.chars.slice(0,r),Array.from(s).map(t=>String.fromCharCode(t)).join("")}catch(Ui){return"."}var s}static scramble(t){t.length>80&&(t=t.slice(0,80)),t=t.toLowerCase();let e=0,i=-1;for(let s=0;s<t.length;s++){const r=t.charCodeAt(s);let n=0;for(let t=0;t<Lr.charMap.length;t++)if(r===Lr.charMap[t]){n=t;break}n>12&&(n+=195),-1===i?n<13?i=n:Lr.scrambledBytes[e++]=255&n:n<13?(Lr.scrambledBytes[e++]=(i<<4)+n&255,i=-1):(Lr.scrambledBytes[e++]=(i<<4)+(n>>4)&255,i=15&n)}return-1!==i&&(Lr.scrambledBytes[e++]=i<<4&255),e}}Lr.scrambledBytes=new Int8Array(100),Lr.chars=new Uint16Array(100),Lr.charMap=new Uint16Array([" ","e","t","a","o","i","h","n","s","r","d","l","u","m","w","c","y","f","g","p","b","v","k","x","j","q","z","0","1","2","3","4","5","6","7","8","9"," ","!","?",".",",",":",";","(",")","-","&","*","\\","'","@","#","+","=","\xa3","$","%",'"',"[","]"].map(t=>t.charCodeAt(0))),Cr=Lr;var Mr={APPEARANCE:59,BANK_CLOSE:203,BANK_OPEN:42,BANK_UPDATE:249,CLOSE_CONNECTION:4,DUEL_ACCEPTED:210,DUEL_CLOSE:225,DUEL_CONFIRM_OPEN:172,DUEL_OPEN:176,DUEL_OPPONENT_ACCEPTED:253,DUEL_SETTINGS:30,DUEL_UPDATE:6,FRIEND_LIST:71,FRIEND_MESSAGE:120,FRIEND_STATUS_CHANGE:149,GAME_SETTINGS:240,IGNORE_LIST:109,INVENTORY_ITEMS:53,INVENTORY_ITEM_REMOVE:123,INVENTORY_ITEM_UPDATE:90,LOGOUT_DENY:183,MESSAGE:131,OPTION_LIST:245,OPTION_LIST_CLOSE:252,PLAYER_DIED:83,PLAYER_QUEST_LIST:5,PLAYER_STAT_EQUIPMENT_BONUS:153,PLAYER_STAT_EXPERIENCE_UPDATE:33,PLAYER_STAT_FATIGUE:114,PLAYER_STAT_FATIGUE_ASLEEP:244,PLAYER_STAT_LIST:156,PLAYER_STAT_UPDATE:159,PRAYER_STATUS:206,PRIVACY_SETTINGS:51,REGION_ENTITY_UPDATE:211,REGION_GROUND_ITEMS:99,REGION_NPCS:79,REGION_NPC_UPDATE:104,REGION_OBJECTS:48,REGION_PLAYERS:191,REGION_PLAYER_UPDATE:234,REGION_WALL_OBJECTS:91,SERVER_MESSAGE:89,SERVER_MESSAGE_ONTOP:222,SHOP_CLOSE:137,SHOP_OPEN:101,SLEEP_CLOSE:84,SLEEP_INCORRECT:194,SLEEP_OPEN:117,SOUND:204,SYSTEM_UPDATE:52,TELEPORT_BUBBLE:36,TRADE_CLOSE:128,TRADE_CONFIRM_OPEN:20,TRADE_ITEMS:97,TRADE_OPEN:92,TRADE_RECIPIENT_STATUS:162,TRADE_STATUS:15,WELCOME:182,WORLD_INFO:25};const Er=L({}),Pr=e({}),Yr=["torcha2","torcha3","torcha4","skulltorcha2","skulltorcha3","skulltorcha4","firea2","firea3","fireplacea2","fireplacea3","firespell2","firespell3","lightning2","lightning3","clawspell2","clawspell3","clawspell4","clawspell5","spellcharge2","spellcharge3"];var Xr=class extends cs{constructor(t){super(t),Er(this),this.packetHandlers=Pr(this),this.localRegionX=0,this.localRegionY=0,this.controlTextListChat=0,this.controlTextListAll=0,this.controlTextListQuest=0,this.controlTextListPrivate=0,this.messageTabSelected=0,this.mouseClickXX=0,this.mouseClickXY=0,this.privateMessageTarget=new ht(0),this.controlListQuest=0,this.controlListMagic=0,this.packetErrorCount=0,this.mouseButtonDownTime=0,this.mouseButtonItemCountIncrement=0,this.animationIndex=0,this.cameraRotationX=0,this.tradeConfirmAccepted=!1,this.appearanceHeadType=0,this.appearanceSkinColour=0,this.anInt707=0,this.deathScreenTimeout=0,this.cameraRotationY=0,this.welcomeUnreadMessages=0,this.logoutTimeout=0,this.tradeRecipientConfirmHash=new ht(0),this.loginTimer=0,this.npcCombatModelArray1=new Int32Array([0,1,2,1,0,0,0,0]),this.npcCombatModelArray2=new Int32Array([0,0,0,0,0,1,2,1]),this.systemUpdate=0,this.graphics=null,this.regionX=0,this.regionY=0,this.welcomScreenAlreadyShown=!1,this.mouseButtonClick=0,this.healthBarCount=0,this.spriteMedia=0,this.spriteUtil=0,this.spriteItem=0,this.spriteProjectile=0,this.spriteTexture=0,this.spriteTextureWorld=0,this.spriteLogo=0,this.teleportBubbleCount=0,this.mouseClickCount=0,this.shopSellPriceMod=0,this.shopBuyPriceMod=0,this.duelOptionRetreat=0,this.duelOptionMagic=0,this.duelOptionPrayer=0,this.duelOptionWeapons=0,this.groundItemCount=0,this.receivedMessagesCount=0,this.messageTabFlashAll=0,this.messageTabFlashHistory=0,this.messageTabFlashQuest=0,this.messageTabFlashPrivate=0,this.bankItemCount=0,this.objectAnimationNumberFireLightningSpell=0,this.objectAnimationNumberTorch=0,this.objectAnimationNumberClaw=0,this.loggedIn=0,this.npcCount=0,this.npcCacheCount=0,this.objectAnimationCount=0,this.tradeConfirmItemsCount=0,this.mouseClickXStep=0,this.newBankItemCount=0,this.npcAnimationArray=[new Int32Array([11,2,9,7,1,6,10,0,5,8,3,4]),new Int32Array([11,2,9,7,1,6,10,0,5,8,3,4]),new Int32Array([11,3,2,9,7,1,6,10,0,5,8,4]),new Int32Array([3,4,2,9,7,1,6,10,8,11,0,5]),new Int32Array([3,4,2,9,7,1,6,10,8,11,0,5]),new Int32Array([4,3,2,9,7,1,6,10,8,11,0,5]),new Int32Array([11,4,2,9,7,1,6,10,0,5,8,3]),new Int32Array([11,2,9,7,1,6,10,0,5,8,4,3])],this.npcWalkModel=new Int32Array([0,1,2,1]),this.referID=0,this.combatTimeout=0,this.optionMenuCount=0,this.errorLoadingCodebase=!1,this.cameraRotationTime=0,this.duelOpponentItemsCount=0,this.duelItemsCount=0,this.duelOfferOpponentItemCount=0,this.characterHairColours=new Int32Array([16760880,16752704,8409136,6307872,3158064,16736288,16728064,16777215,65280,65535]),this.characterTopBottomColours=new Int32Array([16711680,16744448,16769024,10543104,57344,32768,41088,45311,33023,12528,14680288,3158064,6307840,8409088,16777215]),this.characterSkinColours=new Int32Array([15523536,13415270,11766848,10056486,9461792]),this.itemsAboveHeadCount=0,this.selectedItemInventoryIndex=0,this.statFatigue=0,this.fatigueSleeping=0,this.tradeRecipientConfirmItemsCount=0,this.tradeRecipientItemsCount=0,this.showDialogServerMessage=!1,this.menuX=0,this.menuY=0,this.menuWidth=0,this.menuHeight=0,this.menuItemsCount=0,this.showUITab=0,this.tradeItemsCount=0,this.planeWidth=0,this.planeHeight=0,this.planeMultiplier=0,this.playerQuestPoints=0,this.bankActivePage=0,this.welcomeLastLoggedInDays=0,this.inventoryItemsCount=0,this.duelOpponentNameHash=new ht(0),this.minimapRandom1=0,this.minimapRandom2=0,this.objectCount=0,this.duelOfferItemCount=0,this.objectCount=0,this.duelOfferItemCount=0,this.cameraAutoRotatePlayerX=0,this.cameraAutoRotatePlayerY=0,this.playerCount=0,this.knownPlayerCount=0,this.spriteCount=0,this.wallObjectCount=0,this.welcomeRecoverySetDays=0,this.localLowerX=0,this.localLowerY=0,this.localUpperX=0,this.localUpperY=0,this.world=null,this.welcomeLastLoggedInIP=0,this.sleepWordDelayTimer=0,this.menuIndices=new Int32Array(250),this.cameraAutoAngleDebug=!1,this.wallObjectDirection=new Int32Array(500),this.wallObjectId=new Int32Array(500),this.cameraRotationXIncrement=2,this.inventoryMaxItemCount=30,this.bankItemsMax=48,this.optionMenuEntry=[],this.optionMenuEntry.length=5,this.optionMenuEntry.fill(null),this.newBankItems=new Int32Array(256),this.newBankItemsCount=new Int32Array(256),this.teleportBubbleTime=new Int32Array(50),this.tradeConfirmAccepted=!1,this.receivedMessageX=new Int32Array(50),this.receivedMessageY=new Int32Array(50),this.receivedMessageMidPoint=new Int32Array(50),this.receivedMessageHeight=new Int32Array(50),this.localPlayer=new Yt,this.localPlayerServerIndex=-1,this.menuItemX=new Int32Array(250),this.menuItemY=new Int32Array(250),this.bankItems=new Int32Array(256),this.bankItemsCount=new Int32Array(256),this.appearanceBodyGender=1,this.appearance2Colour=2,this.appearanceHairColour=2,this.appearanceTopColour=8,this.appearanceBottomColour=14,this.appearanceHeadGender=1,this.loginUser="",this.loginPass="",this.cameraAngle=1,this.members=!1,this.optionSoundDisabled=!1,this.showRightClickMenu=!1,this.cameraRotationYIncrement=2,this.objectAlreadyInMenu=new Int8Array(1500),this.menuItemText1=[],this.menuItemText1.length=250,this.menuItemText1.fill(null),this.duelOpponentName="",this.lastObjectAnimationNumberFireLightningSpell=-1,this.lastObjectAnimationNumberTorch=-1,this.lastObjectAnimationNumberClaw=-1,this.planeIndex=-1,this.welcomScreenAlreadyShown=!1,this.cameraRotation=128,this.teleportBubbleX=new Int32Array(50),this.errorLoadingData=!1,this.playerExperience=new Int32Array(18),this.tradeRecipientAccepted=!1,this.tradeAccepted=!1,this.mouseClickXHistory=new Int32Array(8192),this.mouseClickYHistory=new Int32Array(8192),this.playerServerIndexes=new Int32Array(500),this.teleportBubbleY=new Int32Array(50),this.receivedMessages=[],this.receivedMessages.length=50,this.receivedMessages.fill(null),this.showDialogDuelConfirm=!1,this.duelAccepted=!1,this.players=[],this.players.length=500,this.players.fill(null),this.prayerOn=new Int8Array(50),this.menuIndex=new Int32Array(250),this.menuSourceIndex=new Int32Array(250),this.menuTargetIndex=new Int32Array(250),this.wallObjectAlreadyInMenu=new Int8Array(500),this.magicLoc=128,this.errorLoadingMemory=!1,this.fogOfWar=!1,this.gameWidth=512,this.gameHeight=334,this.const_9=9,this.tradeConfirmItems=new Int32Array(14),this.tradeConfirmItemCount=new Int32Array(14),this.tradeRecipientName="",this.selectedSpell=-1,this.showOptionMenu=!1,this.playerStatCurrent=new Int32Array(18),this.teleportBubbleType=new Int32Array(50),this.errorLoadingCodebase=!1,this.showDialogShop=!1,this.shopItem=new Int32Array(256),this.shopItemCount=new Int32Array(256),this.shopItemPrice=new Int32Array(256),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1,this.gameModels=[],this.gameModels.length=1e3,this.gameModels.fill(null),this.showDialogDuel=!1,this.serverMessage="",this.duelOpponentItems=new Int32Array(8),this.duelOpponentItemCount=new Int32Array(8),this.duelItems=new Int32Array(8),this.duelItemCount=new Int32Array(8),this.playerStatBase=new Int32Array(18),this.npcsCache=[],this.npcsCache.length=500,this.npcsCache.fill(null),this.groundItemX=new Int32Array(5e3),this.groundItemY=new Int32Array(5e3),this.groundItemID=new Int32Array(5e3),this.groundItemZ=new Int32Array(5e3),this.bankSelectedItemSlot=-1,this.bankSelectedItem=-2,this.duelOfferOpponentItemId=new Int32Array(8),this.duelOfferOpponentItemStack=new Int32Array(8),this.messageHistoryTimeout=new Int32Array(5),this.optionCameraModeAuto=!0,this.objectX=new Int32Array(1500),this.objectY=new Int32Array(1500),this.objectId=new Int32Array(1500),this.objectDirection=new Int32Array(1500),this.selectedItemInventoryIndex=-1,this.selectedItemName="",this.loadingArea=!1,this.tradeRecipientConfirmItems=new Int32Array(14),this.tradeRecipientConfirmItemCount=new Int32Array(14),this.tradeRecipientItems=new Int32Array(14),this.tradeRecipientItemCount=new Int32Array(14),this.showDialogServerMessage=!1,this.menuType=new Int32Array(250),this.questComplete=new Int8Array(50),this.wallObjectModel=[],this.wallObjectModel.length=500,this.wallObjectModel.fill(null),this.actionBubbleX=new Int32Array(50),this.actionBubbleY=new Int32Array(50),this.cameraZoom=550,this.tradeItems=new Int32Array(14),this.tradeItemCount=new Int32Array(14),this.lastHeightOffset=-1,this.duelSettingsRetreat=!1,this.duelSettingsMagic=!1,this.duelSettingsPrayer=!1,this.duelSettingsWeapons=!1,this.showDialogBank=!1,this.loginUserDesc="",this.loginUserDisp="",this.optionMouseButtonOne=!1,this.inventoryItemId=new Int32Array(35),this.inventoryItemStackCount=new Int32Array(35),this.inventoryEquipped=new Int32Array(35),this.knownPlayers=[],this.knownPlayers.length=500,this.knownPlayers.fill(null),this.messageHistory=[],this.messageHistory.length=5,this.messageHistory.fill(null),this.duelOfferItemId=new Int32Array(8),this.duelOfferItemStack=new Int32Array(8),this.actionBubbleScale=new Int32Array(50),this.actionBubbleItem=new Int32Array(50),this.sleepWordDelay=!0,this.showAppearanceChange=!1,this.shopSelectedItemIndex=-1,this.shopSelectedItemType=-2,this.projectileMaxRange=40,this.npcs=[],this.npcs.length=500,this.npcs.fill(null),this.experienceArray=new Int32Array(99),this.healthBarX=new Int32Array(50),this.healthBarY=new Int32Array(50),this.healthBarMissing=new Int32Array(50),this.playerServer=[],this.playerServer.length=4e3,this.playerServer.fill(null),this.walkPathX=new Int32Array(8e3),this.walkPathY=new Int32Array(8e3),this.wallObjectX=new Int32Array(500),this.wallObjectY=new Int32Array(500),this.menuItemText2=[],this.menuItemText2.length=250,this.menuItemText2.fill(null),this.npcsServer=[],this.npcsServer.length=5e3,this.npcsServer.fill(null),this.playerStatEquipment=new Int32Array(5),this.objectModel=[],this.objectModel.length=1500,this.objectModel.fill(null),this.playerMsgHistory=[],this.playerMsgPtr=0,this.recoveryQuestions=["Where were you born?","What was your first teachers name?","What is your fathers middle name?","Who was your first best friend?","What is your favourite vacation spot?","What is your mothers middle name?","What was your first pets name?","What was the name of your first school?","What is your mothers maiden name?","Who was your first boyfriend/girlfriend?","What was the first computer game you purchased?","Who is your favourite actor/actress?","Who is your favourite author?","Who is your favourite musician?","Who is your favourite cartoon character?","What is your favourite book?","What is your favourite food?","What is your favourite movie?"],this.showRecoverChange=!1,this.recoverCustomQuestionIndex=-1,this.showChangePasswordStep=0,this.changePasswordOld="",this.changePasswordNew="",this.welcomeTipDay=0}playSoundFile(t){if(!this.audioPlayer||this.optionSoundDisabled)return;const e=t+".pcm";this.audioPlayer.writeStream(this.soundData,Li.getDataFileOffset(e,this.soundData),Li.getDataFileLength(e,this.soundData))}_walkToActionSource_from8(t,e,i,s,r,n,o,a){let h=this.world.route(t,e,i,s,r,n,this.walkPathX,this.walkPathY,o);if(-1===h){if(!a)return!1;h=1,this.walkPathX[0]=i,this.walkPathY[0]=s}h--,t=this.walkPathX[h],e=this.walkPathY[h],h--,a?this.packetStream.newPacket(ls.WALK_ACTION):this.packetStream.newPacket(ls.WALK),this.packetStream.putShort(t+this.regionX),this.packetStream.putShort(e+this.regionY),a&&-1===h&&(t+this.regionX)%5==0&&(h=0);for(let l=h;l>=0&&l>h-25;l--)this.packetStream.putByte(this.walkPathX[l]-t),this.packetStream.putByte(this.walkPathY[l]-e);return this.packetStream.sendPacket(),this.mouseClickXStep=-24,this.mouseClickXX=this.mouseX,this.mouseClickXY=this.mouseY,!0}walkTo(t,e,i,s,r,n,o,a){let h=this.world.route(t,e,i,s,r,n,this.walkPathX,this.walkPathY,o);if(-1===h)return!1;h--,t=this.walkPathX[h],e=this.walkPathY[h],h--,a?this.packetStream.newPacket(ls.WALK_ACTION):this.packetStream.newPacket(ls.WALK),this.packetStream.putShort(t+this.regionX),this.packetStream.putShort(e+this.regionY),a&&-1===h&&(t+this.regionX)%5==0&&(h=0);for(let l=h;l>=0&&l>h-25;l--)this.packetStream.putByte(this.walkPathX[l]-t),this.packetStream.putByte(this.walkPathY[l]-e);return this.packetStream.sendPacket(),this.mouseClickXStep=-24,this.mouseClickXX=this.mouseX,this.mouseClickXY=this.mouseY,!0}updateBankItems(){this.bankItemCount=this.newBankItemCount;for(let t=0;t<this.newBankItemCount;t++)this.bankItems[t]=this.newBankItems[t],this.bankItemsCount[t]=this.newBankItemsCount[t];for(let t=0;t<this.inventoryItemsCount&&!(this.bankItemCount>=this.bankItemsMax);t++){const e=this.inventoryItemId[t];let i=!1;for(let t=0;t<this.bankItemCount;t++)if(this.bankItems[t]===e){i=!0;break}i||(this.bankItems[this.bankItemCount]=e,this.bankItemsCount[this.bankItemCount]=0,this.bankItemCount++)}}drawAboveHeadStuff(){for(let t=0;t<this.receivedMessagesCount;t++){const e=this.surface.textHeight(1),i=this.receivedMessageX[t];let s=this.receivedMessageY[t];const r=this.receivedMessageMidPoint[t],n=this.receivedMessageHeight[t];let o=!0;for(;o;){o=!1;for(let a=0;a<t;a++)s+n>this.receivedMessageY[a]-e&&s-e<this.receivedMessageY[a]+this.receivedMessageHeight[a]&&i-r<this.receivedMessageX[a]+this.receivedMessageMidPoint[a]&&i+r>this.receivedMessageX[a]-this.receivedMessageMidPoint[a]&&this.receivedMessageY[a]-e-n<s&&(s=this.receivedMessageY[a]-e-n,o=!0)}this.receivedMessageY[t]=s,this.surface.drawParagraph(this.receivedMessages[t],i,s,1,16776960,300)}for(let t=0;t<this.itemsAboveHeadCount;t++){const e=this.actionBubbleX[t],i=this.actionBubbleY[t],s=this.actionBubbleScale[t],r=this.actionBubbleItem[t],n=39*s/100|0,o=27*s/100|0;this.surface.drawActionBubble(e-(n/2|0),i-o,n,o,this.spriteMedia+9,85);const a=36*s/100|0,h=24*s/100|0;this.surface._spriteClipping_from9(e-(a/2|0),i-o+(o/2|0)-(h/2|0),a,h,bs.itemPicture[r]+this.spriteItem,bs.itemMask[r],0,0,!1)}for(let t=0;t<this.healthBarCount;t++){const e=this.healthBarX[t],i=this.healthBarY[t],s=this.healthBarMissing[t];this.surface.drawBoxAlpha(e-15,i-3,s,5,65280,192),this.surface.drawBoxAlpha(e-15+s,i-3,30-s,5,16711680,192)}}_walkToActionSource_from5(t,e,i,s,r){this._walkToActionSource_from8(t,e,i,s,i,s,!1,r)}disposeAndCollect(){null!==this.surface&&(this.surface.clear(),this.surface.pixels=null,this.surface=null),null!==this.scene&&(this.scene.dispose(),this.scene=null),this.gameModels=null,this.objectModel=null,this.wallObjectModel=null,this.playerServer=null,this.players=null,this.npcsServer=null,this.npcs=null,this.localPlayer=null,null!==this.world&&(this.world.terrainModels=null,this.world.wallModels=null,this.world.roofModels=null,this.world.parentModel=null,this.world=null)}drawUI(){if(0!==this.logoutTimeout)this.drawDialogLogout();else if(this.showDialogWelcome)this.drawDialogWelcome();else if(this.showDialogServerMessage)this.drawDialogServerMessage();else if(1===this.showUiWildWarn)this.drawDialogWildWarn();else if(this.showDialogBank&&0===this.combatTimeout)this.drawDialogBank();else if(this.showDialogShop&&0===this.combatTimeout)this.drawDialogShop();else if(this.showDialogTradeConfirm)this.drawDialogTradeConfirm();else if(this.showDialogTrade)this.drawDialogTrade();else if(this.showDialogDuelConfirm)this.drawDialogDuelConfirm();else if(this.showDialogDuel)this.drawDialogDuel();else if(1===this.showDialogReportAbuseStep)this.drawDialogReportAbuse();else if(2===this.showDialogReportAbuseStep)this.drawDialogReportAbuseInput();else if(0!==this.showChangePasswordStep)this.drawDialogChangePassword();else if(0!==this.showDialogSocialInput)this.drawDialogSocialInput();else{this.showOptionMenu&&this.drawOptionMenu(),8!==this.localPlayer.animationCurrent&&9!==this.localPlayer.animationCurrent||this.drawDialogCombatStyle(),this.options.mobile?this.setActiveMobileUITab():this.setActiveUITab();const t=!this.showOptionMenu&&!this.showRightClickMenu;t&&(this.menuItemsCount=0),0===this.showUITab&&t&&this.createRightClickMenu(),1===this.showUITab?this.drawUiTabInventory(t):2===this.showUITab?this.drawUiTabMinimap(t):3===this.showUITab?this.drawUiTabPlayerInfo(t):4===this.showUITab?this.drawUiTabMagic(t):5===this.showUITab?this.drawUiTabSocial(t):6===this.showUITab&&this.drawUiTabOptions(t),this.showOptionMenu||(this.showRightClickMenu?this.drawRightClickMenu():this.createTopMouseMenu())}this.mouseButtonClick=0}resetGame(){this.systemUpdate=0,this.combatStyle=0,this.logoutTimeout=0,this.loginScreen=0,this.loggedIn=1,this.resetPMText(),this.surface.blackScreen(),this.surface.draw(this.graphics,0,0);for(let t=0;t<this.objectCount;t++)this.scene.removeModel(this.objectModel[t]),this.world.removeObject(this.objectX[t],this.objectY[t],this.objectId[t]);for(let t=0;t<this.wallObjectCount;t++)this.scene.removeModel(this.wallObjectModel[t]),this.world.removeWallObject(this.wallObjectX[t],this.wallObjectY[t],this.wallObjectDirection[t],this.wallObjectId[t]);this.objectCount=0,this.wallObjectCount=0,this.groundItemCount=0,this.playerCount=0;for(let t=0;t<4e3;t++)this.playerServer[t]=null;for(let t=0;t<500;t++)this.players[t]=null;this.npcCount=0;for(let t=0;t<5e3;t++)this.npcsServer[t]=null;for(let t=0;t<500;t++)this.npcs[t]=null;for(let t=0;t<this.prayerOn.length;t++)this.prayerOn[t]=!1;this.mouseButtonClick=0,this.lastMouseButtonDown=0,this.mouseButtonDown=0,this.showDialogShop=!1,this.showDialogBank=!1,this.isSleeping=!1,this.friendListCount=0}handleKeyPress(t){if(0===this.loggedIn&&(0===this.loginScreen&&this.panelLoginWelcome&&this.panelLoginWelcome.keyPress(t),1===this.loginScreen&&this.panelLoginNewUser&&this.panelLoginNewUser.keyPress(t),2===this.loginScreen&&this.panelLoginExistingUser&&this.panelLoginExistingUser.keyPress(t),3===this.loginScreen&&this.panelRecoverUser&&this.panelRecoverUser.keyPress(t)),1===this.loggedIn){if(this.showAppearanceChange&&null!==this.panelAppearance)return void this.panelAppearance.keyPress(t);if(0===this.showChangePasswordStep&&0===this.showDialogSocialInput&&0===this.showDialogReportAbuseStep&&!this.isSleeping&&this.panelMessageTabs){if(this.options.messageScrollBack){if(this.ctrl&&[Wi.UP_ARROW,Wi.DOWN_ARROW].includes(t)){if(t===Wi.UP_ARROW){if(this.playerMsgPtr>=this.playerMsgHistory.length)return;this.playerMsgPtr+=1}else if(t===Wi.DOWN_ARROW){if(this.playerMsgPtr<=1)return this.panelMessageTabs.controlText[1]="",void(this.playerMsgPtr=0);this.playerMsgPtr-=1}const e=this.playerMsgHistory[this.playerMsgHistory.length-this.playerMsgPtr];return void(e&&(this.panelMessageTabs.controlText[1]=e))}if(t===Wi.ENTER){const t=this.panelMessageTabs.controlText[1];t&&(t!==this.playerMsgHistory[this.playerMsgHistory.length-1]&&this.playerMsgHistory.push(t),this.playerMsgPtr=0)}}this.panelMessageTabs.keyPress(t)}3!==this.showChangePasswordStep&&4!==this.showChangePasswordStep||(this.showChangePasswordStep=0)}}sendLogout(){if(0!==this.loggedIn){if(!(this.combatTimeout>450))return this.combatTimeout>0?void this.showMessage("@cya@You can't logout for 10 seconds after combat",3):(this.packetStream.newPacket(ls.LOGOUT),this.packetStream.sendPacket(),void(this.logoutTimeout=1e3));this.showMessage("@cya@You can't logout during combat!",3)}}createPlayer(t,e,i,s){null===this.playerServer[t]&&(this.playerServer[t]=new Yt,this.playerServer[t].serverIndex=t,this.playerServer[t].serverId=0);const r=this.playerServer[t];let n=!1;for(let o=0;o<this.knownPlayerCount;o++)if(this.knownPlayers[o].serverIndex===t){n=!0;break}if(n){r.animationNext=s;let t=r.waypointCurrent;e===r.waypointsX[t]&&i===r.waypointsY[t]||(r.waypointCurrent=t=(t+1)%10,r.waypointsX[t]=e,r.waypointsY[t]=i)}else r.serverIndex=t,r.movingStep=0,r.waypointCurrent=0,r.waypointsX[0]=r.currentX=e,r.waypointsY[0]=r.currentY=i,r.animationNext=r.animationCurrent=s,r.stepCount=0;return this.players[this.playerCount++]=r,r}drawItem(t,e,i,s,r){const n=bs.itemPicture[r]+this.spriteItem,o=bs.itemMask[r];this.surface._spriteClipping_from9(t,e,i,s,n,o,0,0,!1)}async handleGameInput(){if(this.systemUpdate>1&&this.systemUpdate--,await this.checkConnection(),this.logoutTimeout>0&&this.logoutTimeout--,this.mouseActionTimeout>4500&&0===this.combatTimeout&&0===this.logoutTimeout)return this.mouseActionTimeout-=500,void this.sendLogout();if(8!==this.localPlayer.animationCurrent&&9!==this.localPlayer.animationCurrent||(this.combatTimeout=500),this.combatTimeout>0&&this.combatTimeout--,this.showAppearanceChange)this.handleAppearancePanelInput();else{for(let t=0;t<this.playerCount;t++){const e=this.players[t];if(!e)return void console.log("null character at ",t,this.playerCount);let i=(e.waypointCurrent+1)%10;if(e.movingStep!==i){let t,s=-1,r=e.movingStep,n=4;(t=r<i?i-r:10+i-r)>2&&(n=4*(t-1)),e.waypointsX[r]-e.currentX>3*this.magicLoc||e.waypointsY[r]-e.currentY>3*this.magicLoc||e.waypointsX[r]-e.currentX<3*-this.magicLoc||e.waypointsY[r]-e.currentY<3*-this.magicLoc||t>8?(e.currentX=e.waypointsX[r],e.currentY=e.waypointsY[r]):(e.currentX<e.waypointsX[r]?(e.currentX+=n,e.stepCount++,s=2):e.currentX>e.waypointsX[r]&&(e.currentX-=n,e.stepCount++,s=6),e.currentX-e.waypointsX[r]<n&&e.currentX-e.waypointsX[r]>-n&&(e.currentX=e.waypointsX[r]),e.currentY<e.waypointsY[r]?(e.currentY+=n,e.stepCount++,s=-1===s?4:2===s?3:5):e.currentY>e.waypointsY[r]&&(e.currentY-=n,e.stepCount++,s=-1===s?0:2===s?1:7),e.currentY-e.waypointsY[r]<n&&e.currentY-e.waypointsY[r]>-n&&(e.currentY=e.waypointsY[r])),-1!==s&&(e.animationCurrent=s),e.currentX===e.waypointsX[r]&&e.currentY===e.waypointsY[r]&&(e.movingStep=(r+1)%10)}else e.animationCurrent=e.animationNext;e.messageTimeout>0&&e.messageTimeout--,e.bubbleTimeout>0&&e.bubbleTimeout--,e.combatTimer>0&&e.combatTimer--,this.deathScreenTimeout>0&&(this.deathScreenTimeout--,0===this.deathScreenTimeout&&(this.showMessage("You have been granted another life. Be more careful this time!",3),this.showMessage("You retain your skills. Your objects land where you died",3)))}for(let t=0;t<this.npcCount;t++){const e=this.npcs[t];let i=(e.waypointCurrent+1)%10;if(e.movingStep!==i){let t,s=-1,r=e.movingStep,n=4;(t=r<i?i-r:10+i-r)>2&&(n=4*(t-1)),e.waypointsX[r]-e.currentX>3*this.magicLoc||e.waypointsY[r]-e.currentY>3*this.magicLoc||e.waypointsX[r]-e.currentX<3*-this.magicLoc||e.waypointsY[r]-e.currentY<3*-this.magicLoc||t>8?(e.currentX=e.waypointsX[r],e.currentY=e.waypointsY[r]):(e.currentX<e.waypointsX[r]?(e.currentX+=n,e.stepCount++,s=2):e.currentX>e.waypointsX[r]&&(e.currentX-=n,e.stepCount++,s=6),e.currentX-e.waypointsX[r]<n&&e.currentX-e.waypointsX[r]>-n&&(e.currentX=e.waypointsX[r]),e.currentY<e.waypointsY[r]?(e.currentY+=n,e.stepCount++,s=-1===s?4:2===s?3:5):e.currentY>e.waypointsY[r]&&(e.currentY-=n,e.stepCount++,s=-1===s?0:2===s?1:7),e.currentY-e.waypointsY[r]<n&&e.currentY-e.waypointsY[r]>-n&&(e.currentY=e.waypointsY[r])),-1!==s&&(e.animationCurrent=s),e.currentX===e.waypointsX[r]&&e.currentY===e.waypointsY[r]&&(e.movingStep=(r+1)%10)}else e.animationCurrent=e.animationNext,43===e.npcId&&e.stepCount++;e.messageTimeout>0&&e.messageTimeout--,e.bubbleTimeout>0&&e.bubbleTimeout--,e.combatTimer>0&&e.combatTimer--}2!==this.showUITab&&(Fi.anInt346>0&&this.sleepWordDelayTimer++,Fi.anInt347>0&&(this.sleepWordDelayTimer=0),Fi.anInt346=0,Fi.anInt347=0);for(let t=0;t<this.playerCount;t++){const e=this.players[t];e.projectileRange>0&&e.projectileRange--}if(this.cameraAutoAngleDebug)(this.cameraAutoRotatePlayerX-this.localPlayer.currentX<-500||this.cameraAutoRotatePlayerX-this.localPlayer.currentX>500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY<-500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY>500)&&(this.cameraAutoRotatePlayerX=this.localPlayer.currentX,this.cameraAutoRotatePlayerY=this.localPlayer.currentY);else if((this.cameraAutoRotatePlayerX-this.localPlayer.currentX<-500||this.cameraAutoRotatePlayerX-this.localPlayer.currentX>500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY<-500||this.cameraAutoRotatePlayerY-this.localPlayer.currentY>500)&&(this.cameraAutoRotatePlayerX=this.localPlayer.currentX,this.cameraAutoRotatePlayerY=this.localPlayer.currentY),this.cameraAutoRotatePlayerX!==this.localPlayer.currentX&&(this.cameraAutoRotatePlayerX+=(this.localPlayer.currentX-this.cameraAutoRotatePlayerX)/(16+((this.cameraZoom-500)/15|0))|0),this.cameraAutoRotatePlayerY!==this.localPlayer.currentY&&(this.cameraAutoRotatePlayerY+=(this.localPlayer.currentY-this.cameraAutoRotatePlayerY)/(16+((this.cameraZoom-500)/15|0))|0),this.optionCameraModeAuto){let t=32*this.cameraAngle-this.cameraRotation,e=1;0!==t?(this.anInt707++,t>128?(e=-1,t=256-t):t>0?e=1:t<-128?(e=1,t=256+t):t<0&&(e=-1,t=-t),this.cameraRotation+=((this.anInt707*t+255)/256|0)*e,this.cameraRotation&=255):this.anInt707=0}if(this.sleepWordDelayTimer>20&&(this.sleepWordDelay=!1,this.sleepWordDelayTimer=0),this.isSleeping)this.handleSleepInput();else{if(await this.handleMesssageTabsInput(),0!==this.deathScreenTimeout&&(this.lastMouseButtonDown=0),this.showDialogTrade||this.showDialogDuel?(0!==this.mouseButtonDown?this.mouseButtonDownTime++:this.mouseButtonDownTime=0,this.mouseButtonDownTime>600?this.mouseButtonItemCountIncrement+=5e3:this.mouseButtonDownTime>450?this.mouseButtonItemCountIncrement+=500:this.mouseButtonDownTime>300?this.mouseButtonItemCountIncrement+=50:this.mouseButtonDownTime>150?this.mouseButtonItemCountIncrement+=5:(this.mouseButtonDownTime>50||this.mouseButtonDownTime>20&&0==(5&this.mouseButtonDownTime))&&this.mouseButtonItemCountIncrement++):(this.mouseButtonDownTime=0,this.mouseButtonItemCountIncrement=0),1===this.lastMouseButtonDown?this.mouseButtonClick=1:2===this.lastMouseButtonDown&&(this.mouseButtonClick=2),this.scene.setMouseLoc(this.mouseX,this.mouseY),this.lastMouseButtonDown=0,this.optionCameraModeAuto){if(0===this.anInt707||this.cameraAutoAngleDebug){if(this.keyLeft&&(this.cameraAngle=this.cameraAngle+1&7,this.keyLeft=!1,!this.fogOfWar)){0==(1&this.cameraAngle)&&(this.cameraAngle=this.cameraAngle+1&7);for(let t=0;t<8&&!this.isValidCameraAngle(this.cameraAngle);t++)this.cameraAngle=this.cameraAngle+1&7}if(this.keyRight&&(this.cameraAngle=this.cameraAngle+7&7,this.keyRight=!1,!this.fogOfWar)){0==(1&this.cameraAngle)&&(this.cameraAngle=this.cameraAngle+7&7);for(let t=0;t<8&&!this.isValidCameraAngle(this.cameraAngle);t++)this.cameraAngle=this.cameraAngle+7&7}}}else this.keyLeft?this.cameraRotation=this.cameraRotation+2&255:this.keyRight&&(this.cameraRotation=this.cameraRotation-2&255);!this.optionCameraModeAuto&&this.options.middleClickCamera&&this.middleButtonDown&&(this.cameraRotation=this.originRotation+(this.mouseX-this.originMouseX)/2&255),this.options.zoomCamera?this.handleCameraZoom():this.fogOfWar&&this.cameraZoom>550?this.cameraZoom-=4:!this.fogOfWar&&this.cameraZoom<750&&(this.cameraZoom+=4),this.mouseClickXStep>0?this.mouseClickXStep--:this.mouseClickXStep<0&&this.mouseClickXStep++,this.scene.doSOemthingWithTheFuckinFountainFuck(17),this.objectAnimationCount++,this.objectAnimationCount>5&&(this.objectAnimationCount=0,this.objectAnimationNumberFireLightningSpell=(this.objectAnimationNumberFireLightningSpell+1)%3,this.objectAnimationNumberTorch=(this.objectAnimationNumberTorch+1)%4,this.objectAnimationNumberClaw=(this.objectAnimationNumberClaw+1)%5);for(let t=0;t<this.objectCount;t++){const e=this.objectX[t],i=this.objectY[t];e>=0&&i>=0&&e<96&&i<96&&74===this.objectId[t]&&this.objectModel[t].rotate(1,0,0)}for(let t=0;t<this.teleportBubbleCount;t++)if(this.teleportBubbleTime[t]++,this.teleportBubbleTime[t]>50){this.teleportBubbleCount--;for(let e=t;e<this.teleportBubbleCount;e++)this.teleportBubbleX[e]=this.teleportBubbleX[e+1],this.teleportBubbleY[e]=this.teleportBubbleY[e+1],this.teleportBubbleTime[e]=this.teleportBubbleTime[e+1],this.teleportBubbleType[e]=this.teleportBubbleType[e+1]}}}}handleCameraZoom(){if(this.keyUp&&!this.ctrl?this.cameraZoom-=16:this.keyDown&&!this.ctrl?this.cameraZoom+=16:this.keyHome?this.cameraZoom=750:this.keyPgUp?this.cameraZoom=450:this.keyPgDown&&(this.cameraZoom=1250),0!==this.mouseScrollDelta&&(2===this.showUITab||0===this.showUITab)){if(0!==this.messageTabSelected&&this.mouseY>this.gameHeight-64)return;this.cameraZoom+=24*this.mouseScrollDelta}this.cameraZoom>=1250?this.cameraZoom=1250:this.cameraZoom<=450&&(this.cameraZoom=450)}autoRotateCamera(){if(1==(1&this.cameraAngle)&&this.isValidCameraAngle(this.cameraAngle))return;if(0==(1&this.cameraAngle)&&this.isValidCameraAngle(this.cameraAngle))return this.isValidCameraAngle(this.cameraAngle+1&7)?void(this.cameraAngle=this.cameraAngle+1&7):void(this.isValidCameraAngle(this.cameraAngle+7&7)&&(this.cameraAngle=this.cameraAngle+7&7));let t=new Int32Array([1,-1,2,-2,3,-3,4]);for(let e=0;e<7;e++)if(this.isValidCameraAngle(this.cameraAngle+t[e]+8&7)){this.cameraAngle=this.cameraAngle+t[e]+8&7;break}if(0==(1&this.cameraAngle)&&this.isValidCameraAngle(this.cameraAngle)){if(this.isValidCameraAngle(this.cameraAngle+1&7))return void(this.cameraAngle=this.cameraAngle+1&7);this.isValidCameraAngle(this.cameraAngle+7&7)&&(this.cameraAngle=this.cameraAngle+7&7)}}drawRightClickMenu(){if(0!==this.mouseButtonClick){for(let t=0;t<this.menuItemsCount;t++){const e=this.menuX+2,i=this.menuY+27+15*t;if(!(this.mouseX<=e-2||this.mouseY<=i-12||this.mouseY>=i+4||this.mouseX>=e-3+this.menuWidth)){this.menuItemClick(this.menuIndices[t]);break}}return this.mouseButtonClick=0,void(this.showRightClickMenu=!1)}if(this.mouseX<this.menuX-10||this.mouseY<this.menuY-10||this.mouseX>this.menuX+this.menuWidth+10||this.mouseY>this.menuY+this.menuHeight+10)this.showRightClickMenu=!1;else{this.surface.drawBoxAlpha(this.menuX,this.menuY,this.menuWidth,this.menuHeight,13684944,160),this.surface.drawString("Choose option",this.menuX+2,this.menuY+12,1,65535);for(let t=0;t<this.menuItemsCount;t++){const e=this.menuX+2,i=this.menuY+27+15*t;let s=16777215;this.mouseX>e-2&&this.mouseY>i-12&&this.mouseY<i+4&&this.mouseX<e-3+this.menuWidth&&(s=16776960),this.surface.drawString(this.menuItemText1[this.menuIndices[t]]+" "+this.menuItemText2[this.menuIndices[t]],e,i,1,s)}}}drawNpc(t,e,i,s,r,n,o){const a=this.npcs[r];let h=a.animationCurrent+(this.cameraRotation+16)/32&7,l=!1,c=h;5===c?(c=3,l=!0):6===c?(c=2,l=!0):7===c&&(c=1,l=!0);let u=3*c+this.npcWalkModel[(a.stepCount/bs.npcWalkModel[a.npcId]|0)%4];8===a.animationCurrent?(c=5,h=2,l=!1,t-=bs.npcCombatAnimation[a.npcId]*o/100|0,u=3*c+this.npcCombatModelArray1[((this.loginTimer/bs.npcCombatModel[a.npcId]|0)-1)%8]):9===a.animationCurrent&&(c=5,h=2,l=!0,t+=bs.npcCombatAnimation[a.npcId]*o/100|0,u=3*c+this.npcCombatModelArray2[(this.loginTimer/bs.npcCombatModel[a.npcId]|0)%8]);for(let d=0;d<12;d++){let r=this.npcAnimationArray[h][d],o=bs.npcSprite.get(a.npcId,r);if(o>=0){let r=0,h=0,d=u;if(l&&c>=1&&c<=3&&1===bs.animationHasF[o]&&(d+=15),5!==c||1===bs.animationHasA[o]){let c=d+bs.animationNumber[o];r=r*i/this.surface.spriteWidthFull[c]|0,h=h*s/this.surface.spriteHeightFull[c]|0;let u=i*this.surface.spriteWidthFull[c]/this.surface.spriteWidthFull[bs.animationNumber[o]]|0;r-=(u-i)/2|0;let m=bs.animationCharacterColour[o],p=0;1===m?(m=bs.npcColourHair[a.npcId],p=bs.npcColourSkin[a.npcId]):2===m?(m=bs.npcColourTop[a.npcId],p=bs.npcColourSkin[a.npcId]):3===m&&(m=bs.npcColorBottom[a.npcId],p=bs.npcColourSkin[a.npcId]),this.surface._spriteClipping_from9(t+r,e+h,u,s,c,m,p,n,l)}}}if(a.messageTimeout>0&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=this.surface.textWidth(a.message,1)/2|0,this.receivedMessageMidPoint[this.receivedMessagesCount]>150&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=150),this.receivedMessageHeight[this.receivedMessagesCount]=(this.surface.textWidth(a.message,1)/300|0)*this.surface.textHeight(1),this.receivedMessageX[this.receivedMessagesCount]=t+(i/2|0),this.receivedMessageY[this.receivedMessagesCount]=e,this.receivedMessages[this.receivedMessagesCount++]=a.message),8===a.animationCurrent||9===a.animationCurrent||0!==a.combatTimer){if(a.combatTimer>0){let s=t;8===a.animationCurrent?s-=20*o/100|0:9===a.animationCurrent&&(s+=20*o/100|0);let r=30*a.healthCurrent/a.healthMax|0;this.healthBarX[this.healthBarCount]=s+(i/2|0),this.healthBarY[this.healthBarCount]=e,this.healthBarMissing[this.healthBarCount++]=r}if(a.combatTimer>150){let r=t;8===a.animationCurrent?r-=10*o/100|0:9===a.animationCurrent&&(r+=10*o/100|0),this.surface._drawSprite_from3(r+(i/2|0)-12,e+(s/2|0)-12,this.spriteMedia+12),this.surface.drawStringCenter(a.damageTaken.toString(),r+(i/2|0)-1,e+(s/2|0)+5,3,16777215)}}}walkToWallObject(t,e,i){0===i?this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e-1,t,e,!1,!0):1===i?this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t-1,e,t,e,!1,!0):this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e,t,e,!0,!0)}async loadGameConfig(){const t=await this.readDataFile(`config${Gi}.jag`,"Configuration",10);if(!t)return void(this.errorLoadingData=!0);bs.loadData(t,this.members);const e=await this.readDataFile(`filter${zi}.jag`,"Chat system",15);if(!e)return void(this.errorLoadingData=!0);const i=new at(Li.loadData("fragmentsenc.txt",0,e)),s=new at(Li.loadData("badenc.txt",0,e)),r=new at(Li.loadData("hostenc.txt",0,e)),n=new at(Li.loadData("tldlist.txt",0,e));Ks.loadFilters(i,s,r,n)}addNpc(t,e,i,s,r){null===this.npcsServer[t]&&(this.npcsServer[t]=new Yt,this.npcsServer[t].serverIndex=t);const n=this.npcsServer[t];let o=!1;for(let a=0;a<this.npcCacheCount;a++)if(this.npcsCache[a].serverIndex===t){o=!0;break}if(o){n.npcId=r,n.animationNext=s;let t=n.waypointCurrent;e===n.waypointsX[t]&&i===n.waypointsY[t]||(n.waypointCurrent=t=(t+1)%10,n.waypointsX[t]=e,n.waypointsY[t]=i)}else n.serverIndex=t,n.movingStep=0,n.waypointCurrent=0,n.waypointsX[0]=n.currentX=e,n.waypointsY[0]=n.currentY=i,n.npcId=r,n.animationNext=n.animationCurrent=s,n.stepCount=0;return this.npcs[this.npcCount++]=n,n}resetLoginVars(){this.systemUpdate=0,this.loginScreen=0,this.loggedIn=0,this.logoutTimeout=0}drawDialogDuel(){if(0!==this.mouseButtonClick&&0===this.mouseButtonItemCountIncrement&&(this.mouseButtonItemCountIncrement=1),this.mouseButtonItemCountIncrement>0){let t=this.mouseX-22,e=this.mouseY-36;if(t>=0&&e>=0&&t<468&&e<262){if(t>216&&e>30&&t<462&&e<235){let i=((t-217|0)/49|0)+5*((e-31)/34|0);if(i>=0&&i<this.inventoryItemsCount){let t=!1,e=0,s=this.inventoryItemId[i];for(let r=0;r<this.duelOfferItemCount;r++)if(this.duelOfferItemId[r]===s)if(0===bs.itemStackable[s])for(let e=0;e<this.mouseButtonItemCountIncrement;e++)this.duelOfferItemStack[r]<this.inventoryItemStackCount[i]&&this.duelOfferItemStack[r]++,t=!0;else e++;if(this.getInventoryCount(s)<=e&&(t=!0),1===bs.itemSpecial[s]&&(this.showMessage("This object cannot be added to a duel offer",3),t=!0),!t&&this.duelOfferItemCount<8&&(this.duelOfferItemId[this.duelOfferItemCount]=s,this.duelOfferItemStack[this.duelOfferItemCount]=1,this.duelOfferItemCount++,t=!0),t){this.packetStream.newPacket(ls.DUEL_ITEM_UPDATE),this.packetStream.putByte(this.duelOfferItemCount);for(let t=0;t<this.duelOfferItemCount;t++)this.packetStream.putShort(this.duelOfferItemId[t]),this.packetStream.putInt(this.duelOfferItemStack[t]);this.packetStream.sendPacket(),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1}}}if(t>8&&e>30&&t<205&&e<129){let i=((t-9)/49|0)+4*((e-31)/34|0);if(i>=0&&i<this.duelOfferItemCount){let t=this.duelOfferItemId[i];for(let e=0;e<this.mouseButtonItemCountIncrement;e++){if(!(0===bs.itemStackable[t]&&this.duelOfferItemStack[i]>1)){this.duelOfferItemCount--,this.mouseButtonDownTime=0;for(let t=i;t<this.duelOfferItemCount;t++)this.duelOfferItemId[t]=this.duelOfferItemId[t+1],this.duelOfferItemStack[t]=this.duelOfferItemStack[t+1];break}this.duelOfferItemStack[i]--}this.packetStream.newPacket(ls.DUEL_ITEM_UPDATE),this.packetStream.putByte(this.duelOfferItemCount);for(let e=0;e<this.duelOfferItemCount;e++)this.packetStream.putShort(this.duelOfferItemId[e]),this.packetStream.putInt(this.duelOfferItemStack[e]);this.packetStream.sendPacket(),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1}}let i=!1;t>=93&&e>=221&&t<=104&&e<=232&&(this.duelSettingsRetreat=!this.duelSettingsRetreat,i=!0),t>=93&&e>=240&&t<=104&&e<=251&&(this.duelSettingsMagic=!this.duelSettingsMagic,i=!0),t>=191&&e>=221&&t<=202&&e<=232&&(this.duelSettingsPrayer=!this.duelSettingsPrayer,i=!0),t>=191&&e>=240&&t<=202&&e<=251&&(this.duelSettingsWeapons=!this.duelSettingsWeapons,i=!0),i&&(this.packetStream.newPacket(ls.DUEL_SETTINGS),this.packetStream.putByte(this.duelSettingsRetreat?1:0),this.packetStream.putByte(this.duelSettingsMagic?1:0),this.packetStream.putByte(this.duelSettingsPrayer?1:0),this.packetStream.putByte(this.duelSettingsWeapons?1:0),this.packetStream.sendPacket(),this.duelOfferOpponentAccepted=!1,this.duelOfferAccepted=!1),t>=217&&e>=238&&t<=286&&e<=259&&(this.duelOfferAccepted=!0,this.packetStream.newPacket(ls.DUEL_ACCEPT),this.packetStream.sendPacket()),t>=394&&e>=238&&t<463&&e<259&&(this.showDialogDuel=!1,this.packetStream.newPacket(ls.DUEL_DECLINE),this.packetStream.sendPacket())}else 0!==this.mouseButtonClick&&(this.showDialogDuel=!1,this.packetStream.newPacket(ls.DUEL_DECLINE),this.packetStream.sendPacket());this.mouseButtonClick=0,this.mouseButtonItemCountIncrement=0}if(this.showDialogDuel){this.surface.drawBox(22,36,468,12,13175581),this.surface.drawBoxAlpha(22,48,468,18,10000536,160),this.surface.drawBoxAlpha(22,66,8,248,10000536,160),this.surface.drawBoxAlpha(227,66,11,248,10000536,160),this.surface.drawBoxAlpha(484,66,6,248,10000536,160),this.surface.drawBoxAlpha(30,135,197,24,10000536,160),this.surface.drawBoxAlpha(30,228,197,23,10000536,160),this.surface.drawBoxAlpha(30,294,197,20,10000536,160),this.surface.drawBoxAlpha(238,271,246,43,10000536,160),this.surface.drawBoxAlpha(30,66,197,69,13684944,160),this.surface.drawBoxAlpha(30,159,197,69,13684944,160),this.surface.drawBoxAlpha(30,251,197,43,13684944,160),this.surface.drawBoxAlpha(238,66,246,205,13684944,160);for(let t=0;t<3;t++)this.surface.drawLineHoriz(30,66+34*t,197,0);for(let t=0;t<3;t++)this.surface.drawLineHoriz(30,159+34*t,197,0);for(let t=0;t<7;t++)this.surface.drawLineHoriz(238,66+34*t,246,0);for(let t=0;t<6;t++)t<5&&this.surface.drawLineVert(30+49*t,66,69,0),t<5&&this.surface.drawLineVert(30+49*t,159,69,0),this.surface.drawLineVert(238+49*t,66,205,0);this.surface.drawLineHoriz(30,251,197,0),this.surface.drawLineHoriz(30,293,197,0),this.surface.drawLineVert(30,251,43,0),this.surface.drawLineVert(226,251,43,0),this.surface.drawString("Preparing to duel with: "+this.duelOpponentName,23,46,1,16777215),this.surface.drawString("Your Stake",31,63,4,16777215),this.surface.drawString("Opponent's Stake",31,156,4,16777215),this.surface.drawString("Duel Options",31,248,4,16777215),this.surface.drawString("Your Inventory",238,63,4,16777215),this.surface.drawString("No retreating",31,267,3,16776960),this.surface.drawString("No magic",31,286,3,16776960),this.surface.drawString("No prayer",132,267,3,16776960),this.surface.drawString("No weapons",132,286,3,16776960),this.surface.drawBoxEdge(115,257,11,11,16776960),this.duelSettingsRetreat&&this.surface.drawBox(117,259,7,7,16776960),this.surface.drawBoxEdge(115,276,11,11,16776960),this.duelSettingsMagic&&this.surface.drawBox(117,278,7,7,16776960),this.surface.drawBoxEdge(213,257,11,11,16776960),this.duelSettingsPrayer&&this.surface.drawBox(215,259,7,7,16776960),this.surface.drawBoxEdge(213,276,11,11,16776960),this.duelSettingsWeapons&&this.surface.drawBox(215,278,7,7,16776960),this.duelOfferAccepted||this.surface._drawSprite_from3(239,274,this.spriteMedia+25),this.surface._drawSprite_from3(416,274,this.spriteMedia+26),this.duelOfferOpponentAccepted&&(this.surface.drawStringCenter("Other player",363,282,1,16777215),this.surface.drawStringCenter("has accepted",363,292,1,16777215)),this.duelOfferAccepted&&(this.surface.drawStringCenter("Waiting for",274,282,1,16777215),this.surface.drawStringCenter("other player",274,292,1,16777215));for(let t=0;t<this.inventoryItemsCount;t++){let e=239+t%5*49,i=67+34*(t/5|0);this.surface._spriteClipping_from9(e,i,48,32,this.spriteItem+bs.itemPicture[this.inventoryItemId[t]],bs.itemMask[this.inventoryItemId[t]],0,0,!1),0===bs.itemStackable[this.inventoryItemId[t]]&&this.surface.drawString(this.inventoryItemStackCount[t].toString(),e+1,i+10,1,16776960)}for(let t=0;t<this.duelOfferItemCount;t++){let e=31+t%4*49,i=67+34*(t/4|0);this.surface._spriteClipping_from9(e,i,48,32,this.spriteItem+bs.itemPicture[this.duelOfferItemId[t]],bs.itemMask[this.duelOfferItemId[t]],0,0,!1),0===bs.itemStackable[this.duelOfferItemId[t]]&&this.surface.drawString(this.duelOfferItemStack[t].toString(),e+1,i+10,1,16776960),this.mouseX>e&&this.mouseX<e+48&&this.mouseY>i&&this.mouseY<i+32&&this.surface.drawString(bs.itemName[this.duelOfferItemId[t]]+": @whi@"+bs.itemDescription[this.duelOfferItemId[t]],30,309,1,16776960)}for(let t=0;t<this.duelOfferOpponentItemCount;t++){let e=31+t%4*49,i=160+34*(t/4|0);this.surface._spriteClipping_from9(e,i,48,32,this.spriteItem+bs.itemPicture[this.duelOfferOpponentItemId[t]],bs.itemMask[this.duelOfferOpponentItemId[t]],0,0,!1),0===bs.itemStackable[this.duelOfferOpponentItemId[t]]&&this.surface.drawString(this.duelOfferOpponentItemStack[t].toString(),e+1,i+10,1,16776960),this.mouseX>e&&this.mouseX<e+48&&this.mouseY>i&&this.mouseY<i+32&&this.surface.drawString(bs.itemName[this.duelOfferOpponentItemId[t]]+": @whi@"+bs.itemDescription[this.duelOfferOpponentItemId[t]],30,309,1,16776960)}}}loadNextRegion(t,e){if(0!==this.deathScreenTimeout)return this.world.playerAlive=!1,!1;if(this.loadingArea=!1,t+=this.planeWidth,e+=this.planeHeight,this.lastHeightOffset===this.planeIndex&&t>this.localLowerX&&t<this.localUpperX&&e>this.localLowerY&&e<this.localUpperY)return this.world.playerAlive=!0,!1;this.surface.drawStringCenter("Loading... Please wait",256,192,1,16777215),this.drawChatMessageTabs(),this.surface.draw(this.graphics,0,0);let i=this.regionX,s=this.regionY,r=(t+24)/48|0,n=(e+24)/48|0;this.lastHeightOffset=this.planeIndex,this.regionX=48*r-48,this.regionY=48*n-48,this.localLowerX=48*r-32,this.localLowerY=48*n-32,this.localUpperX=48*r+32,this.localUpperY=48*n+32,this.world._loadSection_from3(t,e,this.lastHeightOffset),this.regionX-=this.planeWidth,this.regionY-=this.planeHeight;let o=this.regionX-i,a=this.regionY-s;for(let h=0;h<this.objectCount;h++){this.objectX[h]-=o,this.objectY[h]-=a;let t=this.objectX[h],e=this.objectY[h],i=this.objectId[h],s=this.objectModel[h];try{let r=this.objectDirection[h],n=0,o=0;0===r||4===r?(n=bs.objectWidth[i],o=bs.objectHeight[i]):(o=bs.objectWidth[i],n=bs.objectHeight[i]);let a=(t+t+n)*this.magicLoc/2|0,l=(e+e+o)*this.magicLoc/2|0;t>=0&&e>=0&&t<96&&e<96&&(this.scene.addModel(s),s.place(a,-this.world.getElevation(a,l),l),this.world.removeObject2(t,e,i),74===i&&s.translate(0,-480,0))}catch(Ui){console.log("Loc Error: "+Ui.message),console.error(Ui)}}for(let h=0;h<this.wallObjectCount;h++){this.wallObjectX[h]-=o,this.wallObjectY[h]-=a;let t=this.wallObjectX[h],e=this.wallObjectY[h],i=this.wallObjectId[h],s=this.wallObjectDirection[h];try{this.world._setObjectAdjacency_from4(t,e,s,i);let r=this.createModel(t,e,s,i,h);this.wallObjectModel[h]=r}catch(Ui){console.log("Bound Error: "+Ui.message),console.error(Ui)}}for(let h=0;h<this.groundItemCount;h++)this.groundItemX[h]-=o,this.groundItemY[h]-=a;for(let h=0;h<this.playerCount;h++){let t=this.players[h];t.currentX-=o*this.magicLoc,t.currentY-=a*this.magicLoc;for(let e=0;e<=t.waypointCurrent;e++)t.waypointsX[e]-=o*this.magicLoc,t.waypointsY[e]-=a*this.magicLoc}for(let h=0;h<this.npcCount;h++){let t=this.npcs[h];t.currentX-=o*this.magicLoc,t.currentY-=a*this.magicLoc;for(let e=0;e<=t.waypointCurrent;e++)t.waypointsX[e]-=o*this.magicLoc,t.waypointsY[e]-=a*this.magicLoc}return this.world.playerAlive=!0,!0}drawPlayer(t,e,i,s,r,n,o){const a=this.players[r];if(255===a.colourBottom)return;let h=a.animationCurrent+(this.cameraRotation+16)/32&7,l=!1,c=h;5===c?(c=3,l=!0):6===c?(c=2,l=!0):7===c&&(c=1,l=!0);let u=3*c+this.npcWalkModel[(a.stepCount/6|0)%4];8===a.animationCurrent?(h=2,l=!1,t-=5*o/100|0,u=3*(c=5)+this.npcCombatModelArray1[(this.loginTimer/5|0)%8]):9===a.animationCurrent&&(h=2,l=!0,t+=5*o/100|0,u=3*(c=5)+this.npcCombatModelArray2[(this.loginTimer/6|0)%8]);for(let d=0;d<12;d++){let r=this.npcAnimationArray[h][d],o=a.equippedItem[r]-1;if(o>=0){let h=0,d=0,m=u;if(l&&c>=1&&c<=3&&(1===bs.animationHasF[o]?m+=15:4===r&&1===c?(h=-22,d=-3,m=3*c+this.npcWalkModel[(2+(a.stepCount/6|0))%4]):4===r&&2===c?(h=0,d=-8,m=3*c+this.npcWalkModel[(2+(a.stepCount/6|0))%4]):4===r&&3===c?(h=26,d=-5,m=3*c+this.npcWalkModel[(2+(a.stepCount/6|0))%4]):3===r&&1===c?(h=22,d=3,m=3*c+this.npcWalkModel[(2+(a.stepCount/6|0))%4]):3===r&&2===c?(h=0,d=8,m=3*c+this.npcWalkModel[(2+(a.stepCount/6|0))%4]):3===r&&3===c&&(h=-26,d=5,m=3*c+this.npcWalkModel[(2+(a.stepCount/6|0))%4])),5!==c||1===bs.animationHasA[o]){let r=m+bs.animationNumber[o];h=h*i/this.surface.spriteWidthFull[r]|0,d=d*s/this.surface.spriteHeightFull[r]|0;let c=i*this.surface.spriteWidthFull[r]/this.surface.spriteWidthFull[bs.animationNumber[o]]|0;h-=(c-i)/2|0;let u=bs.animationCharacterColour[o];const p=this.characterSkinColours[a.colourSkin];1===u?u=this.characterHairColours[a.colourHair]:2===u?u=this.characterTopBottomColours[a.colourTop]:3===u&&(u=this.characterTopBottomColours[a.colourBottom]),this.surface._spriteClipping_from9(t+h,e+d,c,s,r,u,p,n,l)}}}if(a.messageTimeout>0&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=this.surface.textWidth(a.message,1)/2|0,this.receivedMessageMidPoint[this.receivedMessagesCount]>150&&(this.receivedMessageMidPoint[this.receivedMessagesCount]=150),this.receivedMessageHeight[this.receivedMessagesCount]=(this.surface.textWidth(a.message,1)/300|0)*this.surface.textHeight(1),this.receivedMessageX[this.receivedMessagesCount]=t+(i/2|0),this.receivedMessageY[this.receivedMessagesCount]=e,this.receivedMessages[this.receivedMessagesCount++]=a.message),a.bubbleTimeout>0&&(this.actionBubbleX[this.itemsAboveHeadCount]=t+(i/2|0),this.actionBubbleY[this.itemsAboveHeadCount]=e,this.actionBubbleScale[this.itemsAboveHeadCount]=o,this.actionBubbleItem[this.itemsAboveHeadCount++]=a.bubbleItem),8===a.animationCurrent||9===a.animationCurrent||0!==a.combatTimer){if(a.combatTimer>0){let s=t;8===a.animationCurrent?s-=20*o/100|0:9===a.animationCurrent&&(s+=20*o/100|0);let r=30*a.healthCurrent/a.healthMax|0;this.healthBarX[this.healthBarCount]=s+(i/2|0),this.healthBarY[this.healthBarCount]=e,this.healthBarMissing[this.healthBarCount++]=r}if(a.combatTimer>150){let r=t;8===a.animationCurrent?r-=10*o/100|0:9===a.animationCurrent&&(r+=10*o/100|0),this.surface._drawSprite_from3(r+(i/2|0)-12,e+(s/2|0)-12,this.spriteMedia+11),this.surface.drawStringCenter(a.damageTaken.toString(),r+(i/2|0)-1,e+(s/2|0)+5,3,16777215)}}if(1===a.skullVisible&&0===a.bubbleTimeout){let s=n+t+(i/2|0);8===a.animationCurrent?s-=20*o/100|0:9===a.animationCurrent&&(s+=20*o/100|0);let r=16*o/100|0,h=16*o/100|0;this.surface._spriteClipping_from5(s-(r/2|0),e-(h/2|0)-(10*o/100|0),r,h,this.spriteMedia+13)}}async loadMedia(){const t=await this.readDataFile(`media${Ki}.jag`,"2d graphics",20);if(null===t)return void(this.errorLoadingData=!0);const e=Li.loadData("index.dat",0,t);this.surface.parseSprite(this.spriteMedia,Li.loadData("inv1.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+1,Li.loadData("inv2.dat",0,t),e,6),this.surface.parseSprite(this.spriteMedia+9,Li.loadData("bubble.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+10,Li.loadData("runescape.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+11,Li.loadData("splat.dat",0,t),e,3),this.surface.parseSprite(this.spriteMedia+14,Li.loadData("icon.dat",0,t),e,8),this.surface.parseSprite(this.spriteMedia+22,Li.loadData("hbar.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+23,Li.loadData("hbar2.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+24,Li.loadData("compass.dat",0,t),e,1),this.surface.parseSprite(this.spriteMedia+25,Li.loadData("buttons.dat",0,t),e,2),this.surface.parseSprite(this.spriteUtil,Li.loadData("scrollbar.dat",0,t),e,2),this.surface.parseSprite(this.spriteUtil+2,Li.loadData("corners.dat",0,t),e,4),this.surface.parseSprite(this.spriteUtil+6,Li.loadData("arrows.dat",0,t),e,2),this.surface.parseSprite(this.spriteProjectile,Li.loadData("projectile.dat",0,t),e,bs.projectileSprite);let i=bs.itemSpriteCount;for(let s=1;i>0;s++){let r=i;i-=30,r>30&&(r=30),this.surface.parseSprite(this.spriteItem+30*(s-1),Li.loadData(`objects${s}.dat`,0,t),e,r)}this.surface.loadSprite(this.spriteMedia),this.surface.loadSprite(this.spriteMedia+9);for(let s=11;s<=26;s++)this.surface.loadSprite(this.spriteMedia+s);for(let s=0;s<bs.projectileSprite;s++)this.surface.loadSprite(this.spriteProjectile+s);for(let s=0;s<bs.itemSpriteCount;s++)this.surface.loadSprite(this.spriteItem+s)}async startGame(){if(this.port=this.port||43595,this.maxReadTries=1e3,cs.clientVersion=Vi,await this.loadGameConfig(),this.errorLoadingData)return;this.spriteMedia=2e3,this.spriteUtil=this.spriteMedia+100,this.spriteItem=this.spriteUtil+50,this.spriteLogo=this.spriteItem+1e3,this.spriteProjectile=this.spriteLogo+10,this.spriteTexture=this.spriteProjectile+50,this.spriteTextureWorld=this.spriteTexture+10,this.graphics=this.getGraphics(),this.setTargetFps(50),this.surface=new Fi(this.gameWidth,this.gameHeight+12,4e3,this),this.surface.mudclientref=this,this.surface.setBounds(0,0,this.gameWidth,this.gameHeight+12),As.drawBackgroundArrow=!1,As.baseSpriteStart=this.spriteUtil;let t=this.surface.width2-199,e=36;this.options.mobile&&(t-=32,e=this.gameHeight/2-137.5|0),this.panelQuestList=new As(this.surface,5),this.controlListQuest=this.panelQuestList.addTextListInteractive(t,e+24,196,251,1,500,!0),this.options.mobile&&(t=35,e=this.gameHeight/2-91|0),this.panelMagic=new As(this.surface,5),this.controlListMagic=this.panelMagic.addTextListInteractive(t,e+24,196,90,1,500,!0),this.panelSocialList=new As(this.surface,5),this.controlListSocialPlayers=this.panelSocialList.addTextListInteractive(t,e+40,196,126,1,500,!0),await this.loadMedia(),this.errorLoadingData||(await this.loadEntities(),this.errorLoadingData||(this.scene=new Ts(this.surface,15e3,15e3,1e3),this.scene.view=vs._from2(1e6,1e3),this.scene.setBounds(this.gameWidth/2|0,this.gameHeight/2|0,this.gameWidth/2|0,this.gameHeight/2|0,this.gameWidth,this.const_9),this.scene.clipFar3d=2400,this.scene.clipFar2d=2400,this.scene.fogZFalloff=1,this.scene.fogZDistance=2300,this.scene._setLight_from3(-50,-10,-50),this.world=new yr(this.scene,this.surface),this.world.baseMediaSprite=this.spriteMedia,await this.loadTextures(),this.errorLoadingData||(await this.loadModels(),this.errorLoadingData||(await this.loadMaps(),this.errorLoadingData||(this.members&&await this.loadSounds(),this.errorLoadingData||(this.showLoadingProgress(100,"Starting game..."),this.createMessageTabPanel(),this.createLoginPanels(),this.createAppearancePanel(),this.resetLoginScreenVariables(),this.renderLoginScreenViewports()))))))}hasInventoryItems(t,e){return!(31!==t||!(this.isItemEquipped(197)||this.isItemEquipped(615)||this.isItemEquipped(682)))||!(32!==t||!(this.isItemEquipped(102)||this.isItemEquipped(616)||this.isItemEquipped(683)))||!(33!==t||!(this.isItemEquipped(101)||this.isItemEquipped(617)||this.isItemEquipped(684)))||!(34!==t||!(this.isItemEquipped(103)||this.isItemEquipped(618)||this.isItemEquipped(685)))||this.getInventoryCount(t)>=e}getHostnameIP(t){return Li.ipToString(t)}cantLogout(){this.logoutTimeout=0,this.showMessage("@cya@Sorry, you can't logout at the moment",3)}drawGame(){if(0!==this.deathScreenTimeout)return this.surface.fadeToBlack(),this.surface.drawStringCenter("Oh dear! You are dead...",this.gameWidth/2|0,this.gameHeight/2|0,7,16711680),this.drawChatMessageTabs(),void this.surface.draw(this.graphics,0,0);if(this.showAppearanceChange)this.drawAppearancePanelCharacterSprites();else if(this.isSleeping)this.drawSleep();else if(this.world.playerAlive){for(let t=0;t<64;t++)this.scene.removeModel(this.world.roofModels[this.lastHeightOffset][t]),0===this.lastHeightOffset&&(this.scene.removeModel(this.world.wallModels[1][t]),this.scene.removeModel(this.world.roofModels[1][t]),this.scene.removeModel(this.world.wallModels[2][t]),this.scene.removeModel(this.world.roofModels[2][t])),this.options.showRoofs&&(this.fogOfWar=!0,0===this.lastHeightOffset&&0==(128&this.world.objectAdjacency.get(this.localPlayer.currentX/128|0,this.localPlayer.currentY/128|0))&&(this.scene.addModel(this.world.roofModels[this.lastHeightOffset][t]),0===this.lastHeightOffset&&(this.scene.addModel(this.world.wallModels[1][t]),this.scene.addModel(this.world.roofModels[1][t]),this.scene.addModel(this.world.wallModels[2][t]),this.scene.addModel(this.world.roofModels[2][t])),this.fogOfWar=!1));if(this.objectAnimationNumberFireLightningSpell!==this.lastObjectAnimationNumberFireLightningSpell){this.lastObjectAnimationNumberFireLightningSpell=this.objectAnimationNumberFireLightningSpell;for(let t=0;t<this.objectCount;t++)97===this.objectId[t]&&this.updateObjectAnimation(t,"firea"+(this.objectAnimationNumberFireLightningSpell+1)),274===this.objectId[t]&&this.updateObjectAnimation(t,"fireplacea"+(this.objectAnimationNumberFireLightningSpell+1)),1031===this.objectId[t]&&this.updateObjectAnimation(t,"lightning"+(this.objectAnimationNumberFireLightningSpell+1)),1036===this.objectId[t]&&this.updateObjectAnimation(t,"firespell"+(this.objectAnimationNumberFireLightningSpell+1)),1147===this.objectId[t]&&this.updateObjectAnimation(t,"spellcharge"+(this.objectAnimationNumberFireLightningSpell+1))}if(this.objectAnimationNumberTorch!==this.lastObjectAnimationNumberTorch){this.lastObjectAnimationNumberTorch=this.objectAnimationNumberTorch;for(let t=0;t<this.objectCount;t++)51===this.objectId[t]&&this.updateObjectAnimation(t,"torcha"+(this.objectAnimationNumberTorch+1)),143===this.objectId[t]&&this.updateObjectAnimation(t,"skulltorcha"+(this.objectAnimationNumberTorch+1))}if(this.objectAnimationNumberClaw!==this.lastObjectAnimationNumberClaw){this.lastObjectAnimationNumberClaw=this.objectAnimationNumberClaw;for(let t=0;t<this.objectCount;t++)1142===this.objectId[t]&&this.updateObjectAnimation(t,"clawspell"+(this.objectAnimationNumberClaw+1))}this.scene.reduceSprites(this.spriteCount),this.spriteCount=0;for(let t=0;t<this.playerCount;t++){const e=this.players[t];if(255!==e.colourBottom){const i=e.currentX,s=e.currentY,r=-this.world.getElevation(i,s),n=this.scene.addSprite(5e3+t,i,r,s,145,220,t+1e4);this.spriteCount++,e===this.localPlayer&&this.scene.setLocalPlayer(n),8===e.animationCurrent&&this.scene.setSpriteTranslateX(n,-30),9===e.animationCurrent&&this.scene.setSpriteTranslateX(n,30)}}for(let t=0;t<this.playerCount;t++){const e=this.players[t];if(e.projectileRange>0){let t=null;if(-1!==e.attackingNpcServerIndex?t=this.npcsServer[e.attackingNpcServerIndex]:-1!==e.attackingPlayerServerIndex&&(t=this.playerServer[e.attackingPlayerServerIndex]),null!==t){const i=e.currentX,s=e.currentY,r=-this.world.getElevation(i,s)-110,n=t.currentX,o=t.currentY,a=-(this.world.getElevation(n,o)-bs.npcHeight[t.npcId]/2|0),h=(i*e.projectileRange+n*(this.projectileMaxRange-e.projectileRange))/this.projectileMaxRange|0,l=(r*e.projectileRange+a*(this.projectileMaxRange-e.projectileRange))/this.projectileMaxRange|0,c=(s*e.projectileRange+o*(this.projectileMaxRange-e.projectileRange))/this.projectileMaxRange|0;this.scene.addSprite(this.spriteProjectile+e.incomingProjectileSprite,h,l,c,32,32,0),this.spriteCount++}}}for(let t=0;t<this.npcCount;t++){const e=this.npcs[t],i=e.currentX,s=e.currentY,r=-this.world.getElevation(i,s),n=this.scene.addSprite(2e4+t,i,r,s,bs.npcWidth[e.npcId],bs.npcHeight[e.npcId],t+3e4);this.spriteCount++,8===e.animationCurrent&&this.scene.setSpriteTranslateX(n,-30),9===e.animationCurrent&&this.scene.setSpriteTranslateX(n,30)}for(let t=0;t<this.groundItemCount;t++){const e=this.groundItemX[t]*this.magicLoc+64,i=this.groundItemY[t]*this.magicLoc+64;this.scene.addSprite(4e4+this.groundItemID[t],e,-this.world.getElevation(e,i)-this.groundItemZ[t],i,96,64,t+2e4),this.spriteCount++}for(let t=0;t<this.teleportBubbleCount;t++){const e=this.teleportBubbleX[t]*this.magicLoc+64,i=this.teleportBubbleY[t]*this.magicLoc+64,s=this.teleportBubbleType[t];0===s&&(this.scene.addSprite(5e4+t,e,-this.world.getElevation(e,i),i,128,256,t+5e4),this.spriteCount++),1===s&&(this.scene.addSprite(5e4+t,e,-this.world.getElevation(e,i),i,128,64,t+5e4),this.spriteCount++)}if(this.surface.interlace=!1,this.surface.blackScreen(),this.surface.interlace=this.interlace,3===this.lastHeightOffset){const t=40+(3*Math.random()|0),e=40+(7*Math.random()|0);this.scene._setLight_from5(t,e,-50,-10,-50)}if(this.itemsAboveHeadCount=0,this.receivedMessagesCount=0,this.healthBarCount=0,this.cameraAutoAngleDebug){if(this.optionCameraModeAuto&&!this.fogOfWar){const t=this.cameraAngle;this.autoRotateCamera(),this.cameraAngle!==t&&(this.cameraAutoRotatePlayerX=this.localPlayer.currentX,this.cameraAutoRotatePlayerY=this.localPlayer.currentY)}this.scene.clipFar3d=3e3,this.scene.clipFar2d=3e3,this.scene.fogZFalloff=1,this.scene.fogZDistance=2800,this.cameraRotation=32*this.cameraAngle;const t=this.cameraAutoRotatePlayerX+this.cameraRotationX,e=this.cameraAutoRotatePlayerY+this.cameraRotationY;this.scene.setCamera(t,-this.world.getElevation(t,e),e,912,4*this.cameraRotation,0,2e3)}else{this.optionCameraModeAuto&&!this.fogOfWar&&this.autoRotateCamera(),this.interlace?(this.scene.clipFar3d=2200,this.scene.clipFar2d=2200,this.scene.fogZFalloff=1,this.scene.fogZDistance=2100):(this.scene.clipFar3d=2400,this.scene.clipFar2d=2400,this.scene.fogZFalloff=1,this.scene.fogZDistance=2300),this.cameraZoom>750&&(this.scene.clipFar3d+=1400,this.scene.clipFar2d+=1400,this.scene.fogZDistance+=1400);let t=this.cameraAutoRotatePlayerX+this.cameraRotationX,e=this.cameraAutoRotatePlayerY+this.cameraRotationY;this.scene.setCamera(t,-this.world.getElevation(t,e),e,912,4*this.cameraRotation,0,2*this.cameraZoom)}if(this.scene.render(),this.drawAboveHeadStuff(),this.mouseClickXStep>0&&this.surface._drawSprite_from3(this.mouseClickXX-8,this.mouseClickXY-8,this.spriteMedia+14+((24-this.mouseClickXStep)/6|0)),this.mouseClickXStep<0&&this.surface._drawSprite_from3(this.mouseClickXX-8,this.mouseClickXY-8,this.spriteMedia+18+((24+this.mouseClickXStep)/6|0)),this.options.retroFPSCounter){const t=this.isInWild?70:0;this.surface.drawString("Fps: "+(0|this.fps),this.gameWidth-62-t,this.gameHeight-10,1,16776960)}if(0!==this.systemUpdate){let t=this.systemUpdate/50|0;const e=t/60|0;(t%=60)<10?this.surface.drawStringCenter("System update in: "+e+":0"+t,256,this.gameHeight-7,1,16776960):this.surface.drawStringCenter("System update in: "+e+":"+t,256,this.gameHeight-7,1,16776960)}if(!this.loadingArea){let t=2203-(this.localRegionY+this.planeHeight+this.regionY);if(this.localRegionX+this.planeWidth+this.regionX>=2640&&(t=-50),this.isInWild=t>0,this.isInWild){let e=1+(t/6|0);this.surface._drawSprite_from3(this.gameWidth-59,this.gameHeight-56,this.spriteMedia+13),this.surface.drawStringCenter("Wilderness",this.gameWidth-47,this.gameHeight-20,1,16776960),this.surface.drawStringCenter("Level: "+e,this.gameWidth-47,this.gameHeight-7,1,16776960),0===this.showUiWildWarn&&(this.showUiWildWarn=2)}0===this.showUiWildWarn&&t>-10&&t<=0&&(this.showUiWildWarn=1)}if(0===this.messageTabSelected)for(let t=0;t<5;t++)if(this.messageHistoryTimeout[t]>0){let e=this.messageHistory[t];this.surface.drawString(e,7,this.gameHeight-18-12*t,1,16776960)}this.panelMessageTabs.hide(this.controlTextListChat),this.panelMessageTabs.hide(this.controlTextListQuest),this.panelMessageTabs.hide(this.controlTextListPrivate),1===this.messageTabSelected?this.panelMessageTabs.show(this.controlTextListChat):2===this.messageTabSelected?this.panelMessageTabs.show(this.controlTextListQuest):3===this.messageTabSelected&&this.panelMessageTabs.show(this.controlTextListPrivate),As.textListEntryHeightMod=2,this.panelMessageTabs.drawPanel(),As.textListEntryHeightMod=0,this.options.mobile||this.surface._drawSpriteAlpha_from4(this.surface.width2-3-197,3,this.spriteMedia,128),this.drawUI(),this.surface.loggedIn=!1,this.drawChatMessageTabs(),this.surface.draw(this.graphics,0,0),this.options.mobile&&this.drawMobileUI()}}async loadSounds(){try{this.soundData=await this.readDataFile(`sounds${Ji}.mem`,"Sound effects",90),this.audioPlayer=new class{constructor(){this.player=new Gs({encoding:"16bitInt",channels:1,sampleRate:8e3})}stopPlayer(){this.player.destroy()}writeStream(t,e,i){const s=$s.decode(new Uint8Array(t.slice(e,e+i)));this.player.feed(s)}}}catch(Ui){console.error(Ui)}}isItemEquipped(t){for(let e=0;e<this.inventoryItemsCount;e++)if(this.inventoryItemId[e]===t&&1===this.inventoryEquipped[e])return!0;return!1}async loadEntities(){const t=await this.readDataFile(`entity${Zi}.jag`,"people and monsters",30);if(!t)return void(this.errorLoadingData=!0);const e=Li.loadData("index.dat",0,t);let i=null,s=null;if(this.members){if(!(i=await this.readDataFile("entity"+Zi+".mem","member graphics",45)))return void(this.errorLoadingData=!0);s=Li.loadData("index.dat",0,i)}let r=0;this.animationIndex=0;t:for(let n=0;n<bs.animationCount;n++){let o=bs.animationName[n];for(let t=0;t<n;t++)if(bs.animationName[t].toLowerCase()===o.toLowerCase()){bs.animationNumber[n]=bs.animationNumber[t];continue t}let a=Li.loadData(o+".dat",0,t),h=e;if(null===a&&this.members&&(a=Li.loadData(o+".dat",0,i),h=s),null!==a){if(this.surface.parseSprite(this.animationIndex,a,h,15),r+=15,1===bs.animationHasA[n]){let n=Li.loadData(o+"a.dat",0,t),a=e;null===n&&this.members&&(n=Li.loadData(o+"a.dat",0,i),a=s),this.surface.parseSprite(this.animationIndex+15,n,a,3),r+=3}if(1===bs.animationHasF[n]){let n=Li.loadData(o+"f.dat",0,t),a=e;null===n&&this.members&&(n=Li.loadData(o+"f.dat",0,i),a=s),this.surface.parseSprite(this.animationIndex+18,n,a,9),r+=9}if(0!==bs.animationGender[n])for(let t=this.animationIndex;t<this.animationIndex+27;t++)this.surface.loadSprite(t)}bs.animationNumber[n]=this.animationIndex,this.animationIndex+=27}console.log("Loaded: "+r+" frames of animation")}draw(){if(this.errorLoadingData){const t=this.getGraphics();t.setColor(rt.black),t.fillRect(0,0,512,356),t.setFont(new ot("Helvetica",1,16)),t.setColor(rt.yellow);let e=35;return t.drawString("Sorry, an error has occured whilst loading RuneScape",30,e),e+=50,t.setColor(rt.white),t.drawString("To fix this try the following (in order):",30,e),e+=50,t.setColor(rt.white),t.setFont(new ot("Helvetica",1,12)),t.drawString("1: Try closing ALL open web-browser windows, and reloading",30,e),e+=30,t.drawString("2: Try clearing your web-browsers cache from tools->internet options",30,e),e+=30,t.drawString("3: Try using a different game-world",30,e),e+=30,t.drawString("4: Try rebooting your computer",30,e),e+=30,t.drawString("5: Try selecting a different version of Java from the play-game menu",30,e),void this.setTargetFps(1)}if(this.errorLoadingCodebase){const t=this.getGraphics();return t.setColor(rt.black),t.fillRect(0,0,512,356),t.setFont(new ot("Helvetica",1,20)),t.setColor(rt.white),t.drawString("Error - unable to load game!",50,50),t.drawString("To play RuneScape make sure you play from",50,100),t.drawString("http://www.runescape.com",50,150),void this.setTargetFps(1)}if(this.errorLoadingMemory){const t=this.getGraphics();return t.setColor(rt.black),t.fillRect(0,0,512,356),t.setFont(new ot("Helvetica",1,20)),t.setColor(rt.white),t.drawString("Error - out of memory!",50,50),t.drawString("Close ALL unnecessary programs",50,100),t.drawString("and windows before loading the game",50,150),t.drawString("RuneScape needs about 48meg of spare RAM",50,200),void this.setTargetFps(1)}try{0===this.loggedIn?(this.surface.loggedIn=!1,this.drawLoginScreens()):1===this.loggedIn&&(this.surface.loggedIn=!0,this.drawGame())}catch(Ui){console.error(Ui),this.disposeAndCollect(),this.errorLoadingMemory=!0}}onClosing(){this.closeConnection(),this.disposeAndCollect(),this.audioPlayer&&this.audioPlayer.stopPlayer()}drawDialogDuelConfirm(){this.surface.drawBox(22,36,468,16,192),this.surface.drawBoxAlpha(22,52,468,246,10000536,160),this.surface.drawStringCenter("Please confirm your duel with @yel@"+Li.hashToUsername(this.duelOpponentNameHash),256,48,1,16777215),this.surface.drawStringCenter("Your stake:",139,66,1,16776960);for(let t=0;t<this.duelItemsCount;t++){let e=bs.itemName[this.duelItems[t]];0===bs.itemStackable[this.duelItems[t]]&&(e=e+" x "+Li.formatConfirmAmount(this.duelItemCount[t])),this.surface.drawStringCenter(e,139,78+12*t,1,16777215)}0===this.duelItemsCount&&this.surface.drawStringCenter("Nothing!",139,78,1,16777215),this.surface.drawStringCenter("Your opponent's stake:",373,66,1,16776960);for(let t=0;t<this.duelOpponentItemsCount;t++){let e=bs.itemName[this.duelOpponentItems[t]];0===bs.itemStackable[this.duelOpponentItems[t]]&&(e=e+" x "+Li.formatConfirmAmount(this.duelOpponentItemCount[t])),this.surface.drawStringCenter(e,373,78+12*t,1,16777215)}0===this.duelOpponentItemsCount&&this.surface.drawStringCenter("Nothing!",373,78,1,16777215),0===this.duelOptionRetreat?this.surface.drawStringCenter("You can retreat from this duel",256,216,1,65280):this.surface.drawStringCenter("No retreat is possible!",256,216,1,16711680),0===this.duelOptionMagic?this.surface.drawStringCenter("Magic may be used",256,228,1,65280):this.surface.drawStringCenter("Magic cannot be used",256,228,1,16711680),0===this.duelOptionPrayer?this.surface.drawStringCenter("Prayer may be used",256,240,1,65280):this.surface.drawStringCenter("Prayer cannot be used",256,240,1,16711680),0===this.duelOptionWeapons?this.surface.drawStringCenter("Weapons may be used",256,252,1,65280):this.surface.drawStringCenter("Weapons cannot be used",256,252,1,16711680),this.surface.drawStringCenter("If you are sure click 'Accept' to begin the duel",256,266,1,16777215),this.duelAccepted?this.surface.drawStringCenter("Waiting for other player...",256,286,1,16776960):(this.surface._drawSprite_from3(105,274,this.spriteMedia+25),this.surface._drawSprite_from3(339,274,this.spriteMedia+26)),1===this.mouseButtonClick&&((this.mouseX<22||this.mouseY<36||this.mouseX>490||this.mouseY>298)&&(this.showDialogDuelConfirm=!1,this.packetStream.newPacket(ls.TRADE_DECLINE),this.packetStream.sendPacket()),this.mouseX>=105&&this.mouseX<=210&&this.mouseY>=274&&this.mouseY<=295&&(this.duelAccepted=!0,this.packetStream.newPacket(ls.DUEL_CONFIRM_ACCEPT),this.packetStream.sendPacket()),this.mouseX>=339&&this.mouseX<=445&&this.mouseY>=274&&this.mouseY<=295&&(this.showDialogDuelConfirm=!1,this.packetStream.newPacket(ls.DUEL_DECLINE),this.packetStream.sendPacket()),this.mouseButtonClick=0)}walkToGroundItem(t,e,i,s,r){return this.walkTo(t,e,i,s,i,s,!1,r)?void 0:void this._walkToActionSource_from8(t,e,i,s,i,s,!0,r)}async loadModels(){for(const e of Yr)bs.getModelIndex(e);const t=await this.readDataFile(`models${Qi}.jag`,"3d models",60);if(t)for(let e=0;e<bs.modelCount;e++){const i=Li.getDataFileOffset(bs.modelName[e]+".ob3",t);this.gameModels[e]=0!==i?vs.fromBytes(t,i):vs._from2(1,1),"giantcrystal"===bs.modelName[e].toLowerCase()&&(this.gameModels[e].transparent=!0)}else this.errorLoadingData=!0}showMessage(t,e){if(2===e||4===e||6===e){for(;t.length>5&&"@"===t[0]&&"@"===t[4];t=t.substring(5));const e=t.indexOf(":");if(-1!==e){const i=t.substring(0,e),s=Li.usernameToHash(i);for(let t=0;t<this.ignoreListCount;t++)if(this.ignoreList[t].equals(s))return}}2===e?t="@yel@"+t:3===e||4===e?t="@whi@"+t:6===e&&(t="@cya@"+t),0!==this.messageTabSelected&&(4!==e&&3!==e||(this.messageTabFlashAll=200),2===e&&1!==this.messageTabSelected&&(this.messageTabFlashHistory=200),5===e&&2!==this.messageTabSelected&&(this.messageTabFlashQuest=200),6===e&&3!==this.messageTabSelected&&(this.messageTabFlashPrivate=200),3===e&&0!==this.messageTabSelected&&(this.messageTabSelected=0),6===e&&3!==this.messageTabSelected&&0!==this.messageTabSelected&&(this.messageTabSelected=0));for(let i=4;i>0;i--)this.messageHistory[i]=this.messageHistory[i-1],this.messageHistoryTimeout[i]=this.messageHistoryTimeout[i-1];if(this.messageHistory[0]=t,this.messageHistoryTimeout[0]=300,2===e)this.panelMessageTabs.controlFlashText[this.controlTextListChat]===this.panelMessageTabs.controlListEntryCount[this.controlTextListChat]-4?this.panelMessageTabs.removeListEntry(this.controlTextListChat,t,!0):this.panelMessageTabs.removeListEntry(this.controlTextListChat,t,!1);else if(5===e)this.panelMessageTabs.controlFlashText[this.controlTextListQuest]===this.panelMessageTabs.controlListEntryCount[this.controlTextListQuest]-4?this.panelMessageTabs.removeListEntry(this.controlTextListQuest,t,!0):this.panelMessageTabs.removeListEntry(this.controlTextListQuest,t,!1);else if(6===e){if(this.panelMessageTabs.controlFlashText[this.controlTextListPrivate]===this.panelMessageTabs.controlListEntryCount[this.controlTextListPrivate]-4)return void this.panelMessageTabs.removeListEntry(this.controlTextListPrivate,t,!0);this.panelMessageTabs.removeListEntry(this.controlTextListPrivate,t,!1)}}walkToObject(t,e,i,s){let r=0,n=0;0===i||4===i?(r=bs.objectWidth[s],n=bs.objectHeight[s]):(n=bs.objectWidth[s],r=bs.objectHeight[s]),2===bs.objectType[s]||3===bs.objectType[s]?(0===i?(t--,r++):2===i?n++:4===i?r++:6===i&&(e--,n++),this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e,t+r-1,e+n-1,!1,!0)):this._walkToActionSource_from8(this.localRegionX,this.localRegionY,t,e,t+r-1,e+n-1,!0,!0)}getInventoryCount(t){let e=0;for(let i=0;i<this.inventoryItemsCount;i++)this.inventoryItemId[i]===t&&(1===bs.itemStackable[t]?e++:e+=this.inventoryItemStackCount[i]);return e}async loadTextures(){const t=await this.readDataFile(`textures${ts}.jag`,"Textures",50);if(!t)return void(this.errorLoadingData=!0);const e=Li.loadData("index.dat",0,t);this.scene.allocateTextures(bs.textureCount,7,11);for(let i=0;i<bs.textureCount;i++){const s=bs.textureName[i];let r=Li.loadData(s+".dat",0,t);this.surface.parseSprite(this.spriteTexture,r,e,1),this.surface.drawBox(0,0,128,128,16711935),this.surface._drawSprite_from3(0,0,this.spriteTexture);let n=this.surface.spriteWidthFull[this.spriteTexture],o=bs.textureSubtypeName[i];if(null!==o&&o.length>0){let i=Li.loadData(o+".dat",0,t);this.surface.parseSprite(this.spriteTexture,i,e,1),this.surface._drawSprite_from3(0,0,this.spriteTexture)}this.surface._drawSprite_from5(this.spriteTextureWorld+i,0,0,n,n);let a=n*n;for(let t=0;t<a;t++)65280===this.surface.surfacePixels[this.spriteTextureWorld+i][t]&&(this.surface.surfacePixels[this.spriteTextureWorld+i][t]=16711935);this.surface.drawWorld(this.spriteTextureWorld+i),this.scene.defineTexture(i,this.surface.spriteColoursUsed[this.spriteTextureWorld+i],this.surface.spriteColourList[this.spriteTextureWorld+i],(n/64|0)-1)}}handleMouseDown(t,e,i){this.mouseClickXHistory[this.mouseClickCount]=e,this.mouseClickYHistory[this.mouseClickCount]=i,this.mouseClickCount=this.mouseClickCount+1&8191;for(let s=10;s<4e3;s++){let t=this.mouseClickCount-s&8191;if(this.mouseClickXHistory[t]===e&&this.mouseClickYHistory[t]===i){let r=!1;for(let n=1;n<s;n++){let o=this.mouseClickCount-n&8191,a=t-n&8191;if(this.mouseClickXHistory[a]===e&&this.mouseClickYHistory[a]===i||(r=!0),this.mouseClickXHistory[o]!==this.mouseClickXHistory[a]||this.mouseClickYHistory[o]!==this.mouseClickYHistory[a])break;if(n===s-1&&r&&0===this.combatTimeout&&0===this.logoutTimeout)return void this.sendLogout()}}}}drawTeleportBubble(t,e,i,s,r){const n=this.teleportBubbleType[r],o=this.teleportBubbleTime[r];if(0===n){const r=255+5*o*256;this.surface.drawCircle(t+(i/2|0),e+(s/2|0),20+2*o,r,255-5*o)}else if(1===n){const r=16711680+5*o*256;this.surface.drawCircle(t+(i/2|0),e+(s/2|0),10+o,r,255-5*o)}}showServerMessage(t){/^@bor@/.test(t)?this.showMessage(t,4):/^@que@/.test(t)?this.showMessage("@whi@"+t,5):/^@pri@/.test(t)?this.showMessage(t,6):this.showMessage(t,3)}updateObjectAnimation(t,e){const i=this.objectX[t],s=this.objectY[t],r=i-(this.localPlayer.currentX/128|0),n=s-(this.localPlayer.currentY/128|0);if(i>=0&&s>=0&&i<96&&s<96&&r>-7&&r<7&&n>-7&&n<7){this.scene.removeModel(this.objectModel[t]);const i=bs.getModelIndex(e),s=this.gameModels[i].copy();this.scene.addModel(s),s._setLight_from6(!0,48,48,-50,-10,-50),s.copyPosition(this.objectModel[t]),s.key=t,this.objectModel[t]=s}}createTopMouseMenu(){(this.selectedSpell>=0||this.selectedItemInventoryIndex>=0)&&(this.menuItemText1[this.menuItemsCount]="Cancel",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=4e3,this.menuItemsCount++);for(let t=0;t<this.menuItemsCount;t++)this.menuIndices[t]=t;for(let t=!1;!t;){t=!0;for(let e=0;e<this.menuItemsCount-1;e++){let i=this.menuIndices[e],s=this.menuIndices[e+1];this.menuType[i]>this.menuType[s]&&(this.menuIndices[e]=s,this.menuIndices[e+1]=i,t=!1)}}if(this.menuItemsCount>20&&(this.menuItemsCount=20),this.menuItemsCount>0){let t=-1;for(let i=0;i<this.menuItemsCount;i++)if(!(null===this.menuItemText2[this.menuIndices[i]]||this.menuItemText2[this.menuIndices[i]].length<=0)){t=i;break}let e=null;if((this.selectedItemInventoryIndex>=0||this.selectedSpell>=0)&&1===this.menuItemsCount?e="Choose a target":(this.selectedItemInventoryIndex>=0||this.selectedSpell>=0)&&this.menuItemsCount>1?e="@whi@"+this.menuItemText1[this.menuIndices[0]]+" "+this.menuItemText2[this.menuIndices[0]]:-1!==t&&(e=this.menuItemText2[this.menuIndices[t]]+": @whi@"+this.menuItemText1[this.menuIndices[0]]),2===this.menuItemsCount&&null!==e&&(e+="@whi@ / 1 more option"),this.menuItemsCount>2&&null!==e&&(e=e+"@whi@ / "+(this.menuItemsCount-1)+" more options"),!this.options.mobile&&e&&this.surface.drawString(e,6,14,1,16776960),!this.optionMouseButtonOne&&1===this.mouseButtonClick||this.optionMouseButtonOne&&1===this.mouseButtonClick&&1===this.menuItemsCount)return this.menuItemClick(this.menuIndices[0]),void(this.mouseButtonClick=0);if(!this.optionMouseButtonOne&&2===this.mouseButtonClick||this.optionMouseButtonOne&&1===this.mouseButtonClick){this.menuHeight=15*(this.menuItemsCount+1),this.menuWidth=this.surface.textWidth("Choose option",1)+5;for(let t=0;t<this.menuItemsCount;t++){let e=this.surface.textWidth(this.menuItemText1[t]+" "+this.menuItemText2[t],1)+5;e>this.menuWidth&&(this.menuWidth=e)}this.menuX=this.mouseX-(this.menuWidth/2|0),this.menuY=this.mouseY-7,this.showRightClickMenu=!0,this.menuX<0&&(this.menuX=0),this.menuY<0&&(this.menuY=0),this.menuX+this.menuWidth>510&&(this.menuX=510-this.menuWidth),this.menuY+this.menuHeight>315&&(this.menuY=315-this.menuHeight),this.mouseButtonClick=0}}}menuItemClick(t){const e=this.menuItemX[t],i=this.menuItemY[t],s=this.menuIndex[t],r=this.menuSourceIndex[t],n=this.menuTargetIndex[t];switch(this.menuType[t]){case 200:this.walkToGroundItem(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(ls.CAST_GROUNDITEM),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 210:this.walkToGroundItem(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(ls.USEWITH_GROUNDITEM),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 220:this.walkToGroundItem(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(ls.GROUNDITEM_TAKE),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket();break;case 3200:this.showMessage(bs.itemDescription[s],3);break;case 300:this.walkToWallObject(e,i,s),this.packetStream.newPacket(ls.CAST_WALLOBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 310:this.walkToWallObject(e,i,s),this.packetStream.newPacket(ls.USEWITH_WALLOBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 320:this.walkToWallObject(e,i,s),this.packetStream.newPacket(ls.WALL_OBJECT_COMMAND1),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.sendPacket();break;case 2300:this.walkToWallObject(e,i,s),this.packetStream.newPacket(ls.WALL_OBJECT_COMMAND2),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putByte(s),this.packetStream.sendPacket();break;case 3300:this.showMessage(bs.wallObjectDescription[s],3);break;case 400:this.walkToObject(e,i,s,r),this.packetStream.newPacket(ls.CAST_OBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(n),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 410:this.walkToObject(e,i,s,r),this.packetStream.newPacket(ls.USEWITH_OBJECT),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(n),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 420:this.walkToObject(e,i,s,r),this.packetStream.newPacket(ls.OBJECT_CMD1),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.sendPacket();break;case 2400:this.walkToObject(e,i,s,r),this.packetStream.newPacket(ls.OBJECT_CMD2),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.sendPacket();break;case 3400:this.showMessage(bs.objectDescription[s],3);break;case 600:this.packetStream.newPacket(ls.CAST_INVITEM),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 610:this.packetStream.newPacket(ls.USEWITH_INVITEM),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break;case 620:this.packetStream.newPacket(ls.INV_UNEQUIP),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 630:this.packetStream.newPacket(ls.INV_WEAR),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 640:this.packetStream.newPacket(ls.INV_CMD),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 650:this.selectedItemInventoryIndex=s,this.showUITab=0,this.selectedItemName=bs.itemName[this.inventoryItemId[this.selectedItemInventoryIndex]];break;case 660:this.packetStream.newPacket(ls.INV_DROP),this.packetStream.putShort(s),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1,this.showUITab=0,this.showMessage("Dropping "+bs.itemName[this.inventoryItemId[s]],4);break;case 3600:this.showMessage(bs.itemDescription[s],3);break;case 700:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(ls.CAST_NPC),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break}case 710:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(ls.USEWITH_NPC),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break}case 720:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(ls.NPC_TALK),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 725:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(ls.NPC_CMD),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 715:case 2715:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(ls.NPC_ATTACK),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 3700:this.showMessage(bs.npcDescription[s],3);break;case 800:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(ls.CAST_PLAYER),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedSpell=-1;break}case 810:{const t=(e-64)/this.magicLoc|0,n=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,n,!0),this.packetStream.newPacket(ls.USEWITH_PLAYER),this.packetStream.putShort(s),this.packetStream.putShort(r),this.packetStream.sendPacket(),this.selectedItemInventoryIndex=-1;break}case 805:case 2805:{const t=(e-64)/this.magicLoc|0,r=(i-64)/this.magicLoc|0;this._walkToActionSource_from5(this.localRegionX,this.localRegionY,t,r,!0),this.packetStream.newPacket(ls.PLAYER_ATTACK),this.packetStream.putShort(s),this.packetStream.sendPacket();break}case 2806:this.packetStream.newPacket(ls.PLAYER_DUEL),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 2810:this.packetStream.newPacket(ls.PLAYER_TRADE),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 2820:this.packetStream.newPacket(ls.PLAYER_FOLLOW),this.packetStream.putShort(s),this.packetStream.sendPacket();break;case 900:this._walkToActionSource_from5(this.localRegionX,this.localRegionY,e,i,!0),this.packetStream.newPacket(ls.CAST_GROUND),this.packetStream.putShort(e+this.regionX),this.packetStream.putShort(i+this.regionY),this.packetStream.putShort(s),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 920:this._walkToActionSource_from5(this.localRegionX,this.localRegionY,e,i,!1),-24===this.mouseClickXStep&&(this.mouseClickXStep=24);break;case 1e3:this.packetStream.newPacket(ls.CAST_SELF),this.packetStream.putShort(s),this.packetStream.sendPacket(),this.selectedSpell=-1;break;case 4e3:this.selectedItemInventoryIndex=-1,this.selectedSpell=-1}}showLoginScreenStatus(t,e){1===this.loginScreen?this.panelLoginNewUser.updateText(this.controlRegisterStatus,t+" "+e):2===this.loginScreen&&this.panelLoginExistingUser.updateText(this.controlLoginStatus,t+" "+e),this.loginUserDisp=e,this.drawLoginScreens(),this.resetTimings()}async lostConnection(){this.systemUpdate=0,0!==this.logoutTimeout?this.resetLoginVars():await super.lostConnection()}isValidCameraAngle(t){const e=this.localPlayer.currentX/128|0,i=this.localPlayer.currentY/128|0;for(let s=2;s>=1;s--){if(1===t&&(128==(128&this.world.objectAdjacency.get(e,i-s))||128==(128&this.world.objectAdjacency.get(e-s,i))||128==(128&this.world.objectAdjacency.get(e-s,i-s))))return!1;if(3===t&&(128==(128&this.world.objectAdjacency.get(e,i+s))||128==(128&this.world.objectAdjacency.get(e-s,i))||128==(128&this.world.objectAdjacency.get(e-s,i+s))))return!1;if(5===t&&(128==(128&this.world.objectAdjacency.get(e,i+s))||128==(128&this.world.objectAdjacency.get(e+s,i))||128==(128&this.world.objectAdjacency.get(e+s,i+s))))return!1;if(7===t&&(128==(128&this.world.objectAdjacency.get(e,i-s))||128==(128&this.world.objectAdjacency.get(e+s,i))||128==(128&this.world.objectAdjacency.get(e+s,i-s))))return!1;if(0===t&&128==(128&this.world.objectAdjacency.get(e,i-s)))return!1;if(2===t&&128==(128&this.world.objectAdjacency.get(e-s,i)))return!1;if(4===t&&128==(128&this.world.objectAdjacency.get(e,i+s)))return!1;if(6===t&&128==(128&this.world.objectAdjacency.get(e+s,i)))return!1}return!0}resetLoginScreenVariables(){this.loggedIn=0,this.loginScreen=0,this.loginUser="",this.loginPass="",this.loginUserDesc="Please enter a username:",this.loginUserDisp=`*${this.loginUser}*`,this.playerCount=0,this.npcCount=0}handleIncomingPacket(t,e,i){try{const s=this.packetHandlers[t];if(!s)throw new Error("unhandled packet opcode "+t);s(i,e)}catch(Ui){if(console.error(Ui),this.packetErrorCount<3){let r=Ui.stack,n=r.length;this.packetStream.newPacket(ls.PACKET_EXCEPTION),this.packetStream.putShort(n),this.packetStream.putString(r),this.packetStream.putShort(n=(r="p-type: "+t+" p-size:"+e).length),this.packetStream.putString(r),this.packetStream.putShort(n=(r="rx:"+this.localRegionX+" ry:"+this.localRegionY+" num3l:"+this.objectCount).length),this.packetStream.putString(r),r="";for(let t=0;t<80&&t<e;t++)r=r+i[t]+" ";this.packetStream.putShort(r.length),this.packetStream.putString(r),this.packetStream.sendPacket(),this.packetErrorCount++}this.packetStream.closeStream(),this.resetLoginVars()}}createRightClickMenu(){let t=2203-(this.localRegionY+this.planeHeight+this.regionY);this.localRegionX+this.planeWidth+this.regionX>=2640&&(t=-50);let e=-1;for(let n=0;n<this.objectCount;n++)this.objectAlreadyInMenu[n]=!1;for(let n=0;n<this.wallObjectCount;n++)this.wallObjectAlreadyInMenu[n]=!1;let i=this.scene.getMousePickedCount(),s=this.scene.getMousePickedModels(),r=this.scene.getMousePickedFaces();for(let n=0;n<i&&!(this.menuItemsCount>200);n++){let i=r[n],o=s[n];if(o.faceTag[i]<=65535||o.faceTag[i]>=2e5&&o.faceTag[i]<=3e5)if(o===this.scene.view){let e=o.faceTag[i]%1e4;const s=o.faceTag[i]/1e4|0;if(1===s){let i="",s=0;this.localPlayer.level>0&&this.players[e].level>0&&(s=this.localPlayer.level-this.players[e].level),s<0&&(i="@or1@"),s<-3&&(i="@or2@"),s<-6&&(i="@or3@"),s<-9&&(i="@red@"),s>0&&(i="@gr1@"),s>3&&(i="@gr2@"),s>6&&(i="@gr3@"),s>9&&(i="@gre@"),i=" "+i+"(level-"+this.players[e].level+")",this.selectedSpell>=0?1!==bs.spellType[this.selectedSpell]&&2!==bs.spellType[this.selectedSpell]||(this.menuItemText1[this.menuItemsCount]="Cast "+bs.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=800,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=810,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(t>0&&((this.players[e].currentY-64)/this.magicLoc+this.planeHeight+this.regionY|0)<2203?(this.menuItemText1[this.menuItemsCount]="Attack",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=s>=0&&s<5?805:2805,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++):this.members&&(this.menuItemText1[this.menuItemsCount]="Duel with",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuItemX[this.menuItemsCount]=this.players[e].currentX,this.menuItemY[this.menuItemsCount]=this.players[e].currentY,this.menuType[this.menuItemsCount]=2806,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Trade with",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=2810,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++,this.menuItemText1[this.menuItemsCount]="Follow",this.menuItemText2[this.menuItemsCount]="@whi@"+this.players[e].name+i,this.menuType[this.menuItemsCount]=2820,this.menuIndex[this.menuItemsCount]=this.players[e].serverIndex,this.menuItemsCount++)}else if(2===s)this.selectedSpell>=0?3===bs.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+bs.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@lre@"+bs.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=200,this.menuItemX[this.menuItemsCount]=this.groundItemX[e],this.menuItemY[this.menuItemsCount]=this.groundItemY[e],this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@lre@"+bs.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=210,this.menuItemX[this.menuItemsCount]=this.groundItemX[e],this.menuItemY[this.menuItemsCount]=this.groundItemY[e],this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(this.menuItemText1[this.menuItemsCount]="Take",this.menuItemText2[this.menuItemsCount]="@lre@"+bs.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=220,this.menuItemX[this.menuItemsCount]=this.groundItemX[e],this.menuItemY[this.menuItemsCount]=this.groundItemY[e],this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuItemsCount++,this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@lre@"+bs.itemName[this.groundItemID[e]],this.menuType[this.menuItemsCount]=3200,this.menuIndex[this.menuItemsCount]=this.groundItemID[e],this.menuItemsCount++);else if(3===s){let t="",i=-1;const s=this.npcs[e].npcId;if(bs.npcAttackable[s]>0){const e=(bs.npcAttack[s]+bs.npcDefense[s]+bs.npcStrength[s]+bs.npcHits[s])/4|0,r=(this.playerStatBase[0]+this.playerStatBase[1]+this.playerStatBase[2]+this.playerStatBase[3]+27)/4|0;t="@yel@",(i=r-e)<0&&(t="@or1@"),i<-3&&(t="@or2@"),i<-6&&(t="@or3@"),i<-9&&(t="@red@"),i>0&&(t="@gr1@"),i>3&&(t="@gr2@"),i>6&&(t="@gr3@"),i>9&&(t="@gre@"),t=" "+t+"(level-"+e+")"}this.selectedSpell>=0?2===bs.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+bs.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@yel@"+bs.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=700,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@yel@"+bs.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=710,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(bs.npcAttackable[s]>0&&(this.menuItemText1[this.menuItemsCount]="Attack",this.menuItemText2[this.menuItemsCount]="@yel@"+bs.npcName[this.npcs[e].npcId]+t,this.menuType[this.menuItemsCount]=i>=0?715:2715,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Talk-to",this.menuItemText2[this.menuItemsCount]="@yel@"+bs.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=720,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuItemsCount++,""!==bs.npcCommand[s]&&(this.menuItemText1[this.menuItemsCount]=bs.npcCommand[s],this.menuItemText2[this.menuItemsCount]="@yel@"+bs.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=725,this.menuItemX[this.menuItemsCount]=this.npcs[e].currentX,this.menuItemY[this.menuItemsCount]=this.npcs[e].currentY,this.menuIndex[this.menuItemsCount]=this.npcs[e].serverIndex,this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@yel@"+bs.npcName[this.npcs[e].npcId],this.menuType[this.menuItemsCount]=3700,this.menuIndex[this.menuItemsCount]=this.npcs[e].npcId,this.menuItemsCount++)}}else if(null!==o&&o.key>=1e4){const t=o.key-1e4,e=this.wallObjectId[t];this.wallObjectAlreadyInMenu[t]||(this.selectedSpell>=0?4===bs.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+bs.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@cya@"+bs.wallObjectName[e],this.menuType[this.menuItemsCount]=300,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@cya@"+bs.wallObjectName[e],this.menuType[this.menuItemsCount]=310,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(/^WalkTo$/i.test(bs.wallObjectCommand1[e])||(this.menuItemText1[this.menuItemsCount]=bs.wallObjectCommand1[e],this.menuItemText2[this.menuItemsCount]="@cya@"+bs.wallObjectName[e],this.menuType[this.menuItemsCount]=320,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuItemsCount++),/^Examine$/i.test(bs.wallObjectCommand2[e])||(this.menuItemText1[this.menuItemsCount]=bs.wallObjectCommand2[e],this.menuItemText2[this.menuItemsCount]="@cya@"+bs.wallObjectName[e],this.menuType[this.menuItemsCount]=2300,this.menuItemX[this.menuItemsCount]=this.wallObjectX[t],this.menuItemY[this.menuItemsCount]=this.wallObjectY[t],this.menuIndex[this.menuItemsCount]=this.wallObjectDirection[t],this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@cya@"+bs.wallObjectName[e],this.menuType[this.menuItemsCount]=3300,this.menuIndex[this.menuItemsCount]=e,this.menuItemsCount++),this.wallObjectAlreadyInMenu[t]=!0)}else if(null!==o&&o.key>=0){const t=o.key,e=this.objectId[t];this.objectAlreadyInMenu[t]||(this.selectedSpell>=0?5===bs.spellType[this.selectedSpell]&&(this.menuItemText1[this.menuItemsCount]="Cast "+bs.spellName[this.selectedSpell]+" on",this.menuItemText2[this.menuItemsCount]="@cya@"+bs.objectName[e],this.menuType[this.menuItemsCount]=400,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuTargetIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++):this.selectedItemInventoryIndex>=0?(this.menuItemText1[this.menuItemsCount]="Use "+this.selectedItemName+" with",this.menuItemText2[this.menuItemsCount]="@cya@"+bs.objectName[e],this.menuType[this.menuItemsCount]=410,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuTargetIndex[this.menuItemsCount]=this.selectedItemInventoryIndex,this.menuItemsCount++):(/^WalkTo$/i.test(bs.objectCommand1[e])||(this.menuItemText1[this.menuItemsCount]=bs.objectCommand1[e],this.menuItemText2[this.menuItemsCount]="@cya@"+bs.objectName[e],this.menuType[this.menuItemsCount]=420,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuItemsCount++),/^Examine$/i.test(bs.objectCommand2[e])||(this.menuItemText1[this.menuItemsCount]=bs.objectCommand2[e],this.menuItemText2[this.menuItemsCount]="@cya@"+bs.objectName[e],this.menuType[this.menuItemsCount]=2400,this.menuItemX[this.menuItemsCount]=this.objectX[t],this.menuItemY[this.menuItemsCount]=this.objectY[t],this.menuIndex[this.menuItemsCount]=this.objectDirection[t],this.menuSourceIndex[this.menuItemsCount]=this.objectId[t],this.menuItemsCount++),this.menuItemText1[this.menuItemsCount]="Examine",this.menuItemText2[this.menuItemsCount]="@cya@"+bs.objectName[e],this.menuType[this.menuItemsCount]=3400,this.menuIndex[this.menuItemsCount]=e,this.menuItemsCount++),this.objectAlreadyInMenu[t]=!0)}else i>=0&&(i=o.faceTag[i]-2e5),i>=0&&(e=i)}if(this.selectedSpell>=0&&bs.spellType[this.selectedSpell]<=1&&(this.menuItemText1[this.menuItemsCount]="Cast "+bs.spellName[this.selectedSpell]+" on self",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=1e3,this.menuIndex[this.menuItemsCount]=this.selectedSpell,this.menuItemsCount++),-1!==e)if(this.selectedSpell>=0){if(6===bs.spellType[this.selectedSpell])return this.menuItemText1[this.menuItemsCount]="Cast "+bs.spellName[this.selectedSpell]+" on ground",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=900,this.menuItemX[this.menuItemsCount]=this.world.localX[e],this.menuItemY[this.menuItemsCount]=this.world.localY[e],this.menuIndex[this.menuItemsCount]=this.selectedSpell,void this.menuItemsCount++}else this.selectedItemInventoryIndex<0&&(this.menuItemText1[this.menuItemsCount]="Walk here",this.menuItemText2[this.menuItemsCount]="",this.menuType[this.menuItemsCount]=920,this.menuItemX[this.menuItemsCount]=this.world.localX[e],this.menuItemY[this.menuItemsCount]=this.world.localY[e],this.menuItemsCount++)}async handleInputs(){if(!(this.errorLoadingCodebase||this.errorLoadingMemory||this.errorLoadingData))try{if(this.loginTimer++,0===this.loggedIn?(this.mouseActionTimeout=0,await this.handleLoginScreenInput()):1===this.loggedIn&&(this.mouseActionTimeout++,await this.handleGameInput()),this.lastMouseButtonDown=0,this.cameraRotationTime++,this.cameraRotationTime>500){this.cameraRotationTime=0;const t=4*Math.random()|0;1==(1&t)&&(this.cameraRotationX+=this.cameraRotationXIncrement),2==(2&t)&&(this.cameraRotationY+=this.cameraRotationYIncrement)}if(this.cameraRotationX<-50?this.cameraRotationXIncrement=2:this.cameraRotationX>50&&(this.cameraRotationXIncrement=-2),this.cameraRotationY<-50?this.cameraRotationYIncrement=2:this.cameraRotationY>50&&(this.cameraRotationYIncrement=-2),this.messageTabFlashAll>0&&this.messageTabFlashAll--,this.messageTabFlashHistory>0&&this.messageTabFlashHistory--,this.messageTabFlashQuest>0&&this.messageTabFlashQuest--,this.messageTabFlashPrivate>0)return void this.messageTabFlashPrivate--}catch(Ui){console.error(Ui),this.disposeAndCollect(),this.errorLoadingMemory=!0}}async loadMaps(){this.world.mapPack=await this.readDataFile(`maps${$i}.jag`,"map",70),this.members&&(this.world.memberMapPack=await this.readDataFile(`maps${$i}.mem`,"members map",75)),this.world.landscapePack=await this.readDataFile(`land${$i}.jag`,"landscape",80),this.members&&(this.world.memberLandscapePack=await this.readDataFile(`land${$i}.mem`,"members landscape",85))}createModel(t,e,i,s,r){let n=t,o=e,a=t,h=e;const l=bs.wallObjectTextureFront[s],c=bs.wallObjectTextureBack[s],u=bs.wallObjectHeight[s],d=vs._from2(4,1);0===i?a=t+1:1===i?h=e+1:2===i?(n=t+1,h=e+1):3===i&&(a=t+1,h=e+1),n*=this.magicLoc,o*=this.magicLoc,a*=this.magicLoc,h*=this.magicLoc;const m=new Int32Array([d.vertexAt(n,-this.world.getElevation(n,o),o),d.vertexAt(n,-this.world.getElevation(n,o)-u,o),d.vertexAt(a,-this.world.getElevation(a,h)-u,h),d.vertexAt(a,-this.world.getElevation(a,h),h)]);return d.createFace(4,m,l,c),d._setLight_from6(!1,60,24,-50,-10,-50),t>=0&&e>=0&&t<96&&e<96&&this.scene.addModel(d),d.key=r+1e4,d}};if("undefined"==typeof window)throw new Error("rsc-client needs to run in a browser");(async()=>{const t=document.createElement("canvas"),e=window.location.hash.slice(1).split(","),i=new Xr(t);window.mcOptions=i.options,i.options.middleClickCamera=!0,i.options.mouseWheel=!0,i.options.resetCompass=!0,i.options.zoomCamera=!0,i.options.accountManagement=!0,i.members="members"===e[0],i.server=e[1]?e[1]:"127.0.0.1",i.port=e[2]&&!isNaN(+e[2])?+e[2]:43595,i.threadSleep=10,document.body.appendChild(t),await i.startApplication(512,346,"Runescape by Andrew Gower",!1)})()}();